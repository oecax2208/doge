(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[34017],{1652:function(e,t,o){var n={"./onboarding":[78971,78971],"./onboarding/":[78971,78971],"./onboarding/card-content":[52314,52314],"./onboarding/card-content.tsx":[52314,52314],"./onboarding/index":[78971,78971],"./onboarding/index.tsx":[78971,78971],"./onboarding/styles":[81674,81674],"./onboarding/styles.ts":[81674,81674]};function i(e){if(!o.o(n,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],i=t[0];return o.e(t[1]).then((function(){return o(i)}))}i.keys=function(){return Object.keys(n)},i.id=1652,e.exports=i},68737:function(e,t,o){"use strict";o.d(t,{yt:function(){return n},Nf:function(){return i},we:function(){return r},zR:function(){return s}});const n=[{headline:"Lottie animations support",date:"8 Dec 2022",version:"3.0.75",text:["There is now a special Lottie element that you can use to add Lottie files to projects. You can find this new element in the Left panel, in the Elements section.  ","To use the new element, you will need the animation JSON file URL (examples can be found on lottiefiles.com) and add it as a source from the Attributes pane "],image:"lottie.gif "},{headline:"Toggle CSS classes and styles",date:"8 Dec 2022",version:"3.0.75",text:["Toggle individual CSS classes and style properties in the Advanced panel without deleting them to see how an element would look without that class or property. This does not affect previews or deploys. Its function is similar to a browser\u2019s Dev Tools."],image:"toggle_css_classes.gif"},{headline:"Gap property in right panel",date:"8 Dec 2022",version:"3.0.75",text:["The Gap property is now fully featured in the Visual editor, and you can find a dedicated new input in the Inner Layout section in the Right panel. Previously, it could be manually added in the Advanced tab but we did not offer any help with it. "],image:"gap_prop.gif"},{headline:"\u201cExpand/collapse all\u201d button in treeview",date:"8 Dec 2022",version:"3.0.75",text:["There is a new button while hovering container-type elements in the elements tree view in Layers & Files section. ","Use this new button to collapse or expand it and all elements under it. "],image:"expand_collapse.gif "},{headline:"New templates",date:"8 Dec 2022",version:"3.0.75",text:["There are 6 unique new templates that you can use to start projects with. You\u2019ll find them all when you create a new project.","They are all designed for different industries and each of them have a particular style and color palette "],image:"templates.gif "}],i={playgroundTutorials:"https://www.youtube.com/watch?v=stTXPnijYNw&list=PLQQ9KgvzwLU2KCqTu8y2q8KTAuqvsszUx",playgroundDocs:"https://teleporthq.io/docs",playgroundFullReleaseNotes:"https://teleporthq.io/release-notes-latest"},r="v3.0.75",s="project"},64034:function(e,t,o){"use strict";var n=o(73202),i=o(92809),r=o(30773),s=o(49899),a=o(76883),l=(o(67294),o(92763)),c=o(68737),d=o(84073),p=o(85893);const u=e=>{const{releases:t,onDismiss:o}=e;return(0,p.jsxs)("div",{className:"release-notes-modal",children:[(0,p.jsxs)("div",{className:"release-notes-header",children:[(0,p.jsx)("span",{children:"What's new?"}),(0,p.jsx)("div",{onClick:o,children:(0,p.jsx)(l.J,{type:"actions/close",size:12})})]}),(0,p.jsx)("div",{className:"release-notes-content",children:(0,p.jsx)("ul",{className:"releases-list",children:t.map(((e,t)=>(0,p.jsxs)("li",{children:[(0,p.jsx)("p",{className:"section-title",children:e.headline}),(0,p.jsxs)("div",{className:"section-subtitle",children:[(0,p.jsx)("span",{children:e.date})," ","|"," ",(0,p.jsxs)("span",{children:["v",e.version]})]}),(0,p.jsx)("ul",{className:"paragraphs-list",children:e.text.map((e=>(0,p.jsx)("li",{children:e},e)))}),e.video&&(0,p.jsx)("video",{width:"100%",autoPlay:!0,loop:!0,muted:!0,children:(0,p.jsx)("source",{src:`/release-notes/${e.video}`,type:"video/mp4"})}),e.image&&(0,p.jsx)("img",{style:{maxHeight:"350px"},src:`/release-notes/${e.image}`,alt:e.headline})]},t)))})}),(0,p.jsxs)("div",{className:"release-notes-footer",children:[(0,p.jsxs)("a",{href:c.Nf.playgroundFullReleaseNotes,target:"_blank",rel:"noreferrer noopener",children:["View Release Notes",(0,p.jsx)(l.J,{type:"actions/follow-link",size:12})]}),(0,p.jsxs)("a",{href:c.Nf.playgroundDocs,target:"_blank",rel:"noreferrer noopener",children:[(0,p.jsx)(l.J,{type:"docs",size:12}),"Docs"]})]}),(0,p.jsx)("style",{children:d.ET})]})};var h,m,g,y,f,b,w,v,I,S=o(61030),j=o(65989);h=(0,a.JJ)("releaseNotesFlow"),m=(0,a.f3)("userAccountRepository"),g=(0,a.f3)("modalManagementFlow"),y=(0,a.f3)("globalAppState"),h((b=class{constructor(){(0,n.Z)(this,"userAccountRepository",w,this),(0,n.Z)(this,"modalManagementFlow",v,this),(0,n.Z)(this,"globalAppState",I,this),(0,i.Z)(this,"lastSeenVersion",null),(0,i.Z)(this,"updateUserData",(async()=>{const{userData:e}=this.globalAppState.user;e&&((0,s.JG)(this.globalAppState,(({user:e})=>{e&&e.userData&&(e.userData.meta.lastSeenVersion={APP_VERSION:c.we})})),this.lastSeenVersion={APP_VERSION:c.we},this.userAccountRepository.update({meta:e.meta}))})),(0,i.Z)(this,"resetVersion",(()=>{this.lastSeenVersion={APP_VERSION:c.we},this.modalManagementFlow.hideModal()}))}init(e){var t,o;const{userData:n}=this.globalAppState.user;if(n){var i;if(!this.lastSeenVersion)this.lastSeenVersion=(null===(i=n.meta)||void 0===i?void 0:i.lastSeenVersion)||{APP_VERSION:""};if(null!==(t=this.lastSeenVersion)&&void 0!==t&&t.APP_VERSION){if(c.we!==this.lastSeenVersion.APP_VERSION&&null!==n&&void 0!==n&&null!==(o=n.meta)&&void 0!==o&&o.preferences&&!n.isAnonymous&&c.zR===e){this.updateUserData();const e=S.d.createCustomModal({Component:u,onDismiss:this.resetVersion,data:{releases:c.yt}});this.modalManagementFlow.showModal(e,{backgroundColor:j.Pt.DARK_01,padding:0,borderRadius:8})}}else this.updateUserData()}}},w=(0,r.Z)(b.prototype,"userAccountRepository",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v=(0,r.Z)(b.prototype,"modalManagementFlow",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=(0,r.Z)(b.prototype,"globalAppState",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f=b))},75351:function(e,t,o){"use strict";var n,i,r,s,a,l=o(73202),c=o(30773),d=o(76883);n=(0,d.JJ)("uidlDownloadService"),i=(0,d.f3)("sentryService"),n((s=class{constructor(){(0,l.Z)(this,"sentryService",a,this)}async fetchUIDL(e){const t=await fetch(`https://us-central1-croapp-dev.cloudfunctions.net/repl-api/fetch-uidl/${e}`);if(200!==t.status){const e=new Error(t.statusText);throw this.sentryService.captureException(e),e}return(await t.json()).uidl}},a=(0,c.Z)(s.prototype,"sentryService",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r=s))},72536:function(e,t,o){"use strict";var n,i,r,s,a,l=o(73202),c=o(30773),d=o(76883);n=(0,d.JJ)("uidlUploadService"),i=(0,d.f3)("sentryService"),n((s=class{constructor(){(0,l.Z)(this,"sentryService",a,this)}async upload(e,t="component"){const o=await fetch("https://us-central1-croapp-dev.cloudfunctions.net/repl-api/upload-uidl",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({uidl:e,type:t})});if(200!==o.status){const e=new Error(o.statusText);throw this.sentryService.captureException(e),e}return(await o.json()).fileName}},a=(0,c.Z)(s.prototype,"sentryService",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),r=s))},12154:function(e,t,o){"use strict";o.d(t,{F:function(){return n},$:function(){return i}});const n={ADD_PAGE:"Create new page",ADD_COMPONENT:"Create new component",PREVIEW_COMPONENT:"Preview component",PUBLISH_PROJECT:"Publish project",VIEW_CODE:"View generated code",DOWNLOAD_REACT:"Export as React project",DOWNLOAD_ANGULAR:"Export as Angular project",DOWNLOAD_VUE:"Export as Vue project",DOWNLOAD_GATSBY:"Export as Gatsby project",DOWNLOAD_NEXT:"Export as Next project",DOWNLOAD_NUXT:"Export as Nuxt project",DOWNLOAD_GRIDSOME:"Export as Gridsome project",DOWNLOAD_PREACT:"Export as Preact project",DOWNLOAD_STENCIL:"Export as Stencil project",CONTINUE_ON_SANDBOX:"Continue on CodeSandbox",CONTINUE_ON_GITHUB:"Continue on Github",PROJECT_SETTINGS:"Project settings"},i={PRETTIER:"Run Prettier"}},40866:function(e,t,o){"use strict";o.d(t,{b:function(){return n}});const n={NONE:"None",SLIDE_FROM_TOP:"Slide from Top",SLIDE_FROM_LEFT:"Slide from Left",SLIDE_FROM_RIGHT:"Slide from Right"}},81975:function(e,t,o){"use strict";o.d(t,{g:function(){return i},A:function(){return r}});var n=o(30499);let i;!function(e){e.REPLACE_SOURCE="replace",e.REPLACE_POSTER="replace-poster",e.ADD_CHILD="add",e.ADD_SIBLING="add-sibling"}(i||(i={}));const r=e=>{if(!e)return n.TV.add;switch(e){case i.ADD_CHILD:return n.TV.add;case i.ADD_SIBLING:return n.TV["add-sibling"];case i.REPLACE_SOURCE:case i.REPLACE_POSTER:return n.TV.replace;default:return n.TV.add}}},33043:function(e,t,o){"use strict";o.d(t,{b:function(){return r}});var n=o(65988),i=o(85893);const r=e=>{const{title:t,selections:o}=e;return(0,i.jsxs)("div",{title:t,className:"jsx-449592994 file-selection-root",children:[o.map(((e,t)=>(0,i.jsx)("div",{style:{backgroundColor:null===e||void 0===e?void 0:e.color},className:"jsx-449592994 selection-item"},t))),(0,i.jsx)(n.default,{id:"449592994",children:[".file-selection-root.jsx-449592994{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:space-evenly;-webkit-justify-content:space-evenly;-ms-flex-pack:space-evenly;justify-content:space-evenly;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:100%;max-height:25px;width:30px;}",".selection-item.jsx-449592994{height:7px;width:7px;border-radius:50%;}"]})]})}},71712:function(e,t,o){"use strict";o.d(t,{a:function(){return H}});var n=o(92809),i=o(65988),r=o(67294),s=o(49616),a=o(92763),l=o(26470),c=o(65989),d=o(95690),p=o(37659),u=o(69812),h=o(50847),m=o(74031),g=o(33043),y=o(85893);const f=e=>{const{fileSelections:t,path:o,isFolderPath:n=!1}=e,i=t.map(((e,t)=>{var n;if(!(-1!==(null===(n=e.selectedFile)||void 0===n?void 0:n.indexOf(o))))return null;const i=t++%m.q.length;return{selection:e,color:m.q[i]}})).filter(Boolean),r=n?"folder":"file",s=`${i.length} active ${1===i.length?"user":"users"} inside this ${r}`;return(0,y.jsx)(g.b,{title:s,selections:i})},b=[".item-root.jsx-4197989006{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-left:4px;}",".file-details.jsx-4197989006{width:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}",".icon-name-wrapper.jsx-4197989006{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}",".file-name-wrapper.jsx-4197989006{margin-left:6px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;}",".collaborators-selection.jsx-4197989006{width:30px;}",".lock-icon.jsx-4197989006{display:inline-block;margin-left:4px;}",".file-status-wrapper.jsx-4197989006{line-height:1.7;margin-left:2px;}",`.hover-action-item.jsx-4197989006{border-radius:${c.n_.DEFAULT};padding:0 8px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}`,`.hover-action-item.jsx-4197989006:hover{background-color:${c.Pt.LIGHT_01};}`,`.code-file-item:hover{border-color:transparent !important;color:${c.bo.INFO} !important;}`];b.__hash="4197989006";var w=o(72579);const v=e=>{const{files:t,path:o,selectedFilePath:n,selectedFolder:s,fileDragInProgress:d,pathUnderRename:m,collaboratorsSelectedFiles:g,hoverAction:v,onRename:I}=e,{0:S,1:j}=(0,r.useState)(""),D=e=>{if(!e.status)return null;switch(e.status){case w.E.ADDED:return(0,y.jsxs)("span",{style:{color:c.z8.SUCCESS},title:"Added",children:["A"," "]});case w.E.NEW:return(0,y.jsxs)("span",{style:{color:c.z8.SUCCESS},title:"Untracked",children:[" ","U"]});case w.E.MODIFIED:return(0,y.jsxs)("span",{style:{color:c.z8.WARNING_DARK},title:"Modified",children:["M"," "]});case w.E.REMOVED:return(0,y.jsxs)("span",{style:{color:c.z8.DANGER_LIGHT},title:"Deleted",children:["D"," "]});case w.E.STAGED:return null;case w.E.RENAMED:return(0,y.jsxs)("span",{style:{color:c.z8.WARNING_DARK},title:"Renamed",children:["R"," "]});case w.E.CONFLICT:return(0,y.jsx)(a.J,{type:"custom-code/danger",size:16,color:c.z8.WARNING_DARK});case w.E.RESOLVED:return(0,y.jsx)(a.J,{type:"checkmark",size:16,color:c.z8.SUCCESS})}};return(0,y.jsx)(y.Fragment,{children:t.sort(((e,t)=>e.name.localeCompare(t.name))).map(((t,r)=>((t,r)=>{const c=`${t.name}.${t.fileType}`,O=(0,l.join)(o,c),F=!!v&&(S===O||O===n);return e.searchWord&&!t.name.includes(e.searchWord)?null:(0,y.jsxs)("div",{"data-file-id":O,className:`jsx-${b.__hash} item-root`,children:[(0,y.jsx)(p.p,{className:d?"code-file-item":"",selected:n===O&&""===s,itemId:O,dataAttrs:{"data-file-type":t.fileType,"data-drag-file-id":O},displayChecked:!1,refAttrs:{style:{paddingLeft:4,height:28,width:"calc(100% - 30px)"}},onMouseEnter:()=>j(O),onMouseLeave:()=>j(""),children:(0,y.jsxs)("div",{className:`jsx-${b.__hash} file-details`,children:[(0,y.jsxs)("div",{style:{width:t.status?F?"calc(100% - 40px)":"calc(100% - 12px)":"100%"},className:`jsx-${b.__hash} icon-name-wrapper`,children:[u.oy.includes(t.fileType)&&t.content?(0,y.jsx)("img",{loading:"lazy",src:t.content,alt:"playground_asset",width:23,onError:({currentTarget:e})=>{e.src=u.i$},height:23,className:`jsx-${b.__hash}`}):(0,y.jsx)(a.J,{type:(T=t.fileType,`file-type/${T}`),size:14}),(0,y.jsx)("span",{title:c,className:`jsx-${b.__hash} file-name-wrapper`,children:m===O?(0,y.jsx)(h.E,{className:"code-editor-sidebar-input",id:O,initialValue:c||"",selectOnMount:!0,inputSize:"sm",onConfirmChange:I}):(0,y.jsx)("span",{style:(null===t||void 0===t?void 0:t.status)===w.E.REMOVED?{textDecoration:"line-through"}:{},className:`jsx-${b.__hash}`,children:c})}),t.isProtected?(0,y.jsx)("span",{className:`jsx-${b.__hash} lock-icon`,children:(0,y.jsx)(a.J,{type:"lock",size:8})}):null]}),F?(0,y.jsx)("div",{"data-tooltip-name":null===v||void 0===v?void 0:v.title,"data-tooltip-direction":"vertical",onClick:e=>{e.stopPropagation(),null===v||void 0===v||v.action(O)},className:`jsx-${b.__hash} hover-action-item`,children:v?(0,y.jsx)(a.J,{type:null===v||void 0===v?void 0:v.icon,size:8}):null}):null,(0,y.jsx)("div",{className:`jsx-${b.__hash} file-status-wrapper`,children:D(t)})]})}),(0,y.jsx)("div",{className:`jsx-${b.__hash} collaborators-selection`,children:(0,y.jsx)(f,{path:O,fileSelections:g})}),(0,y.jsx)(i.default,{id:b.__hash,children:b})]},r);var T})(t,r)))})};var I,S,j,D,O,F,T=o(73202),N=o(9626),E=o(33800),C=o(30773),x=o(76883),P=o(49899),k=o(45461),M=o(80123);let Z=(I=(0,x.f3)("projectUIState"),S=(0,x.f3)("projectDoc"),F=new WeakMap,j=class extends r.Component{constructor(...e){super(...e),(0,T.Z)(this,"projectUIState",D,this),(0,T.Z)(this,"projectDoc",O,this),F.set(this,{writable:!0,value:[]}),(0,n.Z)(this,"state",{acceptedDropTarget:null,dragInProgress:!1,overForbiddenFolder:!1}),(0,n.Z)(this,"resetState",(()=>{this.setState({acceptedDropTarget:null,dragInProgress:!1,overForbiddenFolder:!1})}))}componentDidMount(){const e=(0,P.Ys)(this.projectUIState,["drag/draggedEntity","dropFlowStates/folder/**"],(e=>{const t=e.dropFlowStates.folder.acceptedDropTarget,o=null===t||void 0===t?void 0:t.dataset.folderId,n=-1!==(null===o||void 0===o?void 0:o.indexOf(k.Xh)),i=-1!==(null===o||void 0===o?void 0:o.indexOf(k.Wn));if(!o)return;const r=e.drag.draggedEntity;if((null===r||void 0===r?void 0:r.type)!==M.Z.FILE||r.content.draggingForbidden)return void this.resetState();const s=r.content.filePath.split("/");s.pop(),o!==s.join("/")?this.setState({acceptedDropTarget:t,dragInProgress:!!r,overForbiddenFolder:n||i}):this.resetState()}),"ColorTokenDropIndicatorWrapper");(0,E.Z)(this,F).push((()=>{e.dispose()}))}componentWillUnmount(){(0,E.Z)(this,F).forEach((e=>e())),(0,N.Z)(this,F,[])}render(){const{folderId:e}=this.props,{acceptedDropTarget:t,overForbiddenFolder:o}=this.state;return t&&t.dataset.folderId===e?(0,y.jsx)("div",{style:{position:"absolute",top:0,bottom:0,left:0,right:0,border:o?"none":`1px solid ${c.X4.DEFAULT}`,background:o?"":"rgba(194, 240, 255, 0.1)",cursor:o?"not-allowed":"default"}}):null}},D=(0,C.Z)(j.prototype,"projectUIState",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O=(0,C.Z)(j.prototype,"projectDoc",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),j);const U=[".thq-select-list-item.jsx-734564102{padding-right:8px;}",".code-folder.jsx-734564102{padding:0 !important;line-height:26px;width:100%;}",`.folder-name-root.jsx-734564102{height:25px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:calc(100% - 30px);border-radius:${c.n_.DEFAULT};border:1px solid transparent;padding-left:4px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}`,`.folder-name-root.selected.jsx-734564102{color:${c.bo.HIGHLIGHT};background-color:${c.Pt.DEFAULT};}`,`.folder-name-root.jsx-734564102:hover{border:1px solid ${c.Pt.LIGHT_02};color:${c.bo.HIGHLIGHT};}`,`.sidebar-title.jsx-734564102{font-size:${c.um.HEADING};color:${c.bo.HIGHLIGHT};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:8px 8px 8px 12px;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;font-weight:${c.Xw.MEDIUM_500};}`,`.right-addon.jsx-734564102{font-size:${c.um.DEFAULT};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding-left:10px;}`,".expand-icon.jsx-734564102{-webkit-transform:rotate(270deg);-ms-transform:rotate(270deg);transform:rotate(270deg);margin-right:4px;}",".folder-name-root.jsx-734564102>.expand-icon.jsx-734564102{line-height:28px;}",`.expanded.jsx-734564102{-webkit-transition:${c.OK.MOVE};transition:${c.OK.MOVE};-webkit-transform-origin:50% 50%;-ms-transform-origin:50% 50%;transform-origin:50% 50%;-webkit-transform:rotate(360deg);-ms-transform:rotate(360deg);transform:rotate(360deg);}`,".code-editor-sidebar-input{padding-left:0 !important;}"];U.__hash="734564102";var A=o(76182),L=o(89361),_=o(10913);function R(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function B(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?R(Object(o),!0).forEach((function(t){(0,n.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):R(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const H=e=>{var t,o;const{files:n,path:p,selectedFilePath:u,selectedFolder:m,pathUnderRename:g,expandedFolders:b={},sidebarTitle:w,collaboratorsSelectedFiles:I,handleRootContextMenu:S,actions:j,meta:D,hoverAction:O}=e,{isRoot:F=!0,fileDragInProgress:T,autoExpandToSelectedFile:N=!1,rootSectionName:E="main",handleFolderExpand:C=!1,canCollapseAll:x}=D,{selectFile:P,onFolderContextMenu:k,onFileContextMenu:M,onAssetsContextMenu:R,onRename:z,expandFolder:$,setPathUnderRename:G,setSelectedFolder:V,setCanCollapseAll:J}=j,{0:W,1:K}=(0,r.useState)(null===(t=e.meta.rootExpanded)||void 0===t||t),{0:Y,1:X}=(0,r.useState)(!!C||(!!F||b[p])),{0:q,1:Q}=(0,r.useState)(!1),{0:ee,1:te}=(0,r.useState)("");(0,r.useEffect)((()=>{var t,o;K(null===(t=null===(o=e.meta)||void 0===o?void 0:o.rootExpanded)||void 0===t||t)}),[e.meta.rootExpanded]),(0,r.useEffect)((()=>{X(!!C||(!!F||!!b[p]))}),[b]),(0,r.useEffect)((()=>{e.searchWord&&X(!0)}),[e.searchWord]),(0,r.useEffect)((()=>{N&&u&&p&&0===u.indexOf(`${p}/`)&&($&&$(p,!0),p.indexOf("/")>-1&&J&&J(!0))}),[N,u,p]),(0,r.useEffect)((()=>{C&&X(!0)}),[C]);const oe=(e,t)=>{t.forEach((t=>{const o=`${e}/${t.name}`;$&&$(o,!0),oe(o,t.subFolders)}))},ne=(0,r.useCallback)((()=>{if(g)return;const e=Object.keys(b).filter((e=>{if(b[e]&&2===e.split("/").length)return!0}));1===e.length&&e[0]===p?J&&J(!1):J&&J(!0),C?X(!Y):$&&$(p,!Y)}),[Y,b,C,p,g]),ie=(0,r.useCallback)((()=>{p&&V&&V(p)}),[p]),re=e=>{te(e)};return(0,y.jsxs)("div",B(B(B({style:B({position:"relative"},F?{height:"100%"}:{}),"data-folder-id":p},F?{"data-project-files":E}:{}),F&&S?{onContextMenu:S}:{}),{},{className:`jsx-${U.__hash} jsx-${A.W.__hash} jsx-${d.W.__hash}`,children:[(0,y.jsx)(Z,{folderId:p}),F&&!!w&&(0,y.jsxs)("div",{className:`jsx-${U.__hash} jsx-${A.W.__hash} jsx-${d.W.__hash} sidebar-title`,children:[(0,y.jsx)("span",{className:`jsx-${U.__hash} jsx-${A.W.__hash} jsx-${d.W.__hash}`,children:w}),(0,y.jsxs)("div",{className:`jsx-${U.__hash} jsx-${A.W.__hash} jsx-${d.W.__hash} right-addon`,children:[q?(0,y.jsx)(_.M,{id:"layers-search",onType:re}):(0,y.jsx)(y.Fragment,{children:(0,y.jsx)(L.z,{title:"Search",style:"transparent",shape:"square",colorScheme:"neutral",onClick:()=>{q&&re(""),Q(!q)},children:(0,y.jsx)(a.J,{type:"search",size:12})})}),"Explorer"===w&&(0,y.jsx)(L.z,{title:x?"Collapse Folders":"Expand Folders",style:"transparent",shape:"square",colorScheme:"neutral",onClick:()=>((e=!0)=>{n&&(e?oe("teleport-project-react",n.subFolders):Object.keys(b).forEach((e=>{$&&$(e,!1)})),J&&J(e))})(!x),children:(0,y.jsx)(a.J,{type:x?"dev-mode/collapse":"dev-mode/expand",size:12})})]})]}),!F&&(0,y.jsxs)("div",{onClick:e=>{e.stopPropagation(),ne()},onContextMenu:e=>{if(e.preventDefault(),p.includes("playground_assets"))return e.stopPropagation(),void(R&&R(e));k&&k(p,e)},className:`jsx-${U.__hash} jsx-${A.W.__hash} jsx-${d.W.__hash} folder-header code-folder`,children:[(0,y.jsxs)("div",{onClick:ie,className:`jsx-${U.__hash} jsx-${A.W.__hash} jsx-${d.W.__hash} folder-name-root`+(m===p?" selected":""),children:[(0,y.jsx)("div",{className:`jsx-${U.__hash} jsx-${A.W.__hash} jsx-${d.W.__hash} expand-icon `+(Y?"expanded":""),children:(0,y.jsx)(a.J,{type:"expand",size:8})}),(0,y.jsx)("div",{className:`jsx-${U.__hash} jsx-${A.W.__hash} jsx-${d.W.__hash} folder-icon`,children:(0,y.jsx)(a.J,{type:Y?"folder-open":"folder",size:16,color:c.bo.INACTIVE})}),g===p?(0,y.jsx)(h.E,{id:p,className:"code-editor-sidebar-input",initialValue:(null===n||void 0===n?void 0:n.name)||"",selectOnMount:!0,inputSize:"sm",onConfirmChange:(e,t)=>{z&&z(e,t,!0)}}):(0,y.jsx)(y.Fragment,{children:null===n||void 0===n?void 0:n.name})]}),!Y&&(0,y.jsx)(f,{isFolderPath:!0,path:p,fileSelections:I})]}),(0,y.jsx)("div",{style:{paddingLeft:F?11:12,display:Y&&null!==n&&void 0!==n&&n.files&&W?"block":"none"},className:`jsx-${U.__hash} jsx-${A.W.__hash} jsx-${d.W.__hash}`,children:(0,y.jsxs)(s.E,{onSelect:(e,t)=>{t&&(t.stopPropagation(),P(e),V&&V(""))},dataAttrs:{"item-type":"page"},noPadding:!0,onContextMenu:(e,t)=>{t.preventDefault(),M&&M(e,t)},onDoubleClick:G,children:[(0,y.jsx)(y.Fragment,{children:null===n||void 0===n||null===(o=n.subFolders)||void 0===o?void 0:o.map(((t,o)=>(0,y.jsx)(H,{files:t,searchWord:ee||e.searchWord,pathUnderRename:g,expandedFolders:b,selectedFilePath:u,selectedFolder:m,collaboratorsSelectedFiles:I,path:(0,l.join)(p,t.name),meta:B(B({},D),{},{rootExpanded:W,isRoot:!1}),actions:j,hoverAction:O},o)))}),(0,y.jsx)(v,{files:(null===n||void 0===n?void 0:n.files)||[],path:p,searchWord:ee||e.searchWord,selectedFilePath:u,selectedFolder:m,pathUnderRename:g,collaboratorsSelectedFiles:I,onRename:(e,t)=>{z&&z(e,t,!1)},fileDragInProgress:T,hoverAction:O})]})}),(0,y.jsx)(i.default,{id:U.__hash,children:U}),(0,y.jsx)(i.default,{id:A.W.__hash,children:A.W}),(0,y.jsx)(i.default,{id:d.W.__hash,children:d.W})]}))}},76182:function(e,t,o){"use strict";o.d(t,{W:function(){return i}});var n=o(65989);const i=[".expand-icon.jsx-3133078631{-webkit-transform:rotate(270deg);-ms-transform:rotate(270deg);transform:rotate(270deg);margin-right:4px;line-height:28px;}",`.expanded.jsx-3133078631{-webkit-transition:${n.OK.MOVE};transition:${n.OK.MOVE};-webkit-transform-origin:50% 50%;-ms-transform-origin:50% 50%;transform-origin:50% 50%;-webkit-transform:rotate(360deg);-ms-transform:rotate(360deg);transform:rotate(360deg);}`];i.__hash="3133078631"},83140:function(e,t,o){"use strict";o.d(t,{x2:function(){return i},Mz:function(){return r},W2:function(){return s}});var n=o(65989);const i="thq-header",r=50,s=[`.${i}.jsx-1524114982{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:${r}px;background:${n.Pt.DEFAULT};border-bottom:2px solid ${n.Pt.DARK_01};-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;position:relative;}`,`.${i}.jsx-1524114982 .pt-btn.transparent{cursor:default;}`,`.${i}.jsx-1524114982 .left-side.jsx-1524114982,.${i}.jsx-1524114982 .middle-side.jsx-1524114982{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}`,`.${i}.jsx-1524114982 .options-right.jsx-1524114982{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:stretch;-webkit-justify-content:stretch;-ms-flex-pack:stretch;justify-content:stretch;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}`,`.peers-list.jsx-1524114982{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;max-width:500px;overflow-x:auto;overflow-y:hidden;padding-right:${n.N_.UNIT};}`,`.peer-icon.jsx-1524114982{width:26px;height:26px;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;background-color:${n.Pt.LIGHT_02};-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:50%;margin-right:-${n.N_.HALF_UNIT};}`,`.text-button.jsx-1524114982{margin:0 ${n.N_.TWO_UNITS};}`,`.code-view-download-container.jsx-1524114982{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:100%;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-right:solid 1px ${n.Pt.DARK_01};border-left:solid 1px ${n.Pt.DARK_01};margin-right:${n.N_.TWO_UNITS};padding:0 ${n.N_.ONE_AND_HALF};}`];s.__hash="1524114982"},23121:function(e,t,o){"use strict";o.d(t,{i:function(){return U},w:function(){return A}});var n,i,r,s,a,l,c,d,p,u,h,m=o(65988),g=o(65989),y=o(67294),f=o(73202),b=o(92809),w=o(9626),v=o(33800),I=o(30773),S=o(76883),j=o(49899),D=o(52085),O=o(77729),F=o(63410),T=o(56516),N=o(80123),E=o(29389),C=o(93510),x=o(72579),P=o(45461),k=o(85893);let M=(n=(0,S.f3)("projectDoc"),i=(0,S.f3)("projectUIState"),r=(0,S.f3)("navbarFlow"),s=(0,S.f3)("absolutePositionedLayerFlow"),u=new WeakMap,h=new WeakMap,a=class extends y.Component{constructor(e){super(e),(0,f.Z)(this,"projectDoc",l,this),(0,f.Z)(this,"projectUIState",c,this),(0,f.Z)(this,"navbarFlow",d,this),(0,f.Z)(this,"absolutePositionedLayerFlow",p,this),u.set(this,{writable:!0,value:[]}),h.set(this,{writable:!0,value:null}),(0,b.Z)(this,"handleDeleteTab",(e=>{this.navbarFlow.deleteTab(e),this.props.isDevMode&&this.props.setHoveredPath&&this.props.setHoveredPath("")})),(0,b.Z)(this,"handleSelectTab",(e=>{this.navbarFlow.selectTab({tabId:e})})),(0,b.Z)(this,"computeTabName",(e=>{var t;if(this.projectUIState.layout.mainPanel!==C.iW.DEV)return null===(t=this.projectDoc.getProjectPageOrComponent(e.entityId))||void 0===t?void 0:t.title;if("git-file"!==e.type&&"staged-file"!==e.type&&"commited-file"!==e.type)return e.entityId.split("/").slice(-1)[0];const o=e.entityId.split("-").slice(-1)[0],n=e.entityId.replace(`-${o}`,"").split("/").slice(-1)[0];if("staged-file"===e.type)return n+"(Staged)";if("commited-file"===e.type)return e.entityId.replace(P.Vf,"").split("/").slice(-1)[0];let i="";switch(o){case x.E.MODIFIED:i="(Working tree) M";break;case x.E.NEW:i="(Untracked) U";break;case x.E.REMOVED:i="(Deleted)"}return n+i})),(0,b.Z)(this,"handleMouseOverTab",(e=>{if(this.props.isDevMode&&this.props.setHoveredPath){const e=this.state.tabData.entityId;this.props.setHoveredPath(e)}const t=this.projectUIState.drag.draggedEntity;(0,v.Z)(this,h)||this.props.isSelected||(null===t||void 0===t?void 0:t.type)!==N.Z.SUB_HIERARCHY||t.content.isNew&&t.content.hierarchyType===N.h.COMPONENT||(0,w.Z)(this,h,setTimeout((()=>{this.handleSelectTab(e),(0,w.Z)(this,h,null)}),E.UQ))})),(0,b.Z)(this,"handleMouseOutOfTab",(()=>{this.props.isDevMode&&this.props.setHoveredPath&&this.props.setHoveredPath(""),(0,v.Z)(this,h)&&(clearTimeout((0,v.Z)(this,h)),(0,w.Z)(this,h,null))})),(0,b.Z)(this,"handleContextMenu",((e,t)=>{t.preventDefault(),t.stopPropagation();const o=Object.keys(this.navbarFlow.getCurrentTabs()),n=this.navbarFlow.getNextTab(e),i=[{label:O.dU.TAB.CLOSE,action:()=>this.navbarFlow.deleteTab(e),disabled:!this.props.isDevMode&&o.length<2},{label:O.dU.TAB.CLOSE_OTHERS,action:()=>this.navbarFlow.deleteOtherTabs(e),disabled:o.length<2},{label:O.dU.TAB.CLOSE_RIGHT,action:()=>this.navbarFlow.deleteTabsToTheRight(e),disabled:!n}];this.props.isDevMode&&i.push({label:O.dU.TAB.CLOSE_ALL,action:()=>this.navbarFlow.deleteAllDevModeTabs(),disabled:!1}),this.absolutePositionedLayerFlow.showContextMenu((0,k.jsx)(T.x,{menuItems:i}),(0,F.FG)(t))})),(0,b.Z)(this,"handleTabDoubleClick",(e=>{this.navbarFlow.getCurrentNewTabId()===e&&this.navbarFlow.saveNewTab()}));const t=this.navbarFlow.getCurrentTabs()[e.id];this.state={tabName:this.computeTabName(t),acceptingDrop:null,isNew:this.navbarFlow.getCurrentNewTabId()===this.props.id,tabData:t}}componentDidMount(){const e=this.state.tabData.entityId;if(this.props.isDevMode){const e=(0,j.Ys)(this.projectUIState,["navbar/devModeTabs/*","navbar/devModeTabs/**"],(()=>{const e=this.navbarFlow.getCurrentTabs()[this.props.id];e&&"file"===e.type&&this.setState({tabData:e,tabName:e.entityId.split("/").slice(-1)[0]}),!e||"git-file"!==e.type&&"staged-file"!==e.type||this.setState({tabData:e,tabName:this.computeTabName(e)})}),"TabWrapper");(0,v.Z)(this,u).push((()=>e.dispose()))}else{const t=(0,j.Ys)(this.projectDoc,[`pages/byId/${e}/title`,`components/byId/${e}/title`],(()=>{var t;this.setState({tabName:null===(t=this.projectDoc.getProjectPageOrComponent(e))||void 0===t?void 0:t.title})}),"TabWrapper2");(0,v.Z)(this,u).push((()=>t.dispose()))}const t=(0,j.Ys)(this.projectUIState,["dropFlowStates/navbar/**"],(({dropFlowStates:{navbar:e}})=>{var t;this.setState({acceptingDrop:(null===(t=e.acceptingTab)||void 0===t?void 0:t.dataset.tabId)===this.props.id?e.dropPosition:null})}),"TabWrapper3"),o=(0,j.Ys)(this.projectUIState,["drag/draggedEntity"],(()=>{(0,v.Z)(this,h)&&(clearTimeout((0,v.Z)(this,h)),(0,w.Z)(this,h,null))}),"TabWrapper4");if(this.props.id===this.navbarFlow.getCurrentNewTabId()){const e=this.props.isDevMode?"navbar/newDevTabId":"navbar/newTabId",t=(0,j.Ys)(this.projectUIState,[e],(()=>{this.setState({isNew:this.props.id===this.navbarFlow.getCurrentNewTabId()})}),"TabWrapper5");(0,v.Z)(this,u).push((()=>t.dispose()));const o=this.projectUIState.devMode.selectedBranch,n=this.props.isDevMode?`projectFiles/local/${o}/byId/**`:"nodes/byId/**",i=(0,j.Ys)(this.projectDoc,[n],((e,t)=>{const o=t.some((e=>{const{pathArray:t}=e;return-1!==t.indexOf("pages")&&3===t.length||-1!==t.indexOf("components")&&3===t.length||-1!==t.indexOf("projectFiles")&&3===t.length}));this.state.isNew&&!o&&(this.navbarFlow.saveNewTab(),this.setState({isNew:!1}))}),"TabWrapper6");(0,v.Z)(this,u).push((()=>i.dispose()))}(0,v.Z)(this,u).push((()=>t.dispose()),(()=>o.dispose()))}componentWillUnmount(){(0,v.Z)(this,u).forEach((e=>e())),(0,w.Z)(this,u,[])}render(){const{type:e,id:t,entityId:o}=this.state.tabData;return(0,k.jsx)(D.OK,{isSelected:this.props.isSelected,type:e,onDelete:this.props.canBeDeleted?this.handleDeleteTab:void 0,onSelect:this.handleSelectTab,content:this.state.tabName||"",id:t,isNew:this.state.isNew,acceptingDrop:this.state.acceptingDrop,entityId:o,onDoubleClick:this.handleTabDoubleClick,onMouseOver:this.handleMouseOverTab,onMouseOut:this.handleMouseOutOfTab,onContextMenu:this.handleContextMenu,isDevMode:this.props.isDevMode})}},l=(0,I.Z)(a.prototype,"projectDoc",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),c=(0,I.Z)(a.prototype,"projectUIState",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d=(0,I.Z)(a.prototype,"navbarFlow",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p=(0,I.Z)(a.prototype,"absolutePositionedLayerFlow",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a);const Z="thq-navbar",U=32,A=e=>{const{tabIds:t=[],onScroll:o,initialScroll:n=0,selectedTab:i,tabWidths:r=[],isDevMode:s,setHoveredPath:a}=e,l=(0,y.useRef)(null),{0:c,1:d}=(0,y.useState)(!1),{0:p,1:u}=(0,y.useState)(0),h=e=>{e.preventDefault(),e.stopPropagation()};return(0,y.useEffect)((()=>{u((e=>e+1))}),[e.tabIds]),(0,y.useEffect)((()=>{setTimeout((()=>{if(!l.current)return;let e=n;const s=t.findIndex((e=>e===i)),a=r.slice(0,s).reduce(((e,t)=>e+t),0);l.current.removeAttribute("style"),d(!0);const c=n+l.current.clientWidth;return(a>c||a<n)&&(e=a),a>c-r[s]&&(e+=r[s]),l.current.scrollTo({left:e}),o(l.current.scrollLeft),"GestureEvent"in window&&(l.current.addEventListener("gesturestart",h),l.current.addEventListener("gesturechange",h),l.current.addEventListener("gestureend",h)),()=>{var e,t,o;null===(e=l.current)||void 0===e||e.removeEventListener("gesturestart",h),null===(t=l.current)||void 0===t||t.removeEventListener("gesturechange",h),null===(o=l.current)||void 0===o||o.removeEventListener("gestureend",h)}}))}),[i,p]),(0,k.jsxs)("div",{className:m.default.dynamic([["4263243734",[Z,U,g.kg.TEN,g.Pt.DARK_01,Z,g.Pt.DARK_02,Z,Z,g.Pt.DARK_01,g.kg.TWENTY,s?"relative":"absolute",s?"0":"-1px",s?"100%":"calc(100% + 1px)",g.Pt.DARK_01,g.kg.TEN]]])+" navbar-wrapper",children:[(0,k.jsx)("div",{ref:l,style:c?void 0:{left:`-${n}px`,width:"1500%"},onWheelCapture:e=>{e.ctrlKey||e.metaKey||(e.stopPropagation(),e.currentTarget.scrollLeft+=(e.deltaY||0)+(e.deltaX||0),o(e.currentTarget.scrollLeft))},id:"thq-navbar",className:m.default.dynamic([["4263243734",[Z,U,g.kg.TEN,g.Pt.DARK_01,Z,g.Pt.DARK_02,Z,Z,g.Pt.DARK_01,g.kg.TWENTY,s?"relative":"absolute",s?"0":"-1px",s?"100%":"calc(100% + 1px)",g.Pt.DARK_01,g.kg.TEN]]])+" thq-navbar"+(s?" dev-mode":""),children:t.map((e=>(0,k.jsx)(M,{canBeDeleted:t.length>1||!!s,isSelected:i===e,id:e,isDevMode:s,setHoveredPath:a},e+p)))}),(0,k.jsx)("div",{className:m.default.dynamic([["4263243734",[Z,U,g.kg.TEN,g.Pt.DARK_01,Z,g.Pt.DARK_02,Z,Z,g.Pt.DARK_01,g.kg.TWENTY,s?"relative":"absolute",s?"0":"-1px",s?"100%":"calc(100% + 1px)",g.Pt.DARK_01,g.kg.TEN]]])+" navbar-addons",children:e.children}),(0,k.jsx)(m.default,{id:"4263243734",dynamic:[Z,U,g.kg.TEN,g.Pt.DARK_01,Z,g.Pt.DARK_02,Z,Z,g.Pt.DARK_01,g.kg.TWENTY,s?"relative":"absolute",s?"0":"-1px",s?"100%":"calc(100% + 1px)",g.Pt.DARK_01,g.kg.TEN],children:[`.thq-navbar.__jsx-style-dynamic-selector{height:${U}px;z-index:${g.kg.TEN};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;overflow:scroll;-webkit-flex:1;-ms-flex:1;flex:1;-webkit-scrollbar-width:none;-moz-scrollbar-width:none;-ms-scrollbar-width:none;scrollbar-width:none;background-color:${g.Pt.DARK_01};}`,`.thq-navbar.__jsx-style-dynamic-selector:not(.dev-mode){border-left:1px solid ${g.Pt.DARK_02};}`,".thq-navbar.dev-mode.__jsx-style-dynamic-selector{height:30px;position:static;width:100%;}",".thq-navbar.__jsx-style-dynamic-selector::-webkit-scrollbar{display:none;}",`.navbar-addons.__jsx-style-dynamic-selector{background:${g.Pt.DARK_01};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;z-index:${g.kg.TWENTY};}`,`.navbar-wrapper.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;position:${s?"relative":"absolute"};top:0;left:${s?"0":"-1px"};width:${s?"100%":"calc(100% + 1px)"};-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;background-color:${g.Pt.DARK_01};border-left:1px solid black;isolation:isolate;z-index:${g.kg.TEN};}`]})]})}},52085:function(e,t,o){"use strict";o.d(t,{d:function(){return d},FL:function(){return p},OK:function(){return u}});var n=o(65988),i=o(45461),r=o(92763),s=o(65989),a=o(67294),l=o(85893);const c="thq-tab",d=181,p=45,u=e=>{const{type:t,content:o,isNew:d,id:p,onDelete:u,isSelected:h,onSelect:m,entityId:g,acceptingDrop:y,onMouseOver:f,onMouseOut:b,onDoubleClick:w,onContextMenu:v,isDevMode:I}=e,S=(0,a.useRef)(null),j=(0,a.useRef)(null);(0,a.useEffect)((()=>{var e,t;if(j.current&&S.current){if((null===(e=S.current)||void 0===e?void 0:e.offsetWidth)<(null===(t=S.current)||void 0===t?void 0:t.scrollWidth))return j.current.dataset.tooltipName=o,void(j.current.dataset.tooltipDirection="vertical");delete j.current.dataset.tooltipName,delete j.current.dataset.tooltipDirection}}),[j.current,o]);return(0,l.jsxs)("div",{ref:j,onClick:()=>m(p),onContextMenu:e=>v(p,e.nativeEvent),onMouseOver:()=>f(p),onMouseOut:b,onDoubleClick:()=>w(p),"data-drag-component-id":"component"===t?g:void 0,"data-drag-page-id":"page"===t?g:void 0,"data-drag-file-id":"file"===t?g:void 0,"data-tab-id":p,className:n.default.dynamic([["1531700386",[c,h?s.Pt.DARK_02:s.Pt.DARK_01,s.Pt.DARK_02,c,c,s.X4.DEFAULT,c,s.X4.DEFAULT,c,h?s.Pt.DARK_02:s.Pt.LIGHT_01,c,h?"600":"400",s.N_.HALF_UNIT,h?s.bo.HIGHLIGHT:s.bo.INACTIVE,c,s.bo.HIGHLIGHT,s.N_.HALF_UNIT,d&&"font-style: italic;",c,s.N_.HALF_UNIT,c,s.Pt.LIGHT_02,s.n_.DEFAULT,c,c,c,s.Pt.DARK_01,c,s.Pt.DARK_02,c,c]]])+" "+`thq-tab${h?" selected":""}${I?" dev-mode":""}`,children:[(0,l.jsxs)("div",{className:n.default.dynamic([["1531700386",[c,h?s.Pt.DARK_02:s.Pt.DARK_01,s.Pt.DARK_02,c,c,s.X4.DEFAULT,c,s.X4.DEFAULT,c,h?s.Pt.DARK_02:s.Pt.LIGHT_01,c,h?"600":"400",s.N_.HALF_UNIT,h?s.bo.HIGHLIGHT:s.bo.INACTIVE,c,s.bo.HIGHLIGHT,s.N_.HALF_UNIT,d&&"font-style: italic;",c,s.N_.HALF_UNIT,c,s.Pt.LIGHT_02,s.n_.DEFAULT,c,c,c,s.Pt.DARK_01,c,s.Pt.DARK_02,c,c]]])+" name-container",children:[(()=>{if("file"===t)return(0,l.jsx)(r.J,{type:`file-type/${g.split(".").slice(-1)[0]}`,size:12});if("git-file"===t||"staged-file"===t){const e=g.split("-").slice(-1)[0],t=g.replace(`-${e}`,"").split("/").slice(-1)[0];return(0,l.jsx)(r.J,{type:`file-type/${t.split(".").slice(-1)[0]}`,size:12})}if("commited-file"===t){const e=g.split("-").slice(-2)[0],t=g.replace(`-${e}${i.Vf}`,"").split("/").slice(-1)[0];return(0,l.jsx)(r.J,{type:`file-type/${t.split(".").slice(-1)[0]}`,size:12})}return"component"===t||"page"===t?(0,l.jsx)(r.J,{type:t,size:12,color:h?s.X4.DEFAULT:void 0}):null})(),(0,l.jsx)("span",{ref:S,className:n.default.dynamic([["1531700386",[c,h?s.Pt.DARK_02:s.Pt.DARK_01,s.Pt.DARK_02,c,c,s.X4.DEFAULT,c,s.X4.DEFAULT,c,h?s.Pt.DARK_02:s.Pt.LIGHT_01,c,h?"600":"400",s.N_.HALF_UNIT,h?s.bo.HIGHLIGHT:s.bo.INACTIVE,c,s.bo.HIGHLIGHT,s.N_.HALF_UNIT,d&&"font-style: italic;",c,s.N_.HALF_UNIT,c,s.Pt.LIGHT_02,s.n_.DEFAULT,c,c,c,s.Pt.DARK_01,c,s.Pt.DARK_02,c,c]]])+" name",children:o})]}),u&&(0,l.jsx)("div",{onClick:()=>u(p),className:n.default.dynamic([["1531700386",[c,h?s.Pt.DARK_02:s.Pt.DARK_01,s.Pt.DARK_02,c,c,s.X4.DEFAULT,c,s.X4.DEFAULT,c,h?s.Pt.DARK_02:s.Pt.LIGHT_01,c,h?"600":"400",s.N_.HALF_UNIT,h?s.bo.HIGHLIGHT:s.bo.INACTIVE,c,s.bo.HIGHLIGHT,s.N_.HALF_UNIT,d&&"font-style: italic;",c,s.N_.HALF_UNIT,c,s.Pt.LIGHT_02,s.n_.DEFAULT,c,c,c,s.Pt.DARK_01,c,s.Pt.DARK_02,c,c]]])+" close",children:(0,l.jsx)(r.J,{type:"actions/close",size:8})}),y&&(0,l.jsx)("div",{className:n.default.dynamic([["1531700386",[c,h?s.Pt.DARK_02:s.Pt.DARK_01,s.Pt.DARK_02,c,c,s.X4.DEFAULT,c,s.X4.DEFAULT,c,h?s.Pt.DARK_02:s.Pt.LIGHT_01,c,h?"600":"400",s.N_.HALF_UNIT,h?s.bo.HIGHLIGHT:s.bo.INACTIVE,c,s.bo.HIGHLIGHT,s.N_.HALF_UNIT,d&&"font-style: italic;",c,s.N_.HALF_UNIT,c,s.Pt.LIGHT_02,s.n_.DEFAULT,c,c,c,s.Pt.DARK_01,c,s.Pt.DARK_02,c,c]]])+" "+`drop-indicator ${y}`}),(0,l.jsx)(n.default,{id:"1531700386",dynamic:[c,h?s.Pt.DARK_02:s.Pt.DARK_01,s.Pt.DARK_02,c,c,s.X4.DEFAULT,c,s.X4.DEFAULT,c,h?s.Pt.DARK_02:s.Pt.LIGHT_01,c,h?"600":"400",s.N_.HALF_UNIT,h?s.bo.HIGHLIGHT:s.bo.INACTIVE,c,s.bo.HIGHLIGHT,s.N_.HALF_UNIT,d&&"font-style: italic;",c,s.N_.HALF_UNIT,c,s.Pt.LIGHT_02,s.n_.DEFAULT,c,c,c,s.Pt.DARK_01,c,s.Pt.DARK_02,c,c],children:[`.thq-tab.__jsx-style-dynamic-selector{position:relative;height:100%;padding:0px 4px;background:${h?s.Pt.DARK_02:s.Pt.DARK_01};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;border-right:1px solid ${s.Pt.DARK_02};}`,".thq-tab.__jsx-style-dynamic-selector .drop-indicator.__jsx-style-dynamic-selector{position:absolute;height:100%;width:100%;left:0;}",`.thq-tab.__jsx-style-dynamic-selector .drop-indicator.before.__jsx-style-dynamic-selector{border-left:2px solid ${s.X4.DEFAULT};}`,`.thq-tab.__jsx-style-dynamic-selector .drop-indicator.after.__jsx-style-dynamic-selector{border-right:2px solid ${s.X4.DEFAULT};}`,`.thq-tab.__jsx-style-dynamic-selector:hover{background:${h?s.Pt.DARK_02:s.Pt.LIGHT_01};}`,`.thq-tab.__jsx-style-dynamic-selector .name-container.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;max-width:156px;font-weight:${h?"600":"400"};padding:0 ${s.N_.HALF_UNIT};color:${h?s.bo.HIGHLIGHT:s.bo.INACTIVE};}`,`.thq-tab.__jsx-style-dynamic-selector:hover .name-container.__jsx-style-dynamic-selector{color:${s.bo.HIGHLIGHT};}`,`.name.__jsx-style-dynamic-selector{padding:${s.N_.HALF_UNIT};padding-right:0;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;${d&&"font-style: italic;"};}`,`.thq-tab.__jsx-style-dynamic-selector .close.__jsx-style-dynamic-selector{padding:2px ${s.N_.HALF_UNIT};opacity:0;}`,`.thq-tab.__jsx-style-dynamic-selector .close.__jsx-style-dynamic-selector:hover{background-color:${s.Pt.LIGHT_02};border-radius:${s.n_.DEFAULT};}`,".thq-tab.__jsx-style-dynamic-selector:hover .close.__jsx-style-dynamic-selector{opacity:1;}",".thq-tab.selected.__jsx-style-dynamic-selector .close.__jsx-style-dynamic-selector{opacity:1;}",`.thq-tab.dev-mode.__jsx-style-dynamic-selector{background:${s.Pt.DARK_01};}`,`.thq-tab.selected.dev-mode.__jsx-style-dynamic-selector{background:${s.Pt.DARK_02};}`,".thq-tab.dev-mode.__jsx-style-dynamic-selector .name-container.__jsx-style-dynamic-selector{color:#8c8c8c;font-weight:400;}",".thq-tab.selected.dev-mode.__jsx-style-dynamic-selector .name-container.__jsx-style-dynamic-selector{color:#dadada;}"]})]})}},56301:function(e,t,o){"use strict";o.d(t,{AS:function(){return g},NN:function(){return y},ms:function(){return f},tx:function(){return b},AM:function(){return w},ML:function(){return v},H:function(){return I},Uz:function(){return S},TU:function(){return j},cq:function(){return D},S3:function(){return O},$x:function(){return F},jV:function(){return T},y9:function(){return N},$p:function(){return E}});var n=o(92809),i=o(65988),r=(o(67294),o(65989)),s=o(88439),a=o(47971),l=o(92763),c=o(69517),d=o(45461),p=o(10440),u=o(85893);function h(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function m(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?h(Object(o),!0).forEach((function(t){(0,n.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):h(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const g=e=>-1!==e.indexOf(d.Xh)||-1!==e.indexOf(d.Wn),y=(e,t,o)=>Math.hypot(t.x-e.x,t.y-e.y)>o,f=(e,t)=>{let o=Number.MAX_VALUE,n=Number.MAX_VALUE,i=Number.MIN_VALUE,r=Number.MIN_VALUE;for(let a=0;a<e.length;a+=1){const t=e[a];if(!t)continue;const{width:s,height:l,top:c,left:d}=t.getBoundingClientRect(),u=(0,p.AO)(t);o=Math.min(o,d*u),n=Math.min(n,c*u),i=Math.max(i,(d+s)*u),r=Math.max(r,(c+l)*u)}const s=t.getBoundingClientRect();return{top:n-s.top,left:o-s.left,width:Math.abs(o-i),height:Math.abs(n-r)}},b=(e,t)=>{let o=Number.POSITIVE_INFINITY,n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY;e.forEach((e=>{const s=t.getDomTargetNode(e.id);if(!s)return;const a=s.getBoundingClientRect(),l=(0,p.AO)(s),{bottom:c,left:d,right:u,top:h}=a;d*l<o&&(o=d*l),h*l<n&&(n=h*l),u*l>i&&(i=u*l),c*l>r&&(r=c*l)}));return{selectionLeft:o,selectionRight:i,selectionTop:n,selectionBottom:r,width:i-o,height:r-n}},w=(e,t)=>(0,u.jsx)("div",{className:i.default.dynamic([["4260233038",[e,t,r.X4.DEFAULT]]])+" drag-indicator-rectangle",children:(0,u.jsx)(i.default,{id:"4260233038",dynamic:[e,t,r.X4.DEFAULT],children:[`.drag-indicator-rectangle.__jsx-style-dynamic-selector{width:${e}px;height:${t}px;position:relative;background-color:rgba(0,0,0,0.1);border-width:1px;border-style:dashed;border-color:${r.X4.DEFAULT};}`]})}),v=e=>{const t=e.split("/"),o=-1!==e.indexOf(d.Xh),n=-1!==e.indexOf(d.Wn),s=!o&&!n,a=t[t.length-1];return(0,u.jsxs)("div",{className:i.default.dynamic([["2984592166",[r.Pt.LIGHT_01,r.N_.HALF_UNIT]]])+" file-drag-indicator-root",children:[s?a:`Cannot drag from or inside ${o?"teleport":"public"} folder`,(0,u.jsx)(i.default,{id:"2984592166",dynamic:[r.Pt.LIGHT_01,r.N_.HALF_UNIT],children:[`.file-drag-indicator-root.__jsx-style-dynamic-selector{background:${r.Pt.LIGHT_01};padding:${r.N_.HALF_UNIT};}`]})]})},I=(e,t)=>(0,u.jsxs)("div",{className:i.default.dynamic([["3847568087",[r.Pt.DARK_02,r.N_.UNIT,r.bo.DEFAULT]]])+" drag-indicator",children:[(0,u.jsx)(l.J,{type:e,size:32}),t&&(0,u.jsx)("span",{className:i.default.dynamic([["3847568087",[r.Pt.DARK_02,r.N_.UNIT,r.bo.DEFAULT]]])+" drag-label",children:t}),(0,u.jsx)(i.default,{id:"3847568087",dynamic:[r.Pt.DARK_02,r.N_.UNIT,r.bo.DEFAULT],children:[`.drag-indicator.__jsx-style-dynamic-selector{min-width:74px;min-height:74px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;background-color:${r.Pt.DARK_02};}`,`.drag-label.__jsx-style-dynamic-selector{margin-top:${r.N_.UNIT};}`,`.drag-indicator.__jsx-style-dynamic-selector svg{fill:${r.bo.DEFAULT};}`]})]}),S=e=>(0,u.jsxs)("div",{className:i.default.dynamic([["3334341047",[e.value,r.E6.DARK_DROP_DOWN,(0,s.lF)(e.value)]]])+" color-token-square",children:[(0,u.jsx)("span",{className:i.default.dynamic([["3334341047",[e.value,r.E6.DARK_DROP_DOWN,(0,s.lF)(e.value)]]])+" token-name",children:e.name}),(0,u.jsx)(i.default,{id:"3334341047",dynamic:[e.value,r.E6.DARK_DROP_DOWN,(0,s.lF)(e.value)],children:[`.color-token-square.__jsx-style-dynamic-selector{width:35px;height:35px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;background-color:${e.value};box-shadow:${r.E6.DARK_DROP_DOWN};border-radius:4px;}`,`.token-name.__jsx-style-dynamic-selector{font-size:11px;font-weight:700;max-width:100;text-overflow:ellipsis;padding:2px;overflow:hidden;color:${(0,s.lF)(e.value)};}`]})]}),j=e=>(0,u.jsxs)("div",{className:i.default.dynamic([["3902667209",[r.N_.UNIT,r.N_.TWO_UNITS,r.Pt.DEFAULT,r.N_.UNIT,r.bo.INACTIVE,r.N_.UNIT]]])+" layout-token-container",children:[(0,u.jsx)("span",{className:i.default.dynamic([["3902667209",[r.N_.UNIT,r.N_.TWO_UNITS,r.Pt.DEFAULT,r.N_.UNIT,r.bo.INACTIVE,r.N_.UNIT]]])+" layout-token-name",children:e.name}),(0,u.jsx)("span",{className:i.default.dynamic([["3902667209",[r.N_.UNIT,r.N_.TWO_UNITS,r.Pt.DEFAULT,r.N_.UNIT,r.bo.INACTIVE,r.N_.UNIT]]])+" layout-token-value",children:e.value}),(0,u.jsx)(i.default,{id:"3902667209",dynamic:[r.N_.UNIT,r.N_.TWO_UNITS,r.Pt.DEFAULT,r.N_.UNIT,r.bo.INACTIVE,r.N_.UNIT],children:[`.layout-token-container.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:${r.N_.UNIT} ${r.N_.TWO_UNITS};width:180px;background-color:${r.Pt.DEFAULT};}`,`.layout-token-name.__jsx-style-dynamic-selector{margin-right:${r.N_.UNIT};width:90px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis;-webkit-flex-shrink:0;-ms-flex-negative:0;flex-shrink:0;}`,`.layout-token-value.__jsx-style-dynamic-selector{text-align:center;color:${r.bo.INACTIVE};margin-left:${r.N_.UNIT};}`]})]}),D=e=>{var t,o,n,s,l,c,d,p;const h=`${null!==(t=null===e||void 0===e||null===(o=e.content.fontSize)||void 0===o?void 0:o.content)&&void 0!==t?t:""}\n    ${null!==(n=null===e||void 0===e||null===(s=e.content.fontFamily)||void 0===s?void 0:s.content)&&void 0!==n?n:""} ${null!==(l=null===e||void 0===e||null===(c=e.content.fontWeight)||void 0===c?void 0:c.content)&&void 0!==l?l:""} ${null!==(d=null===e||void 0===e||null===(p=e.content.fontStyle)||void 0===p?void 0:p.content)&&void 0!==d?d:""}`;return(0,u.jsxs)("div",{className:i.default.dynamic([["916705473",[r.N_.UNIT,r.N_.ONE_AND_HALF,r.Pt.DEFAULT,r.n_.DISCRETE,r.Pt.LIGHT_02,r.n_.DEFAULT,r.N_.UNIT,r.N_.TWO_UNITS,r.um.DEFAULT,r.N_.UNIT,r.Pt.LIGHT_01,r.n_.DEFAULT,r.N_.UNIT,r.um.INFO]]])+" text-style-container",children:[(0,u.jsx)("div",{style:m(m({},(0,a.N)(e.content)),{},{fontSize:"14px",letterSpacing:"normal",color:`${r.bo.INACTIVE}`}),className:i.default.dynamic([["916705473",[r.N_.UNIT,r.N_.ONE_AND_HALF,r.Pt.DEFAULT,r.n_.DISCRETE,r.Pt.LIGHT_02,r.n_.DEFAULT,r.N_.UNIT,r.N_.TWO_UNITS,r.um.DEFAULT,r.N_.UNIT,r.Pt.LIGHT_01,r.n_.DEFAULT,r.N_.UNIT,r.um.INFO]]])+" preview",children:"Aa"}),(0,u.jsxs)("div",{className:i.default.dynamic([["916705473",[r.N_.UNIT,r.N_.ONE_AND_HALF,r.Pt.DEFAULT,r.n_.DISCRETE,r.Pt.LIGHT_02,r.n_.DEFAULT,r.N_.UNIT,r.N_.TWO_UNITS,r.um.DEFAULT,r.N_.UNIT,r.Pt.LIGHT_01,r.n_.DEFAULT,r.N_.UNIT,r.um.INFO]]])+" token-info-container",children:[(0,u.jsxs)("div",{className:i.default.dynamic([["916705473",[r.N_.UNIT,r.N_.ONE_AND_HALF,r.Pt.DEFAULT,r.n_.DISCRETE,r.Pt.LIGHT_02,r.n_.DEFAULT,r.N_.UNIT,r.N_.TWO_UNITS,r.um.DEFAULT,r.N_.UNIT,r.Pt.LIGHT_01,r.n_.DEFAULT,r.N_.UNIT,r.um.INFO]]])+" token-name",children:[(0,u.jsx)("span",{className:i.default.dynamic([["916705473",[r.N_.UNIT,r.N_.ONE_AND_HALF,r.Pt.DEFAULT,r.n_.DISCRETE,r.Pt.LIGHT_02,r.n_.DEFAULT,r.N_.UNIT,r.N_.TWO_UNITS,r.um.DEFAULT,r.N_.UNIT,r.Pt.LIGHT_01,r.n_.DEFAULT,r.N_.UNIT,r.um.INFO]]]),children:e.name})," ",e.role&&(0,u.jsx)("span",{className:i.default.dynamic([["916705473",[r.N_.UNIT,r.N_.ONE_AND_HALF,r.Pt.DEFAULT,r.n_.DISCRETE,r.Pt.LIGHT_02,r.n_.DEFAULT,r.N_.UNIT,r.N_.TWO_UNITS,r.um.DEFAULT,r.N_.UNIT,r.Pt.LIGHT_01,r.n_.DEFAULT,r.N_.UNIT,r.um.INFO]]])+" token-role",children:e.role})]}),(0,u.jsx)("span",{className:i.default.dynamic([["916705473",[r.N_.UNIT,r.N_.ONE_AND_HALF,r.Pt.DEFAULT,r.n_.DISCRETE,r.Pt.LIGHT_02,r.n_.DEFAULT,r.N_.UNIT,r.N_.TWO_UNITS,r.um.DEFAULT,r.N_.UNIT,r.Pt.LIGHT_01,r.n_.DEFAULT,r.N_.UNIT,r.um.INFO]]])+" token-meta",children:h})]}),(0,u.jsx)(i.default,{id:"916705473",dynamic:[r.N_.UNIT,r.N_.ONE_AND_HALF,r.Pt.DEFAULT,r.n_.DISCRETE,r.Pt.LIGHT_02,r.n_.DEFAULT,r.N_.UNIT,r.N_.TWO_UNITS,r.um.DEFAULT,r.N_.UNIT,r.Pt.LIGHT_01,r.n_.DEFAULT,r.N_.UNIT,r.um.INFO],children:[`.text-style-container.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:${r.N_.UNIT} ${r.N_.ONE_AND_HALF};background-color:${r.Pt.DEFAULT};border-radius:${r.n_.DISCRETE};}`,`.preview.__jsx-style-dynamic-selector{border:1px solid ${r.Pt.LIGHT_02};border-radius:${r.n_.DEFAULT};padding:${r.N_.UNIT};margin-right:${r.N_.TWO_UNITS};width:32px;height:32px;text-align:center;text-transform:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}`,".token-info-container.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;position:relative;}",`.token-name.__jsx-style-dynamic-selector{display:-webkit-inline-box;display:-webkit-inline-flex;display:-ms-inline-flexbox;display:inline-flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:${r.um.DEFAULT};}`,`.token-role.__jsx-style-dynamic-selector{padding:0 ${r.N_.UNIT};background-color:${r.Pt.LIGHT_01};border-radius:${r.n_.DEFAULT};margin-left:${r.N_.UNIT};font-size:${r.um.INFO};height:-webkit-fit-content;height:-moz-fit-content;height:fit-content;text-transform:capitalize;}`]})]})},O=(e,t)=>{const{y:o}=e,{top:n,height:i}=t;return o>=n&&o<=n+i?o<n+5?"before":o<n+i/2?"inside-before":o<n+i-5?"inside-after":"after":null},F=(e,t,o,n,i)=>{const{x:r,y:s}=n,a=e.top*i*t+o.top,l=e.left*i*t+o.left,c=e.right*i*t+o.left,d=e.bottom*i*t+o.top,p=r<=c&&r>=l&&s>=a&&s<=d,u=Math.max(l-r,0,r-c),h=Math.max(a-s,0,s-d);return{inside:p,distance:{absolute:Math.hypot(u,h),horizontal:u,vertical:h,left:Math.abs(l-r),right:Math.abs(r-c),bottom:Math.abs(s-d),top:Math.abs(a-s)}}},T=(e,t,o,n,i,r)=>{let s,a=0,{distance:l,inside:c}=F(t[0],o[0],n,e,i);s=t[0];for(let d=1;d<t.length;d+=1){const p=F(t[d],o[d],n,e,i),u=r?"row"===r?"horizontal":"vertical":"absolute";l[u]>p.distance[u]&&(a=d,l=m({},p.distance),c=p.inside,s=t[d])}return{edgeData:{edge:x(t[a],n,e,i),distance:l,inside:c},targetRect:s,targetPointIdx:a}},N=(e,t,o,n,i,r)=>{const{x:s,y:a}=e,{top:l,left:c,right:d,bottom:p,width:u,height:h}=t,m=l*n+o.top,g=c*n+o.left,y=d*n+o.left,f=p*n+o.top,b=u*n,w=h*n;if(b<=i&&w<=r)return"center";const v=b/2,I=w/2,S=[s,a],j=[g,m],D=[g,f],O=[y,m],F=[y,f],T=[g+v,m],N=[g+v,f],E=[g,m+I],C=[y,m+I],x=[g+v,m+I],P=new Map,k=[j,D,O,F,T,N,E,C,x];let M,Z,U=1/0,A=j;for(let L=0;L<k.length;L+=1)M=k[L],Z=Math.hypot(M[0]-S[0],M[1]-S[1]),P.set(M,Z),U>Z&&(A=M,U=Z);switch(A){case j:return b<=i?"top-middle":w<=r?"left-middle":"top-left";case D:return b<=i?"bottom-middle":w<=r?"left-middle":"bottom-left";case O:return b<=i?"top-middle":w<=r?"right-middle":"top-right";case F:return b<=i?"bottom-middle":w<=r?"right-middle":"bottom-right";case T:return"top-middle";case N:return"bottom-middle";case E:return"left-middle";case C:return"right-middle";case x:return"center"}},E=(e,t,o,n)=>{const{x:i,y:r}=e,{top:s,left:a,right:l,bottom:d,width:p,height:u}=t,h=s*n+o.top,m=a*n+o.left,g=l*n+o.left,y=d*n+o.top,f=(0,c.uZ)(u*n/10,8,15),b=(0,c.uZ)(p*n/10,8,15),w=f/2,v=b/2,I={absolute:0,left:0,right:0,top:0,bottom:0,horizontal:0,vertical:0};return h<r&&r+f>y?(I.absolute=r-y,{edge:"bottom",distance:I,inside:!1,shouldDropIntoComputedParent:r+w>y}):h+f>r&&r<y?(I.absolute=h-r,{edge:"top",distance:I,inside:!1,shouldDropIntoComputedParent:h+w>r}):m<i&&i+b>g?(I.absolute=i-g,{edge:"right",distance:I,inside:!1,shouldDropIntoComputedParent:i+v>g}):m+b>i&&i<g?(I.absolute=m-i,{edge:"left",distance:I,inside:!1,shouldDropIntoComputedParent:m+v>i}):null},C=(e,t)=>{const{p1:o,p2:n}=e,i=(0,c.uZ)((n.y-o.y)/(n.x-o.x),-10,10),r=o.y-i*o.x;return t.y<(s=t.x,i*s+r);var s},x=(e,t,o,n)=>{const i=e.top*n+t.top,r=e.left*n+t.left,s=e.right*n+t.left,a=e.bottom*n+t.top,l={x:s,y:i},c={x:r,y:a},d=C({p1:{x:r,y:i},p2:{x:s,y:a}},o),p=C({p1:c,p2:l},o);return d&&p?"top":d&&!p?"right":!d&&p?"left":"bottom"}},14246:function(e,t,o){"use strict";o.d(t,{a:function(){return i}});var n=o(75222);const i=e=>{let t=null;for(const o of e){const e=null===o||void 0===o?void 0:o.primitiveType;!t&&e&&(t=e),t!==e&&(t=n.sO.MIXED)}return t}},80123:function(e,t,o){"use strict";let n,i;o.d(t,{Z:function(){return n},h:function(){return i}}),function(e){e.SUB_HIERARCHY="sub-hierarchy",e.ABSOLUTE_SUB_HIERARCHY="absolute-sub-hierarchy",e.INTERACTIVE_ELEMENT="interactive-element",e.PAGE="page",e.SECTION_TEMPLATE="section-template",e.FILE="file",e.TOKEN="token",e.STYLE="style"}(n||(n={})),function(e){e.EXISTING="existing",e.COMPONENT="component",e.PRIMITIVE="primitive"}(i||(i={}))},63316:function(e,t,o){"use strict";o.d(t,{kg:function(){return r},Yh:function(){return s},ng:function(){return a},cT:function(){return l},Gw:function(){return c},eA:function(){return d}});var n=o(77729),i=o(10440);const r=e=>{const t=`${e}`.replace("--dl-","").split("-");if(2===t.length)return{type:t[0],name:t[1]};if(t.length<2)throw new Error("Could not extract token data from ref");return t.length>3&&(t[2]=t.splice(2).join("-")),{type:t[0],categoryName:t[1],name:t[2]}},s=async e=>{const{Validator:t}=await o.e(78286).then(o.bind(o,78286)),n=new t;try{n.validateProjectSchema(e),n.validateProjectContent(e)}catch(i){throw new Error("Invalid project UIDL")}},a=e=>{const{usedComponents:t={},doc:o}=e;Object.keys(t).forEach((e=>{const n=o.pages.byId[e]||o.components.byId[e];n&&t[e].forEach((e=>{const{nodeId:t,componentName:i}=e,r=Object.keys(o.components.byId).find((e=>{var t;return(null===(t=o.components.byId[e])||void 0===t?void 0:t.title)===i}));if(!r)return;o.components.byId[r].instantiatedByNodes[t]=!0;const s=o.nodes.byId[t];s&&o.nodes.nodeIsCompInstance(s)&&(s.compIdOfCompInstance=r),o.addUsedComponentRelation({toAddComponentId:n.id,linkedComponentId:r})}))}))},l=e=>{const{doc:t,sectionIds:o={}}=e;Object.keys(o).forEach((e=>{const n=t.pages.byId[e]||t.components.byId[e];n&&o[e].forEach((e=>{const{nodeId:t,sectionId:o}=e;n.sectionIds[t]=o}))}))},c=(e,t)=>{t.forEach((t=>{var o,i;const r=e.nodes.byId[t];if(r&&(null===(o=r.abilities)||void 0===o||null===(i=o.link)||void 0===i?void 0:i.type)===n.RZ.NAVLINK){const t=r.abilities.link.content,o=Object.values(e.pages.byId).find((e=>(null===e||void 0===e?void 0:e.title)===t.routeName));if(!o)return;t.routeName=o.id}}))},d=e=>{if(!e)return null;const t=(0,i.EH)("family",e);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null}},39258:function(e,t,o){"use strict";o(95222);var n,i,r,s,a,l,c,d,p,u,h,m,g,y,f,b,w,v,I,S,j,D,O,F,T,N,E,C,x,P,k,M,Z,U,A,L,_,R,B,H=o(8044),z=(o(83141),o(85591),o(64034),o(60136),o(73202)),$=o(92809),G=o(30773),V=o(49899),J=o(76883),W=o(70705),K=o(71919),Y=o(93510),X=o(4509),q=o(74922),Q=o(34437),ee=o(36565),te=o(76263),oe=o(48055);function ne(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function ie(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?ne(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):ne(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}n=(0,J.JJ)("pageManagementFlow"),i=(0,J.f3)("sharedbProjectSyncService"),r=(0,J.f3)("projectDoc"),s=(0,J.f3)("projectUIState"),a=(0,J.f3)("assetsEditFlow"),l=(0,J.f3)("assetsManagementFlow"),c=(0,J.f3)("nodeSelectionFlow"),d=(0,J.f3)("notificationsManagementFlow"),p=(0,J.f3)("layoutManagementFlow"),u=(0,J.f3)("sentryService"),h=(0,J.f3)("navbarFlow"),m=(0,J.f3)("webRTCState"),g=(0,J.f3)("rtcFlow"),y=(0,J.f3)("collaboratorManagementFlow"),f=(0,J.f3)("imageOptimisationFlow"),b=(0,J.f3)("pageSettingsManagementFlow"),w=(0,J.f3)("projectInitFlow"),v=(0,q.G)(te.l.ENTER_RENAME_PAGE),I=(0,q.G)(te.l.CREATE_PAGE),S=(0,q.G)(te.l.DELETE_PAGE),j=(0,q.G)(te.l.DUPLICATE_PAGE),n((O=class{constructor(){(0,z.Z)(this,"dbSync",F,this),(0,z.Z)(this,"projectDoc",T,this),(0,z.Z)(this,"projectUIState",N,this),(0,z.Z)(this,"assetsEditFlow",E,this),(0,z.Z)(this,"assetsManagementFlow",C,this),(0,z.Z)(this,"nodeSelectionFlow",x,this),(0,z.Z)(this,"notificationsManagementFlow",P,this),(0,z.Z)(this,"layoutManagementFlow",k,this),(0,z.Z)(this,"sentryService",M,this),(0,z.Z)(this,"navbarFlow",Z,this),(0,z.Z)(this,"webRTCState",U,this),(0,z.Z)(this,"rtcFlow",A,this),(0,z.Z)(this,"collaboratorManagementFlow",L,this),(0,z.Z)(this,"imageOptimisationFlow",_,this),(0,z.Z)(this,"pageSettingsManagementFlow",R,this),(0,z.Z)(this,"projectInitFlow",B,this)}async commitPage(e){const t=this.projectUIState.pageList.pageUnderLocalWork;t&&(this.renamePage({id:t.id,newName:e}),(0,V.JG)(this.projectUIState,(e=>{e.pageList.pageUnderLocalWork=null})))}async beginEditing(e){const t=this.projectDoc.pages.byId[e||""];e&&t&&(0,V.JG)(this.projectUIState,(e=>{e.pageList.pageUnderLocalWork=(new oe.m).fromJSON(t.toJSON())}))}async createEmptyPage(){const e=this.projectInitFlow.getProjectLimitations();if(Object.keys(this.projectDoc.pages.byId).length>=e.MAX_PAGES_IN_PROJECT)return void this.notificationsManagementFlow.createNotification(K.k.WARNING,"You reached the maximum number of pages allowed in a project.");this.webRTCState.followedUserId&&this.collaboratorManagementFlow.resetFollowedUserId();const t=new oe.m({title:this.projectDoc.getUniqueCompOrPageName("Page"),pos:this.projectDoc.pages.getPositionAfterLast()});this.dbSync.mutate(this.projectDoc,(e=>{e.addPage({page:t,folderId:"pages"})})),this.rtcFlow.notifySelectedComp(t.id),this.navbarFlow.selectOrCreateTabByEntityId(t.id),(0,V.JG)(this.projectUIState,(e=>{e.pageList.pageUnderLocalWork=(new oe.m).fromJSON(t.toJSON())}))}async createHomePage(){this.webRTCState.followedUserId&&this.collaboratorManagementFlow.resetFollowedUserId(),this.dbSync.mutate(this.projectDoc,(e=>{const t=new oe.m({title:"Home",pos:`${Number.MAX_SAFE_INTEGER}`});t.isHomePage=!0,e.addPage({page:t})}))}async deletePage(e){var t;const{doc:o,id:n}=e;if(!o||!n)return;this.webRTCState.followedUserId&&this.collaboratorManagementFlow.resetFollowedUserId(),this.nodeSelectionFlow.resetNodeSelection(),this.imageOptimisationFlow.removeAssetSizeForPageOrComp({id:n}),Object.values(o.nodes.byId).forEach((e=>{var t;const o=null===e||void 0===e||null===(t=e.abilities)||void 0===t?void 0:t.link;"navlink"===(null===o||void 0===o?void 0:o.type)&&o.content.routeName===n&&(null===e||void 0===e||delete e.abilities.link)}));const i=o.pages.byId[n];null!==i&&void 0!==i&&null!==(t=i.settings)&&void 0!==t&&t.socialImage&&this.assetsEditFlow.delete(i.settings.socialImage),o.removePage(n),this.updateUIAfterPageDeletion(n)}updateUIAfterPageDeletion(e){var t;(0,V.JG)(this.projectUIState,(e=>(e.userInteractions.inPreviewMode=!1,e))),this.projectUIState.selection.componentId===e&&this.nodeSelectionFlow.cleanSelectedExpandedAndEditedNodes(),this.navbarFlow.deleteTab((null===(t=this.navbarFlow.getTabByEntityId(e))||void 0===t?void 0:t.id)||"",!0)}async duplicatePage(e){const{id:t}=e,o=this.projectDoc.pages.byId[t];if(o)try{let e=null;if(o.settings.socialImage){const t=this.projectDoc.assets.byId[o.settings.socialImage];e=await this.assetsManagementFlow.duplicateAssets([t])}const n=e?e[0]:null;this.dbSync.mutate(this.projectDoc,(e=>{const o=e.duplicatePage({duplicatedSocialImage:n,doc:e,pageId:t}),i=this.projectDoc.getProjectPageOrComponent(o);if(!i||!i.rootNodeId)return;this.imageOptimisationFlow.getAssetsLinkedToNodes({nodeIds:[i.rootNodeId],withDescendants:!0}).forEach((n=>{const{sizePerComponent:i}=e.assets.byId[n];i&&(i[o]=i[t])}))}))}catch(n){if(n.message===X.N9.MAXIMUM_LIMIT_REACHED||n.message===X.N9.MAXIMUM_SIZE_LIMIT_REACHED)return ee.Z.mixpanelEvent(ee.Z.AnalyticsEvents.WORKSPACE_LIMIT_ASSETS_REACHED),ee.Z.customEvents.workspace.assetsLimitReached(),void this.notificationsManagementFlow.createNotification(K.k.ERROR,n.message);this.sentryService.captureException(n)}}async select(e){if(this.webRTCState.followedUserId&&this.collaboratorManagementFlow.resetFollowedUserId(),e!==this.projectUIState.selection.componentId)this.navbarFlow.selectOrCreateTabByEntityId(e);else{const t=this.projectDoc.getProjectPageOrComponent(e);null!==t&&void 0!==t&&t.rootNodeId&&this.nodeSelectionFlow.setNodeSelection({nodeId:t.rootNodeId})}}async selectNextPage(){const e=this.projectUIState.selection.componentId,t=this.projectDoc.pages.getIdsOrderedByPageName();if(!e||t.length<=1)return;if(!this.projectDoc.pages.byId[e])return;let o=t.indexOf(e)+1;o>=t.length&&(o=0);this.projectUIState.layout.sidebarPanel!==Y.tI.FILES&&this.layoutManagementFlow.changeActiveSidebar(Y.tI.FILES),this.rtcFlow.notifySelectedComp(t[o]),this.navbarFlow.selectOrCreateTabByEntityId(t[o])}async selectPreviousPage(){const e=this.projectUIState.selection.componentId,t=this.projectDoc.pages.getIdsOrderedByPageName();if(!e||t.length<=1)return;if(!this.projectDoc.pages.byId[e])return;let o=t.indexOf(e)-1;o<0&&(o=t.length-1);this.projectUIState.layout.sidebarPanel!==Y.tI.FILES&&this.layoutManagementFlow.changeActiveSidebar(Y.tI.FILES),this.rtcFlow.notifySelectedComp(t[o]),this.navbarFlow.selectOrCreateTabByEntityId(t[o])}setAsHomePage(e){this.dbSync.mutate(this.projectDoc,(t=>{if(this.projectDoc.pages.getFallbackPageId()===e)return void this.notificationsManagementFlow.createNotification(K.k.ERROR,"404 page can't be marked as home");const o=this.projectDoc.pages.getHomePageId();o&&(t.pages.byId[o].isHomePage=!1),t.pages.byId[e].isHomePage=!0}))}setAsFallbackPage(e){this.dbSync.mutate(this.projectDoc,(t=>{if(this.projectDoc.pages.getHomePageId()===e)return void this.notificationsManagementFlow.createNotification(K.k.ERROR,"Home page can't be marked as fallback");const o=this.projectDoc.pages.getFallbackPageId();o&&(t.pages.byId[o].isFallbackPage=!1),t.pages.byId[e].isFallbackPage=!0}))}openSettings(e){this.select(e),(0,V.JG)(this.projectUIState,(e=>{e.previousSelectedPageOrCompId=e.selection.componentId,e.pageList.isSettingsPanelOpen=!0}))}closeSettings(){(0,V.JG)(this.projectUIState,(e=>{e.pageList.isSettingsPanelOpen=!1}))}renamePage(e){var t;const{id:o,newName:n,doc:i}=e;if(!i)return;const r=i.pages.byId[o];if(!r||r.title===n||!n)return;const s=i.getUniqueCompOrPageName(n);r.title=s;let a=!1,l=`/${(0,W.N0)(s)}`;null!==r&&void 0!==r&&null!==(t=r.settings)&&void 0!==t&&t.url||(a=!!this.pageSettingsManagementFlow.getOtherPageWithUrl(l,r.id),a&&(l=(0,W.Zu)(this.pageSettingsManagementFlow.getAllExistingPageUrls(),l),r.settings=ie(ie({},r.settings),{},{url:l})))}},F=(0,G.Z)(O.prototype,"dbSync",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),T=(0,G.Z)(O.prototype,"projectDoc",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N=(0,G.Z)(O.prototype,"projectUIState",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E=(0,G.Z)(O.prototype,"assetsEditFlow",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C=(0,G.Z)(O.prototype,"assetsManagementFlow",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),x=(0,G.Z)(O.prototype,"nodeSelectionFlow",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P=(0,G.Z)(O.prototype,"notificationsManagementFlow",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k=(0,G.Z)(O.prototype,"layoutManagementFlow",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M=(0,G.Z)(O.prototype,"sentryService",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Z=(0,G.Z)(O.prototype,"navbarFlow",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),U=(0,G.Z)(O.prototype,"webRTCState",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A=(0,G.Z)(O.prototype,"rtcFlow",[g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),L=(0,G.Z)(O.prototype,"collaboratorManagementFlow",[y],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_=(0,G.Z)(O.prototype,"imageOptimisationFlow",[f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R=(0,G.Z)(O.prototype,"pageSettingsManagementFlow",[b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B=(0,G.Z)(O.prototype,"projectInitFlow",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(O.prototype,"beginEditing",[v],Object.getOwnPropertyDescriptor(O.prototype,"beginEditing"),O.prototype),(0,G.Z)(O.prototype,"createEmptyPage",[I],Object.getOwnPropertyDescriptor(O.prototype,"createEmptyPage"),O.prototype),(0,G.Z)(O.prototype,"deletePage",[S,Q.P],Object.getOwnPropertyDescriptor(O.prototype,"deletePage"),O.prototype),(0,G.Z)(O.prototype,"duplicatePage",[j],Object.getOwnPropertyDescriptor(O.prototype,"duplicatePage"),O.prototype),(0,G.Z)(O.prototype,"renamePage",[Q.P],Object.getOwnPropertyDescriptor(O.prototype,"renamePage"),O.prototype),D=O));var re,se,ae,le,ce,de,pe,ue,he,me,ge,ye,fe,be=o(44787),we=o(5395),ve=o(23861);function Ie(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Se(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Ie(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}re=(0,J.JJ)("pageSettingsManagementFlow"),se=(0,J.f3)("sharedbProjectSyncService"),ae=(0,J.f3)("projectDoc"),le=(0,J.f3)("projectUIState"),ce=(0,J.f3)("assetsUploadFlow"),de=(0,J.f3)("assetsEditFlow"),re((ue=class{constructor(){(0,z.Z)(this,"dbSync",he,this),(0,z.Z)(this,"projectDoc",me,this),(0,z.Z)(this,"projectUIState",ge,this),(0,z.Z)(this,"assetsUploadFlow",ye,this),(0,z.Z)(this,"assetsEditFlow",fe,this)}updateSettingsByKey(e){const{key:t,value:o}=e,n=this.projectUIState.selection.componentId;if(!n||!this.projectDoc.pages.byId[n])return"";switch(t){case"title":const e=this.projectDoc.pages.byId[n].title;if(o&&o!==e&&"string"===typeof o){if(!!this.pageNameExists(o))return be.lH;this.dbSync.mutate(this.projectDoc,(e=>{e.pages.byId[n].title=o}))}return"";case"url":const i=this.projectDoc.pages.byId[n],r=i.settings.url;if(o&&o!==r&&"string"===typeof o){const e=`/${(0,W.N0)(o)}`,t=this.getOtherPageWithUrl(e,n);if(t)return`${be.qz} This URL is used by page '${t.title}'.`;if("/"===e&&!i.isHomePage)return be.PX;this.dbSync.mutate(this.projectDoc,(t=>{t.pages.byId[n].settings.url=e}))}if(!o&&r){const e=`/${(0,W.N0)(i.title)}`,t=this.getOtherPageWithUrl(e,n);if(t)return`${be.Zu} The URL is used on page '${t.title}'.`;this.dbSync.mutate(this.projectDoc,(e=>{delete e.pages.byId[n].settings.url}))}return"";default:return this.dbSync.mutate(this.projectDoc,(e=>{e.pages.byId[n].settings=Se(Se({},e.pages.byId[n].settings),{},{[t]:o})})),""}}pageNameExists(e){if(!e)throw new Error("Could not check if project name exists. Name was not provided");return this.projectDoc.pages.getIds().some((t=>{var o;return(null===(o=this.projectDoc.pages.byId[t])||void 0===o?void 0:o.title)===e}))}getOtherPageWithUrl(e,t){return Object.values(this.projectDoc.pages.byId).find((o=>{var n;return!(!o||o.id===t)&&(null!==o&&void 0!==o&&null!==(n=o.settings)&&void 0!==n&&n.url?o.settings.url===e:`/${(0,W.N0)(o.title)}`===e)}))}getAllExistingPageUrls(){return Object.values(this.projectDoc.pages.byId).map((e=>{var t;return null!==e&&void 0!==e&&null!==(t=e.settings)&&void 0!==t&&t.url?e.settings.url:null!==e&&void 0!==e&&e.title?`/${(0,W.N0)(null===e||void 0===e?void 0:e.title)}`:""}))}async uploadSocialImage(e){const{files:t,oldAssetId:o}=e,n=await this.assetsUploadFlow.upload({files:t,assetType:we.K.PAGE_OG_IMAGE,parentFolderId:ve.D.ASSETS});return o&&n&&this.assetsEditFlow.delete([o]),n}async deleteSocialImage(e){const t=await this.assetsEditFlow.delete(e),o=this.projectUIState.selection.componentId;return t&&o&&this.dbSync.mutate(this.projectDoc,(e=>{e.pages.byId[o]&&(e.pages.byId[o].settings.socialImage="")})),t}},he=(0,G.Z)(ue.prototype,"dbSync",[se],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),me=(0,G.Z)(ue.prototype,"projectDoc",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ge=(0,G.Z)(ue.prototype,"projectUIState",[le],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ye=(0,G.Z)(ue.prototype,"assetsUploadFlow",[ce],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fe=(0,G.Z)(ue.prototype,"assetsEditFlow",[de],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pe=ue));o(75373);var je,De,Oe,Fe,Te,Ne,Ee,Ce,xe,Pe,ke,Me,Ze,Ue,Ae,Le,_e,Re,Be,He,ze,$e,Ge,Ve,Je,We,Ke,Ye,Xe,qe,Qe,et=o(62256),tt=o(42745),ot=o(55148),nt=o(20493);function it(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function rt(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?it(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):it(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}je=(0,J.JJ)("projectPublishFlow"),De=(0,J.f3)("projectUIState"),Oe=(0,J.f3)("projectDoc"),Fe=(0,J.f3)("globalAppState"),Te=(0,J.f3)("packerService"),Ne=(0,J.f3)("notificationsManagementFlow"),Ee=(0,J.f3)("sentryService"),Ce=(0,J.f3)("projectRepository"),xe=(0,J.f3)("assetsService"),Pe=(0,J.f3)("sharedbProjectSyncService"),ke=(0,J.f3)("tailwindService"),Me=(0,J.f3)("projectDownloadFlow"),Ze=(0,J.f3)("projectFilesFlow"),Ue=(0,J.f3)("workspacesRepository"),Ae=(0,q.G)(te.l.PUBLISH_TO_TELEPORT),Le=(0,q.G)(te.l.PUBLISH_USING_TOKEN),je((Re=class{constructor(){(0,z.Z)(this,"projectUIState",Be,this),(0,z.Z)(this,"projectDoc",He,this),(0,z.Z)(this,"globalAppState",ze,this),(0,z.Z)(this,"packerService",$e,this),(0,z.Z)(this,"notificationsManagementFlow",Ge,this),(0,z.Z)(this,"sentryService",Ve,this),(0,z.Z)(this,"projectRepository",Je,this),(0,z.Z)(this,"assetsService",We,this),(0,z.Z)(this,"dbSync",Ke,this),(0,z.Z)(this,"tailwindService",Ye,this),(0,z.Z)(this,"projectDownloadFlow",Xe,this),(0,z.Z)(this,"projectFilesFlow",qe,this),(0,z.Z)(this,"workspacesRepository",Qe,this),(0,$.Z)(this,"addCustomDomain",(async(e,t)=>{try{return await this.projectRepository.addCustomDomain(this.projectDoc.id,e,t),(0,V.JG)(this.projectUIState,(t=>{t.customDomain=e})),this.dbSync.mutate(this.projectDoc,(e=>{e.stats.validations={domain:!1,redirectDomain:!1}})),!0}catch(o){const e=JSON.parse(o.message);return this.sentryService.captureException(e,{type:nt.U.CRITICAL}),this.notificationsManagementFlow.createNotification(K.k.ERROR,e.error||"Could not add custom domain."),!1}})),(0,$.Z)(this,"removeCustomDomain",(async()=>{try{await this.projectRepository.removeCustomDomain(this.projectDoc.id),this.dbSync.mutate(this.projectDoc,(e=>{e.stats.validations=void 0})),(0,V.JG)(this.projectUIState,(e=>{e.customDomain=""}))}catch(e){const t=JSON.parse(e.message);this.sentryService.captureException(t),this.notificationsManagementFlow.createNotification(K.k.ERROR,t.error||"Could not remove custom domain.")}})),(0,$.Z)(this,"verifyCustomDomain",(async()=>{try{const e=await this.projectRepository.verifyCustomDomain(this.projectDoc.id);this.dbSync.mutate(this.projectDoc,(t=>{t.stats.validations={domain:!!e.response.configVerifiedAt,redirectDomain:!!e.redirectResponse.configVerifiedAt}}))}catch(e){this.sentryService.captureException(e);try{const t=JSON.parse(e.message);if(0===t.error.toLowerCase().indexOf("you don't have access to"))return void this.notificationsManagementFlow.createNotification(K.k.ERROR,`${t.error}. The domain might be owned by another vercel account or team.`)}catch(t){}this.notificationsManagementFlow.createNotification(K.k.ERROR,"Could not verify custom domain.")}})),(0,$.Z)(this,"requestMoreCustomDomains",(async()=>{const{id:e}=this.projectUIState.workspace;try{await this.workspacesRepository.requestMoreCustomDomains(e),this.notificationsManagementFlow.createNotification(K.k.SUCCESS,"We received your request and we will get back to you as soon as possible")}catch(t){if(-1!=(null===t||void 0===t?void 0:t.message.indexOf("was already sent")))return void this.notificationsManagementFlow.createNotification(K.k.WARNING,"A request was already sent. You can only send one at every 24 hours");this.notificationsManagementFlow.createNotification(K.k.ERROR,"Could not request more custom domains")}})),(0,$.Z)(this,"checkCustomDomainLimitReached",(async e=>{try{const{id:t}=this.projectUIState.workspace,o=this.projectUIState.workspace.subscriptionPlanType;if(!o)return!0;return(await this.workspacesRepository.getCustomDomainsCount(t,e)).domainsCount>=ot.cF[o].MAX_CUSTOM_DOMAINS}catch(t){return!0}}))}async getBuildLogs(){try{const{teleport:e,deployUrl:t}=this.projectDoc.stats.deployments||{};if(!t||!e)return null;return this.projectRepository.getBuildLogs(this.projectDoc.id,t)}catch(e){return this.sentryService.captureException(e),null}}async publishToTeleport(e){await this.deployProject({target:Y.Fb.TELEPORT,withCustomDomain:e})}async publishToVercel(){await this.deployProject({target:Y.Fb.VERCEL})}async deployProject(e){const{target:t,withCustomDomain:o}=e;let n,{framework:i}=e||{framework:"nextjs"};(0,V.JG)(this.projectUIState,(({projectPublish:e})=>{e[t].status="pending"}));try{const e=await this.getGRecaptchaToken();if(this.projectUIState.userPreferences.projectExportType===Y.iW.DEV){const e=Object.values(this.projectDoc.assets.byId),t=await this.assetsService.downloadAssets(e,{skipDownload:!0});n=this.projectFilesFlow.getPackedDevProjectFromCurrentBranch(),i="create-react-app",n=this.projectDownloadFlow.mergeProjectWithTemplateForDeplyment(this.projectDownloadFlow.injectLocalAssetsIntoProject(n,t))}else n=await this.projectFilesFlow.getPackedDesignProject({projectType:et.cd.NEXT,includeAnalytics:!0,skipDownload:!0});const s=await this.projectRepository.deploy({projectId:this.projectDoc.id,projectFolder:n,framework:i,isTeleportHosting:t===Y.Fb.TELEPORT,target:o?"production":"staging",gRecaptchaResponse:e});if(s.success){var r;const e=s.payload,o=(null===e||void 0===e?void 0:e.alias[0])||e.url;this.notificationsManagementFlow.createNotification(K.k.SUCCESS,`Your application is ready at: https://${o}`,{duration:1e4});const n=`https://${o}`,i=e.url.split(`${this.projectUIState.slug}-`)[1];this.updateDeployedLink({key:t,url:n,target:t,deployUrl:i}),null!==(r=this.globalAppState.user.userData)&&void 0!==r&&r.meta&&(0,V.JG)(this.globalAppState.user.userData,(({meta:e})=>{e.deployedProjects?e.deployedProjects[this.projectDoc.id]=!0:e.deployedProjects={[this.projectDoc.id]:!0}})),(0,V.JG)(this.projectUIState,(({projectPublish:e})=>{e[t].status="success",e[t].payload=n}))}else this.notificationsManagementFlow.createNotification(K.k.ERROR,s.payload),(0,V.JG)(this.projectUIState,(({projectPublish:e})=>{e[t].status="error"}))}catch(s){if(this.sentryService.captureException(s,{type:nt.U.CRITICAL}),s.message===X.iD.RECAPTCHA_SCORE)return this.notificationsManagementFlow.createNotification(K.k.ERROR,"Security deploy error: Your Recaptcha score is too low. Please try again later."),ee.Z.mixpanelEvent(ee.Z.AnalyticsEvents.PROJECT_PUBLISH_FAILED_RECAPTCHA),void ee.Z.customEvents.project.sidebars.top.publishProject.failed.recaptcha();this.notificationsManagementFlow.createNotification(K.k.ERROR,"An error occurred while publishing your application. Please try again later."),(0,V.JG)(this.projectUIState,(({projectPublish:e})=>{e[t].status="error"}))}}getGRecaptchaToken(){return new Promise(((e,t)=>{window.grecaptcha.ready((()=>{window.grecaptcha.execute(tt.O,{action:"deploy"}).then((t=>e(t))).catch((e=>t(e.message)))}))}))}updateDeployedLink(e){const{doc:t,key:o,url:n,target:i,deployUrl:r}=e;t&&(t.stats.deployments=rt(rt(rt({},t.stats.deployments),r&&{deployUrl:r}),{},{[o]:n,[i===Y.Fb.VERCEL?"vercelLastPublished":"teleportLastPublished"]:(new Date).toISOString()}))}},Be=(0,G.Z)(Re.prototype,"projectUIState",[De],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),He=(0,G.Z)(Re.prototype,"projectDoc",[Oe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ze=(0,G.Z)(Re.prototype,"globalAppState",[Fe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$e=(0,G.Z)(Re.prototype,"packerService",[Te],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ge=(0,G.Z)(Re.prototype,"notificationsManagementFlow",[Ne],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ve=(0,G.Z)(Re.prototype,"sentryService",[Ee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Je=(0,G.Z)(Re.prototype,"projectRepository",[Ce],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),We=(0,G.Z)(Re.prototype,"assetsService",[xe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ke=(0,G.Z)(Re.prototype,"dbSync",[Pe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ye=(0,G.Z)(Re.prototype,"tailwindService",[ke],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xe=(0,G.Z)(Re.prototype,"projectDownloadFlow",[Me],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qe=(0,G.Z)(Re.prototype,"projectFilesFlow",[Ze],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qe=(0,G.Z)(Re.prototype,"workspacesRepository",[Ue],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(Re.prototype,"publishToTeleport",[Ae],Object.getOwnPropertyDescriptor(Re.prototype,"publishToTeleport"),Re.prototype),(0,G.Z)(Re.prototype,"publishToVercel",[Le],Object.getOwnPropertyDescriptor(Re.prototype,"publishToVercel"),Re.prototype),(0,G.Z)(Re.prototype,"updateDeployedLink",[Q.P],Object.getOwnPropertyDescriptor(Re.prototype,"updateDeployedLink"),Re.prototype),_e=Re));var st=o(54131),at=o(26470),lt=o(72045),ct=o(16815),dt=o(75222),pt=o(77729);const ut={[dt.sO.CONTAINER]:"thqContainer",[dt.sO.ICON]:"thqIcon",[dt.sO.IMAGE]:"thqImage",[dt.sO.LINK]:"thqLink",[dt.sO.TEXT]:"thqText",[dt.sO.COMPONENT]:"thqComponent",[dt.RY.HEADING1]:"thqHeading1",[dt.RY.HEADING2]:"thqHeading2",[dt.RY.HEADING3]:"thqHeading3",[dt.RY.HEADING4]:"thqHeading4",[dt.RY.HEADING5]:"thqHeading5",[dt.RY.HEADING6]:"thqHeading6"};var ht=o(68768),mt=o(10440),gt=o(63639),yt=o(13723),ft=o(88439),bt=o(55572);function wt(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function vt(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?wt(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):wt(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const It=[et.cd.ANGULAR,et.cd.VUE,et.cd.HTML,et.cd.NUXT,et.cd.HTML,et.cd.GRIDSOME],St=["autoplay","background","controls","direction","hover","keepLastFrame","intermission","mode","renderer","speed","loop","src"],jt=(e,t)=>{const o=Object.values(t.byId||{}).find((t=>(null===t||void 0===t?void 0:t.id)===e));if(!o)throw new Error(`Component that the node is referring to is missing - ${e}`);return o.title},Dt=(e,t)=>Object.keys(e).find((o=>e[o].id===t)),Ot=(e,t)=>{const{attrs:o,devComponentPath:n}=e;if(!n)throw new Error(`Path for dev-component is missing - ${e.id}`);const i=(0,at.parse)(n);return vt(vt({elementType:dt.sO.COMPONENT,semanticType:e.name},t.length>0&&{name:t}),{},{dependency:{type:"library",version:"0.0.0",path:(0,at.relative)("teleport-project-react/src/pages/index.tsx",`${i.dir}/${i.name}`)},attrs:Object.keys(o).reduce(((e,t)=>t.length?(e[t]=o[t].toUIDL(),e):e),{})})},Ft=(e,t,o)=>{const n=Nt(e.html||"",t);return vt(vt({},o),{},{semanticType:void 0,children:[],attrs:vt(vt({},o.attrs),{},{html:{type:"raw",content:n}})})},Tt=(e,t)=>({id:e,type:"style-map",content:{mapType:"project-referenced",referenceId:t}}),Nt=(e,t)=>{let o=e;return t&&!It.includes(t)&&(o=o.replaceAll("`","\\`").replaceAll("$","\\$")),t&&It.includes(t)&&(o=o.replaceAll('"',"'")),o},Et=(e,t,o)=>{const{primitiveType:n,attrs:i={}}=e;return Object.keys(i||{}).length>0?vt({},Object.keys(i||{}).reduce(((e,r)=>{if(!r.length)return e;const s=i[r];if(!s)return e;const a=s.toUIDL();if("dynamic"===a.type&&"dynamic"==s.type&&"prop"===s.content.referenceType){const e=Dt(t,s.content.id);if(!e)throw new Error(`Referenced prop is missing from propDefinitions - ${s.content.id}`);a.content.id=e}return n&&-1!==[dt.sO.IMAGE,dt.sO.VIDEO,dt.sO.COMPONENT].indexOf(n)&&(null===o||void 0===o||o.forEach((e=>{"string"===typeof a.content&&-1!==a.content.indexOf(e.id)&&(a.content=e.localPath)}))),e[r]=a,e}),{})):void 0},Ct=e=>Object.keys(e||{}).length>0?vt({},Object.keys(e||{}).reduce(((t,o)=>{const n=Object.values(e[o]);if(!n)return t;const i=n.map((e=>{switch(e.type){case"propCall":return{calls:e.calls,type:e.type,args:e.args};case"stateChange":return{modifies:e.modifies,type:e.type,newState:e.newState}}}));return i&&(t[o]=i),t}),{})):void 0,xt=(e,t,o)=>{const{abilities:n}=e;return Object.keys(n).reduce(((e,i)=>{const r=JSON.parse(JSON.stringify(n[i]));switch(r.type){case pt.RZ.NAVLINK:e[i]=n[i].toUIDL(t);break;case pt.RZ.SECTION:e[i]=r;break;case pt.RZ.URL:const s=r.content;if("string"===typeof s.url){e[i]={type:"url",content:{url:{type:"static",content:s.url},newTab:!(null===s||void 0===s||!s.newTab)}};break}const a=Dt(o,s.url.content.id);s.url.content.id=a,e[i]=r;break;case pt.RZ.PHONE:const l=r.content;if("string"===typeof l.phone){e[i]=r;break}const c=Dt(o,l.phone.content.id);l.phone.content.id=c,e[i]=r;break;case pt.RZ.MAIL:const d=r.content,{mail:p,subject:u}=d;if("string"===typeof p&&"string"===typeof u){e[i]=r;break}if("string"!==typeof p){const e=Dt(o,d.mail.content.id);d.mail.content.id=e}else r.content.mail=p;if(u&&"string"!==typeof u){const e=Dt(o,d.subject.content.id);d.subject.content.id=e}else r.content.subject=u||"";e[i]=r;break;default:e[i]=r}return e}),{})},Pt=(e,t)=>{const{contentChildren:o}=e;return o?Object.keys(o||{}).reduce(((e,n)=>{const i=o[n];if("static"===i.type&&i.content&&i.content.toString().length>0){const t="string"===typeof i.content?i.content.replace(ht.$m,""):i.content;e.push({type:"static",content:t}),"string"===typeof t&&" "===t[t.length-1]&&e.push({type:"raw",content:" "})}if("dynamic"===i.type){const o=Dt(t,i.content.id);e.push({type:"dynamic",content:vt(vt({},i.content),{},{id:o})})}return e}),[]):[]},kt=(e,t,o,n)=>{var i,r;const{referencedStyles:s,primitiveType:a}=e;let l={};if(null!==(i=t.settings.experimentalFeatures)&&void 0!==i&&i.tailwindCSS&&Object.keys(t.tailwindCSS.getTailwindClassesForNode(e.id)).length>0){const o=Object.values(t.tailwindCSS.getTailwindClassesForNode(e.id)).join(" "),n=(0,lt.Z)();l[n]={type:"style-map",content:{mapType:"component-referenced",content:{type:"static",content:o}}}}Object.keys(ct.F).forEach((e=>{const t=Object.values(s||{}).find((t=>"inlined"===t.content.mapType&&t.content.conditions.length&&"element-state"===t.content.conditions[0].conditionType&&t.content.conditions[0].content===e));t&&(l[t.id]=(0,yt.$)(t,n))})),Object.values(s||{}).forEach((e=>{var o;if("design-language-referenced"===e.content.mapType){const o=t.designLanguage.textStyleSetsById[e.content.referenceId];if(!o)return;l[e.id]={type:"style-map",content:{mapType:"project-referenced",referenceId:(0,ft.hN)(o.name)}}}if("project-referenced"===e.content.mapType){const o=t.classes.byId[e.content.referenceId];if(!o)return;null!==o&&void 0!==o&&o.linkedTextStyles&&Object.keys(o.linkedTextStyles).forEach((e=>{const o=t.designLanguage.textStyleSetsById[e];if(!o)return;const n=Tt((0,lt.Z)(),(0,ft.hN)(o.name));l[n.id]=n}));const n=Tt(e.id,o.name);l[n.id]=n}if("inlined"===e.content.mapType&&e.content.conditions&&(null===(o=e.content)||void 0===o?void 0:o.conditions.length)>0&&"screen-size"===e.content.conditions[0].conditionType&&(l[e.id]=(0,yt.$)(e,n)),"component-referenced"===e.content.mapType){let t={};t="static"===e.content.content.type?{type:"static",content:e.content.content.content}:{type:"dynamic",content:{referenceType:e.content.content.content.referenceType,id:gt.Q}},l[e.id]={type:"style-map",content:{mapType:"component-referenced",content:vt({},t)}}}}));const c=Object.keys(o||{}).find((e=>e===ut[a]));if(c){const e=(0,lt.Z)();l=vt(vt({},l),{},{[e]:{type:"style-map",content:{mapType:"project-referenced",referenceId:c}}})}const d=Object.keys(o||{}).find((e=>"thqLink"===e));if(null!==(r=e.abilities)&&void 0!==r&&r.link&&d){const e=(0,lt.Z)();l=vt(vt({},l),{},{[e]:{type:"style-map",content:{mapType:"project-referenced",referenceId:d}}})}return l},Mt=(e,t)=>{let o=e.attrs||{};const n=vt(vt({},e),{},{semanticType:void 0,children:[],attrs:vt({},o)});if(t===et.cd.NEXT){const t=Object.keys(o).reduce(((e,t)=>(St.includes(t)||(e[t]=o[t],delete o[t]),e)),{});n.style={},n.referencedStyles={};return{type:"element",content:vt(vt({},e),{},{attrs:t,elementType:"div",semanticType:"div",children:[{type:"element",content:n}]})}.content}return t!==et.cd.VUE&&t!==et.cd.NUXT||(o=Object.keys(o).reduce(((e,t)=>{if(St.includes(t)){let n=o[t].content;"src"===t&&(n=`\`${n}\``),"background"===t&&(t="backgroundColor"),e[t]={type:"dynamic",content:{referenceType:"local",id:n===bt.j?"true":n}}}else e[t]=o[t];return e}),{}),n.attrs=o),n};var Zt=o(47361);function Ut(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function At(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Ut(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Ut(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const Lt=e=>{const{component:t,doc:o,options:n,projectType:i,defaultElementStyles:r,assetSrcMapping:s,compTitle:a}=e;if(!t.rootNodeId)throw new Error(`Expected a rootNodeId but did not find one for component "${t.id}"`);const l=t instanceof Zt.n?Bt(t.propDefinitions,s):{},c=t instanceof Zt.n?Ht(t.stateDefinitions):{},d=_t({doc:o,propDefinitions:l,stateDefinitions:c,defaultElementStyles:r,assetSrcMapping:s,projectType:i,nodeId:t.rootNodeId,options:n});if(!d)throw new Error(`The node hierarchy for "${t.id}" is invalid`);if("conditional"===d.type)throw new Error("Root node of the UIDL hierarchy can't be of type conditional");const p=Rt(t.styleSetDefinitions||{},s);return{propDefinitions:l,stateDefinitions:c,node:d,name:a||t.title,styleSetDefinitions:p}},_t=e=>{var t;const{nodeId:o,doc:n,propDefinitions:i,stateDefinitions:r,defaultElementStyles:s,assetSrcMapping:a,options:l,projectType:c}=e,{skipDevModeWidgets:d}=l,p=n.nodes.byId[o],u=n.nodes.orderChildrenIds(Object.keys(p.childrenIds||{}));if(p.devComponentPath&&d)return{type:"element",content:{elementType:"container",children:[{type:"static",content:`Placeholder for widget ${(0,at.parse)(p.devComponentPath).name}`}]}};if(p.primitiveType===dt.sO.COMPONENT){const e=n.getSlotNodesForComp(p.compIdOfCompInstance);if(e.length>1)throw new Error("Multiple slots in a component is not yet supported!");e.length&&u.push(...n.nodes.orderChildrenIds(Object.keys(p.slottedNodes[e[0].id]||{})))}const h=u.map((e=>{const t=n.nodes.byId[e];return(null===t||void 0===t?void 0:t.primitiveType)===dt.sO.SLOT?{type:"slot",content:{}}:_t({nodeId:e,doc:n,propDefinitions:i,stateDefinitions:r,defaultElementStyles:s,assetSrcMapping:a,options:l,projectType:c})})),m=((e,t,o,n,i,r)=>{const{semanticType:s,primitiveType:a,styles:l={},name:c}=e;let d;const p=kt(e,n,o,r),u=(0,mt.dE)(c||"");if(a===dt.sO.DEV_COMPONENT)return Ot(e,u);const h=Et(e,t,r),m=Pt(e,t),g=Ct(e.events),y=xt(e,n,t);return d=vt(vt(vt(vt({elementType:a},a===dt.sO.COMPONENT&&{dependency:{type:"local"}}),{},{semanticType:s||void 0},c&&(null===c||void 0===c?void 0:c.length)>0&&{name:u}),{},{referencedStyles:p,abilities:y,attrs:h},Object.keys(l||{}).length>0&&{style:(0,yt.q)(l,r)}),{},{children:m,events:g}),n.nodes.nodeIsCompInstance(e)?(d=vt(vt({},d),{},{semanticType:jt(e.compIdOfCompInstance,n.components)}),d):a===dt.sO.HTML_NODE?Ft(e,i,d):a===dt.sO.LOTTIE?Mt(d,i):d})(p,i,s,n,c,null===a||void 0===a?void 0:a[o]);if(p.renderingConditions){var g;const{renderingConditions:e}=p,{reference:t,value:o,condition:n}=e;return{type:"conditional",content:{node:{type:"element",content:At(At({},m),{},{children:[...h,...null!==(g=m.children)&&void 0!==g?g:[]]})},reference:t,value:o,condition:n}}}return{type:"element",content:At(At({},m),{},{children:[...h,...null!==(t=m.children)&&void 0!==t?t:[]]})}},Rt=(e,t)=>Object.keys(e).reduce(((o,n)=>{const i=e[n],r=[];Object.keys(i.usedByInstances||{}).forEach((e=>{const o=null===t||void 0===t?void 0:t[e];o&&r.push(...o)}));const s=Object.values(i.referencedStyles).reduce(((e,t)=>{if("inlined"!==t.content.mapType)return e;const o=t.content.conditions[0];if("screen-size"!==o.conditionType)return e;const{maxHeight:n,maxWidth:i,minHeight:s,minWidth:a}=o;return e.push({type:o.conditionType,content:(0,yt.q)(t.content.styles,r),meta:{maxWidth:i||0,maxHeight:n,minHeight:s,minWidth:a}}),e}),[]);return o[n]={content:(0,yt.q)(i.styles,r),conditions:s,type:"reusable-component-style-override"},o}),{}),Bt=(e,t)=>Object.keys(e).reduce(((o,n)=>{const i=e[n];let r=i.defaultValue;return t&&Object.keys(i.locations).forEach((e=>{var o;null===(o=t[e])||void 0===o||o.forEach((e=>{-1!==r.indexOf(e.id)&&(r=e.localPath)}))})),o[i.name]={id:i.id,defaultValue:r,type:i.type},o}),{}),Ht=e=>Object.keys(e).reduce(((t,o)=>{const n=e[o];return t[n.name]={id:n.id,defaultValue:n.defaultValue,type:n.type},t}),{});var zt=o(27726),$t=o(49403);function Gt(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Vt(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Gt(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Gt(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const Jt=e=>{var t,o;const{title:n,slug:i,projectType:r,assetSrcMapping:s,options:a}=e;let{doc:l}=e;const c=[],d=[],p=new H.n;p.fromJSON(l.toJSON()),l=p,Object.values(l.components.byId).forEach((e=>{if(!e)return;const t=(0,W.Zu)(c,(0,mt.dE)(null===e||void 0===e?void 0:e.title)||"Component");c.push(t),e.title=t})),Object.values(l.pages.byId).forEach((e=>{if(!e)return;const t=(0,W.Zu)(d,(0,mt.dE)(null===e||void 0===e?void 0:e.title)||"Page");d.push(t),e.title=t}));const u=(null===a||void 0===a?void 0:a.skipDevModeWidgets)||!1,h=l.pages.getIds(),m=l.components.getIds(),g=l.pages.getHomePageId(),y=g&&null!==(t=null===(o=l.pages.byId[g])||void 0===o?void 0:o.title)&&void 0!==t?t:"index",f=Object.values(l.designLanguage.getTokensAsCustomProperties()||{}).reduce(((e,t)=>(e[t.name]={type:"static",content:t.value},e)),{});return{name:n,globals:Kt(n,l,r,a),root:Vt(Vt({name:"App"},Object.values(f).length>0&&{designLanguage:{tokens:f}}),{},{styleSetDefinitions:Vt(Vt({},l.classes.toUIDL(s)),l.designLanguage.textStylesToUIDL()),stateDefinitions:{route:{type:"string",defaultValue:y,values:h.map((e=>Yt(n,i,e,l)))}},node:{type:"element",content:{elementType:"Router",children:h.map((e=>Wt(e,l,{skipDevModeWidgets:u},{},r,s)))}}}),components:m.reduce(((e,t)=>{const o=l.components.byId[t];if(!o)throw new Error(`domainProjectToUIDL iterated over a componentId '${t}' that does not exist in the current project`);return e[o.title]=Lt({component:o,doc:l,options:{skipDevModeWidgets:u},projectType:r,defaultElementStyles:{},assetSrcMapping:s}),e}),{})}},Wt=(e,t,o,n,i,r)=>{const s=t.pages.byId[e];if(!s)throw new Error(`domainPageToUIDL received a pageId '${e}' that does not exist in the current project`);const a=Lt({component:s,doc:t,options:o,projectType:i,defaultElementStyles:n,assetSrcMapping:r});return a.node.content.style=a.node.content.style||{},a.node.content.style.minHeight={type:"static",content:"100vh"},{type:"conditional",content:{node:a.node,value:s.title,reference:{type:"dynamic",content:{referenceType:"state",id:"route"}}}}},Kt=(e,t,o,n)=>{var i,r,s,a,l,c,d;const{settings:p}=t,u={settings:{title:(null===(i=p.general)||void 0===i?void 0:i.title)||e,language:(null===(r=p.general)||void 0===r?void 0:r.language)||"en"},assets:[],meta:[{name:"viewport",content:"width=device-width, initial-scale=1.0"},{charSet:"utf-8"},{property:"twitter:card",content:"summary_large_image"}]};if(null===n||void 0===n||!n.disableResetCSS){const e=(0,$t.w0)(t.designLanguage);u.assets.push({type:"style",attrs:{"data-tag":{type:"static",content:"reset-style-sheet"}},content:[...(0,zt.D)().split("\n"),"html { scroll-behavior: smooth  }"].join("")},{type:"style",attrs:{"data-tag":{type:"static",content:"default-style-sheet"}},content:(0,$t.lf)(e)})}if(!p)return u;if(null!==(s=p.general)&&void 0!==s&&s.favicon){var h;const e=t.assets.byId[null===(h=p.general)||void 0===h?void 0:h.favicon];var m;if(e)null===(m=u.assets)||void 0===m||m.push({type:"icon",path:e.imageSrc,options:{iconType:"icon/png",iconSizes:"32x32"}})}var g,y,f,b;(Object.values(t.fonts.byId||{}).forEach((e=>{var t;null===(t=u.assets)||void 0===t||t.push(Vt({type:"font",path:(null===e||void 0===e?void 0:e.path)||""},(null===e||void 0===e?void 0:e.name)&&{attrs:{"data-tag":{type:"static",content:"font"}}}))})),null!==(a=p.code)&&void 0!==a&&a.googleAnalyticsId)&&(null===(g=u.assets)||void 0===g||g.push({type:"script",path:`https://www.googletagmanager.com/gtag/js?id=${p.code.googleAnalyticsId}`,options:{target:"body",async:!0}}),null===(y=u.assets)||void 0===y||y.push({type:"script",content:`window.dataLayer = window.dataLayer || [];\n        function gtag(){dataLayer.push(arguments);}\n        gtag('js', new Date());\n        gtag('config', '${p.code.googleAnalyticsId}');`,options:{target:"body"}}));null!==(l=p.code)&&void 0!==l&&l.tagManagerId&&(null===(f=u.assets)||void 0===f||f.push({type:"script",content:`(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':\n        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],\n        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=\n        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);\n        })(window,document,'script','dataLayer','${p.code.tagManagerId}');`,options:{target:"body"}}));(u.customCode={},null!==(c=p.code)&&void 0!==c&&c.headTag&&(u.customCode.head=p.code.headTag),null!==(d=p.code)&&void 0!==d&&d.bodyTag&&(u.customCode.body=p.code.bodyTag),o===et.cd.HTML)&&(u.customCode.body=null===(b=u.customCode.body)||void 0===b?void 0:b.concat('<script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"><\/script>'));return u},Yt=(e,t,o,n)=>{var i,r,s,a,l,c;const d=n.pages.byId[o],p=null===d||void 0===d?void 0:d.settings,u=n.settings;if(!d)throw new Error(`Page ${o} could not be found in project ${t}`);if(!p)return{value:d.title};const h=(null===(i=u.general)||void 0===i?void 0:i.title)||e,m=null!==d&&void 0!==d&&d.isHomePage?h:d.title+" - "+h,g=null!==(r=u.social)&&void 0!==r&&r.image?n.assets.byId[null===(s=u.social)||void 0===s?void 0:s.image]:void 0,y=p.socialImage?n.assets.byId[p.socialImage]:void 0,f=[{name:"description",content:p.seoDescription||(null===(a=u.general)||void 0===a?void 0:a.description)},{property:"og:title",content:p.socialTitle||p.seoTitle||m},{property:"og:description",content:p.socialDescription||(null===(l=u.social)||void 0===l?void 0:l.description)||p.seoDescription||(null===(c=u.general)||void 0===c?void 0:c.description)},{property:"og:image",content:(null===y||void 0===y?void 0:y.remoteSrc)||(null===g||void 0===g?void 0:g.remoteSrc)}].filter((e=>e.content)),b={title:p.seoTitle||m,metaTags:f},w={value:d.title,seo:b};return Object.assign(w,{pageOptions:Vt(Vt({},(null===p||void 0===p?void 0:p.url)&&{navLink:p.url}),d.isFallbackPage&&{fallback:d.isFallbackPage})}),w};var Xt=o(99177),qt=o(38375),Qt=o(45461);var eo={name:"teleport-project-react",subFolders:[],files:[{name:"package",fileType:et.Tv.JSON,content:'{\n  "name": "teleport-project-react",\n  "version": "0.0.0",\n  "scripts": {\n    "build": "vite build",\n    "preview": "vite preview",\n    "dev": "vite"\n  },\n  "devDependencies": {\n    "@types/react": "^17.0.33",\n    "@types/react-dom": "^17.0.10",\n    "autoprefixer": "^9.8.6",\n    "postcss": "^8.2.15",\n    "tailwindcss": "^3.0.24",\n    "typescript": "^4.4.4",\n    "vite": "^2.7.2",\n    "vite-plugin-jspm": "^0.1.0"\n  }\n}'},{name:"vite.config",fileType:"mjs",content:'import { defineConfig } from "vite";\nimport jspmPlugin from "vite-plugin-jspm";\nimport { readFileSync } from "node:fs";\nconst config = JSON.parse(readFileSync("./teleport.config.json"));\n\nexport default defineConfig({\n  clearScreen: true,\n  build: {\n    outDir: "build",\n    polyfillModulePreload: false,\n    polyfillDynamicImport: false,\n  },\n  css: {\n    modules: {\n      scopeBehaviour: "local",\n    },\n  },\n  plugins: [jspmPlugin({ inputMap: config.importmap, downloadDeps: true })],\n});'},{name:"tsconfig",fileType:et.Tv.JSON,content:'{\n  "compilerOptions": {\n    "target": "ESNext",\n    "useDefineForClassFields": true,\n    "lib": ["DOM", "DOM.Iterable", "ESNext"],\n    "allowJs": false,\n    "skipLibCheck": false,\n    "esModuleInterop": false,\n    "allowSyntheticDefaultImports": true,\n    "strict": true,\n    "forceConsistentCasingInFileNames": true,\n    "module": "ESNext",\n    "moduleResolution": "Node",\n    "resolveJsonModule": true,\n    "isolatedModules": true,\n    "noEmit": true,\n    "jsx": "react-jsx"\n  },\n  "include": ["./src"]\n}'}]},to=o(89880);const oo=()=>J.hL.getInstance().getSingletonClassInstance("guardsService"),no=(async()=>null).constructor;function io(e,t,o){const n=o.value,i=n instanceof no;o.value=async function(...e){const t=oo(),o=!(!e[0]||!e[0].doc);if(t.getGuard(to._.DISABLE_HISTORY)&&o)return n.apply(this,e);if(o)return i?t.executeAsyncFunctionGuarded(to._.DISABLE_HISTORY,(async()=>await n.apply(this,e))):t.executeFunctionGuarded(to._.DISABLE_HISTORY,(()=>n.apply(this,e)));return function(e,t,o,n){const i=new Q.b,r=oo();if(r.getGuard(to._.DISABLE_HISTORY))return i.getDocForSyncCallback(e,t,o);if(n)return new Promise((n=>{r.executeFunctionGuarded(to._.DISABLE_HISTORY,(async()=>{const r=await i.getDocForSyncCallback(e,t,o);return n(r)}))}));return r.executeFunctionGuarded(to._.DISABLE_HISTORY,(()=>i.getDocForSyncCallback(e,t,o)))}(n,e,this,i)}}class ro extends Error{constructor(e){super(e),this.message=e||""}}var so,ao,lo,co,po,uo,ho,mo,go,yo,fo,bo,wo,vo,Io,So,jo,Do,Oo,Fo,To,No,Eo,Co,xo,Po,ko,Mo;function Zo(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Uo(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Zo(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Zo(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}so=(0,J.JJ)("projectDownloadFlow"),ao=(0,J.f3)("projectUIState"),lo=(0,J.f3)("projectDoc"),co=(0,J.f3)("notificationsManagementFlow"),po=(0,J.f3)("sentryService"),uo=(0,J.f3)("githubRepository"),ho=(0,J.f3)("githubFlow"),mo=(0,J.f3)("assetsService"),go=(0,J.f3)("assetsManagementFlow"),yo=(0,J.f3)("projectFilesFlow"),fo=(0,J.f3)("fileDownloadService"),bo=(0,J.f3)("tailwindService"),wo=(0,q.G)(te.l.DOWNLOAD_ZIP_PROJECT),vo=(0,q.G)(te.l.EXPORT_TO_GITHUB),Io=(0,q.G)(te.l.EXPORT_TO_CODESANDBOX),so((jo=class{constructor(){(0,z.Z)(this,"projectUIState",Do,this),(0,z.Z)(this,"projectDoc",Oo,this),(0,z.Z)(this,"notificationsManagementFlow",Fo,this),(0,z.Z)(this,"sentryService",To,this),(0,z.Z)(this,"githubRepository",No,this),(0,z.Z)(this,"githubFlow",Eo,this),(0,z.Z)(this,"assetsService",Co,this),(0,z.Z)(this,"assetsManagementFlow",xo,this),(0,z.Z)(this,"projectFilesFlow",Po,this),(0,z.Z)(this,"fileDownloadService",ko,this),(0,z.Z)(this,"tailwindService",Mo,this)}updateProjectType(e){(0,V.JG)(this.projectUIState,(({userPreferences:t})=>{t.projectType=e}))}updateProjectExportType(e){(0,V.JG)(this.projectUIState,(({userPreferences:t})=>{t.projectType=et.cd.REACT,t.projectExportType=e}))}async downloadZip(e){(0,V.JG)(this.projectUIState,(({projectDownload:e})=>{e.zip={status:"pending"}}));try{let t=null;const o=this.projectUIState.devMode.selectedBranch;if(this.projectUIState.userPreferences.projectExportType===Y.iW.DEV&&Object.values(this.projectDoc.projectFiles.local[o].byId).length>0){const e=Object.values(this.projectDoc.assets.byId),o=await this.assetsService.downloadAssets(e,{}),n=(0,qt.H)(),i=this.projectFilesFlow.getPackedDevProjectFromCurrentBranch();if(!i)throw new Error("Failed in generating prject from custom-code to export to Codesandbox");this.mergeProjectWithTemplateForDeplyment(this.injectLocalAssetsIntoProject(i,o)),n.setProject(i);const{success:r,payload:s}=await n.publish();r&&(t=s)}else t=await this.projectFilesFlow.getPackedDesignProject({projectType:e,publisher:et.Rl.ZIP,projectCssFlavour:!0,includeAnalytics:!0});const n=new Blob([t],{type:"application/zip"});n&&(this.fileDownloadService.promptDownload(n,`${this.projectUIState.title}-${e}.zip`.toLowerCase()),(0,V.JG)(this.projectUIState,(({projectDownload:e})=>{e.zip={status:"success"}})))}catch(t){(0,V.JG)(this.projectUIState,(({projectDownload:e})=>{e.zip={status:"error"}}));const e=new Error(`Zip download failed: ${t.message}`);this.sentryService.captureException(e,{type:nt.U.CRITICAL}),this.notificationsManagementFlow.createNotification(K.k.ERROR,"An error occurred while downloading your zip application. Please try again later.")}}async exportToGithub(e,t){const{displayNotification:o=!0,deployStagedOnly:n=!1,newDevRepository:i=!1}=t||{};if((0,V.JG)(this.projectUIState,(({projectDownload:e})=>{e.github={status:"pending"}})),n){if(!(await this.githubFlow.checkUserAccessToRepository()))return void this.notificationsManagementFlow.createNotification(K.k.ERROR,"Mare sure that the repository exists and you have proper permissions")}try{var r;let c;const d=(null===t||void 0===t?void 0:t.repository)||(null===(r=this.projectDoc.stats.github)||void 0===r?void 0:r.repositoryName)||(0,mt.dE)(`${this.projectUIState.title}-${e}`);if(i){if(await this.githubRepository.checkIfUserHasAccessToRepo(this.projectDoc.id,"",d))return void this.notificationsManagementFlow.createNotification(K.k.ERROR,"A repository with the same name already exists")}const p=this.projectUIState.devMode.selectedBranch;let u;if(this.projectUIState.userPreferences.projectExportType===Y.iW.DEV||i||n){var s;const e=Object.values(this.projectDoc.assets.byId);u=await this.assetsService.downloadAssets(e,{skipDownload:!1});const t=this.projectDoc.projectFiles.staged[p].byId;n&&(u=u.filter((e=>{const o=`${Qt.Wn}/playground_assets/${e.name}`;if(t[o])return e}))),c=n?this.projectDoc.projectFiles.pack(Uo({filesToPack:t,assets:{},toDeploy:!0},Object.keys((null===(s=this.projectDoc.customFiles)||void 0===s?void 0:s.byId)||{}).length>0&&{customFiles:this.projectDoc.customFiles.byId})):this.projectFilesFlow.getPackedDevProjectFromCurrentBranch(),this.injectLocalAssetsIntoProject(c,u)}else{const t=await this.assetsManagementFlow.getOptimisedUsedAssets();u=await this.assetsService.downloadAssets(t,{}),c=await this.projectFilesFlow.getPackedDesignProject({projectType:e})}const h=p||Qt.cY,m=this.projectDoc.projectFiles.remote[h];if(n&&!m){var a;const e=(null===t||void 0===t?void 0:t.repositoryOwner)||(null===(a=this.projectDoc.stats.github)||void 0===a?void 0:a.repositoryOwner);if(!e)throw new Error("Repository owner not found");await this.githubRepository.createBranch(this.projectDoc.id,{owner:e,repository:d,sourceBranch:Qt.cY,newBranch:h})}const{payload:g,success:y}=await this.githubRepository.deploy(this.projectDoc.id,c,Uo(Uo({},t),{},{repository:d,commitBranch:h}));if(y){var l;if(o)this.notificationsManagementFlow.createNotification(K.k.SUCCESS,`Your codebase is ready on GitHub: ${g}`,{duration:1e4}),null!==(l=this.projectDoc.stats.github)&&void 0!==l&&l.repositoryUrl||window.open(g,"_blank");(0,V.JG)(this.projectUIState,(({projectDownload:e})=>{e.github={status:"success"}})),this.updateGithubLink({repoLink:g,repoName:d}),this.projectFilesFlow.transferLocalFilesToRemote({branch:h,stagedOnly:n,assets:u}),ee.Z.customEvents.githubExport.success({deployStagedCodeOnly:n,commitBranch:h})}}catch(c){if((0,V.JG)(this.projectUIState,(({projectDownload:e})=>{e.github={status:"error"}})),ee.Z.customEvents.githubExport.error({error:c,deployStagedCodeOnly:n}),c instanceof st.qc)return void this.notificationsManagementFlow.createNotification(K.k.ERROR,c.message);if(c instanceof st.rw)return void this.notificationsManagementFlow.createNotification(K.k.ERROR,c.message);if(c instanceof ro)return void this.notificationsManagementFlow.createNotification(K.k.ERROR,c.message);let e="An error occurred while publishing your application. Please try again later.";try{e=JSON.parse(c.message).error}catch(d){}this.sentryService.captureException(c,{type:nt.U.CRITICAL}),this.notificationsManagementFlow.createNotification(K.k.ERROR,e)}}async exportToCodesandbox(e){(0,V.JG)(this.projectUIState,(({projectDownload:e})=>{e.codesandbox={status:"pending"}}));try{let t=null;if(this.projectUIState.userPreferences.projectExportType===Y.iW.DEV){const e=Object.values(this.projectDoc.assets.byId),o=await this.assetsService.downloadAssets(e,{skipDownload:!0}),n=(0,Xt.A)(),i=this.projectFilesFlow.getPackedDevProjectFromCurrentBranch();n.setProject(this.mergeProjectWithTemplateForDeplyment(this.injectLocalAssetsIntoProject(i,o)));const{success:r,payload:s}=await n.publish();r&&(t=s)}else t=await this.projectFilesFlow.getPackedDesignProject({projectType:e,skipDownload:!0,publisher:et.Rl.CODESANDBOX});t&&(this.notificationsManagementFlow.createNotification(K.k.SUCCESS,`Your project is ready on CodeSandbox: ${t}`,{duration:1e4}),window.open(t,"_blank"),(0,V.JG)(this.projectUIState,(({projectDownload:e})=>{e.codesandbox={status:"success"}})))}catch(t){if((0,V.JG)(this.projectUIState,(({projectDownload:e})=>{e.codesandbox={status:"error"}})),t instanceof st.nz)return void this.notificationsManagementFlow.createNotification(K.k.ERROR,t.message);this.sentryService.captureException(t,{type:nt.U.CRITICAL}),this.notificationsManagementFlow.createNotification(K.k.ERROR,"An error occurred while publishing your application. Please try again later.")}}downloadProjectUIDL(){const e=this.domainProjectToUIDL({skipDevModeWidgets:this.projectUIState.userPreferences.projectExportType!==Y.iW.DEV,projectType:"UIDL"}),t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"});this.fileDownloadService.promptDownload(t,`${this.projectUIState.title}-uidl.json`)}domainProjectToUIDL(e){const{assetsMapping:t,skipDevModeWidgets:o,projectType:n}=e,i=t||Object.values(this.projectDoc.assets.byId||{}).reduce(((e,t)=>(Object.keys(t.usedInNodes||{}).forEach((o=>{e[o]||(e[o]=[]),e[o].push({localPath:t.remoteSrc,id:t.id})})),e)),{});return Jt({title:this.projectUIState.title,slug:this.projectUIState.slug,doc:this.projectDoc,projectType:n,assetSrcMapping:i,options:{skipDevModeWidgets:o}})}updateGithubLink(e){const{doc:t,repoLink:o,repoName:n}=e;if(!t)return;const i=o.split("https://github.com/")[1].split("/")[0];t.stats.github={repositoryUrl:o,repositoryName:n,repositoryOwner:i}}mergeProjectWithTemplateForDeplyment(e){var t,o;e.files=[...(null===e||void 0===e?void 0:e.files)||[],...null===eo||void 0===eo?void 0:eo.files];const n=null===(t=e.files.find((({name:e,fileType:t})=>"index"===e&&t===et.Tv.HTML)))||void 0===t?void 0:t.content,i=JSON.parse((null===(o=e.files.find((({name:e,fileType:t})=>"teleport.config"===e&&t===et.Tv.JSON)))||void 0===o?void 0:o.content)||"{}");if(!n||!i)throw new Error("Configuration files are missing for customc-code projects");const r=(new DOMParser).parseFromString(n,"text/html");r.querySelectorAll('[type="importmap"]').forEach((e=>e.remove()));const s=r.createElement("script");Object.assign(s,{type:"text/javascript"}),s.innerHTML="\nglobalThis.process = {\n  env: 'production'\n}\n";const a=r.getElementsByTagName("style")[0]||r.head.firstChild;r.head.insertBefore(s,a);const l=r.createElement("script");return Object.assign(l,{src:"./src/index.jsx",type:"module",async:!0}),r.body.append(l),e.files.forEach((e=>{"index"===e.name&&e.fileType===et.Tv.HTML&&(e.content=`\n<!DOCTYPE html>\n\n<html lang="en">\n\n${r.documentElement.innerHTML}\n\n</html>\n`)})),this.parseFolders("",e,((e,t)=>{e.includes("/teleporthq/")&&t.fileType===et.Tv.JS&&(t.fileType="jsx"),e.includes("/src")&&"index"===t.name&&t.fileType===et.Tv.JS&&(t.fileType="jsx")})),e}parseFolders(e,t,o){const{name:n,files:i,subFolders:r}=t;i.map((t=>o((0,at.join)(e,n),t))),r.map((t=>this.parseFolders((0,at.join)(e,n),t,o)))}injectLocalAssetsIntoProject(e,t){const o=null===e||void 0===e?void 0:e.subFolders.find((e=>"public"===e.name)),n={name:"playground_assets",files:t,subFolders:[]};return o?1===o.subFolders.length&&"playground_assets"===o.subFolders[0].name?o.subFolders=[n]:o.subFolders.push(n):e.subFolders.push({name:"public",files:[],subFolders:[n]}),e}},Do=(0,G.Z)(jo.prototype,"projectUIState",[ao],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oo=(0,G.Z)(jo.prototype,"projectDoc",[lo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fo=(0,G.Z)(jo.prototype,"notificationsManagementFlow",[co],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),To=(0,G.Z)(jo.prototype,"sentryService",[po],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),No=(0,G.Z)(jo.prototype,"githubRepository",[uo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eo=(0,G.Z)(jo.prototype,"githubFlow",[ho],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Co=(0,G.Z)(jo.prototype,"assetsService",[mo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xo=(0,G.Z)(jo.prototype,"assetsManagementFlow",[go],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Po=(0,G.Z)(jo.prototype,"projectFilesFlow",[yo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ko=(0,G.Z)(jo.prototype,"fileDownloadService",[fo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mo=(0,G.Z)(jo.prototype,"tailwindService",[bo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(jo.prototype,"downloadZip",[wo],Object.getOwnPropertyDescriptor(jo.prototype,"downloadZip"),jo.prototype),(0,G.Z)(jo.prototype,"exportToGithub",[vo],Object.getOwnPropertyDescriptor(jo.prototype,"exportToGithub"),jo.prototype),(0,G.Z)(jo.prototype,"exportToCodesandbox",[Io],Object.getOwnPropertyDescriptor(jo.prototype,"exportToCodesandbox"),jo.prototype),(0,G.Z)(jo.prototype,"updateGithubLink",[io],Object.getOwnPropertyDescriptor(jo.prototype,"updateGithubLink"),jo.prototype),So=jo));var Ao,Lo,_o,Ro,Bo,Ho,zo,$o,Go,Vo=o(11163),Jo=o(61030),Wo=o(35307),Ko=o(20165),Yo=o(28132),Xo=o(71178),qo=o(20510);Ao=(0,J.JJ)("projectChangesFlow"),Lo=(0,J.f3)("modalManagementFlow"),_o=(0,J.f3)("projectUIState"),Ro=(0,J.f3)("routerService"),Ao((Ho=class{constructor(){(0,z.Z)(this,"modalManagementFlow",zo,this),(0,z.Z)(this,"projectUIState",$o,this),(0,z.Z)(this,"routerService",Go,this),(0,$.Z)(this,"handleProjectAccessDenied",(()=>{if(this.projectUIState.isLeavingProject)return;const e=Jo.d.createCustomModal({Component:Ko.n,data:{title:"Access denied",description:"Access to this project or it's workspace has been removed. You will be redirected to dashboard in a few moments...",buttonTitle:"Exit project"},onSubmit:()=>this.closeModalAndRedirect()});this.modalManagementFlow.showModal(e),setTimeout((()=>{this.closeModalAndRedirect()}),7e3)})),(0,$.Z)(this,"handleSocketConnectionLost",(()=>{const e=Jo.d.createCustomModal({Component:Ko.n,data:{title:"Server connection lost",description:"Unfortunately you can't make changes any changes to the project. Your page will be refreshed in a few moments...",buttonTitle:"Refresh"},onSubmit:()=>this.closeModalAndReload()});this.modalManagementFlow.showModal(e),setTimeout((()=>{this.closeModalAndReload()}),5e3)})),(0,$.Z)(this,"handleTooManyUserConnections",(()=>{const e=Jo.d.createCustomModal({Component:Ko.n,data:{title:"Real-time collaborators limit",description:"Unfortunately you can't access the project right now because there are too many live connections. Please try again later! You will be redirected to dashboard in a few moments...",buttonTitle:"Exit project"},onSubmit:()=>this.closeModalAndRedirect()});(0,Wo.G)().destroy(),this.modalManagementFlow.showModal(e),setTimeout((()=>{this.closeModalAndRedirect()}),5e3)})),(0,$.Z)(this,"handleProjectDeleted",(()=>{const e=Jo.d.createCustomModal({Component:Ko.n,data:{title:"Deleted project",description:"Unfortunately this project has been deleted by the project owner. You will be redirected to dashboard in a few moments...",buttonTitle:"Exit project"},onSubmit:()=>this.closeModalAndRedirect()});this.modalManagementFlow.showModal(e),setTimeout((()=>{this.closeModalAndRedirect()}),5e3)})),(0,$.Z)(this,"handleApplicationUpdate",(()=>{const e=Jo.d.createCustomModal({Component:Ko.n,data:{title:"New version of the app available",description:"A new version of the app is available. We will reload the page in a few moments to enjoy all the new updates.",buttonTitle:"Reload"},onSubmit:()=>this.closeModalAndReload()});this.modalManagementFlow.showModal(e),setTimeout((()=>{this.closeModalAndReload()}),5e3)})),(0,$.Z)(this,"handleAccessTypeUpdate",(e=>{if(!e)return;const t={[Yo.Z.READ]:Xo.u.VIEWER,[Yo.Z.WRITE]:Xo.u.EDITOR,[Yo.Z.OWNER]:"Owner"},o=Jo.d.createCustomModal({Component:Ko.n,data:{title:"New project permission",description:`A new project permission was assigned to your account (${t[e]}). We will reload the page in a few moments.`,buttonTitle:"Reload"},onSubmit:()=>this.closeModalAndReload()});this.modalManagementFlow.showModal(o),setTimeout((()=>{this.closeModalAndReload()}),5e3)}))}closeModalAndReload(){this.modalManagementFlow.hideModal(),Vo.default.reload()}closeModalAndRedirect(){this.modalManagementFlow.hideModal(),Vo.default.push(qo.Ql)}},zo=(0,G.Z)(Ho.prototype,"modalManagementFlow",[Lo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$o=(0,G.Z)(Ho.prototype,"projectUIState",[_o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Go=(0,G.Z)(Ho.prototype,"routerService",[Ro],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bo=Ho));var Qo,en,tn,on,nn,rn,sn,an,ln,cn,dn,pn,un,hn,mn,gn,yn,fn,bn,wn,vn,In=o(96142),Sn=o(46089),jn=o(66075);Qo=(0,J.JJ)("projectCloneFlow"),en=(0,J.f3)("projectDoc"),tn=(0,J.f3)("projectUIState"),on=(0,J.f3)("projectRepository"),nn=(0,J.f3)("workspacesRepository"),rn=(0,J.f3)("globalAppState"),sn=(0,J.f3)("notificationsManagementFlow"),an=(0,J.f3)("routerService"),ln=(0,J.f3)("modalManagementFlow"),cn=(0,J.f3)("sentryService"),Qo((pn=class{constructor(){(0,z.Z)(this,"projectDoc",un,this),(0,z.Z)(this,"projectUIState",hn,this),(0,z.Z)(this,"projectRepository",mn,this),(0,z.Z)(this,"workspacesRepository",gn,this),(0,z.Z)(this,"globalAppState",yn,this),(0,z.Z)(this,"notificationsManagementFlow",fn,this),(0,z.Z)(this,"routerService",bn,this),(0,z.Z)(this,"modalManagementFlow",wn,this),(0,z.Z)(this,"sentryService",vn,this),(0,$.Z)(this,"cloneProjectFromHeader",(async()=>{const e=await this.workspacesRepository.getAll();if(!e.length)throw new Error("No workspace found on cloning project");const t=Jo.d.createCustomModal({Component:jn.v,data:{projectType:"public"},onSubmit:async t=>{var o;const n=null===(o=e.find((e=>e.id===t)))||void 0===o?void 0:o.slug;if(!n)return;const i=await this.workspacesRepository.getWorkspaceBySlug(n);await this.clone(i),this.modalManagementFlow.hideModal()}});this.modalManagementFlow.showModal(t)}))}async clone(e){const t=this.globalAppState.user.userData;if(!t)throw new Error("Logged in user not found");if((0,Sn.Hr)(e,t))return void this.notificationsManagementFlow.handleError(In.MN);const o=e.projects.map((e=>e.name)),n=(0,W.Zu)(o,this.projectUIState.title),i=await this.projectRepository.clone(this.projectDoc.id,n,e.id);await Vo.default.replace((0,qo.S1)(i.project.slug)),Vo.default.reload()}},un=(0,G.Z)(pn.prototype,"projectDoc",[en],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hn=(0,G.Z)(pn.prototype,"projectUIState",[tn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mn=(0,G.Z)(pn.prototype,"projectRepository",[on],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gn=(0,G.Z)(pn.prototype,"workspacesRepository",[nn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yn=(0,G.Z)(pn.prototype,"globalAppState",[rn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fn=(0,G.Z)(pn.prototype,"notificationsManagementFlow",[sn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bn=(0,G.Z)(pn.prototype,"routerService",[an],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wn=(0,G.Z)(pn.prototype,"modalManagementFlow",[ln],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vn=(0,G.Z)(pn.prototype,"sentryService",[cn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dn=pn));var Dn,On,Fn,Tn,Nn,En,Cn,xn,Pn,kn,Mn;function Zn(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Un(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Zn(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Zn(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}Dn=(0,J.JJ)("componentCodeGenerationFlow"),On=(0,J.f3)("projectUIState"),Fn=(0,J.f3)("projectDoc"),Tn=(0,J.f3)("packerService"),Nn=(0,J.f3)("assetsManagementFlow"),Dn((Cn=class{constructor(){(0,z.Z)(this,"projectUIState",xn,this),(0,z.Z)(this,"projectDoc",Pn,this),(0,z.Z)(this,"packerService",kn,this),(0,z.Z)(this,"assetsManagementFlow",Mn,this)}updateComponentType(e){(0,V.JG)(this.projectUIState,(({userPreferences:t})=>{t.componentCodeType=e;const o=et.vi[e];t.componentCodeStyleVariation=o||void 0}))}updateStyleVariation(e){(0,V.JG)(this.projectUIState,(({userPreferences:t})=>{t.componentCodeStyleVariation=e}))}async generateComponentUIDLcomponent(e,t){const o=await this.assetsManagementFlow.getOptimisedUsedAssets(),n=this.projectDoc.assets.mapClassesAndNodesToOptimisedAssets(o),i=(0,mt.dE)(e.title)||`Component-${e.title}`;return Lt({component:e,doc:this.projectDoc,options:{skipDevModeWidgets:this.projectUIState.userPreferences.projectExportType===Y.iW.DEV},projectType:t,defaultElementStyles:{},assetSrcMapping:n,compTitle:i})}async generateComponentCode(e){const{componentCodeStyleVariation:t,componentCodeType:o}=this.projectUIState.userPreferences,n=await this.generateComponentUIDLcomponent(e,o),i={};if(o===et.re.HTML)for(const a of Object.values(this.projectDoc.components.byId)){if(!a)continue;const e=await this.generateComponentUIDLcomponent(a,o);i[a.title]=e}if("UIDL"===o){const e={files:[{name:`${n.name}-uidl`,fileType:"json",content:JSON.stringify(n,null,2)}],dependencies:{}};return void setTimeout((()=>{(0,V.JG)(this.projectUIState,(({componentCodeGeneration:t})=>{t.compiledComponent=e,t.status="done"}))}))}const r={componentType:o,styleVariation:t,componentGeneratorOptions:{projectStyleSet:{styleSetDefinitions:Un(Un({},this.projectDoc.designLanguage.textStylesToUIDL()),this.projectDoc.classes.toUIDL()),fileName:"style",path:".",importFile:!0},moduleComponents:i}};(0,V.JG)(this.projectUIState,(({componentCodeGeneration:e})=>{e.status="pending",e.compiledComponent=null}));const s=await this.packerService.generateComponentCode(n,r);(0,V.JG)(this.projectUIState,(({componentCodeGeneration:e})=>{e.compiledComponent=s,e.status="done"}))}},xn=(0,G.Z)(Cn.prototype,"projectUIState",[On],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pn=(0,G.Z)(Cn.prototype,"projectDoc",[Fn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kn=(0,G.Z)(Cn.prototype,"packerService",[Tn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mn=(0,G.Z)(Cn.prototype,"assetsManagementFlow",[Nn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),En=Cn));var An,Ln,_n,Rn,Bn,Hn,zn,$n,Gn,Vn,Jn,Wn,Kn,Yn,Xn,qn,Qn,ei,ti,oi,ni,ii,ri,si,ai,li,ci,di,pi,ui,hi,mi,gi,yi,fi,bi,wi,vi,Ii,Si,ji,Di,Oi=o(21753),Fi=o(63316),Ti=o(3715),Ni=o(28520),Ei=o(62057);function Ci(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function xi(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Ci(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Ci(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}An=(0,J.JJ)("componentManagementFlow"),Ln=(0,J.f3)("sharedbProjectSyncService"),_n=(0,J.f3)("projectDoc"),Rn=(0,J.f3)("projectUIState"),Bn=(0,J.f3)("nodeSelectionFlow"),Hn=(0,J.f3)("notificationsManagementFlow"),zn=(0,J.f3)("layoutManagementFlow"),$n=(0,J.f3)("navbarFlow"),Gn=(0,J.f3)("uidlToComponentMapper"),Vn=(0,J.f3)("webRTCState"),Jn=(0,J.f3)("rtcFlow"),Wn=(0,J.f3)("nodeManagementFlow"),Kn=(0,J.f3)("collaboratorManagementFlow"),Yn=(0,J.f3)("modalManagementFlow"),Xn=(0,J.f3)("projectInitFlow"),qn=(0,J.f3)("cloudComponentsFlow"),Qn=(0,J.f3)("imageOptimisationFlow"),ei=(0,J.f3)("projectManagementFlow"),ti=(0,q.G)(te.l.ENTER_RENAME_COMPONENT),oi=(0,q.G)(te.l.CREATE_COMPONENT),ni=(0,q.G)(te.l.CREATE_COMPONENT),ii=(0,q.G)(te.l.DELETE_COMPONENT),ri=(0,q.G)(te.l.DUPLICATE_COMPONENT),An((ai=class{constructor(){(0,z.Z)(this,"dbSync",li,this),(0,z.Z)(this,"projectDoc",ci,this),(0,z.Z)(this,"projectUIState",di,this),(0,z.Z)(this,"nodeSelectionFlow",pi,this),(0,z.Z)(this,"notificationsManagementFlow",ui,this),(0,z.Z)(this,"layoutManagementFlow",hi,this),(0,z.Z)(this,"navbarFlow",mi,this),(0,z.Z)(this,"uidlToComponentMapper",gi,this),(0,z.Z)(this,"webRTCState",yi,this),(0,z.Z)(this,"rtcFlow",fi,this),(0,z.Z)(this,"nodeManagementFlow",bi,this),(0,z.Z)(this,"collaboratorManagementFlow",wi,this),(0,z.Z)(this,"modalManagementFlow",vi,this),(0,z.Z)(this,"projectInitFlow",Ii,this),(0,z.Z)(this,"cloudComponentsFlow",Si,this),(0,z.Z)(this,"imageOptimisationFlow",ji,this),(0,z.Z)(this,"projectManagementFlow",Di,this)}async commitComponent(e){const t=this.projectUIState.componentList.componentUnderLocalWork;t&&(this.renameComponent({id:t.id,newName:e}),(0,V.JG)(this.projectUIState,(e=>{e.componentList.componentUnderLocalWork=null})))}async beginEditing(e){e&&this.projectDoc.components.byId[e]&&(0,V.JG)(this.projectUIState,(t=>{t.componentList.componentUnderLocalWork=(new Zt.n).fromJSON(this.projectDoc.components.byId[e].toJSON())}))}async createEmptyComponent(){if(this.checkComponentsLimitReached())return;this.webRTCState.followedUserId&&this.collaboratorManagementFlow.resetFollowedUserId();const e=new Zt.n({title:this.projectDoc.getUniqueCompOrPageName("Component"),instantiatedByNodes:{},pos:this.projectDoc.components.getPositionAfterLast()});this.dbSync.mutate(this.projectDoc,(t=>{t.addComponent({component:e,folderId:"components",hasDefaultStyles:!0})})),this.rtcFlow.notifySelectedComp(e.id),this.navbarFlow.selectOrCreateTabByEntityId(e.id),(0,V.JG)(this.projectUIState,(t=>{t.componentList.componentUnderLocalWork=(new Zt.n).fromJSON(e.toJSON()),t.componentList.stateValues[e.id]={}}))}checkComponentsLimitReached(){const e=this.projectInitFlow.getProjectLimitations();return Object.keys(this.projectDoc.components.byId).length>=e.MAX_COMPONENTS_IN_PROJECT&&(this.notificationsManagementFlow.createNotification(K.k.WARNING,"You reached the maximum number of components allowed in a project."),!0)}handleMultipleActions(e){this.dbSync.mutate(this.projectDoc,(t=>{e(t)}))}importThqSectionSync(e){const{generatedComponent:t,nextSibling:o,thqPrimitiveType:n,doc:i}=e;let{compInstanceId:r}=e;if(!i)return;const s=this.computeTargetToAcceptElement(e.targetId,n),a=s.target;if(r=r||s.compInstanceId,!a)return;const l=i.nodes.getComponentIdOf(a);if(!l)return;this.replacePropsInGeneratedNodes(t);const c=[...t.nodes],d=[],p=[];for(;c.length;){const e=c.pop();if(!e||"component"!==e.primitiveType||!e.semanticType||n)continue;const o=e.semanticType,r=t.nodes.find((t=>t.id===e.id));if(!r||!i.nodes.nodeIsCompInstance(r))continue;const s=i.getUniqueCompOrPageName(o);if(s!==o&&t.usedComponents[t.components[0].id].forEach((e=>{e.componentName===o&&(e.componentName=s)})),-1===d.indexOf(o));else{const e=p.find((e=>e.components[0].title===s));e&&(r.compIdOfCompInstance=null===e||void 0===e?void 0:e.components[0].id,r.semanticType=null)}}const u=t.components[0].rootNodeId;if(!t.nodes.find((e=>e.id===u)))return;p.forEach((e=>this.addComponentMetaFromData({data:e,doc:i})));const{components:h,nodes:m,usedComponents:g,sectionIds:y}=t;m.forEach((e=>{var t,n;e.compIdOfRootNode=null,e.fakeSize=!1;const s=null===(t=e.attrs)||void 0===t||null===(n=t[Ei.AS])||void 0===n?void 0:n.content;s&&(e.primitiveType=s),e.id===u?i.addNodesToParentOrStage({nodes:[e],parentId:a,nextSibling:o,compInstanceId:r}):i.addNode(e)})),y[l]=y[h[0].id],g[l]=g[h[0].id],delete y[h[0].id],delete g[h[0].id],this.addComponentMetaFromData({doc:i,data:t,createComponentAndNodes:!1})}async importSectionComponent(e){const{sectionId:t,thqPrimitiveType:o,nextSibling:n,customCodeSnippet:i}=e;let{compInstanceId:r}=e;const s=this.computeTargetToAcceptElement(e.targetId,o),a=s.target;if(r=r||s.compInstanceId,!a)return;const l=this.projectDoc.nodes.getComponentIdOf(a);if(!l)return;const c=o?await this.generateInteractiveElement(t,o):await this.generateSectionComponent(t,!0);if(!c)return;this.replacePropsInGeneratedNodes(c);const d=[...c.nodes],p=[],u=[];for(;d.length;){const e=d.pop();if(!e||"component"!==e.primitiveType||!e.semanticType||o)continue;const t=e.semanticType,n=c.nodes.find((t=>t.id===e.id));if(!n||!this.projectDoc.nodes.nodeIsCompInstance(n))continue;const i=this.projectDoc.getUniqueCompOrPageName(t);if(i!==t&&c.usedComponents[c.components[0].id].forEach((e=>{e.componentName===t&&(e.componentName=i)})),-1!==p.indexOf(t)){const e=u.find((e=>e.components[0].title===i));e&&(n.compIdOfCompInstance=null===e||void 0===e?void 0:e.components[0].id,n.semanticType=null);continue}const r=await this.generateSectionComponent(e.semanticType);r&&(n.compIdOfCompInstance=r.components[0].id,n.semanticType=null,p.push(t),u.push(r))}const h=c.components[0].rootNodeId;if(this.dbSync.mutate(this.projectDoc,(e=>{if(!c.nodes.find((e=>e.id===h)))return;u.forEach((t=>this.addComponentMetaFromData({data:t,doc:e})));const{components:t,nodes:o,usedComponents:s,sectionIds:d}=c;o.forEach((t=>{var o,s;t.compIdOfRootNode=null,t.fakeSize=!1;const l=null===(o=t.attrs)||void 0===o||null===(s=o[Ei.AS])||void 0===s?void 0:s.content;switch(l&&(t.primitiveType=l),l){case dt.IV.DROPDOWN:t.customCodeSnippet={},t.customCodeSnippet.head=null===i||void 0===i?void 0:i.head;break;case dt.IV.NAVBAR:t.customCodeSnippet={},t.customCodeSnippet.body=null===i||void 0===i?void 0:i.body}t.id===h?e.addNodesToParentOrStage({nodes:[t],parentId:a,nextSibling:n,compInstanceId:r}):e.addNode(t)})),d[l]=d[t[0].id],s[l]=s[t[0].id],delete d[t[0].id],delete s[t[0].id],this.addComponentMetaFromData({doc:e,data:c,createComponentAndNodes:!1})})),h&&this.nodeSelectionFlow.setNodeSelection({nodeId:h}),!i)return;const m=this.projectDoc.settings||{},{code:g={headTag:Oi.YZ,bodyTag:Oi.Hj}}=m,{headTag:y,bodyTag:f}=g,b=!i.head||null!==y&&void 0!==y&&y.includes(`data-section-id='${i.id||t}'`)?`${y}`:`${y} \n    <style data-section-id='${i.id||t}'>${i.head}</style>`,w=!i.body||null!==f&&void 0!==f&&f.includes(`data-section-id='${i.id||t}'`)||null!==f&&void 0!==f&&f.includes(`src='${i.body}'`)?`${f}`:`${f} \n    <script data-section-id='${i.id||t}' src='${i.body}'><\/script>`,v=xi(xi({},g),{},{headTag:b,bodyTag:w}),I=xi(xi({},m),{},{code:xi({},v)});this.projectManagementFlow.updateSettings(I)}async createFromUIDL(e){const{uidls:t}=e,o=await this.uidlToComponentMapper.mapUIDLsToComponents({doc:this.projectDoc,uidls:t.map((e=>({uidl:e})))});o&&this.addComponentMetaFromData({data:o})}addComponentMetaFromData(e){const{data:t,doc:o,createComponentAndNodes:n=!0}=e;if(!o)return;const{assets:i,nodes:r,propDefinitions:s,tokensInNodes:a,textStylesInNodes:l,fontsInNodes:c,sectionIds:d,usedComponents:p,nodesWithNavlinks:u}=t,h=t.components;return n&&(h.forEach((e=>{const t=o.addComponent({component:e,folderId:"components"});Object.values(s[e.id]).forEach((e=>{null===t||void 0===t||t.createPropDefinition(xi({},e))}))})),r.forEach((e=>o.nodes.add(e)))),i.forEach((e=>o.assets.add(e))),(0,Fi.Gw)(o,u),Object.keys(a).forEach((e=>{a[e].forEach((t=>{const n=o.designLanguage.tokensById[e].usedInNodes[t];o.designLanguage.tokensById[e].usedInNodes[t]=n?n+1:1}))})),Object.keys(l).forEach((e=>{l[e].forEach((t=>{o.designLanguage.textStyleSetsById[e].usedInNodes[t]=!0}))})),Object.keys(c).forEach((e=>{c[e].forEach((t=>{const n=o.fonts.byId[e].usedInNodes[t];o.fonts.byId[e].usedInNodes[t]=n?n+1:1}))})),(0,Fi.ng)({doc:o,usedComponents:p}),(0,Fi.cT)({doc:o,sectionIds:d}),h.map((e=>e.id))}deleteComponent(e){const{id:t}=e,o=this.projectDoc.components.byId[t],n=Object.keys((null===o||void 0===o?void 0:o.instantiatedByNodes)||{}),i=Object.keys(this.projectDoc.cloudComponents.byId[t]||{}),r=()=>this.executeComponentDeletion({id:t});if(n.length&&0===i.length){const e=Jo.d.createDeleteModal({deletedEntity:"component",onSubmit:r});this.modalManagementFlow.showModal(e)}else if(!n.length&&i.length>0){const e=Jo.d.createDeleteModal({deletedEntity:"cloud-components",onSubmit:r});this.modalManagementFlow.showModal(e)}else if(n.length&&i.length>0){const e=Jo.d.createDeleteModal({deletedEntity:"component-cloud-components",onSubmit:r});this.modalManagementFlow.showModal(e)}else this.executeComponentDeletion({id:t}),this.modalManagementFlow.hideModal()}executeComponentDeletion(e){const{id:t,doc:o}=e;o&&(this.webRTCState.followedUserId&&this.collaboratorManagementFlow.resetFollowedUserId(),this.nodeSelectionFlow.resetNodeSelection(),this.imageOptimisationFlow.removeAssetSizeForPageOrComp({id:t}),o.removeComponent(t),this.updateUIAfterCompDeletion(t),this.cloudComponentsFlow.deleteAllComponents({compId:t,doc:o}))}updateUIAfterCompDeletion(e){var t;this.projectUIState.selection.componentId===e&&this.nodeSelectionFlow.cleanSelectedExpandedAndEditedNodes(),this.navbarFlow.deleteTab((null===(t=this.navbarFlow.getTabByEntityId(e))||void 0===t?void 0:t.id)||"")}async duplicateComponent(e){const{doc:t,compId:o}=e;if(!t)return;const n=t.duplicateComponent(o,t),i=t.getProjectPageOrComponent(n);if(!i||!i.rootNodeId)return;this.imageOptimisationFlow.getAssetsLinkedToNodes({nodeIds:[i.rootNodeId],withDescendants:!0}).forEach((e=>{const{sizePerComponent:i}=t.assets.byId[e];i&&(i[n]=i[o])}))}async select(e,t){if(!t&&this.webRTCState.followedUserId&&this.collaboratorManagementFlow.resetFollowedUserId(),e!==this.projectUIState.selection.componentId)this.navbarFlow.selectOrCreateTabByEntityId(e);else{const t=this.projectDoc.getProjectPageOrComponent(e);null!==t&&void 0!==t&&t.rootNodeId&&this.nodeSelectionFlow.setNodeSelection({nodeId:t.rootNodeId})}}async addComponentToSelectedElementPageOrComp(e){const{compId:t,doc:o}=e;if(!o)return;if(!o.components.byId[t])return;const{target:n,nextSibling:i}=this.computeTargetToAcceptElement();n&&this.addComponentToNode({compId:t,doc:o,targetId:n,nextSibling:i})}computeTargetToAcceptElement(e,t){const o=this.projectDoc;if(e){const n=o.nodes.byId[e];return this.projectDoc.isNodeAcceptingChildByElementType(n,dt.sO.COMPONENT)||t?{target:e}:{target:(null===n||void 0===n?void 0:n.parentOrSlotId)||""}}const{componentId:n,compInstanceId:i}=this.projectUIState.selection;if(!n)return{};let r=Object.keys(this.projectUIState.selection.nodes)[0];if(!r){const e=o.pages.byId[n]||o.components.byId[n];e&&(r=e.rootNodeId)}let s=null,a=o.nodes.byId[r];for(;a&&!this.projectDoc.isNodeAcceptingChildByElementType(a,dt.sO.COMPONENT);)r=a.parentOrSlotId||"",s=o.nodes.getNextSibling(a),a=o.nodes.byId[r];return{target:r,nextSibling:s,compInstanceId:i}}async addComponentToNode(e){const{compId:t,nextSibling:o,targetId:n,doc:i}=e;if(!i)return;if(!i.components.byId[t])return;const r=new Ni.F({primitiveType:dt.sO.COMPONENT});r.compIdOfCompInstance=t,this.nodeManagementFlow.addNodesToParentOrStage({parentId:n,nodes:[r],nextSibling:o,withNodeSelection:!0,compInstanceId:i.nodes.getSlotAndCompInstanceIdForNodeById(n).compInstanceId||this.projectUIState.selection.compInstanceId,doc:i})}async addComponentToLastVisitedPage(e){const{compId:t,doc:o}=e;if(!o)return;if(!o.components.byId[t])return;const{lastVisitedPage:n}=this.projectUIState;if(!n||!t)return;const i=this.projectDoc.pages.byId[n],r=null===i||void 0===i?void 0:i.rootNodeId;this.addComponentToNode({compId:t,doc:o,targetId:r})}getActiveComponentSectionIdsList(e){const t=this.projectDoc.getProjectPageOrComponent(e);if(!t)return[];const o=Object.values(t.sectionIds),n=[...Object.keys(null===t||void 0===t?void 0:t.usedComponents)];for(;n.length;){const e=n.shift(),i=this.projectDoc.components.byId[e];if(!i)throw new Error("Component not found");n.push(...Object.keys(null===i||void 0===i?void 0:i.usedComponents));for(let n=0;n<t.usedComponents[e];n++)o.push(...Object.values(i.sectionIds))}const i=[],r=o.filter(((e,t)=>o.indexOf(e)!==t)),s=new Map;for(const a of o)s.has(a)||(s.set(a,!0),i.push({id:a,duplicate:r.includes(a)}));return i.sort(((e,t)=>e.id.toLowerCase()>t.id.toLowerCase()?1:-1))}addIdToComponentSectionIds(e){const{nodeId:t,compId:o,sectionId:n,doc:i}=e;if(!i)return;const r=i.pages.byId[o]||i.components.byId[o];if(!r)throw new Error("Component not found");r.sectionIds[t]=n}removeIdFromComponentSectionIds(e){const{compId:t,nodeId:o}=e;this.dbSync.mutate(this.projectDoc,(e=>{const n=e.pages.byId[t]||e.components.byId[t];if(!n)throw new Error("Component not found");(null===n||void 0===n?void 0:n.sectionIds[o])&&delete n.sectionIds[o]}))}detachComponentInstance(e){const{componentInstanceId:t,doc:o}=e;if(!o)return;const n=o.detachComponentInstance({nodeId:t,doc:o});if(!n)throw new Error("Failed in detaching component instance");n.length>0?this.nodeSelectionFlow.setNodeSelection({nodeId:n[0].id,isMultiSelectMode:!1}):this.notificationsManagementFlow.createNotification(K.k.WARNING,"No elements inside componet to detach")}setComponentPropsManageState(e){(0,V.JG)(this.projectUIState,(t=>{t.dynamicNodeInteractionsData.isManagingProps=e}))}setComponentStateManageState(e){(0,V.JG)(this.projectUIState,(t=>{t.dynamicNodeInteractionsData.isManagingState=e}))}async selectNextComponent(){this.webRTCState.followedUserId&&this.collaboratorManagementFlow.resetFollowedUserId();const e=this.projectUIState.selection.componentId,t=this.projectDoc.components.getIdsOrderedByCompName();if(!e||t.length<=1)return;if(!this.projectDoc.components.byId[e])return;let o=t.indexOf(e)+1;o>=t.length&&(o=0);this.projectUIState.layout.sidebarPanel!==Y.tI.FILES&&this.layoutManagementFlow.changeActiveSidebar(Y.tI.FILES),this.navbarFlow.selectOrCreateTabByEntityId(t[o])}async selectPreviousComponent(){this.webRTCState.followedUserId&&this.collaboratorManagementFlow.resetFollowedUserId();const e=this.projectUIState.selection.componentId,t=this.projectDoc.components.getIdsOrderedByCompName();if(!e||t.length<=1)return;if(!this.projectDoc.components.byId[e])return;let o=t.indexOf(e)-1;o<0&&(o=t.length-1);this.projectUIState.layout.sidebarPanel!==Y.tI.FILES&&this.layoutManagementFlow.changeActiveSidebar(Y.tI.FILES),this.navbarFlow.selectOrCreateTabByEntityId(t[o])}renameComponent(e){const{id:t,newName:o,doc:n}=e;if(!n)return;const i=n.components.byId[t];if(!i||i.title===o||!o)return;const r=n.getUniqueCompOrPageName(o).trim();i.title=r}getNodesWithLinkFromComp(e){const t=[];return this.getNodesWithLinkRecursively(e,t),t}replacePropsInGeneratedNodes(e,t){const o=Object.keys(e.propDefinitions)[0];o&&e.propDefinitions[o].forEach((o=>{var n,i;const r=null===t||void 0===t||null===(n=t.attrs)||void 0===n||null===(i=n[o.name])||void 0===i?void 0:i.content;e.nodes.forEach((e=>{Ti.X.execute({node:e,propId:o.id,propDefinition:o,staticValue:r||o.defaultValue})}))}))}async generateSectionComponent(e,t){const n=await o(9425)(`./${e.toLowerCase()}.json`);return this.uidlToComponentMapper.mapUIDLsToComponents({doc:this.projectDoc,uidls:[{uidl:n,meta:{isPage:t}}]})}async generateInteractiveElement(e,t){const n=await o(73274)(`./${e.toLowerCase()}/${t.toLowerCase()}.json`);return this.uidlToComponentMapper.mapUIDLsToComponents({doc:this.projectDoc,uidls:[{uidl:n}]})}getNodesWithLinkRecursively(e,t){const o=this.projectDoc.nodes.byId[e];o&&(Object.keys(o.abilities).length&&t.push(o),Object.keys(o.childrenIds).forEach((e=>{this.getNodesWithLinkRecursively(e,t)})))}},li=(0,G.Z)(ai.prototype,"dbSync",[Ln],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ci=(0,G.Z)(ai.prototype,"projectDoc",[_n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),di=(0,G.Z)(ai.prototype,"projectUIState",[Rn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pi=(0,G.Z)(ai.prototype,"nodeSelectionFlow",[Bn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ui=(0,G.Z)(ai.prototype,"notificationsManagementFlow",[Hn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hi=(0,G.Z)(ai.prototype,"layoutManagementFlow",[zn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mi=(0,G.Z)(ai.prototype,"navbarFlow",[$n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gi=(0,G.Z)(ai.prototype,"uidlToComponentMapper",[Gn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yi=(0,G.Z)(ai.prototype,"webRTCState",[Vn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fi=(0,G.Z)(ai.prototype,"rtcFlow",[Jn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bi=(0,G.Z)(ai.prototype,"nodeManagementFlow",[Wn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wi=(0,G.Z)(ai.prototype,"collaboratorManagementFlow",[Kn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vi=(0,G.Z)(ai.prototype,"modalManagementFlow",[Yn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ii=(0,G.Z)(ai.prototype,"projectInitFlow",[Xn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Si=(0,G.Z)(ai.prototype,"cloudComponentsFlow",[qn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ji=(0,G.Z)(ai.prototype,"imageOptimisationFlow",[Qn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Di=(0,G.Z)(ai.prototype,"projectManagementFlow",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(ai.prototype,"beginEditing",[ti],Object.getOwnPropertyDescriptor(ai.prototype,"beginEditing"),ai.prototype),(0,G.Z)(ai.prototype,"createEmptyComponent",[oi],Object.getOwnPropertyDescriptor(ai.prototype,"createEmptyComponent"),ai.prototype),(0,G.Z)(ai.prototype,"importThqSectionSync",[Q.P],Object.getOwnPropertyDescriptor(ai.prototype,"importThqSectionSync"),ai.prototype),(0,G.Z)(ai.prototype,"createFromUIDL",[ni],Object.getOwnPropertyDescriptor(ai.prototype,"createFromUIDL"),ai.prototype),(0,G.Z)(ai.prototype,"addComponentMetaFromData",[Q.P],Object.getOwnPropertyDescriptor(ai.prototype,"addComponentMetaFromData"),ai.prototype),(0,G.Z)(ai.prototype,"deleteComponent",[ii],Object.getOwnPropertyDescriptor(ai.prototype,"deleteComponent"),ai.prototype),(0,G.Z)(ai.prototype,"executeComponentDeletion",[Q.P],Object.getOwnPropertyDescriptor(ai.prototype,"executeComponentDeletion"),ai.prototype),(0,G.Z)(ai.prototype,"duplicateComponent",[ri,Q.P],Object.getOwnPropertyDescriptor(ai.prototype,"duplicateComponent"),ai.prototype),(0,G.Z)(ai.prototype,"addComponentToSelectedElementPageOrComp",[Q.P],Object.getOwnPropertyDescriptor(ai.prototype,"addComponentToSelectedElementPageOrComp"),ai.prototype),(0,G.Z)(ai.prototype,"addComponentToNode",[Q.P],Object.getOwnPropertyDescriptor(ai.prototype,"addComponentToNode"),ai.prototype),(0,G.Z)(ai.prototype,"addComponentToLastVisitedPage",[Q.P],Object.getOwnPropertyDescriptor(ai.prototype,"addComponentToLastVisitedPage"),ai.prototype),(0,G.Z)(ai.prototype,"addIdToComponentSectionIds",[Q.P],Object.getOwnPropertyDescriptor(ai.prototype,"addIdToComponentSectionIds"),ai.prototype),(0,G.Z)(ai.prototype,"detachComponentInstance",[Q.P],Object.getOwnPropertyDescriptor(ai.prototype,"detachComponentInstance"),ai.prototype),(0,G.Z)(ai.prototype,"renameComponent",[Q.P],Object.getOwnPropertyDescriptor(ai.prototype,"renameComponent"),ai.prototype),si=ai));var Pi,ki,Mi,Zi,Ui,Ai,Li,_i,Ri,Bi,Hi,zi,$i=o(33800),Gi=o(9626),Vi=o(83140),Ji=o(23121);Pi=(0,J.JJ)("stageScrollFlow"),ki=(0,J.f3)("projectUIState"),Mi=(0,J.f3)("projectDoc"),Zi=(0,J.f3)("nodeStyleManagmentFlow"),Ui=(0,J.f3)("elementRefProvider"),Pi((zi=new WeakMap,Li=class{constructor(){(0,z.Z)(this,"projectUIState",_i,this),(0,z.Z)(this,"projectDoc",Ri,this),(0,z.Z)(this,"nodeStyleManagmentFlow",Bi,this),(0,z.Z)(this,"elementRefProvider",Hi,this),(0,$.Z)(this,"animationFrame",void 0),(0,$.Z)(this,"start",null),zi.set(this,{writable:!0,value:null}),(0,$.Z)(this,"x",0),(0,$.Z)(this,"y",0),(0,$.Z)(this,"destinationY",0),(0,$.Z)(this,"stepY",0),(0,$.Z)(this,"signY",!1),(0,$.Z)(this,"lastFrameTimestamp",0),(0,$.Z)(this,"step",(e=>{null===this.start&&(this.start=e,this.lastFrameTimestamp=e);const t=e-this.start;if(t>=499)return this.setStageXY(this.x,this.destinationY),void this.resetState();const o=e-this.lastFrameTimestamp||16;this.lastFrameTimestamp=e,this.stepY=o*Math.abs(this.destinationY-this.y)/(500-t),this.signY?this.y=this.y<this.destinationY?this.y+this.stepY:this.destinationY:this.y=this.y>this.destinationY?this.y-this.stepY:this.destinationY,this.setStageXY(this.x,this.y),this.animationFrame=requestAnimationFrame(this.step)}))}bringNodeIntoView(e,t){this.resetState(),(0,Gi.Z)(this,zi,document.getElementById("frame-container"));const o=this.projectDoc.getProjectPageOrComponent(this.projectUIState.selection.componentId);if(e===(null===o||void 0===o?void 0:o.rootNodeId))return;if(!(0,$i.Z)(this,zi))return;if("none"===this.nodeStyleManagmentFlow.getCurrentStyleValueByKeyForNode(e,["display"]).display||this.nodeStyleManagmentFlow.ancestorHasStyleAtCurrentBreakpoint({nodeId:e,key:"display",values:["none"]}))return;const n=this.elementRefProvider.getDomTargetNode(e,t);if(!n)return;const i=n.getBoundingClientRect();if(!this.elementRectVisibleInStage(i)){const e=(0,$i.Z)(this,zi).getBoundingClientRect(),t=1-(i.top+i.height/2)*this.projectUIState.stage.webComp.controlValues.scale/e.height,o=this.projectUIState.stage.webComp,n=null===o||void 0===o?void 0:o.controlValues.x,r=null===o||void 0===o?void 0:o.controlValues.y;if(void 0===n||void 0===r)return;this.destinationY=t,this.signY=r-t<0,this.x=n,this.y=r,this.animationFrame=requestAnimationFrame(this.step)}}setStageXY(e,t){(0,V.JG)(this.projectUIState,(o=>{o.stage.webComp.controlValues.x=e,o.stage.webComp.controlValues.y=t}))}resetState(){this.animationFrame&&cancelAnimationFrame(this.animationFrame),this.start=null}elementRectVisibleInStage(e){if(!(0,$i.Z)(this,zi))return;const t=(0,$i.Z)(this,zi).getBoundingClientRect(),o=e.bottom*this.projectUIState.stage.webComp.controlValues.scale,n=e.top*this.projectUIState.stage.webComp.controlValues.scale,i=t.top;return o+i>Vi.Mz+Ji.i&&n+i<window.innerHeight}},_i=(0,G.Z)(Li.prototype,"projectUIState",[ki],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ri=(0,G.Z)(Li.prototype,"projectDoc",[Mi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bi=(0,G.Z)(Li.prototype,"nodeStyleManagmentFlow",[Zi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hi=(0,G.Z)(Li.prototype,"elementRefProvider",[Ui],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ai=Li));var Wi=o(92461),Ki=o(65989);[`.breakpoints-selector-overflow-container.jsx-1360976396{z-index:${Ki.kg.TEN};position:absolute;top:0;left:0;bottom:0;right:0;overflow:visible;background:${Ki.Pt.DEFAULT};height:24px;box-shadow:${Ki.E6.DARK_DROP};}`,".breakpoints-selector.jsx-1360976396{height:24px;-webkit-transform-origin:0 0;-ms-transform-origin:0 0;transform-origin:0 0;left:0;position:relative;}",`.breakpoints-selector.jsx-1360976396 .breakpoint-bar{z-index:2;height:24px;background:${Ki.Pt.DEFAULT};border-left:0.5px solid ${Ki.Pt.DARK_02};border-right:0.5px solid ${Ki.Pt.DARK_02};margin:0 auto;}`,`.breakpoints-selector.jsx-1360976396 .breakpoint-bar.selected{background:${Ki.Pt.DARK_01};}`,".current-breakpoint-indicator.jsx-1360976396{max-width:430px;height:24px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;pointer-events:none;z-index:3;position:absolute;top:0;left:0;right:0;bottom:0;margin:auto;}",".viewport-icon.jsx-1360976396{margin-right:8px;line-height:0;}"].__hash="1360976396";var Yi,Xi,qi,Qi,er,tr,or,nr=o(68124);Yi=(0,J.JJ)("stageMoveFlow"),Xi=(0,J.f3)("projectUIState"),qi=(0,J.f3)("projectDoc"),Yi((er=class{constructor(){(0,z.Z)(this,"projectUIState",tr,this),(0,z.Z)(this,"projectDoc",or,this),(0,$.Z)(this,"animationFrame",void 0),(0,$.Z)(this,"direction",null),(0,$.Z)(this,"position",{x:0,y:0}),(0,$.Z)(this,"move",(()=>{(0,V.JG)(this.projectUIState,(({stage:e})=>{const t=this.projectUIState.stage.webComp,o=null===t||void 0===t?void 0:t.controlValues.scale,n=1/Math.max(o,1)/75;switch(this.direction){case"top":return void(e.webComp.controlValues.y=Math.min(e.webComp.controlValues.y+n,1));case"bottom":return void(e.webComp.controlValues.y=Math.max(e.webComp.controlValues.y-n,0));case"left":return void(e.webComp.controlValues.x=Math.min(e.webComp.controlValues.x+n,1));case"right":return void(e.webComp.controlValues.x=Math.max(e.webComp.controlValues.x-n,0))}}))})),(0,$.Z)(this,"getDragNearStageMarginValue",(e=>{const t=document.body.clientWidth,o=document.body.clientHeight;if(e.x>t-Wi.ak-50)return"right";const n=this.projectUIState.layout.sidebarPanel?Wi.ak+Wi.ZR:Wi.ZR;return e.x<n+50?"left":e.y>o-50?"bottom":e.y<Vi.Mz+24+50?"top":null})),this.moveStage=this.moveStage.bind(this)}checkAndMoveStage(e){this.resetState(),this.position=e,this.animationFrame=requestAnimationFrame(this.moveStage)}centerStage(){(0,V.JG)(this.projectUIState,(e=>{e.stage.webComp.controlValues.x=nr.m7.controlValues.x,e.stage.webComp.controlValues.y=nr.m7.controlValues.y}))}moveStage(){this.direction=this.getDragNearStageMarginValue({x:this.position.x,y:this.position.y}),this.projectUIState.drag.draggedEntity?this.direction&&(this.move(),this.animationFrame=requestAnimationFrame(this.moveStage)):this.resetState()}resetState(){this.animationFrame&&cancelAnimationFrame(this.animationFrame)}},tr=(0,G.Z)(er.prototype,"projectUIState",[Xi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),or=(0,G.Z)(er.prototype,"projectDoc",[qi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qi=er));var ir=o(40615),rr=o(37326),sr=o(5360),ar=o(246),lr=o(78460),cr=o(68803),dr=o(42297),pr=o(67294),ur=o(89361),hr=o(92763),mr=o(84073),gr=o(85893);const yr=e=>{const{onDismiss:t,classToDelete:o,onSubmit:n}=e;return(0,gr.jsxs)("div",{className:"delete-token-modal",children:[(0,gr.jsxs)("div",{className:"modal-title",children:["Delete project class-",o.name]}),(0,gr.jsx)(hr.J,{type:"error",size:32}),(0,gr.jsx)("p",{className:"warning-message",children:"You are about to remove a project class that is bound to nodes in the project. Doing this will unbind the class from all the nodes."}),(0,gr.jsxs)("p",{className:"warning-message",children:[Object.keys(o.usedInNodes).length," node/s bound to the project class."]}),(0,gr.jsxs)("p",{className:"warning-message",children:["Are you sure you want to delete project class: ",o.name," from the list?"]}),(0,gr.jsxs)("div",{className:"modal-buttons",children:[(0,gr.jsx)(ur.z,{style:"solid",colorScheme:"neutral",onClick:t,children:"Cancel"}),(0,gr.jsx)(ur.z,{style:"solid",colorScheme:"danger",onClick:n,children:"Delete"})]}),(0,gr.jsx)("style",{children:mr.mZ})]})};var fr,br,wr,vr,Ir,Sr,jr,Dr,Or,Fr,Tr,Nr,Er,Cr,xr,Pr,kr,Mr,Zr,Ur,Ar,Lr,_r;function Rr(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Br(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Rr(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Rr(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}fr=(0,J.JJ)("projectClassManagementFlow"),br=(0,J.f3)("projectDoc"),wr=(0,J.f3)("projectUIState"),vr=(0,J.f3)("nodeManagementFlow"),Ir=(0,J.f3)("nodeStyleManagmentFlow"),Sr=(0,J.f3)("sharedbProjectSyncService"),jr=(0,J.f3)("designLanguageManagementFlow"),Dr=(0,J.f3)("modalManagementFlow"),Or=(0,J.f3)("positioningService"),Fr=(0,J.f3)("assetsManagementFlow"),Tr=(0,dr.u)(dr.j.UPDATE_CLASS_STYLE),Nr=(0,dr.u)(dr.j.UPDATE_CLASS_STYLE),fr((Cr=class{constructor(){(0,z.Z)(this,"projectDoc",xr,this),(0,z.Z)(this,"projectUIState",Pr,this),(0,z.Z)(this,"nodeManagementFlow",kr,this),(0,z.Z)(this,"nodeStyleManagmentFlow",Mr,this),(0,z.Z)(this,"dbSync",Zr,this),(0,z.Z)(this,"designLanguageManagementFlow",Ur,this),(0,z.Z)(this,"modalManagementFlow",Ar,this),(0,z.Z)(this,"positioningService",Lr,this),(0,z.Z)(this,"assetsManagementFlow",_r,this)}updateName(e){const{doc:t,classId:o,name:n}=e;if(!t)return;t.classes.byId[o].name=n}toggleClassOnNodes(e){const{classId:t,nodeIds:o}=e;(0,V.JG)(this.projectDoc,(e=>{const n=e.classes.byId[t];o.forEach((e=>{n.disabledInNodes||(n.disabledInNodes={}),n.disabledInNodes[e]=!n.disabledInNodes[e]}))}))}bindClassToNodes({doc:e,classId:t,nodeIds:o}){e&&o.forEach((o=>{this.nodeStyleManagmentFlow.bindProjectStyleToNode({doc:e,refId:t,nodeId:o})}))}bindDefaultClassByNodePrimitive(e){var t;const{node:o}=e;if(!o.primitiveType)return;const n=lr.VM[o.primitiveType];if(!n)return;const i=null===(t=this.projectDoc.classes.getAll().find((e=>e.name===n)))||void 0===t?void 0:t.id;if(!i)return;const r={id:i,type:"style-map",content:{mapType:"project-referenced",referenceId:i}};o.referencedStyles[r.id]=r,this.dbSync.mutate(this.projectDoc,(e=>{const t=e.classes.byId[i];if(!t)throw new Error(`Project is missing class from the style sheet - ${i}`);t.usedInNodes[o.id]=!0}))}removeAllClassesFromNode(e){const{doc:t,nodeId:o}=e;if(!t)return;const n=t.nodes.byId[o];Object.values((null===n||void 0===n?void 0:n.referencedStyles)||{}).filter((e=>"project-referenced"===e.content.mapType)).forEach((e=>{this.nodeStyleManagmentFlow.unbindProjectStyleFromNodeIds({doc:t,nodeIds:[o],classId:e.id})}))}getClassesUsedByNodes(e){return this.projectDoc.getUsedProjectClassesForNodesByPos(e).map((e=>e.id))}removeFromNodes({doc:e,classId:t,nodeIds:o}){e&&this.nodeStyleManagmentFlow.unbindProjectStyleFromNodeIds({doc:e,classId:t,nodeIds:o})}addClass(e){const{classToAdd:t,doc:o}=e;if(!o)return;const n=this.positioningService.getHighestAvailablePosition({entitiyCollection:o.classes.byId});t.pos=n;Object.values(o.classes.byId).find((e=>e.name===t.name))?(t.name=(0,W.Zu)(Object.values(o.classes.byId).map((e=>e.name)),t.name),o.classes.byId[t.id]=t):o.classes.byId[t.id]=t}deleteAndUnbind({doc:e,classId:t}){if(!e||!t)return;const o=this.findClassFromDoc(t,e);this.nodeStyleManagmentFlow.unbindProjectStyleFromNodeIds({doc:e,classId:t,nodeIds:Object.keys((null===o||void 0===o?void 0:o.usedInNodes)||{})}),this.assetsManagementFlow.removeClassRelationsFromAssets({doc:e,classId:t}),delete e.classes.byId[t]}deleteStyle(e){const{classId:t,doc:o,identifier:n,key:i}=e;if(!o)return;const r=this.findClassFromDoc(t,o);if("string"===typeof n)return"desktop"===n?void r.deletePropertyByKey(i,o.assets):void r.deletePropertyFromStateCondition(i,n,o.assets);"number"===typeof n&&r.deletePropertyFromMediaCondition(i,n,o.assets)}addOrUpdate(e){const{doc:t,classId:o,key:n,value:i,identifier:r,tokenId:s,oldKey:a}=e;if(!t)return;const l=this.findClassFromDoc(o,t),c=(0,cr.B)(i).map((e=>this.projectDoc.assets.byId[e]));if(a&&this.deleteStyle({doc:t,classId:o,key:a,identifier:r}),"string"===typeof r)return"desktop"===r?(l.addPropertyToContent(Br({key:n,value:i},s&&{tokenId:s})),void c.forEach((e=>null===e||void 0===e?void 0:e.addClassRelation(o)))):(l.addPropertyToStateCondition(Br({key:n,value:i,identifier:r},s&&{tokenId:s})),void c.forEach((e=>null===e||void 0===e?void 0:e.addClassRelation(o))));"number"===typeof r&&(l.addPropertyToMediaCondition(Br(Br({},s&&{tokenId:s}),{},{key:n,value:i,viewPort:r})),c.forEach((e=>null===e||void 0===e?void 0:e.addClassRelation(o))))}deleteAndCheckBoundNodes({doc:e,classId:t}){const o=this.projectDoc.classes.byId[t];if(!o)return;if(Object.keys(o.usedInNodes).length){const e=Jo.d.createCustomModal({data:{classToDelete:o},Component:yr,onSubmit:()=>{this.deleteAndUnbind({classId:t}),this.modalManagementFlow.hideModal()}});this.modalManagementFlow.showModal(e)}else this.deleteAndUnbind({doc:e,classId:t})}createAndBindClassToNode(e){const{nodeId:t,name:o}=e,n=this.getNewClassObjectWithNodeStyles({name:o,nodeId:t});return n?(this.dbSync.mutate(this.projectDoc,(e=>{e.classes.createNewProjectClass(n),this.resetNodeStylesAfterExtract({doc:e,nodeId:t,classId:n.id}),this.nodeStyleManagmentFlow.bindProjectStyleToNode({doc:e,refId:n.id,nodeId:t})})),n.id):null}createEmptyClass(){const e=Object.values(this.projectDoc.classes.categoriesById||{})[0].id,t=new ir.q({pos:this.positioningService.getHighestAvailablePosition({entitiyCollection:this.projectDoc.classes.byId}),content:{},conditions:{},name:this.projectDoc.classes.getUniqueClassName("classname"),categoryId:e,linkedTextStyles:{}});return this.dbSync.mutate(this.projectDoc,(e=>{e.classes.createNewProjectClass(t)})),t.id}createFromNodeStyles(e){const{name:t,nodeId:o}=e,n=this.getNewClassObjectWithNodeStyles({name:t,nodeId:o});return n?(this.dbSync.mutate(this.projectDoc,(e=>{e.classes.createNewProjectClass(n),this.resetNodeStylesAfterExtract({doc:e,nodeId:o,classId:n.id})})),n.id):null}getMissingStatesForClass(e){const t=new Set(Object.values(ct.F)),o=this.projectDoc.classes.byId[e];return o?o.getMissingStates():Array.from(t)}addStyleState(e){const{doc:t,classId:o,state:n}=e;if(!t)return;const i=t.classes.byId[o];if(!i)return;const r=(0,lt.Z)(),s={id:r,type:"element-state",content:{},meta:{state:n}};i.conditions[r]=s}removeStyleState(e){const{doc:t,classId:o,state:n}=e;if(!t)return;const i=t.classes.byId[o];if(!i)return;const r=Object.values(i.conditions).find((e=>"element-state"===e.type&&e.meta.state===n));r&&delete i.conditions[r.id]}removeTextStyleReferenceFromAllClass(e){const{doc:t,textStyleId:o}=e;t&&Object.values(t.classes.byId).forEach((e=>{delete e.linkedTextStyles[o]}))}unbindTokenFromClasses(e){const{doc:t,tokenId:o}=e;if(!t)return;const n=t.designLanguage.tokensById[o];if(!n)throw new Error(`Token which needs to unbind is not found in project - ${o}`);Object.values(t.classes.byId||{}).forEach((e=>{const{content:t,conditions:o}=e;this.replaceTokenToStatic(t,n.id,n.value),Object.values(o).forEach((e=>{null!==e&&void 0!==e&&e.content&&this.replaceTokenToStatic(e.content,n.id,n.value)}))}))}duplicateClass(e){const{classId:t,doc:o}=e;if(!o)return;const n=this.projectDoc.classes.byId[t];if(!n)return null;const i=this.cloneStylesObject(n.content),r=this.cloneReferencedStylesObject(n.conditions),s=n.linkedTextStyles,a=Object.values(this.projectDoc.classes.categoriesById||{})[0].id,l=new ir.q({pos:this.positioningService.getPositionAfterEntity({entitiyCollection:this.projectDoc.classes.byId,entity:n}),content:i,conditions:r,name:this.projectDoc.classes.getUniqueClassName(n.name),categoryId:a,linkedTextStyles:s});Object.values(o.assets.byId).forEach((e=>{var t;null!==(t=e.usedInClasses)&&void 0!==t&&t[n.id]&&(e.usedInClasses[l.id]=e.usedInClasses[n.id])})),o.classes.createNewProjectClass(l)}extractCurrentNodeStylesToClass(e){const{nodeId:t,classId:o,doc:n}=e;if(!n)return;let i={},r={},s={};const a=this.getNodeStylesForClass({nodeId:t});i=(null===a||void 0===a?void 0:a.styles)||{},r=(null===a||void 0===a?void 0:a.conditions)||{},s=(null===a||void 0===a?void 0:a.textStyles)||{};const l=n.classes.byId[o];l.content=i,l.conditions=r,l.linkedTextStyles=s,this.designLanguageManagementFlow.unBindTextStyleFromNodes({doc:n,nodeIds:[t],textStyleId:Object.keys(s)[0]}),this.resetNodeStylesAfterExtract({doc:n,nodeId:t,classId:o})}extractStylesFromClassToNode(e){var t;const{classId:o,doc:n,targetNodeId:i}=e;if(!n||!o||!i)return;const r=n.nodes.byId[i];if(!r)return;const s=n.classes.byId[o];if(!s)return;const a={},l=this.cloneStylesObject(null!==(t=null===s||void 0===s?void 0:s.content)&&void 0!==t?t:{},a),c=Object.values((null===s||void 0===s?void 0:s.conditions)||{}).reduce(((e,t)=>{const o={id:(0,lt.Z)(),type:"style-map",content:{mapType:"inlined",conditions:"element-state"===t.type?[{conditionType:"element-state",content:t.meta.state}]:[{conditionType:"screen-size",maxWidth:t.meta.maxWidth}],styles:this.cloneStylesObject((null===t||void 0===t?void 0:t.content)||{},a)}};return e[o.id]=o,e}),{}),d=n.designLanguage.textStyleSetsById[Object.keys((null===s||void 0===s?void 0:s.linkedTextStyles)||{})[0]];if(d){const e={id:(0,lt.Z)(),type:"style-map",content:{referenceId:d.id,mapType:"design-language-referenced"}};c[e.id]=e,d.usedInNodes[i]=!0}s.content={},s.conditions={},s.linkedTextStyles={};const p=Object.values(r.referencedStyles).reduce(((e,t)=>("project-referenced"===t.content.mapType&&(e[t.id]=t),e)),{});r.referencedStyles=c,Object.entries(p).forEach((([e,t])=>{r.referencedStyles[e]=t})),r.styles=l,Object.entries(a).forEach((([e,t])=>{const o=n.designLanguage.tokensById[e];o&&(o.usedInNodes[i]=t)})),this.transferAssetRelationsFromClassToNode({doc:n,nodeId:i,classId:o})}checkIfNodeStylesIsEmpty(e){const t=this.getNodeStylesForClass({nodeId:e});let o=!0;const n=(null===t||void 0===t?void 0:t.conditions)||{};for(const i in n)Object.keys(n[i].content).length>0&&(o=!1);return!(null!==t&&void 0!==t&&t.styles&&null!==t&&void 0!==t&&t.textStyles&&null!==t&&void 0!==t&&t.conditions&&(Object.keys(t.styles).length>0||Object.keys(t.textStyles).length>0||!o))}updateClassWithCurrentNodeStyles(e){const{classId:t,doc:o,nodeId:n}=e;if(!o||!t||!n)return;let i={},r={},s={};const a=this.getNodeStylesForClass({nodeId:n});i=(null===a||void 0===a?void 0:a.styles)||{},r=(null===a||void 0===a?void 0:a.conditions)||{},s=(null===a||void 0===a?void 0:a.textStyles)||{};const l=o.classes.byId[t];l.content=Br(Br({},l.content),i),Object.values(r).forEach((e=>{const t=Object.values(l.conditions).find((t=>"element-state"===t.type?t.type===e.type&&t.meta.state===e.meta.state:"screen-size"===t.type?t.type===e.type&&t.meta.maxWidth===e.meta.maxWidth:void 0));t?l.conditions[t.id].content=Br(Br({},t.content),e.content):l.conditions[e.id]=e}));const c=Object.keys(s)[0];c&&(Object.keys(l.linkedTextStyles).forEach((e=>{delete l.linkedTextStyles[e]})),l.linkedTextStyles[c]=!0,this.designLanguageManagementFlow.unBindTextStyleFromNodes({doc:o,nodeIds:[n],textStyleId:c})),this.resetNodeStylesAfterExtract({doc:o,nodeId:n,classId:t})}resetNodeStylesAfterExtract(e){const{doc:t,nodeId:o,classId:n}=e;if(!t||!o)return;const i=t.nodes.byId[o];i&&(i.styles={},Object.keys(i.referencedStyles||{}).forEach((e=>{"project-referenced"!==i.referencedStyles[e].content.mapType&&delete i.referencedStyles[e]})),i.primitiveType!==dt.sO.IMAGE&&i.primitiveType!==dt.sO.VIDEO&&(n?this.transferAssetRelationsFromNodeToClass({nodeId:o,classId:n,doc:t}):this.assetsManagementFlow.removeNodeRelationsFromAssets({nodeId:o,doc:t})))}transferAssetRelationsFromNodeToClass(e){const{doc:t,nodeId:o,classId:n}=e;t&&Object.values(t.assets.byId).forEach((e=>{e.usedInNodes[o]&&(e.usedInClasses||(e.usedInClasses={}),e.usedInClasses[n]=1,delete e.usedInNodes[o])}))}transferAssetRelationsFromClassToNode(e){const{doc:t,nodeId:o,classId:n}=e;t&&Object.values(t.assets.byId).forEach((e=>{var t;null!==(t=e.usedInClasses)&&void 0!==t&&t[n]&&(e.usedInNodes[o]=!0,delete e.usedInClasses[n])}))}cloneReferencedStylesObject(e,t){return Object.values(e||{}).reduce(((e,o)=>{switch(o.type){case"screen-size":{const n={id:(0,lt.Z)(),type:"screen-size",content:this.cloneStylesObject(o.content,t),meta:{maxWidth:o.meta.maxWidth}};e[n.id]=n;break}case"element-state":{const n={id:(0,lt.Z)(),type:"element-state",content:this.cloneStylesObject(o.content,t),meta:{state:o.meta.state}};e[n.id]=n;break}}return e}),{})}cloneStylesObject(e,t){return Object.keys(e||{}).reduce(((o,n)=>{const i=e[n];return o[n]=i.clone(),t&&"dynamic"===i.type&&"token"===i.content.referenceType&&(t[i.content.id]?t[i.content.id]++:t[i.content.id]=1),o}),{})}getNewClassObjectWithNodeStyles(e){const{name:t,nodeId:o}=e;if(this.projectDoc.classes.getAll().find((e=>e.name.toLowerCase()===t.toLowerCase())))return null;let n={},i={},r={};if(o){const e=this.getNodeStylesForClass({nodeId:o});n=(null===e||void 0===e?void 0:e.styles)||{},i=(null===e||void 0===e?void 0:e.conditions)||{},r=(null===e||void 0===e?void 0:e.textStyles)||{}}const s=Object.values(this.projectDoc.classes.categoriesById||{})[0].id;return new ir.q({pos:this.positioningService.getHighestAvailablePosition({entitiyCollection:this.projectDoc.classes.byId}),content:n,conditions:i,name:t,categoryId:s,linkedTextStyles:r})}findClassFromDoc(e,t){const o=t.classes.byId[e];if(!o)throw new Error(`Class is missing from project - ${e}`);return o}replaceTokenToStatic(e,t,o){Object.keys(e).forEach((n=>{const i=e[n];"dynamic"===i.type&&"token"===i.content.referenceType&&i.content.id===t&&(e[n]=new ar.F({content:o}))}))}getNodeStylesForClass({nodeId:e}){const t=this.projectDoc;if(!t.nodes.byId[e])return;const o=new Set(this.projectDoc.mediaQueryBreakpoints.getNonDefaultActiveMQBreakpointsInOrder().map((e=>e.maxWidth))),n=sr.S.execute({doc:t,nodeId:e})||{},i=rr.l.execute({doc:t,nodeId:e}),r={},s=Object.values(i||{}).reduce(((e,t)=>{var n,i;if("design-language-referenced"===t.content.mapType&&(r[t.content.referenceId]=!0),"inlined"===t.content.mapType&&1===(null===(n=t.content)||void 0===n||null===(i=n.conditions)||void 0===i?void 0:i.length))switch(t.content.conditions[0].conditionType){case"screen-size":{const n={id:(0,lt.Z)(),type:"screen-size",content:t.content.styles,meta:{maxWidth:t.content.conditions[0].maxWidth}};o.has(n.meta.maxWidth)&&o.delete(n.meta.maxWidth),e[n.id]=n;break}case"element-state":{const o={id:(0,lt.Z)(),type:"element-state",content:t.content.styles,meta:{state:t.content.conditions[0].content}};e[o.id]=o;break}}return e}),{});return o.size>0&&Array.from(o).forEach((e=>{const t={id:(0,lt.Z)(),type:"screen-size",meta:{maxWidth:e},content:{}};s[t.id]=t})),{styles:n,conditions:s,textStyles:r}}getResolvedStylesForRendering(e="stage"){const t=Object.values(this.projectDoc.classes.getSortedClassesListByPos()),o={},n={};let i="";return t.forEach((t=>{const{content:i,conditions:r}=t,s=this.nodeStyleManagmentFlow.resolveStaticAndDynamicNodes({styles:i,dynamicStyleResult:"variable",replaceAssetIdsWithSrcs:!0,ignoreDisabledNodes:"stage"===e});o[t.identifier]=(0,ft.$e)(s,e),Object.keys(r).forEach((i=>{const s=r[i];if("preview"===e&&"element-state"===s.type&&Object.keys((null===s||void 0===s?void 0:s.content)||{}).length>0){const{state:n}=s.meta;o[`${t.identifier}:${n}`]=(0,ft.$e)(this.nodeStyleManagmentFlow.resolveStaticAndDynamicNodes({styles:s.content,dynamicStyleResult:"variable",replaceAssetIdsWithSrcs:!0}),e)}if("screen-size"===s.type&&Object.keys(s.content||{}).length>0){const{maxWidth:o}=s.meta;n[String(o)]=Br(Br({},n[String(o)]),{},{[t.identifier]:(0,ft.$e)(this.nodeStyleManagmentFlow.resolveStaticAndDynamicNodes({styles:s.content,dynamicStyleResult:"variable",replaceAssetIdsWithSrcs:!0,ignoreDisabledNodes:"stage"===e}),e)})}}))})),i=(0,ft.f7)(o)+"\n",Object.keys(n).sort(((e,t)=>Number(e)-Number(t))).reverse().forEach((e=>{const t=n[e]||{};let o=`\n@media(max-width: ${e}px) {`;o=o+(0,ft.f7)(t)+"\n",o+="}\n",i+=o})),i}getResolvedInteractionStateForClasses(e){const t=this.positioningService.orderEntities({entitiyCollection:this.projectDoc.classes.byId,entitiesOfInterest:e});let o={};return t.forEach((e=>{const t=this.projectDoc.classes.byId[e];if(!t)return;const{conditions:n}=t;Object.keys(n).forEach((e=>{const t=n[e];"element-state"===t.type&&t.meta.state===this.projectUIState.stage.interactionState.state&&Object.keys((null===t||void 0===t?void 0:t.content)||{}).length>0&&(o=Br(Br({},o),this.nodeStyleManagmentFlow.resolveStaticAndDynamicNodes({styles:t.content,dynamicStyleResult:"variable",replaceAssetIdsWithSrcs:!0})))}))})),o}toggleClassPropertyByKey(e){const{classId:t,identifier:o,key:n}=e;(0,V.JG)(this.projectDoc,(e=>{const i=this.findClassFromDoc(t,e);if("string"===typeof o)return"desktop"===o?void i.togglePropertyByKey(n):void i.togglePropertyFromStateCondition(n,o);"number"!==typeof o||i.togglePropertyFromMediaCondition(n,o)}))}},xr=(0,G.Z)(Cr.prototype,"projectDoc",[br],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pr=(0,G.Z)(Cr.prototype,"projectUIState",[wr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kr=(0,G.Z)(Cr.prototype,"nodeManagementFlow",[vr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mr=(0,G.Z)(Cr.prototype,"nodeStyleManagmentFlow",[Ir],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zr=(0,G.Z)(Cr.prototype,"dbSync",[Sr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ur=(0,G.Z)(Cr.prototype,"designLanguageManagementFlow",[jr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ar=(0,G.Z)(Cr.prototype,"modalManagementFlow",[Dr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lr=(0,G.Z)(Cr.prototype,"positioningService",[Or],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_r=(0,G.Z)(Cr.prototype,"assetsManagementFlow",[Fr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(Cr.prototype,"updateName",[Q.P],Object.getOwnPropertyDescriptor(Cr.prototype,"updateName"),Cr.prototype),(0,G.Z)(Cr.prototype,"bindClassToNodes",[Q.P],Object.getOwnPropertyDescriptor(Cr.prototype,"bindClassToNodes"),Cr.prototype),(0,G.Z)(Cr.prototype,"removeAllClassesFromNode",[Q.P],Object.getOwnPropertyDescriptor(Cr.prototype,"removeAllClassesFromNode"),Cr.prototype),(0,G.Z)(Cr.prototype,"removeFromNodes",[Q.P],Object.getOwnPropertyDescriptor(Cr.prototype,"removeFromNodes"),Cr.prototype),(0,G.Z)(Cr.prototype,"addClass",[Q.P],Object.getOwnPropertyDescriptor(Cr.prototype,"addClass"),Cr.prototype),(0,G.Z)(Cr.prototype,"deleteAndUnbind",[Q.P],Object.getOwnPropertyDescriptor(Cr.prototype,"deleteAndUnbind"),Cr.prototype),(0,G.Z)(Cr.prototype,"deleteStyle",[Q.P,Tr],Object.getOwnPropertyDescriptor(Cr.prototype,"deleteStyle"),Cr.prototype),(0,G.Z)(Cr.prototype,"addOrUpdate",[Q.P,Nr],Object.getOwnPropertyDescriptor(Cr.prototype,"addOrUpdate"),Cr.prototype),(0,G.Z)(Cr.prototype,"deleteAndCheckBoundNodes",[Q.P],Object.getOwnPropertyDescriptor(Cr.prototype,"deleteAndCheckBoundNodes"),Cr.prototype),(0,G.Z)(Cr.prototype,"addStyleState",[Q.P],Object.getOwnPropertyDescriptor(Cr.prototype,"addStyleState"),Cr.prototype),(0,G.Z)(Cr.prototype,"removeStyleState",[Q.P],Object.getOwnPropertyDescriptor(Cr.prototype,"removeStyleState"),Cr.prototype),(0,G.Z)(Cr.prototype,"removeTextStyleReferenceFromAllClass",[Q.P],Object.getOwnPropertyDescriptor(Cr.prototype,"removeTextStyleReferenceFromAllClass"),Cr.prototype),(0,G.Z)(Cr.prototype,"duplicateClass",[Q.P],Object.getOwnPropertyDescriptor(Cr.prototype,"duplicateClass"),Cr.prototype),(0,G.Z)(Cr.prototype,"extractCurrentNodeStylesToClass",[Q.P],Object.getOwnPropertyDescriptor(Cr.prototype,"extractCurrentNodeStylesToClass"),Cr.prototype),(0,G.Z)(Cr.prototype,"extractStylesFromClassToNode",[Q.P],Object.getOwnPropertyDescriptor(Cr.prototype,"extractStylesFromClassToNode"),Cr.prototype),(0,G.Z)(Cr.prototype,"updateClassWithCurrentNodeStyles",[Q.P],Object.getOwnPropertyDescriptor(Cr.prototype,"updateClassWithCurrentNodeStyles"),Cr.prototype),(0,G.Z)(Cr.prototype,"resetNodeStylesAfterExtract",[Q.P],Object.getOwnPropertyDescriptor(Cr.prototype,"resetNodeStylesAfterExtract"),Cr.prototype),(0,G.Z)(Cr.prototype,"transferAssetRelationsFromNodeToClass",[Q.P],Object.getOwnPropertyDescriptor(Cr.prototype,"transferAssetRelationsFromNodeToClass"),Cr.prototype),(0,G.Z)(Cr.prototype,"transferAssetRelationsFromClassToNode",[Q.P],Object.getOwnPropertyDescriptor(Cr.prototype,"transferAssetRelationsFromClassToNode"),Cr.prototype),Er=Cr));var Hr=o(91164);class zr{constructor(e){(0,$.Z)(this,V.t1,!0),(0,$.Z)(this,"type","conditional"),(0,$.Z)(this,"reference",void 0),(0,$.Z)(this,"condition",void 0),(0,$.Z)(this,"value",void 0);const{reference:t,condition:o,value:n}=e;this.reference=t,this.condition=o,this.value=n}}var $r=o(14246);const Gr=new class{constructor(){(0,$.Z)(this,"execute",(e=>{const{doc:t,targetNodeId:o,nodeId:n}=e;if(!t)return null;const i=t.nodes.byId[n];if(!i)throw new Error("Node to clone referencedStyles is missing");return Object.keys(i.referencedStyles||{}).reduce(((e,n)=>{const r=i.referencedStyles[n],{type:s,content:a}=r;if("style-map"===s&&"project-referenced"===a.mapType){const n=a.referenceId;e[n]={id:n,type:"style-map",content:{mapType:"project-referenced",referenceId:a.referenceId}};const i=t.classes.byId[a.referenceId];if(!i||!o)return e;i.usedInNodes[o]=!0}return e}),{})}))}};Object.freeze(Gr);var Vr,Jr,Wr,Kr,Yr,Xr,qr,Qr,es,ts=o(29389),os=o(39078),ns=o(70057),is=o(3980);let rs;!function(e){e.ACTIONABLE="isActionable",e.CLASS_NAME="className"}(rs||(rs={}));Vr=(0,J.JJ)("htmlValidator"),Jr=(0,J.f3)("cssToDomainFlow"),Wr=(0,J.f3)("projectDoc"),Kr=(0,J.f3)("workersProvider"),Vr((Xr=class{constructor(){(0,z.Z)(this,"cssToDomainFlow",qr,this),(0,z.Z)(this,"projectDoc",Qr,this),(0,z.Z)(this,"workersProvider",es,this),(0,$.Z)(this,"validateHtmlCode",(async e=>{const{code:t,checkIfTeleportCompatible:o}=e,n=await this.workersProvider.generateHtmlTreeFromCode(t),i=[];return Object.values((null===n||void 0===n?void 0:n.nodes)||{}).map((e=>{if(!e.tag||!e.tagNumber)return;const r=e.isClosingTag?`/${e.tag}`:e.tag,s=[];if(o&&s.push(...this.checkIfNodeIsTeleportCompatible(e,n.nodes)),"style"===e.tag){const t=Object.values(e.children);var a;if(t.length>1)s.push({message:"Style tag should not host other tags.",type:"CSS",severity:"error"});else s.push(...this.processStyleTagContent({content:(null===(a=t[0])||void 0===a?void 0:a.content)||"",checkIfTeleportCompatible:o}))}if(e.ended||s.push({message:`Unended tag "${e.tag}"`,type:"HTML",severity:"error"}),e.closed||s.push({message:`Unclosed tag "${e.tag}"`,type:"HTML",severity:"error"}),e.error&&s.push({message:e.error,type:"HTML",severity:"error"}),s.length){const o=this.getNewlinesUpToNthWord(t,this.generateRegexForTag(r),e.tagNumber);s.forEach((e=>e.line=e.line?e.line+o:o)),i.push(...s)}})),i}))}checkIfNodeIsTeleportCompatible(e,t){var o;const n=[];this.checkIfTokenIsTeleportCompatible(e.tag)||n.push({message:`Tag "${e.tag}" cannot be imported to teleport.`,type:"HTML",severity:"error"});const i=Object.values(dt.RY);"br"!==e.tag||i.includes((null===(o=t[e.parentId||""])||void 0===o?void 0:o.tag)||"")||n.push({message:"For a good experience, linebreaks should only be used inside text tags.",type:"HTML",severity:"warning"});const r=t[e.parentId||""],s=t[(null===r||void 0===r?void 0:r.parentId)||""];return i.includes(null===r||void 0===r?void 0:r.tag)&&(["br","span"].includes(e.tag)||n.push({message:'Only "span" and "br" tags are supported inside other text tags. We\'ll try to convert them.',type:"HTML",severity:"warning"}),e.attributes.class&&n.push({message:"Classes are not supported on nested text nodes. We will save the class styles onto the node itself.",type:"CSS",severity:"warning"})),i.includes(e.tag)&&i.includes(null===r||void 0===r?void 0:r.tag)&&i.includes(null===s||void 0===s?void 0:s.tag)&&n.push({message:"We only support up to two levels of nested text elements.",type:"HTML",severity:"error"}),n}processStyleTagContent(e){const{content:t,checkIfTeleportCompatible:o}=e,n=[];try{if(o){const e=this.cssToDomainFlow.convertCSSToClass(t);Object.values(e).forEach((e=>{Object.values(this.projectDoc.classes.byId).find((t=>t.name===e.name))&&n.push({message:`Class collision for "${e.name}" in style tag.`,type:"CSS",severity:"warning",meta:{[rs.CLASS_NAME]:e.name,[rs.ACTIONABLE]:!0}})}))}else(0,ns.parse)(t)}catch(i){const{message:e,line:t}=this.processCssError(i);n.push({message:e,type:"CSS",severity:"error",line:t})}finally{return n}}processCssError(e){var t;const o=e.message.split(" "),n=null===(t=o[1])||void 0===t?void 0:t.split(":"),i=o.join(" ");if(null===n||void 0===n||!n[1])return{message:i,line:0};return{message:i,line:parseInt(n[1])-2}}getNewlinesUpToNthWord(e,t,o){return e.split(t,o).join().split(/\r\n|\r|\n/).length}generateRegexForTag(e){return new RegExp(`<${e}[\n\rs> ]`,"gs")}checkIfTokenIsTeleportCompatible(e){return[...Object.values(dt.qo),...Object.values(dt.iX),...Object.values(dt.gt),...Object.values(dt.RY),...Object.values(dt.mw),...Object.values(dt.sO),"style"].includes((0,is.x)(e))}},qr=(0,G.Z)(Xr.prototype,"cssToDomainFlow",[Jr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qr=(0,G.Z)(Xr.prototype,"projectDoc",[Wr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),es=(0,G.Z)(Xr.prototype,"workersProvider",[Kr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yr=Xr));var ss=o(65988),as=o(39457);const ls=[`.content-modal-wrapper.jsx-4243416624{min-width:800px;background-color:${Ki.Pt.DARK_01};overflow:hidden;}`,`.content-modal-header.jsx-4243416624{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;padding:${Ki.N_.HALF_UNIT} ${Ki.N_.ONE_AND_HALF};border-bottom:0.5px solid ${Ki.GC.LIGHT};}`,`.content-modal-title.jsx-4243416624{font-size:${Ki.um.HEADING};font-weight:${Ki.Xw.MEDIUM_500};}`,".content-modal-children.jsx-4243416624{position:relative;}",".content-modal-editor.jsx-4243416624{display:block;position:relative;}",`.content-modal-footer.jsx-4243416624{padding-right:${Ki.N_.TWO_UNITS};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;border-top:0.5px solid ${Ki.GC.LIGHT};}`,`.validator-title.jsx-4243416624{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;gap:${Ki.N_.UNIT};-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}`,".right-panel-wrapper.jsx-4243416624{position:absolute;right:0px;top:0px;bottom:0px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;cursor:default;height:0px;}",`.right-panel.jsx-4243416624{background-color:${Ki.Pt.DARK_01};width:250px;border-left:0.5px solid ${Ki.GC.LIGHT};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;overflow:scroll;-webkit-transform:translateX(100%);-ms-transform:translateX(100%);transform:translateX(100%);}`,`.expand-button.jsx-4243416624{position:absolute;left:-28px;top:0px;z-index:${Ki.kg.TEN};-webkit-transform:translateX(250px);-ms-transform:translateX(250px);transform:translateX(250px);}`,`.expand-button.jsx-4243416624 .pt-btn{background-color:${Ki.Pt.DARK_01};border-top-right-radius:0px;border-bottom-right-radius:0px;border:0.5px solid ${Ki.GC.LIGHT};border-right:0px;border-top:0px;}`,`.expand-button-warning.jsx-4243416624 .pt-btn,.expand-button-warning.jsx-4243416624 .pt-btn:hover{background-color:${Ki.z8.WARNING_LIGHT};}`,`.validator-label.jsx-4243416624{font-weight:${Ki.Xw.MEDIUM_600};}`,`.validator-section.jsx-4243416624{padding:${Ki.N_.TWO_UNITS};border-bottom:0.5px solid ${Ki.GC.LIGHT};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}`,".fallback-container.jsx-4243416624{min-height:500px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;}","@-webkit-keyframes slide-in-jsx-4243416624{from{-webkit-transform:translateX(100%);-ms-transform:translateX(100%);transform:translateX(100%);}to{-webkit-transform:translateX(0%);-ms-transform:translateX(0%);transform:translateX(0%);}}","@keyframes slide-in-jsx-4243416624{from{-webkit-transform:translateX(100%);-ms-transform:translateX(100%);transform:translateX(100%);}to{-webkit-transform:translateX(0%);-ms-transform:translateX(0%);transform:translateX(0%);}}","@-webkit-keyframes arrow-in-jsx-4243416624{from{-webkit-transform:translateX(250px);-ms-transform:translateX(250px);transform:translateX(250px);}to{-webkit-transform:translateX(0%);-ms-transform:translateX(0%);transform:translateX(0%);}}","@keyframes arrow-in-jsx-4243416624{from{-webkit-transform:translateX(250px);-ms-transform:translateX(250px);transform:translateX(250px);}to{-webkit-transform:translateX(0%);-ms-transform:translateX(0%);transform:translateX(0%);}}","@-webkit-keyframes slide-out-jsx-4243416624{from{-webkit-transform:translateX(0%);-ms-transform:translateX(0%);transform:translateX(0%);}to{-webkit-transform:translateX(100%);-ms-transform:translateX(100%);transform:translateX(100%);}}","@keyframes slide-out-jsx-4243416624{from{-webkit-transform:translateX(0%);-ms-transform:translateX(0%);transform:translateX(0%);}to{-webkit-transform:translateX(100%);-ms-transform:translateX(100%);transform:translateX(100%);}}","@-webkit-keyframes panel-in-jsx-4243416624{from{height:0px;}5%{height:auto;}to{height:auto;}}","@keyframes panel-in-jsx-4243416624{from{height:0px;}5%{height:auto;}to{height:auto;}}","@-webkit-keyframes panel-out-jsx-4243416624{from{height:auto;}95%{height:auto;}to{height:0px;}}","@keyframes panel-out-jsx-4243416624{from{height:auto;}95%{height:auto;}to{height:0px;}}","@-webkit-keyframes code-editor-full-jsx-4243416624{from{width:550px;}to{width:800px;}}","@keyframes code-editor-full-jsx-4243416624{from{width:550px;}to{width:800px;}}","@-webkit-keyframes code-editor-half-jsx-4243416624{from{width:800px;}to{width:550px;}}","@keyframes code-editor-half-jsx-4243416624{from{width:800px;}to{width:550px;}}","@-webkit-keyframes arrow-out-jsx-4243416624{to{-webkit-transform:translateX(250px);-ms-transform:translateX(250px);transform:translateX(250px);}from{-webkit-transform:translateX(0%);-ms-transform:translateX(0%);transform:translateX(0%);}}","@keyframes arrow-out-jsx-4243416624{to{-webkit-transform:translateX(250px);-ms-transform:translateX(250px);transform:translateX(250px);}from{-webkit-transform:translateX(0%);-ms-transform:translateX(0%);transform:translateX(0%);}}",".arrow-expanded.jsx-4243416624{-webkit-animation:arrow-in-jsx-4243416624 1000ms;animation:arrow-in-jsx-4243416624 1000ms;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards;}",".arrow-collapsed.jsx-4243416624{-webkit-animation:arrow-out-jsx-4243416624 1000ms;animation:arrow-out-jsx-4243416624 1000ms;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards;}",".panel-expanded.jsx-4243416624{-webkit-animation-name:slide-in-jsx-4243416624;animation-name:slide-in-jsx-4243416624;-webkit-animation-duration:1000ms;animation-duration:1000ms;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards;}",".panel-collapsed.jsx-4243416624{-webkit-animation-name:slide-out-jsx-4243416624;animation-name:slide-out-jsx-4243416624;-webkit-animation-duration:1000ms;animation-duration:1000ms;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards;}",".wrapper-expanded.jsx-4243416624{-webkit-animation-name:panel-in-jsx-4243416624;animation-name:panel-in-jsx-4243416624;-webkit-animation-duration:1000ms;animation-duration:1000ms;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards;}",".wrapper-collapsed.jsx-4243416624{-webkit-animation-name:panel-out-jsx-4243416624;animation-name:panel-out-jsx-4243416624;-webkit-animation-duration:1000ms;animation-duration:1000ms;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards;}",".code-editor-full-width.jsx-4243416624{width:800px;-webkit-animation-name:code-editor-full-jsx-4243416624;animation-name:code-editor-full-jsx-4243416624;-webkit-animation-duration:1000ms;animation-duration:1000ms;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards;}",".code-editor-half-width.jsx-4243416624{width:550px;-webkit-animation-name:code-editor-half-jsx-4243416624;animation-name:code-editor-half-jsx-4243416624;-webkit-animation-duration:1000ms;animation-duration:1000ms;-webkit-animation-fill-mode:forwards;animation-fill-mode:forwards;}"];ls.__hash="4243416624";var cs=o(12349);const ds=e=>(0,gr.jsxs)("div",{className:ss.default.dynamic([["2761650982",[Ki.z8.WARNING_LIGHT,Ki.Pt.DARK_01]]])+" warning-bubble",children:[(0,gr.jsxs)("span",{className:ss.default.dynamic([["2761650982",[Ki.z8.WARNING_LIGHT,Ki.Pt.DARK_01]]]),children:[e.counter," "]}),(0,gr.jsx)(ss.default,{id:"2761650982",dynamic:[Ki.z8.WARNING_LIGHT,Ki.Pt.DARK_01],children:[`.warning-bubble.__jsx-style-dynamic-selector{background-color:${Ki.z8.WARNING_LIGHT};display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;border-radius:50%;width:16px;height:16px;color:${Ki.Pt.DARK_01};}`]})]});var ps=o(41666),us=o(44222),hs=o(41146);const ms=pr.lazy((()=>Promise.all([o.e(1682),o.e(17189)]).then(o.bind(o,45397)))),gs=e=>{var t,o,n,i;const{title:r,onDismiss:s,onChange:a,submitButton:l,code:c,submitButtonState:d,language:p,isFormatting:u,validationErrors:h}=e,{0:m,1:g}=(0,pr.useState)(!1),{0:y,1:f}=(0,pr.useState)([]),{0:b,1:w}=(0,pr.useState)(-1),v=(0,pr.useRef)(e.submitButtonState),I=(0,pr.useRef)(null);(0,pr.useEffect)((()=>{v.current=e.submitButtonState}),[e.submitButtonState]),(0,pr.useEffect)((()=>{if(!h)return f([]),void w(-1);const e=h.map((e=>e.line?{line:e.line,message:e.message||e.label,severity:e.severity}:null)).filter((e=>e));var t,o;(f(e),e.length)?null===(t=document.getElementById("expand-button"))||void 0===t||t.classList.add("expand-button-warning"):null===(o=document.getElementById("expand-button"))||void 0===o||o.classList.remove("expand-button-warning")}),[h]);return(0,gr.jsxs)("div",{ref:I,className:`jsx-${ls.__hash} content-modal-wrapper`,children:[(0,gr.jsxs)("div",{className:`jsx-${ls.__hash} content-modal-header`,children:[(0,gr.jsx)("p",{className:`jsx-${ls.__hash} content-modal-title`,children:r.toUpperCase()}),(0,gr.jsx)(ur.z,{style:"transparent",onClick:s,children:(0,gr.jsx)(hr.J,{type:"actions/close",size:12,color:Ki.bo.DEFAULT})})]}),(0,gr.jsxs)("div",{className:`jsx-${ls.__hash} content-modal-children`,children:[(0,gr.jsx)("div",{id:"content-modal-editor",className:`jsx-${ls.__hash} content-modal-editor`,children:(0,gr.jsx)(pr.Suspense,{fallback:(0,gr.jsxs)("div",{className:`jsx-${ls.__hash} fallback-container`,children:[(0,gr.jsx)(as.Z,{}),(0,gr.jsx)(ss.default,{id:ls.__hash,children:ls})]}),children:(0,gr.jsx)(ms,{code:c||"",language:p,handleAutoSaveCode:()=>{var t;null!==(t=v.current)&&void 0!==t&&t.disabled||e.onSubmit()},onChange:e=>a(e||""),errors:y,highlightedLine:b,setHighlightedLine:w})})}),(0,gr.jsxs)("div",{id:"right-panel-wrapper",className:`jsx-${ls.__hash} right-panel-wrapper`,children:[(0,gr.jsx)("div",{id:"expand-button",className:`jsx-${ls.__hash} expand-button`,children:(0,gr.jsx)(ur.z,{style:"solid",colorScheme:"neutral",size:"small",onClick:()=>{var e,t,o,n,i,r,s,a,l,c,d,p,u,h,y,f;if(m)return null===(l=document.getElementById("right-panel-wrapper"))||void 0===l||l.classList.add("wrapper-collapsed"),null===(c=document.getElementById("right-panel-wrapper"))||void 0===c||c.classList.remove("wrapper-expanded"),null===(d=document.getElementById("right-panel"))||void 0===d||d.classList.add("panel-collapsed"),null===(p=document.getElementById("right-panel"))||void 0===p||p.classList.remove("panel-expanded"),null===(u=document.getElementById("expand-button"))||void 0===u||u.classList.add("arrow-collapsed"),null===(h=document.getElementById("expand-button"))||void 0===h||h.classList.remove("arrow-expanded"),null===(y=document.getElementById("content-modal-editor"))||void 0===y||y.classList.add("code-editor-full-width"),null===(f=document.getElementById("content-modal-editor"))||void 0===f||f.classList.remove("code-editor-half-width"),void g(!1);null===(e=document.getElementById("right-panel-wrapper"))||void 0===e||e.classList.add("wrapper-expanded"),null===(t=document.getElementById("right-panel-wrapper"))||void 0===t||t.classList.remove("wrapper-collapsed"),null===(o=document.getElementById("right-panel"))||void 0===o||o.classList.add("panel-expanded"),null===(n=document.getElementById("right-panel"))||void 0===n||n.classList.remove("panel-collapsed"),null===(i=document.getElementById("expand-button"))||void 0===i||i.classList.add("arrow-expanded"),null===(r=document.getElementById("expand-button"))||void 0===r||r.classList.remove("arrow-collapsed"),null===(s=document.getElementById("content-modal-editor"))||void 0===s||s.classList.add("code-editor-half-width"),null===(a=document.getElementById("content-modal-editor"))||void 0===a||a.classList.remove("code-editor-full-width"),g(!0)},children:(0,gr.jsx)(hr.J,{type:""+(m?"arrow-right":"arrow-left"),size:12,color:`${y.length?Ki.Pt.DARK_01:Ki.bo.DEFAULT}`})})}),(0,gr.jsx)("div",{id:"right-panel",className:`jsx-${ls.__hash} right-panel`,children:null!==(t=e.validationErrors)&&void 0!==t&&t.length?null===(o=e.validationErrors)||void 0===o?void 0:o.map(((e,t)=>(0,gr.jsxs)("div",{onClick:()=>{e.line&&w(e.line)},className:`jsx-${ls.__hash} validator-section`,children:[(0,gr.jsxs)("div",{className:`jsx-${ls.__hash} validator-title`,children:[(0,gr.jsx)("span",{className:`jsx-${ls.__hash} validator-label`,children:e.label}),e.isValid?(0,gr.jsx)(hr.J,{size:8,type:"checkmark"}):void 0!==e.issuesCount?(0,gr.jsx)(ds,{counter:e.issuesCount||0}):null]}),(null===e||void 0===e?void 0:e.actions)&&e.actions.map(((e,t)=>(0,gr.jsx)("div",{style:{display:"flex",flexDirection:"column",paddingTop:Ki.N_.TWO_UNITS},className:`jsx-${ls.__hash}`,children:e.onClick?(0,gr.jsx)(ps.r,{onChange:e.onClick,label:e.description,defaultValue:e.state}):null},t)))]},t))):(0,gr.jsx)("div",{className:`jsx-${ls.__hash} validator-section`,children:(0,gr.jsx)("span",{className:`jsx-${ls.__hash}`,children:"\u2728 Everything looks good"})})})]})]}),(0,gr.jsxs)("div",{className:`jsx-${ls.__hash} content-modal-footer`,children:[(0,gr.jsx)(ur.z,{onClick:()=>{e.onFormat()},shape:"square",size:"large",cornerStyle:"sharp",style:"transparent",title:"Prettify code",children:u?(0,gr.jsx)(us.$,{}):"{ }"}),null!==(n=e.validationErrors)&&void 0!==n&&n.length?(0,gr.jsx)(cs.g,{gap:"two",children:null===(i=e.validationErrors)||void 0===i?void 0:i.map((e=>e.displayInBottomBar?(0,gr.jsxs)("div",{className:`jsx-${ls.__hash} validator-title`,children:[e.label,e.isValid?(0,gr.jsx)(hr.J,{size:8,type:"checkmark"}):void 0!==e.issuesCount?(0,gr.jsx)(ds,{counter:e.issuesCount||0}):null]},e.label):null))}):null,(0,gr.jsx)("span",{style:{color:Ki.bo.FADED},className:`jsx-${ls.__hash}`,children:(0,gr.jsxs)("i",{className:`jsx-${ls.__hash}`,children:[(0,mt.z2)()?hs.KEY_SYMBOLS.getCtrl(!0):`${hs.KEY_SYMBOLS.getCtrl(!1)} + `,"S to save while editing"]})}),(0,gr.jsx)(ur.z,{refAttrs:{autoFocus:!0},onClick:()=>e.onSubmit(),isDisabled:null===d||void 0===d?void 0:d.disabled,isLoading:null===d||void 0===d?void 0:d.loading,colorScheme:null===d||void 0===d?void 0:d.colorScheme,style:null===d||void 0===d?void 0:d.style,children:l})]}),(0,gr.jsx)(ss.default,{id:ls.__hash,children:ls})]})};var ys,fs,bs,ws,vs,Is,Ss,js,Ds;!function(e){e.MERGE_CLASS="Merge"}(Ds||(Ds={}));let Os=(ys=(0,J.f3)("htmlValidator"),fs=(0,J.f3)("workersProvider"),bs=(0,J.f3)("notificationsManagementFlow"),js=new WeakMap,ws=class extends pr.PureComponent{constructor(...e){super(...e),(0,z.Z)(this,"htmlValidator",vs,this),(0,z.Z)(this,"workersProvider",Is,this),(0,z.Z)(this,"notificationsManagementFlow",Ss,this),(0,$.Z)(this,"state",{validationErrors:[],code:this.props.code||"",isFormatting:!1,classNamesToMerge:{},isSubmitting:!1}),js.set(this,{writable:!0,value:null}),(0,$.Z)(this,"handleValidation",(()=>{(0,$i.Z)(this,js)&&clearTimeout((0,$i.Z)(this,js)),(0,Gi.Z)(this,js,setTimeout((()=>{this.validateCode()}),350))})),(0,$.Z)(this,"handleSubmit",(async()=>{this.setState({isSubmitting:!0}),await this.props.onSubmit(this.state.code,this.state.classNamesToMerge),this.setState({isSubmitting:!1})})),(0,$.Z)(this,"toggleClassNameMerge",(e=>{const t=this.state.classNamesToMerge;t[e]=!t[e],this.setState({classNamesToMerge:t})})),(0,$.Z)(this,"handlePrettify",(async()=>{this.setState({isFormatting:!0}),this.workersProvider.prettify(this.state.code,"code.html",(async e=>{var t,o;const n=(null===(t=e.match(/<script.*?>.*?<\/script>/gs))||void 0===t?void 0:t.map((e=>e.replace(/\<\/?script.*\>/gs,""))))||[],i=(null===(o=e.match(/<style.*?>.*?<\/style>/gs))||void 0===o?void 0:o.map((e=>e.replace(/\<\/?style.*\>/gs,""))))||[];this.setState({code:e,isFormatting:!1}),n.length||i.length?(await this.prettifySnippets(i,"css"),await this.prettifySnippets(n,"js"),this.validateCode(),this.setState({isFormatting:!1})):this.validateCode()}),(()=>{this.notificationsManagementFlow.createNotification(K.k.ERROR,"Failed to run prettier, please check the syntax."),this.setState({isFormatting:!1})}))})),(0,$.Z)(this,"handleChange",(e=>{this.setState({code:e}),this.handleValidation()}))}componentDidMount(){this.handleValidation()}componentWillUnmount(){(0,$i.Z)(this,js)&&clearTimeout((0,$i.Z)(this,js))}async validateCode(){const e=await this.htmlValidator.validateHtmlCode({code:this.state.code,checkIfTeleportCompatible:this.props.checkIfTeleportCompatible}),t=[];if(!e.length)return void this.setState({validationErrors:t});const o=[],n=[];e.forEach((e=>{const t=e.line?`Line ${e.line}: `:"",i=[];"HTML"!==e.type?(e.meta&&!0===e.meta[rs.ACTIONABLE]&&"string"===typeof e.meta[rs.CLASS_NAME]&&i.push({description:Ds.MERGE_CLASS,onClick:()=>{var t;return this.toggleClassNameMerge(null===(t=e.meta)||void 0===t?void 0:t[rs.CLASS_NAME])},state:this.state.classNamesToMerge[e.meta[rs.CLASS_NAME]]}),o.push({label:`${t}${e.message}`,line:e.line,message:e.message,severity:e.severity,actions:i})):n.push({label:`${t}${e.message}`,message:e.message,line:e.line,severity:e.severity,actions:i})})),n.length&&t.push({label:"HTML",issuesCount:n.length,displayInBottomBar:!0},...n),o.length&&t.push({label:"CSS",issuesCount:o.length,displayInBottomBar:!0},...o),(0,Gi.Z)(this,js,null),this.setState({validationErrors:t})}async prettifySnippets(e,t){for(let o=0;o<e.length;o++){const n=e[o]||"";n&&await this.workersProvider.prettify(n,`code.${t}`,(e=>{this.state.code&&this.setState({code:this.state.code.replace(n,`\n${e}`)})}),(()=>{this.notificationsManagementFlow.createNotification(K.k.ERROR,"Failed to run prettier, please check the syntax.")}))}}render(){const{onDismiss:e,title:t,allowSaveWithErrors:o}=this.props,{validationErrors:n,code:i,isFormatting:r,isSubmitting:s}=this.state;return(0,gr.jsx)(gs,{title:t||"HTML Editor",submitButton:"Save",submitButtonState:{loading:s,colorScheme:"accent",style:"solid",disabled:!o&&n.some((e=>"error"===e.severity))},code:i,language:"js",validationErrors:n,onSubmit:this.handleSubmit,onDismiss:e,onFormat:this.handlePrettify,onChange:this.handleChange,isFormatting:r})}},vs=(0,G.Z)(ws.prototype,"htmlValidator",[ys],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Is=(0,G.Z)(ws.prototype,"workersProvider",[fs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ss=(0,G.Z)(ws.prototype,"notificationsManagementFlow",[bs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ws);var Fs=o(80123);const Ts=["doc"];var Ns,Es,Cs,xs,Ps,ks,Ms,Zs,Us,As,Ls,_s,Rs,Bs,Hs,zs,$s,Gs,Vs,Js,Ws,Ks,Ys,Xs,qs,Qs,ea,ta,oa,na,ia,ra,sa,aa,la,ca,da,pa,ua,ha,ma,ga,ya,fa,ba,wa,va,Ia,Sa,ja,Da,Oa,Fa,Ta,Na,Ea,Ca;function xa(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Pa(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?xa(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):xa(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}Ns=(0,J.JJ)("nodeManagementFlow"),Es=(0,J.f3)("projectUIState"),Cs=(0,J.f3)("nodeSelectionFlow"),xs=(0,J.f3)("projectDoc"),Ps=(0,J.f3)("sharedbProjectSyncService"),ks=(0,J.f3)("componentManagementFlow"),Ms=(0,J.f3)("notificationsManagementFlow"),Zs=(0,J.f3)("nodeStyleManagmentFlow"),Us=(0,J.f3)("nodeAttributeManagmentFlow"),As=(0,J.f3)("propDefinitionManagementFlow"),Ls=(0,J.f3)("nodeEditingFlow"),_s=(0,J.f3)("elementRefProvider"),Rs=(0,J.f3)("stageScrollFlow"),Bs=(0,J.f3)("freestyleNodeFlow"),Hs=(0,J.f3)("dropIntoButtonFlow"),zs=(0,J.f3)("rtcFlow"),$s=(0,J.f3)("imageOptimisationFlow"),Gs=(0,J.f3)("modalManagementFlow"),Vs=(0,q.G)(te.l.ENTER_RENAME_NODE),Js=(0,q.G)(te.l.DELETE_NODES),Ws=(0,dr.u)(dr.j.DELETE_NODES),Ks=(0,q.G)(te.l.DUPLICATE_NODES),Ys=(0,q.G)(te.l.MOVE_NODES_TO_TARGET),Xs=(0,q.G)(te.l.COPY_NODES_TO_TARGET),qs=(0,dr.u)(dr.j.COPY_NODES),Qs=(0,dr.u)(dr.j.ADD_NODES),ea=(0,q.G)(te.l.COPY_NODE_STYLES_TO_TARGET),ta=(0,dr.u)(dr.j.COPY_STYLES),oa=(0,q.G)(te.l.COPY_NODE_CLASSES_TO_TARGET),na=(0,q.G)(te.l.COPY_NODES_TO_TARGET),ia=(0,dr.u)(dr.j.COPY_NODES),ra=(0,q.G)(te.l.GROUP_NODES),sa=(0,q.G)(te.l.UNGROUP_NODES),aa=(0,q.G)(te.l.ADD_PRIMITIVE),la=(0,q.G)(te.l.UPDATE_NODE_SEMANTIC),ca=(0,q.G)(te.l.MOVE_NODES_TO_TARGET),da=(0,q.G)(te.l.MOVE_NODES_TO_TARGET),pa=(0,q.G)(te.l.ADD_PRIMITIVE),Ns((ha=class{constructor(){(0,z.Z)(this,"projectUIState",ma,this),(0,z.Z)(this,"nodeSelectionFlow",ga,this),(0,z.Z)(this,"projectDoc",ya,this),(0,z.Z)(this,"dbSync",fa,this),(0,z.Z)(this,"componentManagementFlow",ba,this),(0,z.Z)(this,"notificationsManagementFlow",wa,this),(0,z.Z)(this,"nodeStyleManagmentFlow",va,this),(0,z.Z)(this,"nodeAttributeManagmentFlow",Ia,this),(0,z.Z)(this,"propDefinitionManagementFlow",Sa,this),(0,z.Z)(this,"nodeEditingFlow",ja,this),(0,z.Z)(this,"elementRefProvider",Da,this),(0,z.Z)(this,"stageScrollFlow",Oa,this),(0,z.Z)(this,"freestyleNodeFlow",Fa,this),(0,z.Z)(this,"dropIntoButtonFlow",Ta,this),(0,z.Z)(this,"rtcFlow",Na,this),(0,z.Z)(this,"imageOptimisationFlow",Ea,this),(0,z.Z)(this,"modalManagementFlow",Ca,this)}setRenamedNode(e){if(this.projectUIState.userPreferences.showElementTag)return;const t=this.projectDoc.nodes.byId[e||""];(null===t||void 0===t?void 0:t.primitiveType)===dt.sO.SLOT&&t.compIdOfSlot!==this.projectUIState.selection.componentId||(0,V.JG)(this.projectUIState,(t=>{t.layout.sidebarPanel!==Y.tI.FILES&&(t.layout.sidebarPanel=Y.tI.FILES),t.nodesList.renamedNodeId=e}))}beginLocalWork(e){if(this.projectUIState.localWork.nodesUnderLocalWork)return;const t={};for(const o of e){if(!this.projectDoc.nodes.byId[o])return;t[o]=this.projectDoc.getLocalWorkClone({nodeId:o})}Object.keys(t).length&&(0,V.JG)(this.projectUIState,(e=>{e.localWork={nodesUnderLocalWork:t,changedAttrs:[],changedStyles:[],initialPropValues:{},changedContent:null}}))}revertLocalWork(){const e=this.projectUIState.localWork.nodesUnderLocalWork;if(!e)return;const t=[...new Set(this.projectUIState.localWork.changedAttrs)],o=[...new Set(this.projectUIState.localWork.changedStyles)],n=this.projectUIState.localWork.initialPropValues||{};(0,V.JG)(this.projectDoc,(i=>{for(const r in e){const s=i.nodes.byId[r];if(!s)return;null!==o&&void 0!==o&&o.length&&(this.nodeStyleManagmentFlow.copyStylesFromNodeBasedOnCurrentBreakpoint({doc:i,nodeId:r,changedKeys:o,node:e[r]}),s.fakeSize=e[r].fakeSize),null!==t&&void 0!==t&&t.length&&this.nodeAttributeManagmentFlow.copyAttrsFromNode({doc:i,nodeId:r,changedKeys:t,node:e[r]}),Object.keys(n).forEach((e=>{this.propDefinitionManagementFlow.updatePropDefinition({doc:i,propId:e,propData:{defaultValue:n[e]}})}))}})),(0,V.JG)(this.projectUIState,(e=>{e.localWork={nodesUnderLocalWork:null,changedAttrs:null,changedStyles:null,initialPropValues:null,changedContent:null}}))}commitLocalWork(){const e=this.projectUIState.localWork.nodesUnderLocalWork;if(!e)return;const t=[...new Set(this.projectUIState.localWork.changedAttrs)],o=[...new Set(this.projectUIState.localWork.changedStyles)],n=this.projectUIState.localWork.changedContent,i={};(0,V.JG)(this.projectDoc,(n=>{for(const r in e){if(!n.nodes.byId[r])return;i[r]=n.getLocalWorkClone({nodeId:r}),null!==o&&void 0!==o&&o.length&&this.nodeStyleManagmentFlow.copyStylesFromNodeBasedOnCurrentBreakpoint({doc:n,nodeId:r,changedKeys:o,node:e[r]}),null!==t&&void 0!==t&&t.length&&this.nodeAttributeManagmentFlow.copyAttrsFromNode({doc:n,nodeId:r,changedKeys:t,node:e[r]})}})),(0,V.JG)(this.projectUIState,(e=>{e.localWork={nodesUnderLocalWork:null,changedAttrs:null,changedStyles:null,initialPropValues:null,changedContent:null}})),this.dbSync.mutate(this.projectDoc,(e=>{for(const r in i){null!==o&&void 0!==o&&o.length&&this.nodeStyleManagmentFlow.copyStylesFromNodeBasedOnCurrentBreakpoint({doc:e,nodeId:r,changedKeys:o,node:i[r]}),null!==t&&void 0!==t&&t.length&&this.nodeAttributeManagmentFlow.copyAttrsFromNode({doc:e,nodeId:r,changedKeys:t,node:i[r]});const s=e.nodes.byId[r];if(!s)return;if(i[r].contentChildren&&s.contentChildren&&null!==n){const t=Object.keys(s.contentChildren)[0],o=s.contentChildren[t];if("static"===o.type){const e=new ar.F({content:n});s.contentChildren={[e.id]:e}}if("dynamic"===o.type){const t=this.projectUIState.selection.componentId,i=t&&e.components.byId[t];if(!i)return;null===i||void 0===i||i.updatePropDefinition(o.content.id,{defaultValue:n})}}}}))}deleteNodesById(e){const{doc:t,nodeIds:o}=e;if(!t)return;const n=this.projectUIState.selection.nodes;if(1===o.length&&n[o[0]]){var i,r;const e=this.projectDoc.nodes.byId[o[0]];if(!e||e.compIdOfRootNode)return;const n=(null===(i=this.projectDoc.nodes.getNextSibling(e))||void 0===i?void 0:i.id)||(null===(r=this.projectDoc.nodes.getPrevSibling(e))||void 0===r?void 0:r.id)||e.parentOrSlotId,s=t.nodes.getSlotAndCompInstanceIdForNodeById(n||"").compInstanceId||this.projectUIState.selection.compInstanceId;this.nodeSelectionFlow.setNodeSelection({nodeId:n,compInstanceId:s})}o.length>1&&this.nodeSelectionFlow.resetNodeSelection(),t.deleteNodesById({nodeIds:o})}duplicateNodesById(e){const{nodeIds:t,doc:o}=e;if(!o)return;const n=this.projectUIState.selection.componentId;if(n)for(const s of t){var i,r;if(!!(null===(i=o.nodes.byId[s])||void 0===i||!i.parentOrSlotId))continue;const e=o.duplicateNodeInstanceHierarchy({doc:o,rootNodeId:s,sourceCompId:n,targetCompId:n});if((null===(r=this.projectUIState.drag.draggedEntity)||void 0===r?void 0:r.type)===Fs.Z.ABSOLUTE_SUB_HIERARCHY)continue;const t=this.nodeStyleManagmentFlow.getCurrentStyleValueByKeyForNode(e[s],["top","left","bottom","right","position"]),a=t.position;"absolute"!==a&&"fixed"!==a||(this.freestyleNodeFlow.nudgeNode(e[s],"top",t.top),this.freestyleNodeFlow.nudgeNode(e[s],"bottom",t.bottom),this.freestyleNodeFlow.nudgeNode(e[s],"left",t.left),this.freestyleNodeFlow.nudgeNode(e[s],"right",t.right))}}convertNodesToComponent(e){const{compId:t}=e,{automaticallyCreateOverrides:o}=this.projectUIState.userPreferences;if(this.componentManagementFlow.checkComponentsLimitReached())return;const n=this.projectDoc.nodes.getOrderedTopLevelNodes(e.nodeIds);if(!this.projectDoc.nodes.areNodesSiblings(n))return;let i=null;this.dbSync.mutate(this.projectDoc,(e=>{var r;if(n.length>1?(this.groupNodes({nodeIds:n}),i=Object.keys(this.projectUIState.selection.nodes||{})[0]):i=n[0],!i)return;const s=e.nodes.byId[i];if(!s)throw new Error(`Node that need to be converted to component is missing - ${i}`);if(!s.parentOrSlotId)throw new Error("Parent id is missing from the node, that is being converted");if(s.compIdOfRootNode||e.nodes.nodeIsCompInstance(s))throw new Error("Trying to convert a existing component or page to component");const a=e.nodes.getSlotAndCompInstanceIdForNodeById(i).compInstanceId,l=Object.values(this.projectDoc.components.byId||{}).map((e=>null===e||void 0===e?void 0:e.title)),c=(0,W.Zu)(l,s.name?(0,mt.kC)(s.name):"Component"),d=e.nodes.byId[s.parentOrSlotId];if(!d)throw new Error(`Parent is missing for the node to change - ${s.parentOrSlotId}`);const p=e.getComponentIdForNode(s.id)||t;let u=new Zt.n({title:c});(0,V.JG)(this.projectUIState,(e=>{e.componentList.stateValues[u.id]={}}));const h=new Ni.F({primitiveType:dt.sO.COMPONENT,parentId:s.parentId,slotId:s.slotId,compInstanceId:s.compInstanceId,pos:s.pos});h.compIdOfCompInstance=u.id,s.primitiveType!==dt.sO.CONTAINER&&s.primitiveType!==dt.sO.LIST&&s.primitiveType!==dt.IV.DROPDOWN||(u.rootNodeId=s.id,d.primitiveType===dt.sO.SLOT?e.unslotNodeFromInstance({node:s,instanceId:a,slotId:d.id}):delete d.childrenIds[s.id],s.styles.position||(s.styles.position=new ar.F({content:"relative"})),s.compIdOfRootNode=u.id,s.parentId=null,delete s.slotId,delete s.compInstanceId);const m="absolute"===(null===(r=s.styles.position)||void 0===r?void 0:r.content);let g={};if(m){const t=["top","left","bottom","right","position","margin","marginTop","marginBottom","marginRight","marginLeft"];g=this.nodeStyleManagmentFlow.getCurrentStyleValueByKeyForNode(i,t),this.nodeStyleManagmentFlow.removeMultipleStylesByKey({nodeIds:[i||""],doc:e,keys:t}),this.nodeStyleManagmentFlow.setStyleByKey({nodeIds:[i],key:"position",value:"relative"})}e.nodes.getDescendents(s.id).forEach((e=>{this.projectDoc.nodes.nodeIsCompInstance(e)&&(u.usedComponents[e.compIdOfCompInstance]?u.usedComponents[e.compIdOfCompInstance]+=1:u.usedComponents[e.compIdOfCompInstance]=1)})),u.pos=e.components.getPositionAfterLast(),u=e.addComponent({component:u});const{rootNodeId:y,id:f}=u;if(!y||!f)return;if(y!==s.id){if(!e.nodes.byId[y])throw new Error(`Newly created parent's root node is missing - ${y}`);this.moveNodesToTarget({targetId:y,nodes:[s],doc:e}),e.addUsedComponentRelation({toAddComponentId:p,linkedComponentId:f})}const b=e.getProjectPageOrComponent(t);if(!b)return;e.nodes.bfs(i,(n=>{this.imageOptimisationFlow.getAssetsLinkedToNodes({nodeIds:[n.id]}).forEach((e=>{this.imageOptimisationFlow.computeAssetSizeForComponent({assetId:e,compId:f})})),b instanceof Zt.n&&o?e.moveNodePropDefinitionToTarget({doc:e,sourceCompId:t,targetCompId:f,nodeId:n.id}):o&&e.addDefaultPropsDefinitionForNode({node:n,doc:e,component:u})})),e.addNode(h),h.slotId&&h.compInstanceId&&e.slotNodeInInstance({node:h,instanceId:h.compInstanceId,slotId:h.slotId});e.nodes.getDescendents(s.id).forEach((e=>{var t,o;const n=null===e||void 0===e||null===(t=e.attrs)||void 0===t||null===(o=t.id)||void 0===o?void 0:o.content;n&&i&&(delete b.sectionIds[i],u.sectionIds[i]=n)})),u.instantiatedByNodes[h.id]=!0,this.nodeSelectionFlow.setNodeSelection({nodeId:h.id}),m&&Object.keys(g).map((e=>{g[e]&&this.nodeStyleManagmentFlow.setStyleByKey({nodeIds:[h.id],key:e,value:g[e]})}))}))}moveNodesToTarget(e){const{doc:t,removeMargins:o,nodes:n}=e;if(!t)return;if(t.moveNodesToTarget(e),!o)return;const i=n.map((e=>e.parentId)),r=n.filter(((e,o)=>{var n;return(null===(n=t.nodes.byId[e.id])||void 0===n?void 0:n.parentId)!==i[o]})).map((e=>e.id));r.length&&this.nodeStyleManagmentFlow.removeMultipleStylesByKeyBasedOnCurrentBreakpoint({nodeIds:r,doc:t,keys:["margin","marginLeft","marginRight","marginTop","marginBottom"]})}deleteAndAddNodes(e){const{doc:t,nodesToAdd:o,nodesToRemove:n,nodesToRemoveContentFrom:i}=e;t&&(this.addNodesToParentOrStage(Pa({doc:t,withNodeSelection:!0},o)),this.deleteNodesById({doc:t,nodeIds:n}),null===i||void 0===i||i.forEach((e=>{const o=t.nodes.byId[e];o&&o.contentChildren&&Object.keys(o.contentChildren)&&Object.keys(o.contentChildren).forEach((e=>{var t;null===o||void 0===o||(null===(t=o.contentChildren)||void 0===t||delete t[e])}))})))}copyNodeHierarchyToTarget(e){const{doc:t}=e;if(t)return t.copyNodesHierarchyToTarget(e)}addNodesToParentOrStage(e){const{doc:t,nodes:o,withNodeSelection:n}=e;if(t){if(t.addNodesToParentOrStage(e),n&&1===o.length&&!this.projectUIState.drag.draggedEntity){if(!t.nodes.byId[o[0].id])return;this.nodeSelectionFlow.setNodeSelection({nodeId:o[0].id,expandTreeView:!0,compInstanceId:e.compInstanceId})}if(t.nodes.nodeIsCompInstance(o[0])){const e=o[0].compIdOfCompInstance,n=t.components.byId[e];if(!n)return;const{stateDefinitions:i}=n;(0,V.JG)(this.projectUIState,(t=>{Object.values(i).forEach((n=>{t.componentList.stateValues[e][n.id].componentInstanceValues[o[0].id]=n.defaultValue}))}))}}}copyNodeStylesToTargets(e){const{source:t,doc:o,targets:n}=e;if(!o)return;const i=o.nodes.byId[t];if(!i)throw new Error(`Source node is missing - ${t}`);const r=Object.values(o.assets.byId).filter((e=>e.usedInNodes[t]));for(const s of n){const e=o.nodes.byId[s];if(!i||!e)throw new Error(`Target node is missing - ${s}`);const n=sr.S.execute({targetNodeId:s,nodeId:t,doc:o});n&&(e.styles=n);const a=rr.l.execute({targetNodeId:s,nodeId:t,doc:o});a&&(e.referencedStyles=a),r.forEach((e=>{e.usedInNodes[s]=!0}))}}copyNodeClassesStylesToTargets(e){this.dbSync.mutate(this.projectDoc,(t=>{const o=t.nodes.byId[e.source];if(!o)throw new Error(`Source node is missing - ${e.source}`);for(const n of e.targets){const i=t.nodes.byId[n];if(!o||!i)throw new Error(`Target node is missing - ${n}`);const r=Gr.execute({targetNodeId:n,nodeId:e.source,doc:t});r&&Object.values(r).forEach((e=>{i.referencedStyles[e.id]=e}))}}))}copyNodesToTarget(e){const{doc:t,nodes:o}=e;if(!t)return;let n=!1;return o.forEach((e=>{t.nodes.bfs(e.id,(e=>{e.primitiveType===dt.sO.SLOT&&(n=!0)}))})),n&&this.notificationsManagementFlow.createNotification(K.k.INFO,"Did not copy slot. Only one slot per component currently supported."),t.copyNodesToTarget(e)}groupNodes(e){const t=this.projectDoc.nodes.getOrderedTopLevelNodes(e.nodeIds);this.projectDoc.nodes.areNodesSiblings(t)&&!this.nodeIsChildOfButton(t[0])&&(this.freestyleNodeFlow.nodesAreFreestyle(t)?this.freestyleNodeFlow.groupFreestyleNodes({nodeIds:t}):this.dbSync.mutate(this.projectDoc,(e=>{this.nodeSelectionFlow.setNodeSelection({nodeId:e.groupNodes({nodeIds:t})})})))}ungroupNodeChildren(e){const{nodeId:t}=e,o=this.projectDoc.nodes.byId[t];!o||(null===o||void 0===o?void 0:o.primitiveType)!==dt.sO.CONTAINER||null!==o&&void 0!==o&&o.compIdOfRootNode||(Object.keys((null===o||void 0===o?void 0:o.childrenIds)||{}).length?this.dbSync.mutate(this.projectDoc,(t=>{var n;const i=null===(n=this.getFirstPositionedParentOfNode(o.id).parentElement)||void 0===n?void 0:n.getBoundingClientRect();i&&this.freestyleNodeFlow.setFreestyleNodesPositionBeforeMoving({nodeIds:Object.keys(o.childrenIds||{}),targetRect:i,doc:t}),t.ungroupNodeChildren(e)})):this.deleteNodesById({nodeIds:[t]}))}addEmbedNodeToSelNode(e){const t=Jo.d.createCustomModal({Component:Os,data:{title:"Code Embed (HTML+CSS+JS)",allowSaveWithErrors:!0},onSubmit:t=>{if(t){if(e.nodes){const o=e;o.nodes[0].html=t,this.dbSync.mutate(this.projectDoc,(e=>{this.addNodesToParentOrStage(Pa(Pa({},o),{},{doc:e}))}))}else{const o=e;o.primitives[0].html=t,this.addPrimitivesToSelNodeSelectAndScroll({primitives:o.primitives})}this.modalManagementFlow.hideModal()}else this.modalManagementFlow.hideModal()}});this.modalManagementFlow.showModal(t,{padding:"0px"})}addPrimitivesToSelNodeSelectAndScroll(e){const{doc:t,primitives:o,keepOriginalParent:n}=e;if(!t)return;const i=Object.keys(this.projectUIState.selection.nodes||{}),r=this.projectUIState.selection.compInstanceId||void 0,s=(0,$r.a)(o);if(i.length>1)return;let a;if(0===i.length){const e=this.projectDoc.getProjectPageOrComponent(this.projectUIState.selection.componentId||"");a=this.projectDoc.nodes.byId[(null===e||void 0===e?void 0:e.rootNodeId)||""]}else a=this.projectDoc.nodes.byId[i[0]];if(!a||!s)return;const l=a.primitiveType!==dt.sO.BUTTON&&t.isNodeAcceptingChildByElementType(a,s);let c=a.id,d=null;if(l||(c=a.slotId||a.parentId,d=this.projectDoc.nodes.getNextSibling(a)),c){const e=t.nodes.byId[c];if(!e||!t.isNodeAcceptingChildByElementType(e,s))return;this.addNodesToParentOrStage({doc:t,parentId:c,nextSibling:d,nodes:o,withNodeSelection:!0,compInstanceId:r,keepOriginalParent:n})}1===o.length&&setTimeout((()=>{this.stageScrollFlow.bringNodeIntoView(o[0].id,r)}),ts.x1.SIXTY)}updateSemanticType(e){const{nodeId:t,type:o}=e;this.dbSync.mutate(this.projectDoc,(e=>{const n=e.nodes.byId[t];if(!n)throw new Error(`Node that need to change semantic type is missing - ${t}`);n.semanticType=o}))}getFirstPositionedParentOfNode(e){const t=this.projectDoc.nodes.byId[e];let{compInstanceId:o}=this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(e);const n=null===t||void 0===t?void 0:t.parentOrSlotId;if(!t||!n)return{parentNode:null,parentElement:null};let i=this.projectDoc.nodes.byId[n],r=!1;for(;!r&&i;){const e=this.projectDoc.components.byId[i.compIdOfRootNode||""],t=e&&o&&e.instantiatedByNodes[o]?o:i.id;if(this.nodeStyleManagmentFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:t,key:"position",values:["absolute","fixed","relative"]}))r=!0;else{const e=i.parentOrSlotId||o;if(!e){r=!0;continue}o===e&&(o=this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(o).compInstanceId),i=this.projectDoc.nodes.byId[e]}}if(!i)return{parentNode:null,parentElement:null};return{parentNode:i,parentElement:this.elementRefProvider.getDomNodeElementRefByCompInstance(i.id,o)||this.elementRefProvider.getDomNodeElementRefByCompInstance(i.id)}}getNodeChildren(e,t){const o=this.projectDoc.nodes.byId[e];if(!o)return[];if(this.projectDoc.nodes.nodeIsCompInstance(o)){const e=this.projectDoc.components.byId[o.compIdOfCompInstance];return Object.keys((null===e||void 0===e?void 0:e.slots)||{})}if(o.primitiveType===dt.sO.SLOT){if(!t)return[];const e=this.projectDoc.nodes.byId[t];return e?Object.keys(e.slottedNodes[o.id]||{}):[]}return Object.keys((null===o||void 0===o?void 0:o.childrenIds)||{})}swapWithNextNode(e){const{nodeId:t,doc:o}=e;if(!o)return;const n=o.nodes.byId[t];if(!n||this.rtcFlow.isNodeLocked(n.id))return;const i=o.nodes.getNextSibling(n);i&&!this.rtcFlow.isNodeLocked(i.id)&&([n.pos,i.pos]=[i.pos,n.pos])}swapWithPrevNode(e){const{nodeId:t,doc:o}=e;if(!o)return;const n=o.nodes.byId[t];if(!n||this.rtcFlow.isNodeLocked(n.id))return;const i=o.nodes.getPrevSibling(n);i&&!this.rtcFlow.isNodeLocked(i.id)&&([n.pos,i.pos]=[i.pos,n.pos])}updateNodePosition(e){const{nodeId:t,doc:o,newPos:n}=e;if(!o)return;const i=o.nodes.byId[t];i&&!this.rtcFlow.isNodeLocked(i.id)&&(i.pos=n)}addNewOptionItem(e){const{doc:t}=e,o=(0,Hr.Z)(e,Ts);if(!t)return;t.nodes.byId[o.parentNodeId]&&t.addNewOptionItem(o)}createOrUpdateRenderingCondition(e){var t;const{nodeId:o,stateReference:n,renderCondition:i,doc:r}=e,s=this.projectUIState.selection.componentId;if(!r||!s)return;const a=r.nodes.byId[o],l=r.components.byId[s];if(!a||!l)return;const c=null===(t=Object.values(l.stateDefinitions).find((e=>e.name===n)))||void 0===t?void 0:t.id;if(!c)return;const d=new zr({reference:new os.P({content:{referenceType:"state",id:n},id:c}),value:i});a.renderingConditions=Pa(Pa({},a.renderingConditions),d)}removeRenderingCondition(e){const{nodeId:t,doc:o}=e;if(!o)return;const n=o.nodes.byId[t];n&&(n.renderingConditions=null)}nodeIsChildOfButton(e){const t=this.projectDoc.nodes.byId[e];if(!t||!t.parentId)return!1;const o=this.projectDoc.nodes.byId[t.parentId];return(null===o||void 0===o?void 0:o.primitiveType)===dt.sO.BUTTON}findParentThatAcceptsNodes(e){const{nodes:t,startNode:o,doc:n}=e;if(!n)return;let i=o,r=t.every((e=>{var t;return null===(t=i)||void 0===t?void 0:t.isNodeAcceptingChildByElementType(e.primitiveType)}));for(;!r&&i;)i=n.nodes.byId[i.parentId||""],r=t.every((e=>{var t;return null===(t=i)||void 0===t?void 0:t.isNodeAcceptingChildByElementType(e.primitiveType)}));return i}updateHtmlForNodeById(e){const{doc:t,nodeId:o,value:n}=e;if(!t)return;const i=t.nodes.byId[o];i&&t.updateHtmlForNode({node:i,value:n})}},ma=(0,G.Z)(ha.prototype,"projectUIState",[Es],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ga=(0,G.Z)(ha.prototype,"nodeSelectionFlow",[Cs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ya=(0,G.Z)(ha.prototype,"projectDoc",[xs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fa=(0,G.Z)(ha.prototype,"dbSync",[Ps],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ba=(0,G.Z)(ha.prototype,"componentManagementFlow",[ks],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wa=(0,G.Z)(ha.prototype,"notificationsManagementFlow",[Ms],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),va=(0,G.Z)(ha.prototype,"nodeStyleManagmentFlow",[Zs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ia=(0,G.Z)(ha.prototype,"nodeAttributeManagmentFlow",[Us],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sa=(0,G.Z)(ha.prototype,"propDefinitionManagementFlow",[As],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ja=(0,G.Z)(ha.prototype,"nodeEditingFlow",[Ls],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Da=(0,G.Z)(ha.prototype,"elementRefProvider",[_s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oa=(0,G.Z)(ha.prototype,"stageScrollFlow",[Rs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fa=(0,G.Z)(ha.prototype,"freestyleNodeFlow",[Bs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ta=(0,G.Z)(ha.prototype,"dropIntoButtonFlow",[Hs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Na=(0,G.Z)(ha.prototype,"rtcFlow",[zs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ea=(0,G.Z)(ha.prototype,"imageOptimisationFlow",[$s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ca=(0,G.Z)(ha.prototype,"modalManagementFlow",[Gs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(ha.prototype,"setRenamedNode",[Vs],Object.getOwnPropertyDescriptor(ha.prototype,"setRenamedNode"),ha.prototype),(0,G.Z)(ha.prototype,"deleteNodesById",[Js,Q.P,Ws],Object.getOwnPropertyDescriptor(ha.prototype,"deleteNodesById"),ha.prototype),(0,G.Z)(ha.prototype,"duplicateNodesById",[Ks,Q.P],Object.getOwnPropertyDescriptor(ha.prototype,"duplicateNodesById"),ha.prototype),(0,G.Z)(ha.prototype,"moveNodesToTarget",[Ys,Q.P],Object.getOwnPropertyDescriptor(ha.prototype,"moveNodesToTarget"),ha.prototype),(0,G.Z)(ha.prototype,"deleteAndAddNodes",[Q.P],Object.getOwnPropertyDescriptor(ha.prototype,"deleteAndAddNodes"),ha.prototype),(0,G.Z)(ha.prototype,"copyNodeHierarchyToTarget",[Xs,Q.P,qs],Object.getOwnPropertyDescriptor(ha.prototype,"copyNodeHierarchyToTarget"),ha.prototype),(0,G.Z)(ha.prototype,"addNodesToParentOrStage",[Q.P,Qs],Object.getOwnPropertyDescriptor(ha.prototype,"addNodesToParentOrStage"),ha.prototype),(0,G.Z)(ha.prototype,"copyNodeStylesToTargets",[ea,Q.P,ta],Object.getOwnPropertyDescriptor(ha.prototype,"copyNodeStylesToTargets"),ha.prototype),(0,G.Z)(ha.prototype,"copyNodeClassesStylesToTargets",[oa],Object.getOwnPropertyDescriptor(ha.prototype,"copyNodeClassesStylesToTargets"),ha.prototype),(0,G.Z)(ha.prototype,"copyNodesToTarget",[na,Q.P,ia],Object.getOwnPropertyDescriptor(ha.prototype,"copyNodesToTarget"),ha.prototype),(0,G.Z)(ha.prototype,"groupNodes",[ra],Object.getOwnPropertyDescriptor(ha.prototype,"groupNodes"),ha.prototype),(0,G.Z)(ha.prototype,"ungroupNodeChildren",[sa],Object.getOwnPropertyDescriptor(ha.prototype,"ungroupNodeChildren"),ha.prototype),(0,G.Z)(ha.prototype,"addPrimitivesToSelNodeSelectAndScroll",[aa,Q.P],Object.getOwnPropertyDescriptor(ha.prototype,"addPrimitivesToSelNodeSelectAndScroll"),ha.prototype),(0,G.Z)(ha.prototype,"updateSemanticType",[la],Object.getOwnPropertyDescriptor(ha.prototype,"updateSemanticType"),ha.prototype),(0,G.Z)(ha.prototype,"swapWithNextNode",[ca,Q.P],Object.getOwnPropertyDescriptor(ha.prototype,"swapWithNextNode"),ha.prototype),(0,G.Z)(ha.prototype,"swapWithPrevNode",[da,Q.P],Object.getOwnPropertyDescriptor(ha.prototype,"swapWithPrevNode"),ha.prototype),(0,G.Z)(ha.prototype,"updateNodePosition",[Q.P],Object.getOwnPropertyDescriptor(ha.prototype,"updateNodePosition"),ha.prototype),(0,G.Z)(ha.prototype,"addNewOptionItem",[pa,Q.P],Object.getOwnPropertyDescriptor(ha.prototype,"addNewOptionItem"),ha.prototype),(0,G.Z)(ha.prototype,"createOrUpdateRenderingCondition",[Q.P],Object.getOwnPropertyDescriptor(ha.prototype,"createOrUpdateRenderingCondition"),ha.prototype),(0,G.Z)(ha.prototype,"removeRenderingCondition",[Q.P],Object.getOwnPropertyDescriptor(ha.prototype,"removeRenderingCondition"),ha.prototype),(0,G.Z)(ha.prototype,"findParentThatAcceptsNodes",[Q.P],Object.getOwnPropertyDescriptor(ha.prototype,"findParentThatAcceptsNodes"),ha.prototype),(0,G.Z)(ha.prototype,"updateHtmlForNodeById",[Q.P],Object.getOwnPropertyDescriptor(ha.prototype,"updateHtmlForNodeById"),ha.prototype),ua=ha));var ka,Ma,Za=o(39795);(0,J.JJ)("slotNodeManagementFlow")((Ma=class{getSlotPreviewSize(e){var t,o,n;const{slotId:i,instanceId:r,doc:s}=e;if(!s)return{width:Za.l.WIDTH,height:Za.l.HEIGHT};const a=r?s.nodes.byId[r]:void 0,l=null===(t=s.nodes.byId[i])||void 0===t?void 0:t.compIdOfSlot,c=(null===(o=s.components.byId[l||""])||void 0===o||null===(n=o.slots)||void 0===n?void 0:n[i])||{width:Za.l.WIDTH,height:Za.l.HEIGHT};return a&&a.previewSize[i]||c}setSlotPreviewSize(e){const{slotId:t,compId:o,instanceId:n,width:i,height:r,doc:s}=e;if(!s)return;if(!n){if(!o)return;const e=s.components.byId[o];if(!e)return;return void(e.slots[t]={width:i,height:r})}const a=s.nodes.byId[n];if(!a||!s.nodes.nodeIsCompInstance(a))throw new Error(`Attempted to set preview size on slot with no instance node! id: ${t}`);a.setPreviewSize(i,r,t)}toggleSlotPreviewHidden(e){const{slotId:t,instanceId:o,doc:n}=e;if(!n)return;const i=n.nodes.byId[o];if(!i||!n.nodes.nodeIsCompInstance(i))throw new Error(`Attempted to set preview size on slot with no instance node! id: ${t}`);i.slotsWithHiddenPreview[t]=!i.slotsWithHiddenPreview[t]}},(0,G.Z)(Ma.prototype,"getSlotPreviewSize",[Q.P],Object.getOwnPropertyDescriptor(Ma.prototype,"getSlotPreviewSize"),Ma.prototype),(0,G.Z)(Ma.prototype,"setSlotPreviewSize",[Q.P],Object.getOwnPropertyDescriptor(Ma.prototype,"setSlotPreviewSize"),Ma.prototype),(0,G.Z)(Ma.prototype,"toggleSlotPreviewHidden",[Q.P],Object.getOwnPropertyDescriptor(Ma.prototype,"toggleSlotPreviewHidden"),Ma.prototype),ka=Ma));var Ua,Aa,La,_a,Ra,Ba,Ha,za,$a,Ga,Va,Ja,Wa,Ka,Ya,Xa=o(12293),qa=o(94932);Ua=(0,J.JJ)("nodeSelectionFlow"),Aa=(0,J.f3)("projectUIState"),La=(0,J.f3)("webRTCState"),_a=(0,J.f3)("projectDoc"),Ra=(0,J.f3)("nodeRichTextFlow"),Ba=(0,J.f3)("nodeEditingFlow"),Ha=(0,J.f3)("nodeManagementFlow"),Ua(($a=class{constructor(){(0,z.Z)(this,"projectUIState",Ga,this),(0,z.Z)(this,"webRTCState",Va,this),(0,z.Z)(this,"projectDoc",Ja,this),(0,z.Z)(this,"nodeRichTextFlow",Wa,this),(0,z.Z)(this,"nodeEditingFlow",Ka,this),(0,z.Z)(this,"nodeManagementFlow",Ya,this)}setHoveredNodeIds(e){const{nodeIds:t,compInstanceId:o,hoveringProp:n,hoveringCompLink:i}=e,r={},s=this.projectUIState.selection.nodes;null===t||void 0===t||t.forEach((e=>{e&&!s[e]&&(r[e]=!0)})),(0,V.JG)(this.projectUIState,(e=>{e.hoveredNodes.nodes=r,e.hoveredNodes.compInstanceId=o,e.hoveredNodes.hoveringProp=n,e.hoveredNodes.hoveringCompLink=i}))}resetNodeSelection(){(0,V.JG)(this.projectUIState,(e=>{Object.keys(e.selection.nodes).forEach((t=>{delete e.selection.nodes[t],e.selection.compInstanceId=null,e.selection.interactiveElementRootId=null}))}))}getSelectedNodeId(){var e;if(1===Object.keys(this.projectUIState.selection.nodes||{}).length)return Object.keys(this.projectUIState.selection.nodes)[0];const t=this.projectUIState.selection.componentId;if(!t)return null;const o=this.projectDoc.pages.byId[t]||this.projectDoc.components.byId[t];return null!==(e=null===o||void 0===o?void 0:o.rootNodeId)&&void 0!==e?e:null}getSelectedNodeType(){var e;const t=this.getSelectedNodeId();if(!t)return null;const o=this.projectDoc.nodes.byId[t];return o?null!==(e=null===o||void 0===o?void 0:o.semanticType)&&void 0!==e?e:null===o||void 0===o?void 0:o.primitiveType:null}selectAllSiblings(){var e;const t=Object.keys(this.projectUIState.selection.nodes);if(1!==t.length)return;const o=null===(e=this.projectDoc.nodes.byId[t[0]])||void 0===e?void 0:e.parentId,n=o&&this.projectDoc.nodes.byId[o];if(!n)return;const i=Object.keys(n.childrenIds);this.setMultipleNodesSelection(i)}selectNextSibling(){const e=Object.keys(this.projectUIState.selection.nodes);if(1!==e.length)return;const t=this.projectDoc.nodes.getNextSibling(this.projectDoc.nodes.byId[e[0]]);t&&this.setNodeSelection({nodeId:t.id,isMultiSelectMode:!1,keepCurrentInstance:!0})}selectPreviousSibling(){const e=Object.keys(this.projectUIState.selection.nodes);if(1!==e.length)return;const t=this.projectDoc.nodes.getPrevSibling(this.projectDoc.nodes.byId[e[0]]);t&&this.setNodeSelection({nodeId:t.id,isMultiSelectMode:!1,keepCurrentInstance:!0})}selectSelectedNodeParent(){const e=Object.keys(this.projectUIState.selection.nodes);1===e.length&&this.selectNodeParent(e[0],this.projectUIState.selection.compInstanceId)}selectNodeParent(e,t){if(!e)return;const o=this.projectDoc.nodes.byId[e];if(!o)return;const n=o.primitiveType===dt.sO.SLOT&&t?t:o.parentOrSlotId;if(!n)return void this.resetNodeSelection();const i=this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(n||"").compInstanceId||this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(e).compInstanceId;this.setNodeSelection({nodeId:n,isMultiSelectMode:!1,compInstanceId:i})}selectChildOrEditNode(){var e;const t=Object.keys(this.projectUIState.selection.nodes);if(1!==t.length)return;const o=this.projectDoc.nodes.byId[t[0]];if(!o)return;if(o.primitiveType&&((0,mt.xK)(o)||o.primitiveType===dt.sO.HTML_NODE))return void this.nodeEditingFlow.beginEditingNode(o.id);if(!this.projectDoc.nodes.nodeIsCompInstance(o)&&(0===Object.keys(this.nodeManagementFlow.getNodeChildren(o.id,this.projectUIState.selection.compInstanceId||void 0)||{}).length||0===(null===(e=dt.y7[o.primitiveType])||void 0===e?void 0:e.length)))return;let n,i=this.projectUIState.selection.compInstanceId;if(this.projectDoc.nodes.nodeIsCompInstance(o)){const e=this.projectDoc.components.byId[o.compIdOfCompInstance];i=o.id;const t=this.projectDoc.nodes.orderChildrenIds(Object.keys((null===e||void 0===e?void 0:e.slots)||{}))[0];if(!t)return;n=this.projectDoc.nodes.byId[t]}else n=this.projectDoc.nodes.getFirstChild(o,i);n&&this.setNodeSelection({nodeId:n.id,isMultiSelectMode:!1,compInstanceId:i});const r=Object.keys(o.childrenIds);o.primitiveType!==dt.sO.BUTTON||1!==r.length||this.nodeEditingFlow.beginEditingNode(r[0])}editSelectedNode(){const e=Object.keys(this.projectUIState.selection.nodes);if(1!==e.length)return;const t=this.projectDoc.nodes.byId[e[0]];t.primitiveType&&t.primitiveType!==dt.sO.DEV_COMPONENT&&dt.Ih.includes(t.primitiveType)&&this.nodeEditingFlow.beginEditingNode(e[0])}setMultipleNodesSelection(e,t){e.length&&(0,V.JG)(this.projectUIState,(o=>{o.stage.setInteractionState(null),Object.keys(o.selection.nodes).forEach((e=>delete o.selection.nodes[e]));const n=Object.values(this.webRTCState.editedNodes).reduce(((e,{nodeIds:t})=>[...e,...t]),[]);e.forEach((e=>{if(!n.includes(e))return o.selection.nodes[e]?(delete o.selection.nodes[e],o):(o.selection.nodes[e]=!0,this.expandTreeviewToNodeAndFocusSidebar(e),o)})),o.selection.compInstanceId=t||null}))}setNodeSelection({nodeId:e,isMultiSelectMode:t=!1,expandTreeView:o=!0,compInstanceId:n=null,keepCurrentInstance:i=!1}){var r;const s=this.projectDoc.nodes.byId[e||""],{nodes:a,compInstanceId:l}=this.projectUIState.selection;let c;(0,V.JG)(this.projectUIState,(({userInteractions:e})=>{e.inPreviewMode=!1}));let d=!1;if(t||!e||!a[e]||1!==Object.keys(a).length||n!==l){if(!t&&1===Object.keys(a).length){var p;c=this.projectDoc.nodes.byId[Object.keys(a)[0]||""];const{editingNode:e={}}=this.projectUIState.staticNodeInterationsData;Object.keys(e)[0]===(null===(p=c)||void 0===p?void 0:p.id)&&(d=!0)}this.nodeRichTextFlow.toggleAddLink(!1),this.nodeRichTextFlow.storeSelection(null),(0,V.JG)(this.projectUIState,(r=>{if(r.stage.setInteractionState(null),Object.keys(r.selection.nodes).forEach((e=>{(!e||!t||null!==s&&void 0!==s&&s.compIdOfRootNode)&&delete r.selection.nodes[e];const o=this.projectDoc.nodes.byId[e];null!==o&&void 0!==o&&o.compIdOfRootNode&&delete r.selection.nodes[e]})),!e)return;if(!Object.values(this.webRTCState.editedNodes).reduce(((e,{nodeIds:t})=>[...e,...t]),[]).includes(e)){if(!t)return r.selection.nodes[e]=!0,this.handleInteractiveElementsSelection(e,r),i||(r.selection.compInstanceId=n),void(o&&this.expandTreeviewToNodeAndFocusSidebar(e));if(n===l)if(r.selection.nodes[e])delete r.selection.nodes[e];else{var a;const t=Object.keys(r.selection.nodes);1===t.length&&n&&(null===(a=this.projectDoc.nodes.byId[t[0]])||void 0===a?void 0:a.primitiveType)===dt.sO.SLOT?r.selection.nodes={[e]:!0}:r.selection.nodes[e]=!0,o&&this.expandTreeviewToNodeAndFocusSidebar(e)}}})),(null===(r=c)||void 0===r?void 0:r.primitiveType)===dt.sO.TEXT&&d&&this.editSelectedNode()}}handleInteractiveElementsSelection(e,t){var o,n;const i=this.projectDoc.nodes.getAncestors(e,!1,!0).map((e=>this.projectDoc.nodes.byId[e])).filter((e=>Object.values(dt.tn).includes(null===e||void 0===e?void 0:e.primitiveType)));let r=null===(o=i.at(-1))||void 0===o?void 0:o.id;var s;i.length>=2&&(null===(n=i.at(-1))||void 0===n?void 0:n.primitiveType)===dt.IV.NAVBAR&&(r=null===(s=i.at(-2))||void 0===s?void 0:s.id);if(r){if(r!==t.selection.interactiveElementRootId){const e=this.projectDoc.nodes.byId[r];switch(null===e||void 0===e?void 0:e.primitiveType){case dt.IV.DROPDOWN:case dt.IV.NAVBAR:this.projectDoc.nodes.getDescendents(t.selection.interactiveElementRootId||"").filter((e=>e.primitiveType===dt.IV.DROPDOWN_LIST||e.primitiveType===dt.IV.MOBILE_MENU)).forEach((e=>{(0,Xa.kY)(e,qa.w.SHOW,!0),(0,Xa.kY)(e,qa.w.TRANSLATE_TO_DEFAULT,!0),delete t.selection.nodesWithUtilityClasses[e.id]}))}}t.selection.interactiveElementRootId=r}else t.selection.interactiveElementRootId&&(this.projectDoc.nodes.getDescendents(t.selection.interactiveElementRootId).filter((e=>e.primitiveType===dt.IV.DROPDOWN_LIST||e.primitiveType===dt.IV.MOBILE_MENU)).forEach((e=>{(0,Xa.kY)(e,qa.w.SHOW,!0),(0,Xa.kY)(e,qa.w.TRANSLATE_TO_DEFAULT,!0),delete t.selection.nodesWithUtilityClasses[e.id]})),t.selection.interactiveElementRootId=null)}setNodeInPreview(e){(0,V.JG)(this.projectUIState,(t=>{t.selection.interactiveElementRootId=e}))}removeNodeSelection(e){(0,V.JG)(this.projectUIState,(t=>{delete t.selection.nodes[e],t.selection.interactiveElementRootId=null}))}expandTreeviewToNodeAndFocusSidebar(e){const t=this.projectDoc.nodes.byId[e];if(!t)return;const o=this.projectUIState.layout.sidebarPanel;o&&![Y.tI.ASSETS_MANAGER,Y.tI.FILES].includes(o)&&(0,V.JG)(this.projectUIState,(e=>{e.layout.sidebarPanel=Y.tI.FILES}));let n=this.projectDoc.nodes.byId[t.parentOrSlotId||""],i=this.projectUIState.selection.compInstanceId||this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(e).compInstanceId;for(t.primitiveType===dt.sO.SLOT&&(n=this.projectDoc.nodes.byId[i||""]);n;)i===n.id&&(i=this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(i).compInstanceId),this.setExpandedTreeNodeValue(n.id,!0,i),n=n.primitiveType!==dt.sO.SLOT?this.projectDoc.nodes.byId[n.parentOrSlotId||""]:this.projectDoc.nodes.byId[i||""]}setNodeRangeSelection({nodeId:e,compInstanceId:t}){(0,V.JG)(this.projectUIState,(o=>{var n,i;o.selection.compInstanceId=t||null,o.stage.setInteractionState(null);const r=Object.keys(o.selection.nodes);if(!r.length)return o.selection.nodes[e]=!0,o;let s=r[0];if(s===e)return o;const a=null===(n=this.projectDoc.nodes.byId[s])||void 0===n?void 0:n.parentOrSlotId,l=null===(i=this.projectDoc.nodes.byId[e])||void 0===i?void 0:i.parentOrSlotId;if(!a||a!==l)return r.forEach((e=>delete o.selection.nodes[e])),o.selection.nodes[e]=!0,this.expandTreeviewToNodeAndFocusSidebar(e),o;const c=this.projectDoc.nodes.orderChildrenIds(this.nodeManagementFlow.getNodeChildren(a,t));if(0===c.length)return;let d=c.indexOf(s),p=c.indexOf(e);d>p&&(r.length>1&&(s=r[r.length-1]),d=c.indexOf(s),[d,p]=[p,d]);const u=c.slice(d,p+1);return r.forEach((e=>delete o.selection.nodes[e])),u.forEach((e=>o.selection.nodes[e]=!0)),o}))}forceExpandTreeNode(e,t){const o=t||"root";this.setExpandedTreeNodeValue(e,!0,o)}forceCollapseTreeNode(e,t){const o=t||"root";this.setExpandedTreeNodeValue(e,!1,o,!0)}toggleExpandedTreeNode(e,t){var o;const n=t||"root";this.setExpandedTreeNodeValue(e,!(null!==(o=this.projectUIState.selection.expandedTreeNodes[n])&&void 0!==o&&o[e]),n)}setExpandedTreeNodeValue(e,t,o,n){const i=o||"root";(0,V.JG)(this.projectUIState,(o=>(o.selection.expandedTreeNodes[i]||(o.selection.expandedTreeNodes[i]={}),!t&&o.selection.expandedTreeNodes[i][e]?(delete o.selection.expandedTreeNodes[i][e],o):(n||(o.selection.expandedTreeNodes[i][e]=!0),o))))}cleanSelectedExpandedAndEditedNodes(){(0,V.JG)(this.projectUIState,(e=>{Object.keys(e.selection.nodes).forEach((t=>{this.projectDoc.nodes.byId[t]||delete e.selection.nodes[t]})),Object.keys(e.selection.expandedTreeNodes).forEach((t=>{this.projectDoc.nodes.byId[t]?Object.keys(e.selection.expandedTreeNodes[t]||{}).forEach((t=>{this.projectDoc.nodes.byId[t]||delete e.selection.expandedTreeNodes[t]})):delete e.selection.expandedTreeNodes[t]}))}))}},Ga=(0,G.Z)($a.prototype,"projectUIState",[Aa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Va=(0,G.Z)($a.prototype,"webRTCState",[La],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ja=(0,G.Z)($a.prototype,"projectDoc",[_a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wa=(0,G.Z)($a.prototype,"nodeRichTextFlow",[Ra],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ka=(0,G.Z)($a.prototype,"nodeEditingFlow",[Ba],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ya=(0,G.Z)($a.prototype,"nodeManagementFlow",[Ha],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),za=$a));var Qa,el,tl,ol,nl,il,rl,sl,al,ll,cl,dl,pl,ul,hl,ml,gl,yl,fl,bl,wl,vl,Il,Sl,jl=o(53482),Dl=o(6945),Ol=o(78064),Fl=o(30499);Qa=(0,J.JJ)("nodeEditingFlow"),el=(0,J.f3)("projectDoc"),tl=(0,J.f3)("projectUIState"),ol=(0,J.f3)("componentManagementFlow"),nl=(0,J.f3)("sharedbProjectSyncService"),il=(0,J.f3)("propDefinitionManagementFlow"),rl=(0,J.f3)("nodeSelectionFlow"),sl=(0,J.f3)("nodeStyleManagmentFlow"),al=(0,J.f3)("webRTCState"),ll=(0,J.f3)("nodeManagementFlow"),cl=(0,J.f3)("modalManagementFlow"),dl=(0,q.G)(te.l.BEGIN_EDIT_TEXT),Qa((ul=class{constructor(){(0,z.Z)(this,"projectDoc",hl,this),(0,z.Z)(this,"projectUIState",ml,this),(0,z.Z)(this,"componentManagementFlow",gl,this),(0,z.Z)(this,"dbSync",yl,this),(0,z.Z)(this,"propDefinitionManagementFlow",fl,this),(0,z.Z)(this,"nodeSelectionFlow",bl,this),(0,z.Z)(this,"nodeStyleManagementFlow",wl,this),(0,z.Z)(this,"webRTCState",vl,this),(0,z.Z)(this,"nodeManagementFlow",Il,this),(0,z.Z)(this,"modalManagementFlow",Sl,this),(0,$.Z)(this,"getCommonTypeForNodes",(e=>{let t,o;for(const n of e){const e=this.projectDoc.nodes.byId[n];e&&(void 0===t&&e.primitiveType&&(t=e.primitiveType),e.primitiveType!==t&&(t=dt.sO.MIXED),void 0===o&&e.semanticType&&(o=e.semanticType),e.semanticType!==o&&(o=null))}return{primitiveType:t,semanticType:o}})),(0,$.Z)(this,"getCommonSemanticTypeForNodes",(e=>{let t=null;for(const o of e){const e=this.projectDoc.nodes.byId[o];if(!e)continue;const n=e.semanticType;if(!t&&n&&(t=n),n!==t)return null}return t})),(0,$.Z)(this,"getElementIconPath",(e=>{let t,o;const n=this.getCommonDisplayTypeForNodes(e);if(e.length>1)({primitiveType:t,semanticType:o}=this.getCommonTypeForNodes(e));else{const n=this.projectDoc.nodes.byId[e[0]];if(!n)return;if(this.nodeIsRich({nodeId:(null===n||void 0===n?void 0:n.id)||""}))return Fl.TV["rich-text"];({primitiveType:t,semanticType:o}=n)}const i=n||(o&&Ol.cf.includes(o)?o:t||"");return Ol.YN[i]})),(0,$.Z)(this,"getCommonDisplayTypeForNodes",(e=>{let t;for(const n of e){const e=this.projectDoc.nodes.byId[n];if(!e)continue;if(e.primitiveType!==dt.sO.CONTAINER)return;const i=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(n,["display","flexDirection"]);let r="grid"===i.display?"grid":void 0;var o;if("flex"===i.display)null!==i&&void 0!==i&&i.flexDirection&&!["row","row-reverse"].includes(i.flexDirection.toString())||(r=Ol.Bw.ROW),["column","column-reverse"].includes(null===(o=i.flexDirection)||void 0===o?void 0:o.toString())&&(r=Ol.Bw.COLUMN);if(void 0===t&&r&&(t=r),r!==t)return}return t}))}nodeIsRich(e){const{nodeId:t,doc:o}=e,n=(o||this.projectDoc).nodes.byId[t];return!!n&&(!!(0,mt.xK)(n)&&(!!n.contentChildren&&!!Object.keys((null===n||void 0===n?void 0:n.childrenIds)||{}).length))}getNodeDisplayName(e){const{primitiveType:t,semanticType:o}=this.getCommonTypeForNodes(e);if(!t)return"";let n="",i=!1;if(1===e.length){const t=this.projectDoc.nodes.byId[e[0]];if(!t)return"";if(n=t.name||"",t.compIdOfRootNode){const e=this.projectDoc.getProjectPageOrComponent(t.compIdOfRootNode);n=(null===e||void 0===e?void 0:e.title)||n}i=!!t.abilities.link}if(this.projectUIState.userPreferences.showElementTag)return o||dt.pS[t];if(n)return n;if(t===dt.sO.COMPONENT){let t="";for(const o of e){const e=this.projectDoc.nodes.byId[o];if(e&&(this.projectDoc.nodes.nodeIsCompInstance(e)||e.compIdOfRootNode)){const o=this.projectDoc.getProjectPageOrComponent(e.compIdOfCompInstance||e.compIdOfRootNode||"");if(!o)throw new Error("Did not find selected component.");t||(t=o.title),t!==o.title&&(t=dt.AP[dt.sO.COMPONENT])}}return t}switch(t){case dt.sO.TEXT:return i?"Link":null!==o&&void 0!==o&&o.includes("h")?"Heading":o===dt.RY.LABEL?"Label":dt.AP[dt.sO.TEXT];default:return dt.AP[t]}}linkNodeContentToProp(e,t){this.dbSync.mutate(this.projectDoc,(o=>{var n;const i=o.nodes.byId[e];if(!i)return;if(!(0,mt.xK)(i)||this.nodeIsRich({nodeId:e}))return;const r=this.projectUIState.selection.componentId,s=null===(n=this.projectDoc.components.byId[r])||void 0===n?void 0:n.propDefinitions[t];if(!s)return;const a=Object.values(i.contentChildren||{});if(1===a.length)if("dynamic"===a[0].type){var l;const t=null===(l=this.projectDoc.components.byId[r])||void 0===l?void 0:l.propDefinitions[a[0].content.id];this.propDefinitionManagementFlow.removePropLocationForNode({nodeId:e,location:{base:jl.hD.CONTENT},propId:t.id,unlink:!0,doc:o}),i.contentChildren[a[0].id]=new os.P({content:{referenceType:"prop",id:s.id},id:a[0].id}),this.propDefinitionManagementFlow.addPropLocationForNode({nodeId:e,location:{base:jl.hD.CONTENT},propId:s.id,doc:o})}else i.contentChildren[a[0].id]=new os.P({content:{referenceType:"prop",id:s.id},id:a[0].id}),this.propDefinitionManagementFlow.addPropLocationForNode({nodeId:e,location:{base:jl.hD.CONTENT},propId:s.id,doc:o})}))}unlinkNodeContentFromProp(e){const{nodeId:t,unlink:o,doc:n}=e;if(!n)return;const i=n.nodes.byId[t];if(!i)return;const r=Object.values(i.contentChildren||{});if(1===r.length&&"dynamic"===r[0].type){var s;const e=this.projectUIState.selection.componentId,a=null===(s=n.components.byId[e])||void 0===s?void 0:s.propDefinitions[r[0].content.id];if(!a)return;n.replaceDynamicPropWithStaticNode({node:i,propId:a.id,propDefinition:a,staticValue:a.defaultValue}),this.propDefinitionManagementFlow.removePropLocationForNode({nodeId:t,location:{base:jl.hD.CONTENT},propId:a.id,unlink:o,doc:n})}}replaceDynamicContentWithPropDefaultValue(e){const{nodeId:t,defaultPropValue:o,doc:n}=e;if(!n)return;const i=n.nodes.byId[t];if(!i)return;const r=i.contentChildren;if(!r)return;const s=Object.values(r);1===s.length&&"dynamic"===s[0].type&&Object.keys(r).forEach((e=>{r[e]=new ar.F({content:o||"",id:e})}))}createNodeContentPropDefinition(e){const{nodeId:t,doc:o}=e;if(!o)return;const n=o.nodes.byId[t];if(!n)return;const i=this.projectUIState.selection.componentId,r=o.components.byId[i];r&&o.addDefaultContentPropDefinition(n,r)}rename(e){this.dbSync.mutate(this.projectDoc,(t=>{const o=t.nodes.byId[e.id];if((null===o||void 0===o?void 0:o.name)===e.value)return t;if(!Dl.RQ.test(e.value))return t;if(o){if(this.projectDoc.nodes.nodeIsCompInstance(o)){const n=t.components.byId[o.compIdOfCompInstance];return e.value===(null===n||void 0===n?void 0:n.title)?(delete o.name,t):(o.name=e.value,t)}o.name=e.value}return t}))}beginEditingNode(e){const t=this.projectDoc.nodes.byId[e];if(t)if(this.projectDoc.nodes.nodeIsCompInstance(t))this.componentManagementFlow.select(t.compIdOfCompInstance);else if(t.primitiveType!==dt.sO.HTML_NODE){if((0,mt.xK)(t)){const{editingNode:o}=this.projectUIState.staticNodeInterationsData;if(o&&o[e])return;const n=Object.values(t.contentChildren||{});if(1===n.length&&"dynamic"===n[0].type)return(0,V.JG)(this.projectUIState,(({layout:e,dynamicNodeInteractionsData:t})=>{e.selectedComponentSetupTab===Y.wU.STATE&&(e.selectedComponentSetupTab=Y.wU.PROPS),t.isManagingProps=!0,t.selectedPropId=n[0].content.id,t.autofocusDefaultValue=!0})),void setTimeout((()=>{(0,V.JG)(this.projectUIState,(({dynamicNodeInteractionsData:e})=>{e.autofocusDefaultValue=!1}))}),100);let i=!1;if(Object.entries(this.webRTCState.editedNodes).forEach((([t,o])=>{o.nodeIds.includes(e)&&(i=!0)})),i)return;return this.nodeSelectionFlow.setNodeSelection({nodeId:e}),void(0,V.JG)(this.projectUIState,(t=>{const n=Object.keys(o)[0]||-1;delete t.staticNodeInterationsData.editingNode[n],t.staticNodeInterationsData.editingNode[e]=!0,t.layout.visibleInspector=Y.dG.MAIN}))}}else{const e=Jo.d.createCustomModal({data:{code:t.html,title:"Code Embed (HTML+CSS+JS)",allowSaveWithErrors:!0},Component:Os,onSubmit:e=>{this.nodeManagementFlow.updateHtmlForNodeById({nodeId:t.id,value:e}),this.modalManagementFlow.hideModal()}});this.modalManagementFlow.showModal(e,{padding:"0px"})}}},hl=(0,G.Z)(ul.prototype,"projectDoc",[el],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ml=(0,G.Z)(ul.prototype,"projectUIState",[tl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gl=(0,G.Z)(ul.prototype,"componentManagementFlow",[ol],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yl=(0,G.Z)(ul.prototype,"dbSync",[nl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fl=(0,G.Z)(ul.prototype,"propDefinitionManagementFlow",[il],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bl=(0,G.Z)(ul.prototype,"nodeSelectionFlow",[rl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wl=(0,G.Z)(ul.prototype,"nodeStyleManagementFlow",[sl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vl=(0,G.Z)(ul.prototype,"webRTCState",[al],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Il=(0,G.Z)(ul.prototype,"nodeManagementFlow",[ll],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sl=(0,G.Z)(ul.prototype,"modalManagementFlow",[cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(ul.prototype,"unlinkNodeContentFromProp",[Q.P],Object.getOwnPropertyDescriptor(ul.prototype,"unlinkNodeContentFromProp"),ul.prototype),(0,G.Z)(ul.prototype,"replaceDynamicContentWithPropDefaultValue",[Q.P],Object.getOwnPropertyDescriptor(ul.prototype,"replaceDynamicContentWithPropDefaultValue"),ul.prototype),(0,G.Z)(ul.prototype,"createNodeContentPropDefinition",[Q.P],Object.getOwnPropertyDescriptor(ul.prototype,"createNodeContentPropDefinition"),ul.prototype),(0,G.Z)(ul.prototype,"beginEditingNode",[dl],Object.getOwnPropertyDescriptor(ul.prototype,"beginEditingNode"),ul.prototype),pl=ul));var Tl,Nl,El,Cl,xl,Pl,kl,Ml,Zl,Ul,Al,Ll,_l,Rl=o(12394),Bl=o(33235);function Hl(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function zl(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Hl(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Hl(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}Tl=(0,J.JJ)("nodeAttributeManagmentFlow"),Nl=(0,J.f3)("projectDoc"),El=(0,J.f3)("projectUIState"),Cl=(0,J.f3)("sharedbProjectSyncService"),xl=(0,J.f3)("propDefinitionManagementFlow"),Pl=(0,dr.u)(dr.j.UPDATE_ATTR_KEY),kl=(0,dr.u)(dr.j.UPDATE_ATTR_KEY),Tl((Zl=class{constructor(){(0,z.Z)(this,"projectDoc",Ul,this),(0,z.Z)(this,"projectUIState",Al,this),(0,z.Z)(this,"dbSync",Ll,this),(0,z.Z)(this,"propDefinitionManagementFlow",_l,this),(0,$.Z)(this,"setFocusedImgAttr",(e=>{this.projectUIState.userInteractions.focusedImgAttr!==e&&(0,V.JG)(this.projectUIState,(t=>{t.userInteractions.focusedImgAttr=e}))}))}createPropDefinitionForAttr(e){const{nodeId:t,key:o,defaultValue:n,doc:i}=e;if(!i)return;const r=i.nodes.byId[t];if(!r)throw new Error(`Node that need to update attr is missing - ${t}`);const s=i.nodes.getComponentIdOf(t),a=i.components.byId[s];if(!a)throw new Error(`Comp that need to update attr is missing - ${s}`);i.addDefaultAttrPropDefinition({node:r,component:a,defaultValue:n,attrName:o})}updateAttrByKey(e){const{nodeId:t,key:o,value:n,propId:i,doc:r}=e;if(!r)return;const s=this.projectUIState.localWork.nodesUnderLocalWork,a=r.nodes.byId[t];if(!a)throw new Error(`Node that need to update link is missing - ${t}`);const l=zl({},a.attrs[o]);if(i)a.attrs[o]=new os.P({content:{referenceType:"prop",id:i}}),this.propDefinitionManagementFlow.addPropLocationForNode({nodeId:t,propId:i,location:{base:jl.hD.ATTR,sufix:o},doc:r}),"dynamic"===l.type&&"prop"===l.content.referenceType&&this.propDefinitionManagementFlow.removePropLocationForNode({nodeId:t,propId:l.content.id,location:{base:jl.hD.ATTR,sufix:o},doc:r});else if("dynamic"===l.type&&"prop"===l.content.referenceType){const e=r.getComponentIdForNode(t);if(!e)throw new Error(`Component id not found for node: ${t}`);const o=r.components.byId[e],i=l.content.id;if(s&&o&&i){const e=o.propDefinitions[i].defaultValue;(0,V.JG)(this.projectUIState,(t=>{const o=t.localWork.initialPropValues;i&&o&&!o[i]&&(o[i]=e)}))}this.propDefinitionManagementFlow.updatePropDefinition({compId:e,propId:i,propData:{defaultValue:n},doc:r})}else a.attrs[o]=new ar.F({content:n});s||r.syncAssetInNodeRelationByNewContent({node:a,oldContent:l,newContent:a.attrs[o]}),s&&(0,V.JG)(this.projectUIState,(e=>{var t;null===(t=e.localWork.changedAttrs)||void 0===t||t.push(o)}))}removeAttrByKey(e){const{nodeId:t,key:o,unlink:n,defaultPropValue:i,doc:r}=e;if(!r)return;const s=this.projectUIState.localWork.nodesUnderLocalWork,a=r.nodes.byId[t];if(!a)throw new Error(`Node that need to update link is missing - ${t}`);const l=zl({},a.attrs[o]);if("src"!==o||"dynamic"===l.type||(null===a||void 0===a?void 0:a.primitiveType)!==dt.sO.IMAGE){if(delete a.attrs[o],"dynamic"===l.type&&"prop"===l.content.referenceType&&i&&this.updateAttrByKey(zl(zl({},e),{},{doc:r,value:i})),"dynamic"===l.type&&"prop"===l.content.referenceType&&n){const e=l.content.id;this.propDefinitionManagementFlow.removePropLocationForNode({nodeId:t,propId:e,location:{base:jl.hD.ATTR,sufix:o},unlink:n})}s||n||r.syncAssetInNodeRelationByNewContent({node:a,oldContent:l,newContent:null}),s&&(0,V.JG)(this.projectUIState,(e=>{var t;null===(t=e.localWork.changedAttrs)||void 0===t||t.push(o)}))}else this.updateAttrByKey(zl(zl({},e),{},{doc:r,value:Bl.M3.IMAGE_SRC}))}copyAttrsFromNode(e){const{doc:t,nodeId:o,changedKeys:n,node:i}=e;t&&n.forEach((e=>{const n=i.attrs[e];n?"dynamic"!==n.type&&this.updateAttrByKey({doc:t,nodeId:o,key:e,value:n.content}):this.removeAttrByKey({doc:t,nodeId:o,key:e})}))}},Ul=(0,G.Z)(Zl.prototype,"projectDoc",[Nl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Al=(0,G.Z)(Zl.prototype,"projectUIState",[El],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ll=(0,G.Z)(Zl.prototype,"dbSync",[Cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_l=(0,G.Z)(Zl.prototype,"propDefinitionManagementFlow",[xl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(Zl.prototype,"createPropDefinitionForAttr",[Q.P],Object.getOwnPropertyDescriptor(Zl.prototype,"createPropDefinitionForAttr"),Zl.prototype),(0,G.Z)(Zl.prototype,"updateAttrByKey",[Q.P,Pl],Object.getOwnPropertyDescriptor(Zl.prototype,"updateAttrByKey"),Zl.prototype),(0,G.Z)(Zl.prototype,"removeAttrByKey",[Q.P,kl],Object.getOwnPropertyDescriptor(Zl.prototype,"removeAttrByKey"),Zl.prototype),(0,G.Z)(Zl.prototype,"copyAttrsFromNode",[Q.P],Object.getOwnPropertyDescriptor(Zl.prototype,"copyAttrsFromNode"),Zl.prototype),Ml=Zl));var $l,Gl,Vl,Jl,Wl,Kl,Yl,Xl,ql,Ql,ec,tc,oc,nc=o(25074);$l=(0,J.JJ)("nodeAbilityManagmentFlow"),Gl=(0,J.f3)("projectDoc"),Vl=(0,J.f3)("projectUIState"),Jl=(0,J.f3)("sharedbProjectSyncService"),Wl=(0,J.f3)("propDefinitionManagementFlow"),Kl=(0,q.G)(te.l.UPDATE_NODE_LINK),Yl=(0,q.G)(te.l.REMOVE_NODE_LINK),$l((ql=class{constructor(){(0,z.Z)(this,"projectDoc",Ql,this),(0,z.Z)(this,"projectUIState",ec,this),(0,z.Z)(this,"dbSync",tc,this),(0,z.Z)(this,"propDefinitionManagementFlow",oc,this)}createPropDefinitionForLink(e){const{nodeId:t,type:o,location:n,doc:i}=e;if(!i)return;const r=i.nodes.byId[t];if(!r)throw new Error(`Node that need to update ability is missing - ${t}`);const s=i.nodes.getComponentIdOf(t),a=i.components.byId[s];if(!a)throw new Error(`Comp that need to update ability is missing - ${s}`);const l=r.abilities.link&&JSON.parse(JSON.stringify(r.abilities.link));l&&(l.type!==o?this.removeNodeLink({nodeId:t,linkLocations:[l.type]}):this.removeNodeLinkProp({link:l,nodeId:t,comp:a,linkLocations:[n]})),i.addDefaultLinkPropDefinition({node:r,comp:a,type:o,location:n}),r.styles.textDecoration||(r.styles.textDecoration=new ar.F({content:"none"}))}removeLinksFromChildrenWithLinkAbilitiesFromNode(e){const{doc:t,nodeId:o}=e;if(!t)return;if(!t.nodes.byId[o])throw new Error(`Could not remove links. Node not found: ${o}`);t.nodes.bfs(o,(e=>{e.abilities.link&&e.id!==o&&this.removeNodeLink({nodeId:e.id,unlink:!0})}))}updateNodeLink(e){const{nodeId:t,type:o,content:n,doc:i}=e;if(!i)return;const r=i.nodes.byId[t];if(!r)throw new Error(`Node that need to update link is missing - ${t}`);const s=i.nodes.getComponentIdOf(t),a=i.components.byId[s];if(this.removeLinksFromChildrenWithLinkAbilitiesFromNode({doc:i,nodeId:t}),!a)return void this.updateNodeLinkWithoutProps({node:r,type:o,content:n});const l=Object.keys(n)[0];if(!l)throw new Error("No link location found");const c=r.abilities.link&&JSON.parse(JSON.stringify(r.abilities.link));c&&(c.type!==o?this.removeNodeLink({nodeId:t,linkLocations:[c.type],unlink:!0}):this.removeNodeLinkProp({link:c,nodeId:t,comp:a,linkLocations:[l]})),this.updateNodeLinkWithoutProps({node:r,type:o,content:n})}updateNodeLinkWithoutProps(e){const{node:t,type:o,content:n}=e;if(!Object.keys(n).length)throw new Error("No link location found");Object.keys(n).forEach((e=>{var i;(null===(i=t.abilities.link)||void 0===i?void 0:i.type)===o?t.abilities.link.content[e]=n[e]:(t.abilities.link=new nc.G({type:o,content:n}),t.styles.textDecoration||(t.styles.textDecoration=new ar.F({content:"none"})))}))}updateNodeLinkProp(e){const{nodeId:t,type:o,location:n,propId:i,doc:r}=e;if(!r)return;const s=r.nodes.byId[t];if(!s)throw new Error(`Node that need to update link is missing - ${t}`);const a=r.nodes.getComponentIdOf(t),l=r.components.byId[a];if(!l)throw new Error(`Comp that need to update ability is missing - ${a}`);if(o===pt.RZ.SECTION||o===pt.RZ.NAVLINK)throw new Error("Link type doesn't support dynamic content");const c=s.abilities.link&&JSON.parse(JSON.stringify(s.abilities.link)),d=new os.P({content:{referenceType:"prop",id:i}});c&&c.type===o?s.abilities.link.content[n]=d:s.abilities.link=new nc.G({type:o,content:{[n]:d}}),l.addLocationToPropDefinition(i,t,{base:jl.hD.ABILITY,sufix:n}),c&&(c.type!==o?this.removeNodeLink({nodeId:t,linkLocations:[c.type]}):this.removeNodeLinkProp({link:c,nodeId:t,comp:l,linkLocations:[n]}))}removeNodeLink(e){const{nodeId:t,linkLocations:o,removeOnlyProp:n,unlink:i,defaultPropValue:r,doc:s}=e;if(!s)return;const a=s.nodes.byId[t];if(!a)throw new Error(`Node that need to update link is missing - ${t}`);const l=a.abilities.link;if(!l)return;const c=s.nodes.getComponentIdOf(t),d=s.components.byId[c],p=o&&"mail"!==o[0]?o:l.type===pt.RZ.MAIL?["subject","mail"]:[l.type];let u=!1;if(d){const e=JSON.parse(JSON.stringify(l));n&&p.forEach((e=>{var t;null!==(t=l.content)&&void 0!==t&&t[e]&&"string"!==typeof l.content[e]&&(a.abilities.link.content[e]=r||"",r&&(u=!0))})),i&&this.removeNodeLinkProp({link:e,nodeId:t,comp:d,linkLocations:p,unlink:i})}if(n&&u)return;const h=a.abilities.link.content;a.abilities.link.type!==pt.RZ.MAIL||Object.keys(h).every((e=>!h[e]||p.includes(e)))?delete a.abilities.link:p.forEach((e=>{a.abilities.link.content[e]=""})),a.styles.textDecoration&&delete a.styles.textDecoration}removeNodeLinkProp(e){const{link:t,nodeId:o,comp:n,linkLocations:i,unlink:r}=e;if(!t)return;(i||(t.type===pt.RZ.MAIL?["subject","mail"]:[t.type])).forEach((e=>{var i;if(!jl._u.includes(e))return;if(null===(i=t.content)||void 0===i||!i[e]||"string"===typeof t.content[e])return;const s=t.content[e].content.id;n.removeLocationFromPropDefinition(s,o,{base:jl.hD.ABILITY,sufix:e},r)}))}nodeHasAncestorWithLink(e){let t=this.projectDoc.nodes.byId[e];for(;null!==(o=t)&&void 0!==o&&o.parentId;){var o,n;if(t=this.projectDoc.nodes.byId[t.parentId],null!==(n=t)&&void 0!==n&&n.abilities.link)return!0}return!1}},Ql=(0,G.Z)(ql.prototype,"projectDoc",[Gl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ec=(0,G.Z)(ql.prototype,"projectUIState",[Vl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tc=(0,G.Z)(ql.prototype,"dbSync",[Jl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oc=(0,G.Z)(ql.prototype,"propDefinitionManagementFlow",[Wl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(ql.prototype,"createPropDefinitionForLink",[Q.P],Object.getOwnPropertyDescriptor(ql.prototype,"createPropDefinitionForLink"),ql.prototype),(0,G.Z)(ql.prototype,"removeLinksFromChildrenWithLinkAbilitiesFromNode",[Q.P],Object.getOwnPropertyDescriptor(ql.prototype,"removeLinksFromChildrenWithLinkAbilitiesFromNode"),ql.prototype),(0,G.Z)(ql.prototype,"updateNodeLink",[Kl,Q.P],Object.getOwnPropertyDescriptor(ql.prototype,"updateNodeLink"),ql.prototype),(0,G.Z)(ql.prototype,"updateNodeLinkProp",[Q.P],Object.getOwnPropertyDescriptor(ql.prototype,"updateNodeLinkProp"),ql.prototype),(0,G.Z)(ql.prototype,"removeNodeLink",[Yl,Q.P],Object.getOwnPropertyDescriptor(ql.prototype,"removeNodeLink"),ql.prototype),(0,G.Z)(ql.prototype,"removeNodeLinkProp",[Q.P],Object.getOwnPropertyDescriptor(ql.prototype,"removeNodeLinkProp"),ql.prototype),Xl=ql));var ic,rc,sc,ac,lc,cc,dc,pc,uc,hc,mc,gc,yc;function fc(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function bc(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?fc(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):fc(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}ic=(0,J.JJ)("nodeEventManagmentFlow"),rc=(0,J.f3)("projectDoc"),sc=(0,J.f3)("projectUIState"),ac=(0,J.f3)("sharedbProjectSyncService"),lc=(0,J.f3)("propDefinitionManagementFlow"),cc=(0,J.f3)("positioningService"),ic((pc=class{constructor(){(0,z.Z)(this,"projectDoc",uc,this),(0,z.Z)(this,"projectUIState",hc,this),(0,z.Z)(this,"dbSync",mc,this),(0,z.Z)(this,"propDefinitionManagementFlow",gc,this),(0,z.Z)(this,"positioningService",yc,this)}getNodeEvents(e){const{nodeId:t,doc:o}=e;if(!o)return[];const n=o.nodes.byId[t];if(!n||!n.events)return[];const{events:i}=n;return Object.keys(i).reduce(((e,t)=>{const o=t;if(!i[o])return e;const n=this.positioningService.orderEntities({entitiyCollection:i[o]}).map((e=>{const t=i[o][e];return{eventId:e,propDefinitionId:"propCall"===t.type?t.id:void 0,eventType:t.type,supportedEvent:o,calls:"propCall"===t.type?t.calls:void 0,modifies:"stateChange"===t.type?t.modifies:void 0,newState:"stateChange"===t.type?t.newState:void 0,pos:t.pos}}));return e=[...e,...n]}),[])}getAllEventPropsForComponent(e){if(!e)return{};const t=this.projectDoc.components.byId[e];return t?Object.values(t.propDefinitions).reduce(((e,t)=>("func"!==t.type||(e[t.id]=t),e)),{}):{}}createPropCallEvent(e){const{nodeId:t,supportedEvent:o,propDefName:n,defaultValue:i,doc:r}=e;if(!r)return;const s=r.nodes.byId[t];if(!s)throw new Error(`Node that need to update attr is missing - ${t}`);const a=r.nodes.getComponentIdOf(t),l=r.components.byId[a];if(!l)throw new Error(`Comp that need to update attr is missing - ${a}`);const c=this.positioningService.getHighestAvailablePosition({entitiyCollection:s.events[o]});r.addPropCallEvent({node:s,component:l,defaultValue:i,supportedEvent:o,propDefName:n,pos:c})}createStateChangeEvent(e){const{nodeId:t,supportedEvent:o,modifies:n,newState:i,doc:r}=e;if(!r)return;const s=r.nodes.byId[t];if(!s)throw new Error(`Node to bind event to is missing - ${t}`);const a=r.nodes.getComponentIdOf(t),l=r.components.byId[a];if(!l)throw new Error(`Referenced component is missing - ${a}`);const c=this.positioningService.getHighestAvailablePosition({entitiyCollection:s.events[o]});r.addStateChangeEvent({node:s,component:l,supportedEvent:o,modifies:n,newState:i,pos:c})}removeEventFromNode(e){const{nodeId:t,eventId:o,doc:n}=e;if(!n)return;const i=n.nodes.byId[t],r=n.nodes.getComponentIdOf(t);if(!i||!r)return;const s=n.components.byId[r];s&&i.events&&Object.keys(i.events).forEach((e=>{var n;const r=null===(n=i.events)||void 0===n?void 0:n[e][o];if(r&&"propCall"===r.type){const o=r.id;s.removeLocationFromPropDefinition(o,t,{base:jl.hD.EVENT,sufix:e},!0)}delete i.events[e][o],Object.keys(i.events[e]).length||delete i.events[e]}))}removeAllEventsByType(e){const{nodeIds:t,supportedEvent:o,propName:n,doc:i}=e;i&&t.forEach((e=>{const t=i.nodes.getComponentIdOf(e),r=i.nodes.byId[e];if(!r||!t)return;const s=i.components.byId[t];s&&(o&&n?r.events[o]&&(Object.keys(r.events[o]).forEach((t=>{if(!("propCall"===r.events[o][t].type))return;if(r.events[o][t].calls!==n)return;const i=r.events[o][t].id;delete r.events[o][t];s.propDefinitions[i]&&s.removeLocationFromPropDefinition(i,e,{base:jl.hD.EVENT,sufix:o},!0)})),Object.keys(r.events[o]).length||delete r.events[o]):r.events={})}))}updateEventPropDefinitionName(e){const{nodeId:t,eventId:o,supportedEvent:n,oldPropDefName:i,newPropDefName:r,doc:s}=e;if(!s||i===r)return;const a=s.nodes.byId[t],l=s.nodes.getComponentIdOf(t);if(!a||!l)return;const c=s.components.byId[l];if(!c)return;const d=Object.values(null===c||void 0===c?void 0:c.propDefinitions).find((e=>e.name===i));if(!d)return;const p=Object.values(null===c||void 0===c?void 0:c.propDefinitions).find((e=>e.name===r)),u={base:jl.hD.EVENT,sufix:n};p?c.addLocationToPropDefinition(p.id,t,u):this.createPropCallEvent({nodeId:t,supportedEvent:n,propDefName:r}),d.locations[t]&&c.removeLocationFromPropDefinition(d.id,t,u,!0),Object.keys(a.events).forEach((e=>{var t;if("propCall"===a.events[e][o].type&&null!==(t=a.events)&&void 0!==t&&t[e][o]){a.events[e][o].calls=r,p&&(a.events[e][o].id=null===p||void 0===p?void 0:p.id)}}))}updateEvent(e){const{doc:t,nodeId:o,changes:n}=e;if(!t)return;const{eventId:i,supportedEvent:r,calls:s,modifies:a,newState:l}=n,c=t.nodes.byId[o];if(!i||!c)return;const d=this.getNodeEvents({nodeId:o}).find((e=>e.eventId===i));d&&(d.supportedEvent!==r&&this.updateEventType({eventId:i,nodeId:o,oldEventType:d.supportedEvent,newEventType:r}),"stateChange"===d.eventType&&a&&"undefined"!==typeof l&&(c.events[r][i]=bc(bc({},c.events[r][i]),{},{modifies:a,newState:l})),"propCall"===d.eventType&&s&&(c.events[r][i]=bc(bc({},c.events[r][i]),{},{calls:s})))}updateEventType(e){const{oldEventType:t,newEventType:o,eventId:n,nodeId:i,doc:r}=e;if(!r)return;const s=r.nodes.byId[i];if(!s)return;const a=s.events[t][n];s.events=bc(bc({},s.events),{},{[o]:bc(bc({},s.events[o]),{},{[n]:bc({},a)})});const l=s.events[t][n].id;delete s.events[t][n],Object.keys(s.events[t]).length||delete s.events[t];const c=this.projectUIState.selection.componentId;if(!c)return;const d=this.projectDoc.components.byId[c];if(!d)return;const p=d.propDefinitions[l];p&&(p.locations[s.id]={[`event${o}`]:{base:jl.hD.EVENT,sufix:o}})}},uc=(0,G.Z)(pc.prototype,"projectDoc",[rc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hc=(0,G.Z)(pc.prototype,"projectUIState",[sc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mc=(0,G.Z)(pc.prototype,"dbSync",[ac],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gc=(0,G.Z)(pc.prototype,"propDefinitionManagementFlow",[lc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yc=(0,G.Z)(pc.prototype,"positioningService",[cc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(pc.prototype,"getNodeEvents",[Q.P],Object.getOwnPropertyDescriptor(pc.prototype,"getNodeEvents"),pc.prototype),(0,G.Z)(pc.prototype,"createPropCallEvent",[Q.P],Object.getOwnPropertyDescriptor(pc.prototype,"createPropCallEvent"),pc.prototype),(0,G.Z)(pc.prototype,"createStateChangeEvent",[Q.P],Object.getOwnPropertyDescriptor(pc.prototype,"createStateChangeEvent"),pc.prototype),(0,G.Z)(pc.prototype,"removeEventFromNode",[Q.P],Object.getOwnPropertyDescriptor(pc.prototype,"removeEventFromNode"),pc.prototype),(0,G.Z)(pc.prototype,"removeAllEventsByType",[Q.P],Object.getOwnPropertyDescriptor(pc.prototype,"removeAllEventsByType"),pc.prototype),(0,G.Z)(pc.prototype,"updateEventPropDefinitionName",[Q.P],Object.getOwnPropertyDescriptor(pc.prototype,"updateEventPropDefinitionName"),pc.prototype),(0,G.Z)(pc.prototype,"updateEvent",[Q.P],Object.getOwnPropertyDescriptor(pc.prototype,"updateEvent"),pc.prototype),(0,G.Z)(pc.prototype,"updateEventType",[Q.P],Object.getOwnPropertyDescriptor(pc.prototype,"updateEventType"),pc.prototype),dc=pc));var wc,vc,Ic,Sc,jc,Dc,Oc,Fc,Tc,Nc,Ec,Cc,xc,Pc,kc,Mc,Zc=o(40652),Uc=o(49249),Ac=o(61063),Lc=o(10609),_c=o(33381);function Rc(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Bc(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Rc(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Rc(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}wc=(0,J.JJ)("nodeRichTextFlow"),vc=(0,J.f3)("projectDoc"),Ic=(0,J.f3)("projectUIState"),Sc=(0,J.f3)("nodeManagementFlow"),jc=(0,J.f3)("nodeStyleManagmentFlow"),Dc=(0,J.f3)("nodeAbilityManagmentFlow"),Oc=(0,J.f3)("mediaQueryBreakpointManagementFlow"),Fc=(0,dr.u)(dr.j.ADD_NODES),wc((Nc=class{constructor(){(0,z.Z)(this,"projectDoc",Ec,this),(0,z.Z)(this,"projectUIState",Cc,this),(0,z.Z)(this,"nodeManagementFlow",xc,this),(0,z.Z)(this,"nodeStyleManagmentFlow",Pc,this),(0,z.Z)(this,"nodeAbilityManagmentFlow",kc,this),(0,z.Z)(this,"mediaQueryBreakpointManagementFlow",Mc,this)}storeSelection(e){(0,V.JG)(this.projectUIState,(t=>{t.staticNodeInterationsData.activeSelection=e,t.staticNodeInterationsData.isSettingLink=!1}))}storeSelectionStyles(e){(0,V.JG)(this.projectUIState,(t=>{t.staticNodeInterationsData.selectionStyles=e}))}toggleAddLink(e){const t=this.projectUIState.staticNodeInterationsData.isSettingLink;void 0!==e&&t===e||(0,V.JG)(this.projectUIState,(o=>{o.staticNodeInterationsData.isSettingLink=null!==e&&void 0!==e?e:!t}))}getTextComponentForNode(e){var t;if(!e)return null;if(!this.projectUIState.staticNodeInterationsData.selectionStyles)return null;const o=(0,Uc.G)(e);return o&&null!==(t=o.parentElement)&&void 0!==t&&t.parentElement?o.parentElement.parentElement:null}getTextComponentForChildNode(e,t){const o=e.nodes.byId[t];if(!o)return null;if(o.primitiveType!==dt.sO.BUTTON&&o.primitiveType!==dt.sO.TEXT&&!o.parentId)return null;if(!o.parentId)return this.getTextComponentForNode(o.id);const n=e.nodes.byId[o.parentId];return n?n.primitiveType!==dt.sO.BUTTON&&n.primitiveType!==dt.sO.TEXT?this.getTextComponentForNode(o.id):this.getTextComponentForChildNode(e,o.parentId):null}stopEditingNodes(){const{editingNode:e}=this.projectUIState.staticNodeInterationsData;(0,V.JG)(this.projectUIState,(t=>{const o=Object.keys(e)[0]||-1;delete t.staticNodeInterationsData.editingNode[o]}))}removeRichStylesFromNode(e){const{doc:t,nodeId:o}=e;if(!t||!o)return;const n=t.nodes.byId[o];if(!n)return;const i=this.extractContentFromNode(o);Object.keys(n.childrenIds).forEach((e=>{t.deleteNodesById({nodeIds:[e],withSubtree:!0})}));const r=new ar.F({content:i});n.contentChildren?n.contentChildren[r.id]=r:n.contentChildren={[r.id]:r}}updateStaticContent(e){var t;const{doc:o,nodeId:n,newContent:i,nextSiblingId:r,needsNewNode:s=!1,lastChange:a="",childrenRemoveRequired:l=!1}=e;if(!o)return;const c=this.projectUIState.localWork.nodesUnderLocalWork,d=o.nodes.byId[n];if(!d||!d.contentChildren)throw new Error(`Tried to replace static content but did not find node: ${n}`);const p=Object.keys(d.contentChildren)[0];if(l&&Object.keys((null===d||void 0===d?void 0:d.childrenIds)||{}).length){const e=new ar.F({content:a});return Object.keys(d.contentChildren).forEach((e=>{var t;null===(t=d.contentChildren)||void 0===t||delete t[e]})),o.deleteNodesById({nodeIds:Object.keys((null===d||void 0===d?void 0:d.childrenIds)||{})}),void(d.contentChildren[e.id]=e)}if((null===(t=d.contentChildren[p])||void 0===t?void 0:t.content)!==i)if(s||Object.keys((null===d||void 0===d?void 0:d.childrenIds)||{}).length){const e=new ar.F({content:a}),t=new Zc.H({semanticType:dt.RY.SPAN,primitiveType:dt.sO.TEXT,contentChildren:{[e.id]:e}}),i=r?o.nodes.byId[r]:void 0;o.addNodesToParentOrStage({nextSibling:i,nodes:[t],parentId:n})}else if(p){if("static"===d.contentChildren[p].type&&!c){const e=new ar.F({content:i});return d.contentChildren={},void(d.contentChildren[e.id]=e)}if("dynamic"!==d.contentChildren[p].type||c)c&&(0,V.JG)(this.projectUIState,(e=>{e.localWork.changedContent=i}));else{const e=o.nodes.getRootIdOf(d.id),t=o.nodes.byId[e];if(!t.compIdOfRootNode)return;const n=o.components.byId[t.compIdOfRootNode],r=d.contentChildren[p].content.id;null===n||void 0===n||n.updatePropDefinition(r,{defaultValue:i})}}else{const e=new ar.F({content:a});d.contentChildren[e.id]=e}}replaceParentWithNewHierarchy(e){const{doc:t,nodes:o,parentId:n,rootNode:i,mappingToInitialNodes:r,stylesRemovedFromRoot:s}=e;if(!t)return;const a=t.nodes.byId[n];if(!a)return;if(!o.length)return void this.nodeManagementFlow.deleteNodesById({doc:t,nodeIds:[n]});a.contentChildren={},i.abilities.link&&this.nodeAbilityManagmentFlow.updateNodeLink({doc:t,nodeId:n,content:i.abilities.link.content,type:i.abilities.link.type}),Object.keys(a.referencedStyles).forEach((e=>{delete a.referencedStyles[e]})),a.referencedStyles={},Object.keys(i.referencedStyles).forEach((e=>{a.referencedStyles[e]=(0,_c.LA)(i.referencedStyles[e])})),this.applyStylesToNode({doc:t,styles:i.styles,nodeId:a.id});const l=Object.keys(a.childrenIds);if(1===o.length){var c;const e=Object.keys(o[0].contentChildren||{})[0];if(!e)return;const n=null===(c=o[0].contentChildren)||void 0===c?void 0:c[e];if(!n)return;return void(a.contentChildren&&(t.deleteNodesById({nodeIds:l}),a.contentChildren[e]=n))}const d=this.mediaQueryBreakpointManagementFlow.getCurrentMediaQuery(),p=this.transferStylesFromRootToChildren(t,s,a.id),u=o.reduce(((e,t)=>(e[t.id]=JSON.parse(JSON.stringify(t.styles)),t.styles={},e)),{}),h=JSON.parse(JSON.stringify(a.childrenIds));if(a.primitiveType===dt.sO.BUTTON){const o=new Zc.H({primitiveType:dt.sO.TEXT,semanticType:dt.RY.SPAN,abilities:{},styles:{},attrs:{}});return this.nodeManagementFlow.addNodesToParentOrStage(Bc(Bc({},e),{},{doc:t,nodes:[o]})),this.nodeManagementFlow.addNodesToParentOrStage(Bc(Bc({},e),{},{doc:t,parentId:o.id})),void Object.keys(u).forEach((e=>{const o=u[e];this.applyStylesToNode({doc:t,styles:o,nodeId:e})}))}this.nodeManagementFlow.addNodesToParentOrStage(Bc({doc:t},e)),this.restoreOldNodeStylesToNewNode(t,r,Object.keys(i.styles)),t.deleteNodesById({nodeIds:l}),Object.keys(u).forEach((e=>{const o=u[e];this.applyStylesToNode({doc:t,styles:o,nodeId:e})})),s.forEach((e=>{if(!Object.keys(h).length&&Object.keys(a.childrenIds).length&&(null===d||void 0===d||!d.isDefault)){const o=p[e];if(!o||!a.childrenIds)return;Object.keys(a.childrenIds).forEach((n=>{const i=t.nodes.byId[n];i&&!i.styles[e]&&(i.styles[e]=o)}))}})),this.keepUsedTextStylesInSync(t,o)}updateRootNodesFormat(e){const{doc:t,nodeIds:o,removeFormatIfExists:n=!0}=e;let{options:i}=e;if(!t)return;i=(0,Ac.vw)(t,i);for(const s of o)this.removeConflictingFormatFromNodesDescendents({doc:t,nodeId:s,format:i});const r=Object.keys(i.styles||{}).reduce(((e,t)=>{var o;if(null===(o=i)||void 0===o||!o.styles)return e;const n=i.styles[t];return e[t]={value:n.value},n.tokenId&&(e[t].tokenId=n.tokenId),n.mergeable&&(e[t].mergeable=n.mergeable),e}),{});for(const s of o){if(!(0,mt.xK)(this.projectDoc.nodes.byId[s]))continue;const e=this.nodeStyleManagmentFlow.getComputedStyleByKeyForCurrentBreakpoint(s,Object.keys(r)),{stylesToAdd:i,stylesToRemove:a}=Object.keys(r).reduce(((t,o)=>{const i=e.styles[o]||e.classesStyles[o];let s=r[o].value;const a=r[o].mergeable,l=r[o].tokenId;if(i&&-1!==(null===i||void 0===i?void 0:i.indexOf(s))&&n){if(a){const e=i.replace(s,"");return t.stylesToAdd[o]={value:e},t}return t.stylesToRemove[o]=r[o],t}return a&&i&&i!==s&&-1===i.indexOf(s)&&(s=`${s} ${i}`),t.stylesToAdd[o]={value:s,tokenId:l},t}),{stylesToAdd:{},stylesToRemove:{}});Object.keys(a).forEach((e=>{this.nodeStyleManagmentFlow.removeStyleByKeyBasedOnCurrentBreakpoint({doc:t,key:e,nodeIds:o})})),Object.keys(i).length&&this.nodeStyleManagmentFlow.setMultipleStylesByKeyForCurrentBreakpoint({doc:t,nodeIds:[s],styleMap:i})}}removeRootNodesConflictingFormats(e){const{doc:t,nodeIds:o,options:n}=e;t&&n&&(Object.keys(n.styles||{}).forEach((e=>{this.nodeStyleManagmentFlow.removeStyleByKeyBasedOnCurrentBreakpoint({doc:t,key:e,nodeIds:o})})),o.forEach((e=>{const o=t.nodes.byId[e];if(!o)return;if(!this.getTextComponentForNode(o.id))return;const i=t.nodes.byId[e];(0,Lc.Ei)({doc:t,node:i,format:n}),this.removeConflictingFormatFromNodesDescendents({doc:t,nodeId:e,format:n})})))}removeConflictingFormatFromNodesDescendents(e){const{doc:t,format:o,nodeId:n}=e;this.getNodeDescendentsIds(t,n).forEach((e=>{const n=t.nodes.byId[e];(0,Lc.Ei)({doc:t,node:n,format:o})}))}getNodeDescendentsIds(e,t){return e.nodes.getDescendents(t).map((e=>e.id)).filter((e=>e!==t))}transferStylesFromRootToChildren(e,t,o){const n=this.mediaQueryBreakpointManagementFlow.getCurrentMediaQuery(),i=e.nodes.byId[o];if(!i)return{};const r=Object.keys(i.childrenIds),s={};return t.forEach((t=>{this.nodeStyleManagmentFlow.removeStyleByKeyBasedOnCurrentBreakpoint({doc:e,key:t,nodeIds:[i.id]});const o=i.styles[t];if(!o)return;const a=JSON.parse(JSON.stringify(o));a&&(s[t]=a,this.nodeStyleManagmentFlow.removeStyleByKey({doc:e,key:t,nodeIds:[i.id]}),null!==n&&void 0!==n&&n.isDefault||r.forEach((o=>{const n=e.nodes.byId[o];n&&!n.styles[t]&&(n.styles[t]=a)})))})),s}keepUsedTextStylesInSync(e,t){t.forEach((t=>{Object.keys(t.referencedStyles).forEach((o=>{const n=t.referencedStyles[o];if("style-map"!==n.type||"design-language-referenced"!==n.content.mapType)return;const i=n.content.referenceId,r=e.designLanguage.textStyleSetsById[i];r&&(r.usedInNodes[t.id]=!0)}))}))}extractContentFromNode(e){let t="";return this.projectDoc.nodes.bfs(e,(e=>{const o=Object.keys(e.contentChildren||{});if(e.contentChildren&&o.length){const n=e.contentChildren[o[0]];"string"===typeof n&&(t+=this.trimContent(n)),"static"===n.type&&(t+=this.trimContent(n.content))}})),t}applyStylesToNode(e){const{doc:t,styles:o,nodeId:n}=e,{mediaQueryOnRichText:i}=this.projectUIState.userPreferences;if(!this.mediaQueryBreakpointManagementFlow.getCurrentMediaQuery())return;(null===t||void 0===t?void 0:t.nodes.byId[n])&&Object.keys(o).forEach((e=>{const{value:r,tokenId:s}=this.computeStyleValueAndToken(o[e]),a="backgroundColor"===e?"backgroundImage":"backgroundImage"===e?"backgroundColor":null;if(i)return a&&this.nodeStyleManagmentFlow.removeStyleByKeyBasedOnCurrentBreakpoint({doc:t,nodeIds:[n],key:a}),this.nodeStyleManagmentFlow.removeStyleByKeyBasedOnCurrentBreakpoint({doc:t,key:e,nodeIds:[n]}),void this.nodeStyleManagmentFlow.setStyleByKeyBasedOnCurrentBreakpoint({doc:t,value:r,tokenId:s,nodeIds:[n],key:e});a&&this.nodeStyleManagmentFlow.removeStyleByKey({doc:t,nodeIds:[n],key:a}),this.nodeStyleManagmentFlow.removeStyleByKey({doc:t,key:e,nodeIds:[n]}),this.nodeStyleManagmentFlow.setStyleByKey({doc:t,value:r,tokenId:s,nodeIds:[n],key:e})}))}restoreOldNodeStylesToNewNode(e,t,o){const{mediaQueryOnRichText:n}=this.projectUIState.userPreferences;if(!n)return;const i=this.mediaQueryBreakpointManagementFlow.getCurrentMediaQuery();i&&!i.isDefault&&Object.keys(t).forEach((n=>{const i=t[n],r=e.nodes.byId[i];r&&Object.keys(r.styles).forEach((t=>{if(-1!==o.indexOf(t))return;const{value:i,tokenId:s}=this.computeStyleValueAndToken(r.styles[t]);this.nodeStyleManagmentFlow.setStyleByKey({doc:e,value:i,tokenId:s,nodeIds:[n],key:t})}))}))}computeStyleValueAndToken(e){const t=e.content;let o="",n=null;return"string"===typeof t||"number"===typeof t?(o=t,n=void 0):(o=t.defaultValue,n=t.id),{value:o,tokenId:n}}trimContent(e){return e.replaceAll(ht.Bw," ").replaceAll(ht.$m,"").replace(ht.ss,"")}},Ec=(0,G.Z)(Nc.prototype,"projectDoc",[vc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cc=(0,G.Z)(Nc.prototype,"projectUIState",[Ic],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xc=(0,G.Z)(Nc.prototype,"nodeManagementFlow",[Sc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pc=(0,G.Z)(Nc.prototype,"nodeStyleManagmentFlow",[jc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kc=(0,G.Z)(Nc.prototype,"nodeAbilityManagmentFlow",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mc=(0,G.Z)(Nc.prototype,"mediaQueryBreakpointManagementFlow",[Oc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(Nc.prototype,"removeRichStylesFromNode",[Q.P],Object.getOwnPropertyDescriptor(Nc.prototype,"removeRichStylesFromNode"),Nc.prototype),(0,G.Z)(Nc.prototype,"updateStaticContent",[Q.P],Object.getOwnPropertyDescriptor(Nc.prototype,"updateStaticContent"),Nc.prototype),(0,G.Z)(Nc.prototype,"replaceParentWithNewHierarchy",[Q.P,Fc],Object.getOwnPropertyDescriptor(Nc.prototype,"replaceParentWithNewHierarchy"),Nc.prototype),(0,G.Z)(Nc.prototype,"updateRootNodesFormat",[Q.P],Object.getOwnPropertyDescriptor(Nc.prototype,"updateRootNodesFormat"),Nc.prototype),(0,G.Z)(Nc.prototype,"removeRootNodesConflictingFormats",[Q.P],Object.getOwnPropertyDescriptor(Nc.prototype,"removeRootNodesConflictingFormats"),Nc.prototype),Tc=Nc));var Hc,zc,$c,Gc,Vc,Jc,Wc,Kc,Yc,Xc,qc,Qc,ed,td,od,nd,id,rd=o(98200);Hc=(0,J.JJ)("freestyleNodeFlow"),zc=(0,J.f3)("projectDoc"),$c=(0,J.f3)("nodeStyleManagmentFlow"),Gc=(0,J.f3)("nodeManagementFlow"),Vc=(0,J.f3)("elementRefProvider"),Jc=(0,J.f3)("projectUIState"),Wc=(0,J.f3)("guardsService"),Kc=(0,J.f3)("nodeSelectionFlow"),Hc((Xc=class{constructor(){(0,z.Z)(this,"projectDoc",qc,this),(0,z.Z)(this,"nodeStyleManagmentFlow",Qc,this),(0,z.Z)(this,"nodeManagementFlow",ed,this),(0,z.Z)(this,"elementRefProvider",td,this),(0,z.Z)(this,"projectUIState",od,this),(0,z.Z)(this,"guardsService",nd,this),(0,z.Z)(this,"nodeSelectionFlow",id,this),(0,$.Z)(this,"startingTopForNode",{}),(0,$.Z)(this,"startingLeftForNode",{}),(0,$.Z)(this,"moved",!1),(0,$.Z)(this,"startingStageControlValues",{x:0,y:0})}nudgeNode(e,t,o){if(!o&&0!==o)return;let n=null;if("number"===typeof o)n=`${o+5}px`;else{const e=parseInt(o.replace(/[^0-9]/g,"")),t=o.replace(/[0-9]/g,"");e&&!isNaN(e)&&t&&(n=`${e+("px"===t?30:5)}${t}`)}n&&this.nodeStyleManagmentFlow.setStyleByKeyBasedOnCurrentBreakpoint({key:t,value:n,nodeIds:[e]})}nodesAreFreestyle(e){return!e.some((e=>!this.nodeStyleManagmentFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:e,key:"position",values:["absolute","fixed"]})))}groupFreestyleNodes(e){var t;const{nodeIds:o,doc:n}=e;if(!n)return;let i=1/0,r=-1/0,s=1/0,a=-1/0;const l={};o.forEach((e=>{var t;const o=null===(t=this.elementRefProvider.getDomNodeElementRefById(e))||void 0===t?void 0:t.getBoundingClientRect();o.top<i&&(i=o.top),o.bottom>r&&(r=o.bottom),o.left<s&&(s=o.left),o.right>a&&(a=o.right),l[e]=o}));const c=a-s,d=r-i;this.setFreestyleNodesPositionBeforeMoving({nodeIds:o,nodeRectangles:l,targetRect:{top:i,bottom:r,left:s,right:a,width:c,height:d},doc:n});const p=null===(t=this.nodeManagementFlow.getFirstPositionedParentOfNode(o[0]).parentElement)||void 0===t?void 0:t.getBoundingClientRect();if(p){const{top:e,left:t}=p;i-=e,r-=e,s-=t,a-=t}const u={top:i,left:s,width:c,height:d};this.nodeSelectionFlow.setNodeSelection({nodeId:n.groupNodes({nodeIds:o,freestyleParams:u})})}setFreestyleNodesPositionBeforeMoving(e){const{doc:t,nodeRectangles:o}=e;let n=e.nodeIds;if(!t)return;n=n.filter((e=>this.nodeStyleManagmentFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:e,key:"position",values:["absolute","fixed"]})));const{top:i=0,left:r=0,right:s=0,bottom:a=0,height:l=1,width:c=1}=e.targetRect,d=o||n.reduce(((e,t)=>{var o;return e[t]=null===(o=this.elementRefProvider.getDomNodeElementRefById(t))||void 0===o?void 0:o.getBoundingClientRect(),e}),{});n.forEach((e=>{const t=d[e],o=t.top-i,n=a-t.bottom,p=t.left-r,u=s-t.right,h={};o<=l/2?(h.top={value:`${o}px`},h.bottom={value:""}):(h.bottom={value:`${n}px`},h.top={value:""}),p<=c/2?(h.left={value:`${p}px`},h.right={value:""}):(h.right={value:`${u}px`},h.left={value:""}),this.nodeStyleManagmentFlow.setMultipleStylesByKeyForCurrentBreakpoint({nodeIds:[e],styleMap:h})}))}setNodesPositionBasedOnBoundingRect(e){const{nodeIds:t,doc:o}=e;o&&t.forEach((e=>{const t=this.elementRefProvider.getDomNodeElementRefById(e);if(!t)return;let{parentElement:n}=this.nodeManagementFlow.getFirstPositionedParentOfNode(e);n||(n=this.elementRefProvider.getIframeRoot());let i="",r="",s="",a="";const{top:l,left:c,height:d,width:p}=t.getBoundingClientRect(),u=(0,mt.AO)(t),h=(0,mt.d$)(t),m=l*u,g=c*u,y=p*u,f=d*u,{height:b,width:w,top:v,left:I}=n.getBoundingClientRect(),S=(0,mt.AO)(n),j=(0,mt.d$)(n),D=v*S,O=I*S,F=w*S,T=b*S;let N=0,E=0;h.x!==j.x&&(N=p*(1-1/h.x)/2),h.y!==j.y&&(E=d*(1-1/h.y)/2),m+f/2<=D+T/2?i=`${Math.round(((m-D)/u+E)/j.y)}px`:r=`${Math.round(((T+D-m-f)/u+E)/j.y)}px`,g+y/2<=O+F/2?s=`${Math.round(((g-O)/u+N)/j.x)}px`:a=`${Math.round(((F+O-g-y)/u+N)/j.x)}px`,this.nodeStyleManagmentFlow.setMultipleStylesByKeyForCurrentBreakpoint({styleMap:{top:{value:i},left:{value:s},right:{value:a},bottom:{value:r}},nodeIds:[e],doc:o})}))}startFreestyleDragFromEntity(e){var t,o;if(!e||e.type!==Fs.Z.SUB_HIERARCHY)return e;const n=e.content.subHierarchy;if(this.projectUIState.staticNodeInterationsData.editingNode[null===(t=n[0])||void 0===t?void 0:t.id])return this.nodeManagementFlow.revertLocalWork(),e;const i=null===(o=this.elementRefProvider.getIframeRef())||void 0===o?void 0:o.current,r=this.elementRefProvider.getIframeRoot();if(!r||!r)return e;if(null!==n&&void 0!==n&&n.some((e=>!this.nodeStyleManagmentFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:e.id,key:"position",values:["absolute","fixed"]}))))return e;const s={},a={},l={};return n.forEach((e=>{var t;const o=this.projectDoc.nodes.nodeIsCompInstance(e);let c=this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(e.id).compInstanceId,d=e;var p;o&&(d=this.projectDoc.nodes.byId[(null===(p=this.projectDoc.components.byId[e.compIdOfCompInstance])||void 0===p?void 0:p.rootNodeId)||""]||d,c=e.id);const u=this.nodeStyleManagmentFlow.getResolvedStylesBasedOnCurrentBreakpoint({nodeId:d.id});if(n.some((e=>"fixed"!==u.position&&-1!==Object.keys(e.childrenIds||{}).indexOf(d.id))))return;const h=this.elementRefProvider.getDomTargetNode(d.id,c),m=o?null===h||void 0===h||null===(t=h.parentElement)||void 0===t?void 0:t.parentElement:null===h||void 0===h?void 0:h.parentElement,g=null===h||void 0===h?void 0:h.getBoundingClientRect();if(!h||!g||!m)return;const y="fixed"!==u.position&&this.nodeManagementFlow.getFirstPositionedParentOfNode(e.id).parentElement||r,f=y.getBoundingClientRect(),b=(0,mt.AO)(y),w={top:f.top*b,left:f.left*b,width:f.width*b,height:f.height*b};a[e.id]={actualParent:m,referredParent:y};const v=w.top||0,I=w.left||0,S=(0,mt.d$)(h),j=(0,mt.d$)(y);let D=0,O=0;S.x!==j.x&&(D=g.width*(1-1/S.x)/2),S.y!==j.y&&(O=g.height*(1-1/S.y)/2);const F=(0,mt.AO)(h),T=F===b?1:F;this.startingTopForNode[e.id]=Math.round((g.top*F-v)/T/j.y+O),this.startingLeftForNode[e.id]=Math.round((g.left*F-I)/T/j.x+D);const N=this.nodeStyleManagmentFlow.getCurrentStyleValueByKeyForNode(d.id,["top","left","bottom","right"]),E=N.top,C=N.left,x=N.bottom,P=N.right;h.style.top=E,h.style.left=C,h.style.bottom=x,h.style.right=P,s[e.id]=h,l[e.id]=h.cloneNode(!0),i&&(this.startingStageControlValues={x:i.getBoundingClientRect().x,y:i.getBoundingClientRect().y})})),Object.keys(s).length&&(e.type=Fs.Z.ABSOLUTE_SUB_HIERARCHY,(0,V.JG)(this.projectUIState,(e=>{e.drag.dragInAbsolutePosition.absDraggedElements=s,e.drag.dragInAbsolutePosition.absDraggedElementsParents=a,e.drag.dragInAbsolutePosition.clonePlaceholders=l}))),e}moveDraggedFreestyleNodes(){var e,t,o,n,i,r;const s=this.projectUIState.drag.draggedEntity;if((null===s||void 0===s?void 0:s.type)!==Fs.Z.ABSOLUTE_SUB_HIERARCHY||!this.projectUIState.drag.initialMousePosition||!this.projectUIState.drag.currentMousePosition)return;this.moved=!0;const{scale:a}=this.projectUIState.stage.webComp.controlValues,{x:l,y:c}=this.projectUIState.drag.currentMousePosition,{x:d,y:p}=this.projectUIState.drag.initialMousePosition,{pressedKeys:u}=this.projectUIState.userInteractions,h=Math.abs(l-d),m=Math.abs(c-p),{absDraggedElements:g,absDraggedElementsParents:y}=this.projectUIState.drag.dragInAbsolutePosition;if(!g||!y)return;const f=this.startingStageControlValues.x-((null===(e=this.elementRefProvider.getIframeRef())||void 0===e||null===(t=e.current)||void 0===t||null===(o=t.getBoundingClientRect())||void 0===o?void 0:o.x)||0),b=this.startingStageControlValues.y-((null===(n=this.elementRefProvider.getIframeRef())||void 0===n||null===(i=n.current)||void 0===i||null===(r=i.getBoundingClientRect())||void 0===r?void 0:r.y)||0);Object.values(g).forEach((e=>{const t=(0,rd.MT)({element:e});if(!t)throw new Error("Dragged node element does not have metadata!");const{slotId:o,nodeId:n,compInstanceId:i}=t;if(!n)throw new Error("Tried to drag a node whose element does not have an id!");const r=(0,mt.AO)(e),s=o?n:i||n,g=y[s].referredParent,w=g.getBoundingClientRect(),v=(0,mt.AO)(g),I=(0,mt.d$)(g),S=Math.round(this.startingTopForNode[s]/v+(c-p+b)/a/r/I.y),j=Math.round(this.startingLeftForNode[s]/v+(l-d+f)/a/r/I.x),D=w.width*v/r/I.x,O=w.height*v/r/I.y,F=e.getBoundingClientRect();let T="auto",N="auto",E="auto",C="auto";const{top:x,left:P}=e.style,k=Math.abs(D-F.width),M=Math.abs(O-F.height),Z=(0,mt.d$)(e);let U=0,A=0;Z.x!==I.x&&(U=F.width*(1-1/Z.x)/2),Z.y!==I.y&&(A=F.height*(1-1/Z.y)/2),"auto"!==x?S<=85*M/100+A?T=`${S}px`:N=`${Math.round(O-S-F.height/Z.y)}px`:S>=15*M/100+A?N=`${Math.round(O-S-F.height/Z.y)}px`:T=`${S}px`,"auto"!==P?j<=85*k/100+U?E=`${j}px`:C=`${Math.round(D-j-F.width/Z.x)}px`:j>=15*k/100+U?C=`${Math.round(D-j-F.width/Z.x)}px`:E=`${j}px`,u.shift?h>m?(e.style.removeProperty("top"),e.style.left=`${E}`,e.style.right=`${C}`,e.style.removeProperty("bottom")):(e.style.top=`${T}`,e.style.removeProperty("left"),e.style.removeProperty("right"),e.style.bottom=`${N}`):(e.style.top=`${T}`,e.style.left=`${E}`,e.style.right=`${C}`,e.style.bottom=`${N}`)}))}endFreestyleDrag(e){const{doc:t}=e;if(!t)return;const o=this.projectUIState.drag.draggedEntity;if((null===o||void 0===o?void 0:o.type)!==Fs.Z.ABSOLUTE_SUB_HIERARCHY)return;const{absDraggedElements:n}=this.projectUIState.drag.dragInAbsolutePosition;this.projectUIState.userInteractions.pressedKeys.alt&&this.nodeManagementFlow.duplicateNodesById({nodeIds:Object.keys(n)}),Object.values(n).forEach((e=>{if(!this.moved||!e)return;const o=(0,rd.MT)({element:e});if(!o)throw new Error("Dragged node element does not have metadata!");const{slotId:n,nodeId:i,compInstanceId:r}=o;if(!i)throw new Error("Tried to drag a node whose element does not have an id!");const s=n?i:r||i,{top:a,left:l,right:c,bottom:d}=e.style,p={};a&&(p.top={value:"auto"!==a?a:""}),l&&(p.left={value:"auto"!==l?l:""}),c&&(p.right={value:"auto"!==c?c:""}),d&&(p.bottom={value:"auto"!==d?d:""}),this.nodeStyleManagmentFlow.setMultipleStylesByKeyForCurrentBreakpoint({nodeIds:[s],styleMap:p,doc:t})}))}cleanUpAfterFreestyleDrag(){this.startingLeftForNode={},this.startingTopForNode={};const{absDraggedElements:e,clonePlaceholders:t}=this.projectUIState.drag.dragInAbsolutePosition;Object.values(e).forEach((e=>{e.removeAttribute("style")})),Object.values(t).forEach((e=>e.remove())),(0,V.JG)(this.projectUIState,(e=>{e.drag.dragInAbsolutePosition.absDraggedElements={},e.drag.dragInAbsolutePosition.absDraggedElementsParents={},e.drag.dragInAbsolutePosition.clonePlaceholders={}})),this.moved=!1,this.startingStageControlValues={x:0,y:0}}},qc=(0,G.Z)(Xc.prototype,"projectDoc",[zc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qc=(0,G.Z)(Xc.prototype,"nodeStyleManagmentFlow",[$c],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ed=(0,G.Z)(Xc.prototype,"nodeManagementFlow",[Gc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),td=(0,G.Z)(Xc.prototype,"elementRefProvider",[Vc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),od=(0,G.Z)(Xc.prototype,"projectUIState",[Jc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nd=(0,G.Z)(Xc.prototype,"guardsService",[Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),id=(0,G.Z)(Xc.prototype,"nodeSelectionFlow",[Kc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(Xc.prototype,"groupFreestyleNodes",[Q.P],Object.getOwnPropertyDescriptor(Xc.prototype,"groupFreestyleNodes"),Xc.prototype),(0,G.Z)(Xc.prototype,"setFreestyleNodesPositionBeforeMoving",[Q.P],Object.getOwnPropertyDescriptor(Xc.prototype,"setFreestyleNodesPositionBeforeMoving"),Xc.prototype),(0,G.Z)(Xc.prototype,"setNodesPositionBasedOnBoundingRect",[Q.P],Object.getOwnPropertyDescriptor(Xc.prototype,"setNodesPositionBasedOnBoundingRect"),Xc.prototype),(0,G.Z)(Xc.prototype,"endFreestyleDrag",[Q.P],Object.getOwnPropertyDescriptor(Xc.prototype,"endFreestyleDrag"),Xc.prototype),Yc=Xc));var sd,ad,ld,cd,dd,pd,ud;sd=(0,J.JJ)("nodeTailwindManagementFlow"),ad=(0,J.f3)("projectDoc"),ld=(0,J.f3)("projectUIState"),sd((dd=class{constructor(){(0,z.Z)(this,"projectDoc",pd,this),(0,z.Z)(this,"projectUIState",ud,this)}addClassesToNode(e){const{doc:t,nodeIds:o,classNames:n}=e;t&&o.forEach((e=>{t.tailwindCSS.addTailwindClassToNode(e,n)}))}deleteClassesFromNode(e){const{doc:t,nodeIds:o,classId:n}=e;t&&o.forEach((e=>{t.tailwindCSS.deleteClassesForNode(e,n)}))}selectTailwindClassesOnNode(e){const{nodeId:t,classNames:o}=e;(0,V.JG)(this.projectUIState,(({tailwind:e})=>{var n;if((null===(n=e.selected)||void 0===n?void 0:n.nodeId)!==t)e.selected={nodeId:t,classNames:o};else{if(o||(e.selected.classNames=null),"string"===typeof e.selected.classNames){var i;if((null===(i=e.selected)||void 0===i?void 0:i.classNames)===o)return void(e.selected.classNames=null);e.selected.classNames=o}"object"===typeof e.selected.classNames&&(e.selected.classNames=o)}}))}resetTailwindState(){(0,V.JG)(this.projectUIState,(e=>{delete e.tailwind.selected}))}cloneTailwindCSSFromNode(e){const{doc:t,nodeId:o,targetNodeId:n}=e;t&&t.tailwindCSS.cloneTailwindCSSFromNode(o,n)}},pd=(0,G.Z)(dd.prototype,"projectDoc",[ad],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ud=(0,G.Z)(dd.prototype,"projectUIState",[ld],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(dd.prototype,"addClassesToNode",[Q.P],Object.getOwnPropertyDescriptor(dd.prototype,"addClassesToNode"),dd.prototype),(0,G.Z)(dd.prototype,"deleteClassesFromNode",[Q.P],Object.getOwnPropertyDescriptor(dd.prototype,"deleteClassesFromNode"),dd.prototype),(0,G.Z)(dd.prototype,"cloneTailwindCSSFromNode",[Q.P],Object.getOwnPropertyDescriptor(dd.prototype,"cloneTailwindCSSFromNode"),dd.prototype),cd=dd));var hd,md,gd,yd,fd,bd,wd,vd,Id,Sd,jd,Dd,Od,Fd,Td,Nd=o(40866);hd=(0,J.JJ)("interactiveElementsFlow"),md=(0,J.f3)("projectDoc"),gd=(0,J.f3)("projectUIState"),yd=(0,J.f3)("nodeStyleManagmentFlow"),fd=(0,J.f3)("mediaQueryBreakpointManagementFlow"),bd=(0,J.f3)("mainInspectorFlow"),wd=(0,J.f3)("projectClassManagementFlow"),hd((Id=class{constructor(){(0,z.Z)(this,"projectDoc",Sd,this),(0,z.Z)(this,"projectUIState",jd,this),(0,z.Z)(this,"nodeStyleManagementFlow",Dd,this),(0,z.Z)(this,"mediaQueryBreakpointManagementFlow",Od,this),(0,z.Z)(this,"mainInspectorFlow",Fd,this),(0,z.Z)(this,"projectClassManagementFlow",Td,this),(0,$.Z)(this,"getAnimationSettingValue",(e=>{if(!e)return Nd.b.NONE;switch(this.nodeStyleManagementFlow.getAllStyleValuesForKey({key:"transform",nodeId:e.id})[0]){case"translateX(100%)":return Nd.b.SLIDE_FROM_RIGHT;case"translateX(-100%)":return Nd.b.SLIDE_FROM_LEFT;case"translateY(-100%)":return Nd.b.SLIDE_FROM_TOP;default:return Nd.b.NONE}})),(0,$.Z)(this,"getNavbarCollapseBreakpoint",(e=>{const t=this.mediaQueryBreakpointManagementFlow.getActiveMediaQueriesInOrder()[1];if(!t)return this.mediaQueryBreakpointManagementFlow.getDefaultMediaQuery();if(!this.projectDoc.nodes.byId[e])return t;const o=(0,Xa.U2)(this.projectDoc,e,dt.IV.NAVBAR);if(!o)return t;const n=(0,Xa.xf)(this.projectDoc,o,dt.IV.NAVBAR_NAV);if(!n)return t;let i=this.mediaQueryBreakpointManagementFlow.getDefaultMediaQuery();return this.mediaQueryBreakpointManagementFlow.getActiveMediaQueriesInOrder().forEach((e=>{const t=this.nodeStyleManagementFlow.getComputedStyleByKeyForBreakpoint(n.id,["display"],e,!1);"none"===t.styles.display&&t.breakpointForStyles===e.maxWidth&&(i=e)})),i})),(0,$.Z)(this,"handleNavbarAnimationChange",((e,t)=>{if(!t)return;const o=this.projectDoc.classes.getAll().find((e=>"teleport-show"===e.name));if(o)switch(e){case Nd.b.NONE:this.mainInspectorFlow.handleMultipleActions((e=>{this.nodeStyleManagementFlow.setStyleByKey({doc:e,nodeIds:[t.id],key:"display",value:"none"}),this.nodeStyleManagementFlow.removeStyleByKey({doc:e,nodeIds:[t.id],key:"transform"}),this.nodeStyleManagementFlow.removeStyleByKey({doc:e,nodeIds:[t.id],key:"transition"}),o.content.transform&&this.projectClassManagementFlow.deleteStyle({doc:e,classId:o.id,key:"transform",identifier:"desktop"})}));break;case Nd.b.SLIDE_FROM_RIGHT:this.mainInspectorFlow.handleMultipleActions((e=>{this.nodeStyleManagementFlow.setStyleByKey({doc:e,nodeIds:[t.id],key:"display",value:"flex"}),this.nodeStyleManagementFlow.setStyleByKey({doc:e,nodeIds:[t.id],key:"transform",value:"translateX(100%)"}),this.nodeStyleManagementFlow.setStyleByKey({doc:e,nodeIds:[t.id],key:"transition",value:"0.5s"}),this.projectClassManagementFlow.addOrUpdate({doc:e,classId:o.id,key:"transform",value:"translateX(0%) !important",identifier:"desktop"})}));break;case Nd.b.SLIDE_FROM_LEFT:this.mainInspectorFlow.handleMultipleActions((e=>{this.nodeStyleManagementFlow.setStyleByKey({doc:e,nodeIds:[t.id],key:"display",value:"flex"}),this.nodeStyleManagementFlow.setStyleByKey({doc:e,nodeIds:[t.id],key:"transform",value:"translateX(-100%)"}),this.nodeStyleManagementFlow.setStyleByKey({doc:e,nodeIds:[t.id],key:"transition",value:"0.5s"}),this.projectClassManagementFlow.addOrUpdate({doc:e,classId:o.id,key:"transform",value:"translateX(0%) !important",identifier:"desktop"})}));break;case Nd.b.SLIDE_FROM_TOP:this.mainInspectorFlow.handleMultipleActions((e=>{this.nodeStyleManagementFlow.setStyleByKey({doc:e,nodeIds:[t.id],key:"display",value:"flex"}),this.nodeStyleManagementFlow.setStyleByKey({doc:e,nodeIds:[t.id],key:"transform",value:"translateY(-100%)"}),this.nodeStyleManagementFlow.setStyleByKey({doc:e,nodeIds:[t.id],key:"transition",value:"0.5s"}),this.projectClassManagementFlow.addOrUpdate({doc:e,classId:o.id,key:"transform",value:"translateY(0%) !important",identifier:"desktop"})}))}})),(0,$.Z)(this,"handleNavbarBreakpointChanged",((e,t)=>{if(!t)return null;if(!this.projectDoc.nodes.byId[t])return null;const o=(0,Xa.U2)(this.projectDoc,t,dt.IV.NAVBAR);if(!o)return null;const n=(0,Xa.xf)(this.projectDoc,o,dt.IV.NAVBAR_NAV),i=(0,Xa.xf)(this.projectDoc,o,dt.IV.NAVBAR_BTN_GROUP),r=(0,Xa.xf)(this.projectDoc,o,dt.IV.BURGER_MENU);if(!n||!i||!r)return null;const s=this.mediaQueryBreakpointManagementFlow.getActiveMediaQueriesInOrder(),a=this.mediaQueryBreakpointManagementFlow.getDefaultMediaQuery();this.mainInspectorFlow.handleMultipleActions((t=>{s.forEach((e=>{this.nodeStyleManagementFlow.removeConditionalInlineStyleByKey({doc:t,nodeIds:[n.id,i.id,r.id],key:"display",condition:{conditionType:"screen-size",maxWidth:e.maxWidth}})})),this.nodeStyleManagementFlow.setStyleByKey({doc:t,nodeIds:[n.id,i.id],key:"display",value:"flex"}),this.nodeStyleManagementFlow.setStyleByKey({doc:t,nodeIds:[r.id],key:"display",value:"none"}),this.nodeStyleManagementFlow.setConditionalInlineStyleByKey({doc:t,nodeIds:[n.id,i.id],key:"display",value:"none",condition:{conditionType:"screen-size",maxWidth:e.maxWidth}}),this.nodeStyleManagementFlow.setConditionalInlineStyleByKey({doc:t,nodeIds:[r.id],key:"display",value:"flex",condition:{conditionType:"screen-size",maxWidth:e.maxWidth}}),e.maxWidth===a.maxWidth&&(this.nodeStyleManagementFlow.setStyleByKey({doc:t,nodeIds:[n.id,i.id],key:"display",value:"none"}),this.nodeStyleManagementFlow.setStyleByKey({doc:t,nodeIds:[r.id],key:"display",value:"flex"}))}))}))}toggleUtilityClassOnNodeId(e){var t;const{doc:o}=e;if(!o)return;const{node:n,status:i,utilityClass:r}=e,s=document.getElementById("stage-frame");if(!s)return;const a=null===(t=s.contentDocument)||void 0===t?void 0:t.body.querySelector(`[data-node-id="${n.id}"]`);a&&(i?(a.classList.add(r),(0,V.JG)(this.projectUIState,(({selection:e})=>{e.nodesWithUtilityClasses[n.id]=r}))):(a.classList.remove(r),(0,V.JG)(this.projectUIState,(({selection:e})=>{delete e.nodesWithUtilityClasses[n.id]}))))}},Sd=(0,G.Z)(Id.prototype,"projectDoc",[md],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jd=(0,G.Z)(Id.prototype,"projectUIState",[gd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dd=(0,G.Z)(Id.prototype,"nodeStyleManagementFlow",[yd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Od=(0,G.Z)(Id.prototype,"mediaQueryBreakpointManagementFlow",[fd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fd=(0,G.Z)(Id.prototype,"mainInspectorFlow",[bd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Td=(0,G.Z)(Id.prototype,"projectClassManagementFlow",[wd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(Id.prototype,"toggleUtilityClassOnNodeId",[Q.P],Object.getOwnPropertyDescriptor(Id.prototype,"toggleUtilityClassOnNodeId"),Id.prototype),vd=Id));o(24023);var Ed,Cd,xd,Pd,kd,Md,Zd,Ud,Ad,Ld,_d,Rd,Bd,Hd,zd,$d,Gd,Vd=o(46882);Ed=(0,J.JJ)("unsplashFlow"),Cd=(0,J.f3)("thirdPartyAssetsService"),xd=(0,J.f3)("projectDoc"),Pd=(0,J.f3)("projectUIState"),kd=(0,J.f3)("assetsUploadFlow"),Md=(0,J.f3)("fileDownloadService"),Zd=(0,J.f3)("assetsService"),Ud=(0,J.f3)("notificationsManagementFlow"),Ed((Ld=class{constructor(){(0,z.Z)(this,"thirdPartyAssetsService",_d,this),(0,z.Z)(this,"projectDoc",Rd,this),(0,z.Z)(this,"projectUIState",Bd,this),(0,z.Z)(this,"assetsUploadFlow",Hd,this),(0,z.Z)(this,"fileDownloadService",zd,this),(0,z.Z)(this,"assetsService",$d,this),(0,z.Z)(this,"notificationsManagementFlow",Gd,this),(0,$.Z)(this,"getCuratedPhotos",(async e=>this.thirdPartyAssetsService.getCuratedUnsplash(e))),(0,$.Z)(this,"searchPhotos",(async(e,t)=>this.thirdPartyAssetsService.searchUnsplash(e,t))),(0,$.Z)(this,"getAPIDownloadUrl",(async e=>this.thirdPartyAssetsService.getUnsplashAPIDownloadUrl(e))),(0,$.Z)(this,"savePhotoToAssets",(async e=>{const t=await this.assetsService.fetchImageFromUrlAsBlob((await this.getAPIDownloadUrl(e)).url),o=t.type.split("/")[1],n=new File([t],`unsplash-image.${o}`,{type:t.type});try{await this.assetsUploadFlow.upload({files:[n],parentFolderId:this.projectUIState.folders.selectedAssetFolderId||ve.D.ASSETS})&&this.notificationsManagementFlow.createNotification(K.k.SUCCESS,pt.ou.jz.SUCCESS)}catch(i){this.notificationsManagementFlow.createNotification(K.k.ERROR,pt.ou.jz.ERROR)}})),(0,$.Z)(this,"downloadPhoto",(async e=>{const t=await this.assetsService.fetchImageFromUrlAsBlob((await this.getAPIDownloadUrl(e)).url),o=t.type.split("/")[1];this.fileDownloadService.promptDownload(t,`unsplash-image.${o}`)}))}computeNewUnsplashUrl(e,t){const o=pt.ou.I1,n=pt.ou.yL,i=this.projectDoc.estimateNodeDimensionInPxByStyle("width",e),r=this.projectDoc.estimateNodeDimensionInPxByStyle("height",e);let s=i>pt.ou.nq?pt.ou.nq:Math.ceil(i/o)*o;const a=r>pt.ou.nq?pt.ou.nq:Math.ceil(r/o)*o;s=s>n?s:n;const l=a>s?`&h=${a}`:`&w=${s}`,c=(0,Vd.EH)("w",t)[0],d=(0,Vd.EH)("h",t)[0];if(c===l||d===l)return;let p=t;return c&&d&&(p=(0,Vd.gG)("w",p,""),p=(0,Vd.gG)("h",p,l)),c&&!d&&(p=(0,Vd.gG)("w",p,l)),!c&&d&&(p=(0,Vd.gG)("h",p,l)),c||d||(p=(0,Vd.gG)("w",p,l)),p}},_d=(0,G.Z)(Ld.prototype,"thirdPartyAssetsService",[Cd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rd=(0,G.Z)(Ld.prototype,"projectDoc",[xd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bd=(0,G.Z)(Ld.prototype,"projectUIState",[Pd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hd=(0,G.Z)(Ld.prototype,"assetsUploadFlow",[kd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zd=(0,G.Z)(Ld.prototype,"fileDownloadService",[Md],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$d=(0,G.Z)(Ld.prototype,"assetsService",[Zd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gd=(0,G.Z)(Ld.prototype,"notificationsManagementFlow",[Ud],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ad=Ld));var Jd,Wd,Kd,Yd,Xd;Jd=(0,J.JJ)("assetsNavigationFlow"),Wd=(0,J.f3)("projectUIState"),Jd((Yd=class{constructor(){(0,z.Z)(this,"projectUIState",Xd,this)}toggleIconLibrary(e){(0,V.JG)(this.projectUIState,(t=>{var o;const n=t.assetsList.toggledIconLibraries[e];t.assetsList.toggledIconLibraries[e]=null!==(o=!n)&&void 0!==o&&o}))}setToggledIconLibraries(e){(0,V.JG)(this.projectUIState,(t=>{t.assetsList.toggledIconLibraries=e}))}},Xd=(0,G.Z)(Yd.prototype,"projectUIState",[Wd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kd=Yd));var qd,Qd,ep,tp,op;qd=(0,J.JJ)("assetsSearchFlow"),Qd=(0,J.f3)("projectUIState"),qd((tp=class{constructor(){(0,z.Z)(this,"projectUIState",op,this)}storeIconSearch(e){(0,V.JG)(this.projectUIState,(t=>{t.assetsList.currentIconSearch=e}))}storeUnsplashSearch(e){(0,V.JG)(this.projectUIState,(t=>{t.assetsList.currentUnsplashSearch=e}))}},op=(0,G.Z)(tp.prototype,"projectUIState",[Qd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ep=tp));var np,ip,rp,sp,ap,lp,cp,dp,pp,up,hp=o(81975);let mp;!function(e){e.NONE="none",e.SOME="some",e.ALL="all"}(mp||(mp={}));np=(0,J.JJ)("assetsSelectionFlow"),ip=(0,J.f3)("projectDoc"),rp=(0,J.f3)("projectUIState"),sp=(0,J.f3)("nodeStyleManagmentFlow"),np((up=new WeakMap,lp=class{constructor(){(0,z.Z)(this,"projectDoc",cp,this),(0,z.Z)(this,"projectUIState",dp,this),(0,z.Z)(this,"nodeStyleManagmentFlow",pp,this),up.set(this,{writable:!0,value:""})}getAssetActionType(){const e=Object.keys(this.projectUIState.selection.nodes)[0],t=this.projectUIState.userInteractions.pressedKeys.alt,o=this.projectDoc.nodes.byId[e];if(!o)return hp.g.ADD_CHILD;const n=o.primitiveType;let i=!1;if(this.projectDoc.nodes.nodeIsCompInstance(o)){var r;const e=o.compIdOfCompInstance;if(!e)throw new Error("Component not found");const t=(null===(r=this.projectDoc.components.byId[e])||void 0===r?void 0:r.propDefinitions)||{};i=Object.values(t).some((e=>e.inputType===jl.SO.IMAGE))}if(n===dt.sO.LIST||n===dt.sO.LISTITEM)return t?hp.g.ADD_SIBLING:hp.g.REPLACE_SOURCE;const{focusedImgAttr:s,UploadedAssetType:a}=this.projectUIState.userInteractions;if(i||null!==s&&void 0!==s&&s.includes(o.id))return t?hp.g.ADD_SIBLING:hp.g.REPLACE_SOURCE;const l=this.nodeStyleManagmentFlow.getCurrentStyleValueByKeyForNode(e,["backgroundImage"]).backgroundImage;switch(a){case"video":return n===dt.sO.VIDEO?t?hp.g.ADD_SIBLING:hp.g.REPLACE_SOURCE:this.projectDoc.isNodeAcceptingChildByElementType(o,dt.sO.VIDEO)?t?hp.g.ADD_SIBLING:hp.g.ADD_CHILD:hp.g.ADD_SIBLING;case"image":default:{if(n===dt.sO.IMAGE)return t?hp.g.ADD_SIBLING:hp.g.REPLACE_SOURCE;if(n===dt.sO.VIDEO)return t?hp.g.ADD_SIBLING:hp.g.REPLACE_POSTER;let e=hp.g.ADD_SIBLING;if(this.projectDoc.isNodeAcceptingChildByElementType(o,dt.sO.IMAGE)){if(l)return t?hp.g.ADD_CHILD:hp.g.REPLACE_SOURCE;e=hp.g.ADD_CHILD}return o.primitiveType===dt.sO.COMPONENT?t?hp.g.REPLACE_SOURCE:hp.g.ADD_SIBLING:t&&e!==hp.g.ADD_SIBLING?hp.g.REPLACE_SOURCE:e}}}selectAsset(e){const{selected:t}=this.projectUIState.assetsList;(0,Gi.Z)(this,up,e),(0,V.JG)(this.projectUIState,(o=>{t[e]?delete o.assetsList.selected[e]:o.assetsList.selected[e]=!0}))}selectAllAssets(){const e=this.projectDoc.assets.getSelectableIds(this.projectUIState.folders.selectedAssetFolderId);(0,V.JG)(this.projectUIState,(t=>{e.forEach((e=>t.assetsList.selected[e]=!0))}))}deselectAllAssets(){(0,V.JG)(this.projectUIState,(e=>e.assetsList.selected={}))}checkHowManyAssetsAreSelected(){const e=Object.keys(this.projectUIState.assetsList.selected).length,t=this.projectDoc.assets.getSelectableIds(this.projectUIState.folders.selectedAssetFolderId).length;return 0===e?mp.NONE:e<t?mp.SOME:mp.ALL}selectAssetRangeWithGroups(e,t){const o=e.findIndex((e=>e.id===(0,$i.Z)(this,up)));if(-1===o)return;const n=e.findIndex((e=>e.id===t));if(-1===n)return;const i=n<o?o:n,r=[];for(let s=n>o?o:n;s<=i;s++)r.push(e[s].id);(0,V.JG)(this.projectUIState,(e=>{e.assetsList.selected={},r.forEach((t=>e.assetsList.selected[t]=!0))}))}setPreviewOnHover(e){(0,V.JG)(this.projectUIState,(t=>{t.userPreferences.previewAssetsOnHover=e}))}setFocusedUploadedAssetType(e){(0,V.JG)(this.projectUIState,(t=>{t.userInteractions.UploadedAssetType=e}))}},cp=(0,G.Z)(lp.prototype,"projectDoc",[ip],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dp=(0,G.Z)(lp.prototype,"projectUIState",[rp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pp=(0,G.Z)(lp.prototype,"nodeStyleManagmentFlow",[sp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ap=lp));var gp,yp,fp,bp,wp,vp,Ip,Sp,jp,Dp,Op,Fp,Tp,Np,Ep,Cp,xp,Pp,kp;o(33567),o(91070);gp=(0,J.JJ)("imageOptimisationFlow"),yp=(0,J.f3)("projectDoc"),fp=(0,J.f3)("projectUIState"),bp=(0,J.f3)("nodeStyleManagmentFlow"),wp=(0,J.f3)("assetsService"),vp=(0,J.f3)("nodeAttributeManagmentFlow"),Ip=(0,J.f3)("propDefinitionManagementFlow"),Sp=(0,J.f3)("unsplashFlow"),jp=(0,J.f3)("collaboratorManagementFlow"),gp((Op=class{constructor(){(0,z.Z)(this,"projectDoc",Fp,this),(0,z.Z)(this,"projectUIState",Tp,this),(0,z.Z)(this,"nodeStyleManagementFlow",Np,this),(0,z.Z)(this,"assetsService",Ep,this),(0,z.Z)(this,"nodeAttributeManagementFlow",Cp,this),(0,z.Z)(this,"propDefinitionManagementFlow",xp,this),(0,z.Z)(this,"unsplashFlow",Pp,this),(0,z.Z)(this,"collaboratorManagementFlow",kp,this)}optimiseNodeImages(e){var t,o;const{nodeId:n,doc:i,unsplashOnly:r}=e;!i||null!==(t=this.projectUIState.localWork)&&void 0!==t&&null!==(o=t.nodesUnderLocalWork)&&void 0!==o&&o[n]||(this.updateUnsplashSizeQuery({nodeId:n,doc:i}),r||this.updateLinkedAssetsSizes({doc:i,nodeId:n}))}updateBgImgProperty(e,t){var o;const n=null===(o=e.backgroundImage)||void 0===o?void 0:o.content;if("string"!==typeof n)return;const i=(0,cr.B)(n).map((e=>{if(e.includes("gradient"))return e;let o=`${e}`.split(/'|"/)[1];return o&&o.includes("images.unsplash")?(o=this.unsplashFlow.computeNewUnsplashUrl(t,o)||"",o?`url('${o}')`:e):e})).join();n!==i&&(e.backgroundImage=new ar.F({content:i}))}updateUnsplashSizeQuery(e){const{nodeId:t,doc:o}=e,n=null===o||void 0===o?void 0:o.nodes.byId[t];if(!n||!o)return;const i=n.attrs.src;if(i&&"static"===i.type&&String(i.content).indexOf("images.unsplash")>-1){const e=this.unsplashFlow.computeNewUnsplashUrl(n.id,String(i.content));e&&this.nodeAttributeManagementFlow.updateAttrByKey({nodeId:t,key:"src",value:e,doc:o})}if(i&&"dynamic"===i.type){var r;const e=o.getComponentIdForNode(n.id);if(!e)return;const t=null===(r=o.components.byId[e])||void 0===r?void 0:r.propDefinitions;if(!t)return;const s=i.content.id,a=t[s];if(a.defaultValue.indexOf("images.unsplash")>-1){const t=this.unsplashFlow.computeNewUnsplashUrl(n.id,a.defaultValue);t&&this.propDefinitionManagementFlow.updatePropDefinition({compId:e,propId:s,propData:{defaultValue:t},doc:o})}}this.updateBgImgProperty(n.styles,t),Object.values(n.referencedStyles).forEach((e=>{"inlined"===e.content.mapType&&this.updateBgImgProperty(e.content.styles,t)}))}computeAssetSizeForComponent(e){const{doc:t,assetId:o,compId:n}=e;if(!t)return;const i=t.assets.byId[o],r=n||this.projectUIState.selection.componentId;if(!i||!r||i.skipOptimisations)return;if(!Object.keys(i.usedInNodes).length)return void delete i.sizePerComponent;let s;var a;(Object.keys(i.usedInNodes).forEach((e=>{const o=t.getComponentIdForNode(e);!o||r&&o!==r||(s=this.computeAssetSizeForNode({nodeId:e,asset:i,currentValue:s}))})),s)?(i.sizePerComponent||(i.sizePerComponent={}),i.sizePerComponent[r]=s):null===(a=i.sizePerComponent)||void 0===a||delete a[r]}computeAssetSizeForNode(e){var t,o;const{nodeId:n,asset:i,currentValue:r}=e,{originalHeight:s=1,originalWidth:a=1}=i,l=this.projectDoc.nodes.byId[n];let c=0,d=0;if(l&&this.projectDoc.nodes.nodeIsCompInstance(l)){const e=this.projectDoc.components.byId[l.compIdOfCompInstance];Object.keys(l.attrs||{}).forEach((t=>{if(l.attrs[t].content!==i.id)return;const o=Object.values(e.propDefinitions).find((e=>e.name===t));Object.keys((null===o||void 0===o?void 0:o.locations)||{}).forEach((e=>{const t=this.projectDoc.estimateNodeDimensionInPxByStyle("width",e),o=this.projectDoc.estimateNodeDimensionInPxByStyle("height",e);c=c<t?t:c,d=d<o?o:d}))}))}else c=this.projectDoc.estimateNodeDimensionInPxByStyle("width",n),d=this.projectDoc.estimateNodeDimensionInPxByStyle("height",n);const p=pt.ou.I1;c=Math.ceil(c/p)*p,d=Math.ceil(d/p)*p;const u=c/a,h=d/s;if(c<=pt.ou.yL&&d<=pt.ou.yL&&(u>h?(c=pt.ou.yL,d=0):(c=0,d=pt.ou.yL)),!r)return u>h?`w=${c}`:`h=${d}`;const m=u>h?`w=${c}`:`h=${d}`;return parseInt((null===(t=m.match(/\d/g))||void 0===t?void 0:t.join(""))||"",10)/(-1!==m.indexOf("w")?u:h)>parseInt((null===(o=r.match(/\d/g))||void 0===o?void 0:o.join(""))||"",10)/(-1!==r.indexOf("w")?u:h)?m:r}computeSizePerComponentForAllAssetsIfNeeded(e){const{doc:t}=e;if(!t)return;if(this.collaboratorManagementFlow.getCurrentUserProjectRole()===Yo.Z.READ)return;const o=Object.values(t.assets.byId);if(o.some((e=>e.sizePerComponent)))return;const n=this.computeAssetSizePerComponent(o);Object.keys(n).forEach((e=>{t.assets.byId[e]&&(t.assets.byId[e].sizePerComponent=n[e])}))}computeAssetSizePerComponent(e){const t={};for(const o of e){const{originalHeight:e=1,originalWidth:n=1}=o;if(Object.keys(o.usedInNodes).length)t[o.id]||(t[o.id]={}),Object.keys(o.usedInNodes).forEach((e=>{const n=this.projectDoc.getComponentIdForNode(e);n&&(t[o.id][n]=this.computeAssetSizeForNode({nodeId:e,asset:o,currentValue:t[o.id][n]}))}));else{const i=e>=n?`w=${pt.ou.Cg}`:`h=${pt.ou.Cg}`;t[o.id]={nonComponent:i}}}return t}nodeHasSomeImage(e){const{nodeId:t,doc:o}=e;if(!o)return;const n=o.nodes.byId[t];if(n&&o.nodes.nodeIsCompInstance(n)){const e=o.components.byId[n.compIdOfCompInstance];if(!e)throw new Error(`Tried to compute images for a component that doesn't exist: ${n.compIdOfCompInstance}`);return Object.values(e.propDefinitions).some((e=>e.inputType===jl.SO.IMAGE))}if((null===n||void 0===n?void 0:n.primitiveType)===dt.sO.VIDEO)return n.attrs.poster&&n.attrs.poster.content;if(null!==n&&void 0!==n&&n.attrs.src&&n.attrs.src.content)return!0;return!!this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(t,["backgroundImage"]).backgroundImage}updateLinkedAssetsSizes(e){const{doc:t,nodeId:o}=e;t&&this.nodeHasSomeImage({doc:t,nodeId:o})&&Object.values(t.assets.byId).forEach((e=>{e.usedInNodes[o]&&this.computeAssetSizeForComponent({doc:t,assetId:e.id})}))}getAssetsLinkedToNodes(e){const{nodeIds:t,doc:o,withDescendants:n}=e;let i=[];return n?t.forEach((e=>{null===o||void 0===o||o.nodes.bfs(e,(e=>{i.includes(e.id)||i.push(e.id)}))})):i=t,Object.values((null===o||void 0===o?void 0:o.assets.byId)||{}).filter((e=>i.some((t=>Object.keys(e.usedInNodes).includes(t))))).map((e=>e.id))}removeAssetSizeForPageOrComp(e){const{id:t,doc:o}=e;if(!o)return;const n=o.getProjectPageOrComponent(t);if(!n||!n.rootNodeId)return;this.getAssetsLinkedToNodes({nodeIds:[n.rootNodeId],withDescendants:!0}).forEach((e=>{const{sizePerComponent:n}=o.assets.byId[e];n&&delete n[t]}))}},Fp=(0,G.Z)(Op.prototype,"projectDoc",[yp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tp=(0,G.Z)(Op.prototype,"projectUIState",[fp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Np=(0,G.Z)(Op.prototype,"nodeStyleManagementFlow",[bp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ep=(0,G.Z)(Op.prototype,"assetsService",[wp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cp=(0,G.Z)(Op.prototype,"nodeAttributeManagementFlow",[vp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xp=(0,G.Z)(Op.prototype,"propDefinitionManagementFlow",[Ip],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pp=(0,G.Z)(Op.prototype,"unsplashFlow",[Sp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kp=(0,G.Z)(Op.prototype,"collaboratorManagementFlow",[jp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(Op.prototype,"optimiseNodeImages",[Q.P],Object.getOwnPropertyDescriptor(Op.prototype,"optimiseNodeImages"),Op.prototype),(0,G.Z)(Op.prototype,"updateUnsplashSizeQuery",[Q.P],Object.getOwnPropertyDescriptor(Op.prototype,"updateUnsplashSizeQuery"),Op.prototype),(0,G.Z)(Op.prototype,"computeAssetSizeForComponent",[Q.P],Object.getOwnPropertyDescriptor(Op.prototype,"computeAssetSizeForComponent"),Op.prototype),(0,G.Z)(Op.prototype,"computeSizePerComponentForAllAssetsIfNeeded",[Q.P],Object.getOwnPropertyDescriptor(Op.prototype,"computeSizePerComponentForAllAssetsIfNeeded"),Op.prototype),(0,G.Z)(Op.prototype,"nodeHasSomeImage",[Q.P],Object.getOwnPropertyDescriptor(Op.prototype,"nodeHasSomeImage"),Op.prototype),(0,G.Z)(Op.prototype,"updateLinkedAssetsSizes",[Q.P],Object.getOwnPropertyDescriptor(Op.prototype,"updateLinkedAssetsSizes"),Op.prototype),(0,G.Z)(Op.prototype,"getAssetsLinkedToNodes",[Q.P],Object.getOwnPropertyDescriptor(Op.prototype,"getAssetsLinkedToNodes"),Op.prototype),(0,G.Z)(Op.prototype,"removeAssetSizeForPageOrComp",[Q.P],Object.getOwnPropertyDescriptor(Op.prototype,"removeAssetSizeForPageOrComp"),Op.prototype),Dp=Op));var Mp,Zp,Up,Ap,Lp,_p,Rp,Bp,Hp,zp,$p,Gp,Vp;function Jp(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Wp(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Jp(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Jp(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}Mp=(0,J.JJ)("imageTransformationFlow"),Zp=(0,J.f3)("projectDoc"),Up=(0,J.f3)("projectUIState"),Ap=(0,J.f3)("nodeStyleManagmentFlow"),Lp=(0,J.f3)("nodeAttributeManagmentFlow"),_p=(0,J.f3)("propDefinitionManagementFlow"),Mp((Bp=class{constructor(){(0,z.Z)(this,"projectDoc",Hp,this),(0,z.Z)(this,"projectUIState",zp,this),(0,z.Z)(this,"nodeStyleManagmentFlow",$p,this),(0,z.Z)(this,"nodeAttributeManagementFlow",Gp,this),(0,z.Z)(this,"propDefinitionManagementFlow",Vp,this)}extractImageFromContainer(e){var t,o,n;const{doc:i,nodeId:r}=e;if(!i)return;const s=i.nodes.byId[r];if(!s)throw new Error("Cannot extract image from unexisting node");if(Object.keys((null===s||void 0===s?void 0:s.childrenIds)||{}).length>0)throw new Error("Cannot extract image from container with children");const{styles:a,inheritedStyles:l}=this.nodeStyleManagmentFlow.getComputedStyleByKeyForCurrentBreakpoint(s.id,["backgroundImage"]);let c=a.backgroundImage||l.backgroundImage;if(!c||"string"!==typeof c)throw new Error("Could not extract image: node does not have one.");const d=dt.sO.IMAGE,p={},u=Wp({},s.styles),h=null===(t=s.styles.backgroundSize)||void 0===t?void 0:t.content,m=null===(o=s.styles.backgroundPosition)||void 0===o?void 0:o.content;let g=null===(n=s.attrs.id)||void 0===n?void 0:n.content;"string"!==typeof g&&(g="");if(c=(0,cr.B)(c).find((e=>!e.includes("gradient")))||"",!c)return!1;if("string"===typeof c&&!this.projectDoc.assets.byId[c]){const e=c.split(/"|'/)[1];if(!e)return!1;c=e}Object.keys(u).forEach((e=>{for(const t of nr.Or)if(e.includes(t)&&!e.includes("background"))return;delete u[e]})),u.objectFit=new ar.F({content:"contain"!==h?"cover":h}),u.objectPosition=new ar.F({content:"string"!==typeof m?"center":m}),p.src=new ar.F({content:c}),g&&(p.id=new ar.F({content:g})),s.primitiveType=d,s.semanticType=null,s.attrs=p,s.styles=u}turnImageIntoContainer(e){var t,o,n;const{doc:i,nodeId:r}=e;if(!i)return!1;const s=i.nodes.byId[r];if(!s)throw new Error("Cannot transform unexisting node to container.");const a=s.attrs.src;if(!a)throw new Error("Cannot transform image to container: image has no source.");let l;var c;"string"===typeof a.content?l=a.content:l=(null===(c=this.propDefinitionManagementFlow.getPropDefForDynamicNode(s,a))||void 0===c?void 0:c.defaultValue)||"";const d=null===(t=s.styles.objectFit)||void 0===t?void 0:t.content,p=null===(o=s.styles.objectPosition)||void 0===o?void 0:o.content;let u=null===(n=s.attrs.id)||void 0===n?void 0:n.content;"string"!==typeof u&&(u="");const h=dt.sO.CONTAINER,m=dt.iX.DIV;let g=Wp({},s.styles);const y=Wp({},s.attrs),f={};if(Object.keys(g).forEach((e=>{for(const t of nr.Or)if(e.includes(t)&&!e.includes("object"))return;delete g[e]})),this.projectDoc.assets.byId[l]||(l=`url('${l}')`),g=Wp(Wp({},g),{},{backgroundImage:new ar.F({content:l}),backgroundPosition:new ar.F({content:"string"!==typeof p?"center":p}),backgroundSize:new ar.F({content:"contain"!==d?"cover":d}),display:new ar.F({content:"flex"})}),u&&(f.id=new ar.F({content:u})),!g.width){const t=e.width?Math.round(e.width):100;g.width=new ar.F({content:`${t}px`})}if(!g.height){const t=e.height?Math.round(e.height):100;g.height=new ar.F({content:`${t}px`})}s.semanticType=m,s.attrs=f,s.styles=g,s.primitiveType=h,Object.keys(y).forEach((e=>{"dynamic"===y[e].type&&-1!==jl.lm.indexOf(e)&&this.propDefinitionManagementFlow.removePropLocationForNode({nodeId:s.id,propId:y[e].content.id,location:{base:jl.hD.ATTR,sufix:e},doc:i})}))}},Hp=(0,G.Z)(Bp.prototype,"projectDoc",[Zp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zp=(0,G.Z)(Bp.prototype,"projectUIState",[Up],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$p=(0,G.Z)(Bp.prototype,"nodeStyleManagmentFlow",[Ap],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gp=(0,G.Z)(Bp.prototype,"nodeAttributeManagementFlow",[Lp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vp=(0,G.Z)(Bp.prototype,"propDefinitionManagementFlow",[_p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(Bp.prototype,"extractImageFromContainer",[Q.P],Object.getOwnPropertyDescriptor(Bp.prototype,"extractImageFromContainer"),Bp.prototype),(0,G.Z)(Bp.prototype,"turnImageIntoContainer",[Q.P],Object.getOwnPropertyDescriptor(Bp.prototype,"turnImageIntoContainer"),Bp.prototype),Rp=Bp));var Kp=o(42414),Yp=o(89308);const Xp=e=>{const{onSubmit:t,onDismiss:o,folderName:n,entitiesToBeDeleted:i}=e,{folders:r,assets:s}=i;return(0,gr.jsxs)("div",{className:ss.default.dynamic([["4170421248",[Ki.N_.ONE_AND_HALF,Ki.N_.UNIT,Ki.N_.UNIT,Ki.N_.HALF_UNIT,Ki.N_.HALF_UNIT]]])+" wrapper",children:[(0,gr.jsxs)("p",{className:ss.default.dynamic([["4170421248",[Ki.N_.ONE_AND_HALF,Ki.N_.UNIT,Ki.N_.UNIT,Ki.N_.HALF_UNIT,Ki.N_.HALF_UNIT]]])+" modal-title",children:["Are you sure you want to delete ",n," folder and all of its contents?"]}),(0,gr.jsxs)("div",{className:ss.default.dynamic([["4170421248",[Ki.N_.ONE_AND_HALF,Ki.N_.UNIT,Ki.N_.UNIT,Ki.N_.HALF_UNIT,Ki.N_.HALF_UNIT]]])+" entities-wrapper",children:[(0,gr.jsx)("p",{className:ss.default.dynamic([["4170421248",[Ki.N_.ONE_AND_HALF,Ki.N_.UNIT,Ki.N_.UNIT,Ki.N_.HALF_UNIT,Ki.N_.HALF_UNIT]]]),children:"Items to be deleted:"}),r.map((e=>(0,gr.jsxs)("div",{className:ss.default.dynamic([["4170421248",[Ki.N_.ONE_AND_HALF,Ki.N_.UNIT,Ki.N_.UNIT,Ki.N_.HALF_UNIT,Ki.N_.HALF_UNIT]]])+" entity",children:[(0,gr.jsx)(hr.J,{type:"folder"})," ",(0,gr.jsx)("span",{className:ss.default.dynamic([["4170421248",[Ki.N_.ONE_AND_HALF,Ki.N_.UNIT,Ki.N_.UNIT,Ki.N_.HALF_UNIT,Ki.N_.HALF_UNIT]]]),children:e.name})]},e.id))),s.map((e=>(0,gr.jsxs)("div",{className:ss.default.dynamic([["4170421248",[Ki.N_.ONE_AND_HALF,Ki.N_.UNIT,Ki.N_.UNIT,Ki.N_.HALF_UNIT,Ki.N_.HALF_UNIT]]])+" entity",children:[(0,gr.jsx)(hr.J,{type:"asset"})," ",(0,gr.jsx)("span",{className:ss.default.dynamic([["4170421248",[Ki.N_.ONE_AND_HALF,Ki.N_.UNIT,Ki.N_.UNIT,Ki.N_.HALF_UNIT,Ki.N_.HALF_UNIT]]]),children:e.name})]},e.id)))]}),(0,gr.jsxs)("div",{className:ss.default.dynamic([["4170421248",[Ki.N_.ONE_AND_HALF,Ki.N_.UNIT,Ki.N_.UNIT,Ki.N_.HALF_UNIT,Ki.N_.HALF_UNIT]]])+" modal-btns",children:[(0,gr.jsx)(ur.z,{onClick:o,style:"solid",colorScheme:"neutral",children:"Cancel"}),(0,gr.jsx)(ur.z,{onClick:()=>{t(),o()},style:"solid",colorScheme:"danger",refAttrs:{autoFocus:!0},children:"Delete"})]}),(0,gr.jsx)(ss.default,{id:"4170421248",dynamic:[Ki.N_.ONE_AND_HALF,Ki.N_.UNIT,Ki.N_.UNIT,Ki.N_.HALF_UNIT,Ki.N_.HALF_UNIT],children:[`.modal-title.__jsx-style-dynamic-selector{margin-bottom:${Ki.N_.ONE_AND_HALF};}`,".modal-btns.__jsx-style-dynamic-selector{-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}",`.entities-wrapper.__jsx-style-dynamic-selector{padding:${Ki.N_.UNIT} 0;max-height:300px;overflow:auto;}`,`.entities-wrapper.__jsx-style-dynamic-selector>p.__jsx-style-dynamic-selector{margin-bottom:${Ki.N_.UNIT};}`,`.entity.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:${Ki.N_.HALF_UNIT};}`,".entity.__jsx-style-dynamic-selector:last-child,.entity.__jsx-style-dynamic-selector:only-child{margin-bottom:0;}",`.entity.__jsx-style-dynamic-selector>span.__jsx-style-dynamic-selector{margin-left:${Ki.N_.HALF_UNIT};}`]}),(0,gr.jsx)("style",{children:mr.W2})]})};var qp,Qp,eu,tu,ou,nu,iu,ru,su,au,lu,cu,du,pu,uu,hu,mu;qp=(0,J.JJ)("folderManagementFlow"),Qp=(0,J.f3)("projectDoc"),eu=(0,J.f3)("sharedbProjectSyncService"),tu=(0,J.f3)("projectUIState"),ou=(0,J.f3)("assetsManagementFlow"),nu=(0,J.f3)("assetsEditFlow"),iu=(0,J.f3)("guardsService"),ru=(0,J.f3)("modalManagementFlow"),qp((au=class{constructor(){(0,z.Z)(this,"projectDoc",lu,this),(0,z.Z)(this,"dbSync",cu,this),(0,z.Z)(this,"projectUIState",du,this),(0,z.Z)(this,"assetsManagementFlow",pu,this),(0,z.Z)(this,"assetsEditFlow",uu,this),(0,z.Z)(this,"guardsService",hu,this),(0,z.Z)(this,"modalManagementFlow",mu,this),(0,$.Z)(this,"getFolderParents",(e=>{const t=this.projectDoc.folders.byId[e];let o=t.parentId;const n=[t];for(;o;){const e=this.projectDoc.folders.byId[o];n.push(e),o=e.parentId}return n.reverse()}))}startEditingFolder(e){e&&this.projectDoc.folders.byId[e]&&(0,V.JG)(this.projectUIState,(t=>{t.folders.folderUnderEdit=e}))}stopEditingAnyFolders(){(0,V.JG)(this.projectUIState,(e=>{e.folders.folderUnderEdit=null}))}getChildFoldersOfFolder(e){return this.projectDoc.folders.getChildFoldersOfFolder(e)}create(e){const{folderName:t,parentFolderId:o="assets"}=e;let n;return this.guardsService.executeFunctionGuarded(to._.DISABLE_HISTORY,(()=>this.dbSync.mutate(this.projectDoc,(e=>{n=e.folders.create({folderName:t,parentFolderId:o}),e.folders.addChildToFolder({child:{[n.id]:"folder"},folderId:o})})))),n}delete(e){const t=this.projectDoc.folders.byId[e];if(!t)return;const o=this.getAllChildEntitiesOfFolder(e),n={folders:o.folders.map((e=>this.projectDoc.folders.byId[e])),assets:o.assets.map((e=>this.projectDoc.assets.byId[e]))};if(1===n.folders.length&&!n.assets.length)return void this.guardsService.executeFunctionGuarded(to._.DISABLE_HISTORY,(()=>this.dbSync.mutate(this.projectDoc,(o=>{o.folders.removeChildFromFolder({child:{[t.id]:"folder"},folderId:t.parentId}),o.folders.delete(e)}))));const i=Jo.d.createCustomModal({Component:Xp,onSubmit:()=>{this.assetsEditFlow.delete(o.assets),this.guardsService.executeFunctionGuarded(to._.DISABLE_HISTORY,(()=>this.dbSync.mutate(this.projectDoc,(e=>{e.folders.removeChildFromFolder({child:{[t.id]:"folder"},folderId:t.parentId}),o.folders.forEach((t=>{e.folders.delete(t)}))}))))},data:{folderName:t.name,entitiesToBeDeleted:n}});this.modalManagementFlow.showModal(i)}rename(e,t){t||(t="New Folder");const o=this.projectDoc.folders.getChildFoldersOfFolder(this.projectUIState.folders.selectedAssetFolderId).filter((t=>t.id!==e)).map((e=>e.name));this.guardsService.executeFunctionGuarded(to._.DISABLE_HISTORY,(()=>this.dbSync.mutate(this.projectDoc,(n=>{n.folders.rename(e,(0,W.Zu)(o,t))})))),(0,V.JG)(this.projectUIState,(e=>{e.folders.folderUnderEdit=null}))}getAllChildEntitiesOfFolder(e){const t=this.projectDoc.folders.byId[e],o=[...Object.keys(t.children)],n={folders:[e],assets:[]};for(;o.length;){const e=o.shift(),t=this.projectDoc.folders.byId[e]||this.projectDoc.assets.byId[e];t instanceof Kp.g&&(n.folders.push(t.id),o.push(...Object.keys(t.children))),t instanceof Yp.G&&n.assets.push(t.id)}return n}},lu=(0,G.Z)(au.prototype,"projectDoc",[Qp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cu=(0,G.Z)(au.prototype,"dbSync",[eu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),du=(0,G.Z)(au.prototype,"projectUIState",[tu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pu=(0,G.Z)(au.prototype,"assetsManagementFlow",[ou],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uu=(0,G.Z)(au.prototype,"assetsEditFlow",[nu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hu=(0,G.Z)(au.prototype,"guardsService",[iu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mu=(0,G.Z)(au.prototype,"modalManagementFlow",[ru],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),su=au));var gu,yu,fu,bu,wu,vu,Iu,Su,ju,Du,Ou,Fu,Tu;function Nu(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Eu(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Nu(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Nu(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}gu=(0,J.JJ)("assetFoldersFlow"),yu=(0,J.f3)("sharedbProjectSyncService"),fu=(0,J.f3)("projectDoc"),bu=(0,J.f3)("projectUIState"),wu=(0,J.f3)("folderManagementFlow"),vu=(0,J.f3)("guardsService"),gu((Su=class{constructor(){(0,z.Z)(this,"dbSync",ju,this),(0,z.Z)(this,"projectDoc",Du,this),(0,z.Z)(this,"projectUIState",Ou,this),(0,z.Z)(this,"folderManagementFlow",Fu,this),(0,z.Z)(this,"guardsService",Tu,this)}runMigrationForProjectAssets(){let e=this.projectDoc.folders.byId.assets;e||this.dbSync.mutate(this.projectDoc,(t=>{e=t.folders.create({folderName:"assets",folderId:"assets",parentFolderId:null})}));const{name:t}=e;t!==ve.D.ASSETS&&this.folderManagementFlow.rename(e.id,ve.D.ASSETS);const o=this.projectDoc.assets.byId;Object.keys(o).forEach((e=>{const t=o[e],{parentFolderId:n}=t;n!==ve.D.ASSETS||t.id in this.projectDoc.folders.byId[ve.D.ASSETS].children||this.dbSync.mutate(this.projectDoc,(e=>{e.folders.byId[ve.D.ASSETS].children=Eu(Eu({},e.folders.byId[ve.D.ASSETS].children),{[t.id]:"asset"})}))}))}getAssetFolders(){return Object.values(this.projectDoc.folders.byId).filter((e=>e.id!==ve.D.COMPONENTS&&e.id!==ve.D.PAGES))}setcurrentAssetFolder(e){this.projectUIState.folders.folderUnderEdit!==e&&(0,V.JG)(this.projectUIState,(t=>{t.folders.selectedAssetFolderId=e,t.assetsList.selected={}}))}moveAssetsToFolder(e){const{assetIds:t,targetFolderId:o}=e;this.guardsService.executeFunctionGuarded(to._.DISABLE_HISTORY,(()=>this.dbSync.mutate(this.projectDoc,(e=>{t.forEach((t=>{const n=e.assets.byId[t];if(!n)return;const i={[n.id]:"asset"};e.folders.removeChildFromFolder({child:i,folderId:n.parentFolderId}),e.folders.addChildToFolder({child:i,folderId:o})})),e.assets.changeParentFolder(t,o)}))))}removeAssetsFromFolder(e){const{assetIds:t,targetFolderId:o}=e;this.guardsService.executeFunctionGuarded(to._.DISABLE_HISTORY,(()=>this.dbSync.mutate(this.projectDoc,(e=>{t.forEach((t=>{const n=e.assets.byId[t];if(!n)return;const i={[n.id]:"asset"};e.folders.removeChildFromFolder({child:i,folderId:o})}))}))))}},ju=(0,G.Z)(Su.prototype,"dbSync",[yu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Du=(0,G.Z)(Su.prototype,"projectDoc",[fu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ou=(0,G.Z)(Su.prototype,"projectUIState",[bu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fu=(0,G.Z)(Su.prototype,"folderManagementFlow",[wu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tu=(0,G.Z)(Su.prototype,"guardsService",[vu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iu=Su));var Cu,xu,Pu,ku,Mu;Cu=(0,J.JJ)("dragFilesOverWindowFlow"),xu=(0,J.f3)("projectUIState"),Cu((ku=class{constructor(){(0,z.Z)(this,"projectUIState",Mu,this)}setDraggingFiles(e){(0,V.JG)(this.projectUIState,(t=>{t.drag.draggingFiles=e}))}},Mu=(0,G.Z)(ku.prototype,"projectUIState",[xu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pu=ku));var Zu,Uu,Au,Lu,_u;const Ru=[.25,.5,.75,1,1.25,1.5,1.75,2,3,4,5,6];Zu=(0,J.JJ)("zoomControlFlow"),Uu=(0,J.f3)("projectUIState"),Zu((Lu=class{constructor(){(0,z.Z)(this,"projectUIState",_u,this)}zoomOut(){if(this.projectUIState.drag.draggedEntity||this.projectUIState.selection.dragSelection)return;const e=this.projectUIState.stage.webComp.controlValues.scale;(0,V.JG)(this.projectUIState,(({stage:t,userPreferences:o})=>{for(let n=Ru.length-1;n>=0;n-=1)if(e>Ru[n])return t.webComp.controlValues.scale=Ru[n],void(o.zoomLevel=Ru[n])}))}zoomIn(){if(this.projectUIState.drag.draggedEntity||this.projectUIState.selection.dragSelection)return;const e=this.projectUIState.stage.webComp.controlValues.scale;(0,V.JG)(this.projectUIState,(({stage:t,userPreferences:o})=>{for(const n of Ru)if(e<n)return t.webComp.controlValues.scale=n,void(o.zoomLevel=n)}))}resetScaleValue(){(0,V.JG)(this.projectUIState,(({stage:e,userPreferences:t})=>{e.webComp.controlValues.scale=nr.m7.controlValues.scale,t.zoomLevel=nr.m7.controlValues.scale}))}adjustStageZoomLevelToScreenResolution(e){(0,V.JG)(this.projectUIState,(({stage:t})=>{e<1440&&(t.webComp.controlValues.scale=Ru[1]),e>=1440&&e<1800&&(t.webComp.controlValues.scale=Ru[2]),e>=1800&&(t.webComp.controlValues.scale=Ru[3])}))}setStageZoomLevel(e){(0,V.JG)(this.projectUIState,(({stage:t})=>{t.webComp.controlValues.scale=e}))}},_u=(0,G.Z)(Lu.prototype,"projectUIState",[Uu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Au=Lu));o(73449);var Bu,Hu,zu,$u,Gu,Vu,Ju,Wu,Ku,Yu,Xu;Bu=(0,J.JJ)("tutorialFlow"),Hu=(0,J.f3)("projectUIState"),zu=(0,J.f3)("projectDoc"),$u=(0,J.f3)("globalAppState"),Gu=(0,J.f3)("userAccountRepository"),Bu((Ju=class{constructor(){(0,z.Z)(this,"projectUIState",Wu,this),(0,z.Z)(this,"projectDoc",Ku,this),(0,z.Z)(this,"globalAppState",Yu,this),(0,z.Z)(this,"userAccountRepository",Xu,this),(0,$.Z)(this,"tutorialSteps",[]),(0,$.Z)(this,"currentPosition",-1),(0,$.Z)(this,"overallTutorialState",null),(0,$.Z)(this,"checkAndBeginTutorial",(e=>{var t;const{userData:o}=this.globalAppState.user;if(null!==o&&void 0!==o&&o.isAnonymous)return;const n=null===o||void 0===o?void 0:o.meta;this.overallTutorialState||(this.overallTutorialState=(null===n||void 0===n?void 0:n[`${e}Tutorial`])||{completed:!1});const{completed:i,skipped:r}=this.overallTutorialState,s=null===n||void 0===n||null===(t=n.login)||void 0===t?void 0:t.lastTimeEnteredStage,a=(new Date).toISOString();(!i&&!r||((e,t)=>{const o=new Date(e),n=new Date(t),i=o.getFullYear(),r=[31,i%4===0&&i%100!==0||i%400===0?29:28,31,30,31,30,31,31,30,31,30,31];let s=n.getFullYear()-i,a=n.getMonth()-o.getMonth();a<0&&(s--,a+=12);let l=n.getDate()-o.getDate();return l<0&&(a>0?a--:(s--,a=11),l+=r[o.getMonth()]),12*s+a+l/30})(a,s)>=3)&&this.beginTutorial(e)})),(0,$.Z)(this,"beginTutorial",(async e=>{const{steps:t}=await o(1652)(`./${e}`);this.tutorialSteps=t,(0,V.JG)(this.projectUIState,(({tutorials:t})=>{t.tutorialInProgress=e})),this.nextStep()})),(0,$.Z)(this,"nextStep",(()=>{if(!this.projectUIState.tutorials.tutorialInProgress)throw new Error("Cannot get next step if no tutorial is active");const e=this.currentPosition+1;e===this.tutorialSteps.length&&this.endTutorial();const t=this.tutorialSteps[this.currentPosition];(null===t||void 0===t?void 0:t.afterShow)&&t.afterShow(this.projectUIState,this.projectDoc),this.currentPosition=e;const o=this.tutorialSteps[e];(null===o||void 0===o?void 0:o.beforeShow)&&o.beforeShow(this.projectUIState,this.projectDoc),(0,V.JG)(this.projectUIState,(({tutorials:t})=>{t.tutorialInProgress&&(t.currentStep=this.tutorialSteps[e])}))})),(0,$.Z)(this,"previousStep",(()=>{if(!this.projectUIState.tutorials.tutorialInProgress)throw new Error("Cannot get previous step if no tutorial active");const e=this.currentPosition-1;if(e<0)return(0,V.JG)(this.projectUIState,(({tutorials:e})=>{e.tutorialInProgress&&(e.currentStep=this.tutorialSteps[0])})),this.tutorialSteps[0];const t=this.tutorialSteps[this.currentPosition];(null===t||void 0===t?void 0:t.afterShow)&&t.afterShow(this.projectUIState,this.projectDoc);const o=this.tutorialSteps[e];(null===o||void 0===o?void 0:o.beforeShow)&&o.beforeShow(this.projectUIState,this.projectDoc),this.currentPosition=e,(0,V.JG)(this.projectUIState,(({tutorials:t})=>{t.tutorialInProgress&&(t.currentStep=this.tutorialSteps[e])}))}))}isLast(){return this.currentPosition===this.tutorialSteps.length-1}isFirst(){return 0===this.currentPosition}async endTutorial(){var e;this.overallTutorialState={completed:!0},(0,V.JG)(this.globalAppState,(({user:e})=>{if(!e.userData||null===this.overallTutorialState)return;const t=this.projectUIState.tutorials.tutorialInProgress;e.userData.meta[`${t}Tutorial`]=this.overallTutorialState})),await this.userAccountRepository.update({meta:null===(e=this.globalAppState.user.userData)||void 0===e?void 0:e.meta}),this.currentPosition=-1,(0,V.JG)(this.projectUIState,(({tutorials:e})=>{e.tutorialInProgress=null}))}async skipTutorial(){var e;this.currentPosition=-1,this.overallTutorialState={completed:!1,skipped:!0,position:this.currentPosition},(0,V.JG)(this.globalAppState,(({user:e})=>{if(!e.userData||null===this.overallTutorialState)return;const t=this.projectUIState.tutorials.tutorialInProgress;e.userData.meta[`${t}Tutorial`]=this.overallTutorialState})),await this.userAccountRepository.update({meta:null===(e=this.globalAppState.user.userData)||void 0===e?void 0:e.meta}),(0,V.JG)(this.projectUIState,(({tutorials:e})=>{e.tutorialInProgress=null}))}},Wu=(0,G.Z)(Ju.prototype,"projectUIState",[Hu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ku=(0,G.Z)(Ju.prototype,"projectDoc",[zu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yu=(0,G.Z)(Ju.prototype,"globalAppState",[$u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xu=(0,G.Z)(Ju.prototype,"userAccountRepository",[Gu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vu=Ju));var qu,Qu,eh,th,oh,nh,ih,rh,sh,ah,lh,ch,dh,ph,uh,hh,mh,gh,yh,fh,bh,wh,vh,Ih,Sh,jh,Dh,Oh,Fh,Th,Nh,Eh,Ch,xh,Ph,kh,Mh=o(19236),Zh=o(4781),Uh=o(71606),Ah=o(41130),Lh=o(41487),_h=o.n(Lh),Rh=o(7717),Bh=o(69812),Hh=o(66485),zh=o.n(Hh),$h=o(71023),Gh=o(32307);function Vh(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Jh(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Vh(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Vh(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}qu=(0,J.JJ)("clipboardFlow"),Qu=(0,J.f3)("projectDoc"),eh=(0,J.f3)("projectUIState"),th=(0,J.f3)("nodeManagementFlow"),oh=(0,J.f3)("componentManagementFlow"),nh=(0,J.f3)("uidlToComponentMapper"),ih=(0,J.f3)("sharedbProjectSyncService"),rh=(0,J.f3)("uidlToProjectMapper"),sh=(0,J.f3)("fontsInProjectFlow"),ah=(0,J.f3)("notificationsManagementFlow"),lh=(0,J.f3)("htmlToDomainFlow"),ch=(0,J.f3)("navbarFlow"),dh=(0,J.f3)("rtcFlow"),ph=(0,J.f3)("projectManagementFlow"),uh=(0,J.f3)("componentCodeGenerationFlow"),hh=(0,J.f3)("assetsService"),mh=(0,J.f3)("modalManagementFlow"),gh=(0,q.G)(te.l.PASTE_UIDL),qu((fh=class{constructor(){(0,z.Z)(this,"projectDoc",bh,this),(0,z.Z)(this,"projectUIState",wh,this),(0,z.Z)(this,"nodeManagementFlow",vh,this),(0,z.Z)(this,"componentManagementFlow",Ih,this),(0,z.Z)(this,"uidlToComponentMapper",Sh,this),(0,z.Z)(this,"dbSync",jh,this),(0,z.Z)(this,"uidlToProjectMapper",Dh,this),(0,z.Z)(this,"fontsInProjectFlow",Oh,this),(0,z.Z)(this,"notificationsManagementFlow",Fh,this),(0,z.Z)(this,"htmlToDomainFlow",Th,this),(0,z.Z)(this,"navbarFlow",Nh,this),(0,z.Z)(this,"rtcFlow",Eh,this),(0,z.Z)(this,"projectManagementFlow",Ch,this),(0,z.Z)(this,"componentCodeGenerationFlow",xh,this),(0,z.Z)(this,"assetsService",Ph,this),(0,z.Z)(this,"modalManagementFlow",kh,this)}copyNodesById(e,t){(0,V.JG)(this.projectUIState,(({userInteractions:o})=>{const n=[];for(const i of e){const e=this.projectDoc.nodes.byId[i];t&&null!==e&&void 0!==e&&e.compIdOfRootNode||e&&e.primitiveType!==dt.sO.SLOT&&n.push(e)}o.clipboard.cutNodesEnabled=!!t,o.clipboard.copiedNodes=n.length?n:null,o.clipboard.copiedUIDL=null}))}pasteCopiedNodes(e){var t;const{copiedNodes:o,cutNodesEnabled:n}=this.projectUIState.userInteractions.clipboard;if(!o)return;let i=this.projectDoc.nodes.byId[e],r=e,s=null;var a;i&&(o.some((e=>e.primitiveType&&!this.projectDoc.isNodeAcceptingChild(i,e)))||1===o.length&&o[0].id===e)&&(r=(null===(a=i)||void 0===a?void 0:a.parentOrSlotId)||e,s=this.projectDoc.nodes.getNextSibling(i),i=this.projectDoc.nodes.byId[r]);let l=this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(r).compInstanceId;(null===(t=i)||void 0===t?void 0:t.primitiveType)===dt.sO.SLOT&&(l=this.projectUIState.selection.compInstanceId||void 0),n?(this.nodeManagementFlow.moveNodesToTarget({nodes:o,targetId:r,nextSibling:s,targetCompInstanceId:l}),(0,V.JG)(this.projectUIState,(({userInteractions:e})=>{e.clipboard.copiedNodes=null,e.clipboard.cutNodesEnabled=!1}))):this.nodeManagementFlow.copyNodesToTarget({nodes:o,targetId:r,copyBefore:s,compInstanceId:l})}pasteOnMultipleNodes(e){const{copiedNodes:t,cutNodesEnabled:o}=this.projectUIState.userInteractions.clipboard;!t||o||e.some((e=>-1===t.findIndex((t=>t.id===e))))||this.nodeManagementFlow.duplicateNodesById({nodeIds:e})}pasteCopiedStyleToTargets(e){const t=this.projectUIState.userInteractions.clipboard.copiedNodes;!t||t.length>1||this.nodeManagementFlow.copyNodeStylesToTargets({source:t[0].id,targets:e})}pasteCopiedClassesStyleToTargets(e){const t=this.projectUIState.userInteractions.clipboard.copiedNodes;!t||t.length>1||this.nodeManagementFlow.copyNodeClassesStylesToTargets({source:t[0].id,targets:e})}replaceDependencyNamesAndClasses(e,t,o){try{for(const n of Object.values(e))if(n&&Array.isArray(n))for(const e of n)this.replaceDependencyNamesAndClasses(e,t,o);else if("object"===typeof n){if(n.hasOwnProperty("semanticType")&&t[n.semanticType]&&(n.semanticType=t[n.semanticType]),n.hasOwnProperty("referencedStyles")&&(null!==o&&void 0!==o&&o.classes||null!==o&&void 0!==o&&o.textStyles)&&Object.keys(n.referencedStyles).forEach((e=>{const t=n.referencedStyles[e].content.referenceId;o.classes[t]&&(n.referencedStyles[e].content.referenceId=o.classes[t]),o.textStyles[t]&&(n.referencedStyles[e].content.referenceId=o.textStyles[t])})),n.hasOwnProperty("referenceType")&&"token"===n.referenceType&&(-1!==n.id.indexOf("--dl-color")||-1!==n.id.indexOf("--dl-size")||-1!==n.id.indexOf("--dl-space")||-1!==n.id.indexOf("--dl-radius"))){const e=n.id;null!==o&&void 0!==o&&o.tokens[e]&&(n.id=o.tokens[e])}this.replaceDependencyNamesAndClasses(n,t,o)}}catch(n){}}async pasteCopiedUIDL(e){var t,o;const{doc:n,nodeId:i,elementUIDLs:r,componentUIDLs:s,designTokens:a,textStyles:l,classes:c,designLanguageMergeOptions:d,isConditionalRenderingEnabled:p,isTailwindEnabled:u,globals:h,rawUIDL:m}=e;if(!n)return;this.notificationsManagementFlow.createNotification(K.k.INFO,"Pasting the content of your clipboard...");const g=!this.projectDoc.settings.experimentalFeatures&&u||this.projectDoc.settings.experimentalFeatures&&!this.projectDoc.settings.experimentalFeatures.tailwindCSS&&u,y=!this.projectDoc.settings.experimentalFeatures&&p||this.projectDoc.settings.experimentalFeatures&&!this.projectDoc.settings.experimentalFeatures.conditionalRendering&&p;if(g||y){const e={experimentalFeatures:{conditionalRendering:p,tailwindCSS:u}},t=Jh(Jh({},this.projectDoc.settings),e);this.projectManagementFlow.updateSettings(t),this.notificationsManagementFlow.createNotification(K.k.INFO,`The following experimental features have been activated: ${g?y?"Tailwind CSS, ":"TailwindCSS":""} ${y?"Conditional Rendering":""}`)}const f=this.uidlToProjectMapper.solveDesignLanguageConflicts(n,c,a,l,h,d);this.uidlToProjectMapper.addFontsUsedInTokens(n);const b=this.componentManagementFlow.computeTargetToAcceptElement(i).target;if(!b)return;if(!this.projectDoc.nodes.getComponentIdOf(b))return;const w={},v=Object.keys(s).reduce(((e,t)=>(Object.values(n.components.byId).some((e=>(null===e||void 0===e?void 0:e.title)===s[t].name))&&(w[s[t].name]=this.projectDoc.getUniqueCompOrPageName(s[t].name),s[t].name=this.projectDoc.getUniqueCompOrPageName(s[t].name)),e[t]=s[t],e)),{});Object.keys(v).map((e=>{this.replaceDependencyNamesAndClasses(v[e],w,f)}));const I=Object.keys(v).map((e=>({uidl:s[e],validateUIDL:!1}))),S=await this.uidlToComponentMapper.mapUIDLsToComponents({uidls:I,doc:n}),j=null===S||void 0===S?void 0:S.components,D=r.map((e=>({uidl:e}))),O=await this.uidlToComponentMapper.mapUIDLsToComponents({doc:n,uidls:D});if(!O)return;const F=(null===S||void 0===S?void 0:S.nodes)||[],T=[...(null===O||void 0===O?void 0:O.assets)||[],...(null===S||void 0===S?void 0:S.assets)||[]],{tokensInNodes:N,textStylesInNodes:E,classesInNodes:C,fontsInNodes:x,fontsToImport:P}=O;Object.keys((null===S||void 0===S?void 0:S.tokensInNodes)||{}).forEach((e=>{N[e]?N[e].push(...(null===S||void 0===S?void 0:S.tokensInNodes[e])||[]):N[e]=(null===S||void 0===S?void 0:S.tokensInNodes[e])||[]})),Object.keys((null===S||void 0===S?void 0:S.textStylesInNodes)||{}).forEach((e=>{E[e]?E[e].push(...(null===S||void 0===S?void 0:S.textStylesInNodes[e])||[]):E[e]=(null===S||void 0===S?void 0:S.textStylesInNodes[e])||[]})),Object.keys((null===S||void 0===S?void 0:S.classesInNodes)||{}).forEach((e=>{C[e]?C[e].push(...(null===S||void 0===S?void 0:S.classesInNodes[e])||[]):C[e]=(null===S||void 0===S?void 0:S.classesInNodes[e])||[]})),Object.keys((null===S||void 0===S?void 0:S.fontsInNodes)||{}).forEach((e=>{x[e]?x[e].push(...(null===S||void 0===S?void 0:S.fontsInNodes[e])||[]):x[e]=(null===S||void 0===S?void 0:S.fontsInNodes[e])||[]})),Object.keys((null===S||void 0===S?void 0:S.fontsToImport)||{}).forEach((e=>{P[e]=(null===S||void 0===S?void 0:S.fontsToImport[e])||""})),(0,V.JG)(this.projectUIState,(({userInteractions:e})=>{e.clipboard.copiedUIDL=null})),this.dbSync.mutate(this.projectDoc,(e=>{j.forEach((t=>{const o=e.addComponent({component:t,folderId:"components"});Object.values((null===S||void 0===S?void 0:S.propDefinitions[t.id])||{}).forEach((e=>{"rootClassName"===e.name&&(e.hidden=!0),null===o||void 0===o||o.createPropDefinition(Jh({},e))}))})),Object.keys(P).forEach((t=>{const o=this.fontsInProjectFlow.importGoogleFont({doc:e,fontName:P[t]}),n=Object.keys(this.projectDoc.fonts.byId).find((e=>this.projectDoc.fonts.byId[e].name===o));n&&(x[n]?x[n].push(t):x[n]=[t])})),F.forEach((t=>{t.primitiveType===dt.sO.COMPONENT&&(t.semanticType=null),e.addNode(t)})),T.forEach((t=>{e.assets.add(t);const o={[t.id]:"asset"};e.folders.addChildToFolder({child:o,folderId:t.parentFolderId})})),m&&(null===S||void 0===S||S.components.forEach((e=>{this.componentManagementFlow.addComponentToSelectedElementPageOrComp({compId:e.id})}))),O.components.forEach((e=>{const t=e.rootNodeId,o=O.nodes.find((e=>e.id===t));o&&(o.parentId=b)})),O.nodes.forEach((t=>{if(t.compIdOfRootNode=null,t.fakeSize=!1,e.nodes.nodeIsCompInstance(t)){const o=Object.keys(e.components.byId).find((o=>{var n;return(null===(n=e.components.byId[o])||void 0===n?void 0:n.title)===t.semanticType}));if(!o)throw new Error("Trying to add an instance of a nonexisting component!");t.compIdOfCompInstance=o;const n=e.components.byId[o];if(!n)return;n.instantiatedByNodes[t.id]=!0}O.components.find((e=>e.rootNodeId===t.id))?e.addNodesToParentOrStage({nodes:[t],parentId:b,nextSibling:void 0}):e.addNode(t)})),(0,Fi.cT)({doc:e,sectionIds:null===O||void 0===O?void 0:O.sectionIds}),(0,Fi.cT)({doc:e,sectionIds:null===S||void 0===S?void 0:S.sectionIds}),(0,Fi.ng)({doc:e,usedComponents:null===S||void 0===S?void 0:S.usedComponents}),S&&Object.keys(S.tailwindClasses).forEach((t=>{var o;const n=(null===(o=Object.values(S.tailwindClasses[t]))||void 0===o?void 0:o[0].split(" "))||[];e.tailwindCSS.addTailwindClassToNode(t,n)})),Object.keys(N).forEach((t=>{N[t].forEach((o=>{const n=e.designLanguage.tokensById[t].usedInNodes[o];e.designLanguage.tokensById[t].usedInNodes[o]=n?n+1:1}))})),Object.keys(E).forEach((t=>{E[t].forEach((o=>{e.designLanguage.textStyleSetsById[t].usedInNodes[o]=!0}))})),Object.keys(C).forEach((t=>{C[t].forEach((o=>{e.classes.byId[t].usedInNodes[o]=!0}))})),Object.keys(x).forEach((t=>{x[t].forEach((o=>{const n=e.fonts.byId[t].usedInNodes[o];e.fonts.byId[t].usedInNodes[o]=n?n+1:1}))}))})),(0,V.JG)(this.projectUIState,(e=>{j.forEach((t=>{if(!t)return;const{stateDefinitions:o,id:n,instantiatedByNodes:i}=t,r=Object.keys(o).reduce(((t,r)=>{var s,a,l,c;return t[r]={id:r,type:o[r].type,value:o[r].defaultValue,name:o[r].name,meta:{highlightInTreeView:!(null===(s=e.componentList.stateValues)||void 0===s||null===(a=s[n])||void 0===a||null===(l=a[r])||void 0===l||null===(c=l.meta)||void 0===c||!c.highlightInTreeView)},componentInstanceValues:Object.keys(i).reduce(((e,t)=>(e[t]=o[r].defaultValue,e)),{})},t}),{});e.componentList.stateValues[n]=Jh(Jh({},e.componentList.stateValues[n]),r)}))})),this.rtcFlow.notifySelectedComp(null===(t=j[j.length-1])||void 0===t?void 0:t.id),this.navbarFlow.selectOrCreateTabByEntityId(null===(o=j[j.length-1])||void 0===o?void 0:o.id)}async pasteFromExternalCopyEvent(){const e=Object.keys(this.projectUIState.hoveredNodes.nodes)||Object.keys(this.projectUIState.selection.nodes);if("denied"===(await navigator.permissions.query({name:"clipboard-read"})).state)return;const t=await navigator.clipboard.read();this.clearCopiedNodes();const o=t[0];if(!o)return;const n=o.types[1]||o.types[0];if("image/png"===n){ee.Z.mixpanelEvent(ee.Z.AnalyticsEvents.PROJECT_CANVAS_PASTE,{type:"image/png"});const t=await o.getType(n),i=new FileReader;let r="";return i.onload=t=>{var o;r=null===(o=t.target)||void 0===o?void 0:o.result,this.pasteCopiedUIDL({nodeId:e[0],elementUIDLs:[(0,Rh.h)("",r)],componentUIDLs:{},designTokens:{},textStyles:{},globals:{settings:{title:"pastedImage",language:"none"},meta:[],assets:[]}})},void i.readAsDataURL(t)}if("text/plain"!==n);else{const t=await o.getType(n),r=await t.text();try{const t=new Zh.Z,o=JSON.parse(r,((e,t)=>{if(null!==t)return t})),n=t.validateComponentSchema(o),{componentUIDL:s,valid:a}=n,l=Uh.parseComponentJSON(s),c=(new Mh.Z).resolveUIDL(l,{});if(a&&c)try{this.notificationsManagementFlow.createNotification(K.k.INFO,"Pasting the content of your clipboard...");let t=0;if(null!==l&&void 0!==l&&l.stateDefinitions)throw new Error("UIDL with statedefinitions is not yet supported");Ah.rc(l.node,(e=>{const{type:o}=e;if("conditional"===o)throw new Error("Conditional nodes are not supported");"comp-style"!==e.type&&Ah.KO(e,(e=>{var o;const{elementType:n,style:i,attrs:r,referencedStyles:s}=e;if(Object.values(i||{}).forEach((e=>{if("dynamic"===e.type)throw new Error("dynamic style is not yet supported")})),Object.values(s||{}).forEach((e=>{"inlined"===e.content.mapType&&Object.values(e.content.styles||{}).forEach((e=>{if("dynamic"===e.type)throw new Error("dynamic style is not yet supported")}))})),"conditional"===n)throw new Error("conditional node in UIDL is not yet supported");if("repeat"===n)throw new Error("reapeat node in UIDL is not yet supported");if("slot"===n){if(t>1)throw new Error("we dont support more than 1 slot node per UIDL component");t+=1}if("component"===n)throw new Error("components in stand alone UIDL is not yet supported");if("import"===(null===r||void 0===r||null===(o=r.referenceType)||void 0===o?void 0:o.type))throw new Error("reference type import is not yet supported for attrs");var a;if("text"===n&&1!==(null===(a=e.children)||void 0===a?void 0:a.length))throw new Error("we only support UIDL text nodes having one exact child")}))})),this.pasteCopiedUIDL({nodeId:e[0],elementUIDLs:[],componentUIDLs:{resolvedUIDL:c},designTokens:{},textStyles:{},globals:{settings:{title:"uidlpaste",language:"none"},meta:[],assets:[]},rawUIDL:!0})}catch(i){this.notificationsManagementFlow.createNotification(K.k.INFO,"Couldn't import the content of your clipboard... "+i)}return}catch{if(_h()(r)){ee.Z.mixpanelEvent(ee.Z.AnalyticsEvents.PROJECT_CANVAS_PASTE,{type:"svg"});const t=r.split("height")[1].split('"')[1],o=r.split("width")[1].split('"')[1],n=window.btoa(r);return void this.pasteCopiedUIDL({nodeId:e[0],elementUIDLs:[(0,Rh.h)("data:image/svg+xml;base64,",n,parseInt(o),parseInt(t))],componentUIDLs:{},designTokens:{},textStyles:{},globals:{settings:{title:"pastedImage",language:"none"},meta:[],assets:[]}})}if((0,is.F)(r))return ee.Z.mixpanelEvent(ee.Z.AnalyticsEvents.PROJECT_CANVAS_PASTE,{type:"HTML"}),void this.htmlToDomainFlow.openEditor(r);const t=JSON.parse(r);if(Array.isArray(t.componentUIDLs)){Object.keys(t.components).length?ee.Z.mixpanelEvent(ee.Z.AnalyticsEvents.PROJECT_CANVAS_PASTE,{type:"component"}):ee.Z.mixpanelEvent(ee.Z.AnalyticsEvents.PROJECT_CANVAS_PASTE,{type:"figma"}),this.projectUIState.userInteractions.clipboard.copiedUIDL=t.componentUIDLs,t.hasImages&&this.notificationsManagementFlow.createNotification(K.k.INFO,"Import in progress...");const o=this.checkForDesignLanguageConflicts(t.usedClasses,t.usedDesignTokens,t.usedTextStyles);if(o&&(o.classes.length||o.textStyles.length||o.tokens.length)){const n=Jo.d.createCustomModal({Component:Gh.s,onSubmit:o=>{this.pasteCopiedUIDL({nodeId:e[0],elementUIDLs:t.componentUIDLs,componentUIDLs:t.components,designTokens:t.usedDesignTokens,textStyles:t.usedTextStyles,classes:t.usedClasses,designLanguageMergeOptions:o,isConditionalRenderingEnabled:t.isConditionalRenderingEnabled,isTailwindEnabled:t.isTailwindEnabled,globals:t.globals})},data:{conflicts:o}});this.modalManagementFlow.showModal(n)}else this.pasteCopiedUIDL({nodeId:e[0],elementUIDLs:t.componentUIDLs,componentUIDLs:t.components,designTokens:t.usedDesignTokens,textStyles:t.usedTextStyles,classes:t.usedClasses,isConditionalRenderingEnabled:t.isConditionalRenderingEnabled,isTailwindEnabled:t.isTailwindEnabled,globals:t.globals})}}}}clearCopiedNodes(){(0,V.JG)(this.projectUIState,(({userInteractions:e})=>{e.clipboard.copiedNodes=null}))}getDependecy(e,t){const o=this.projectDoc.getProjectPageOrComponent(e);if(o){if(o.usedComponents)for(const e in o.usedComponents)this.getDependecy(e,t);t.push(e)}}async getTokensClassesAndAssets(e){const t=this.projectDoc.classes.getAll(),o=this.projectDoc.assets.getAssetsUsedInProject(),n=await this.assetsService.createOptimisedAssets(o),i=[],r=[],s=[],a=async e=>{try{for(const o of Object.values(e))if(o&&Array.isArray(o))for(const e of o)await a(e);else if("object"===typeof o){if(!o.hasOwnProperty("referenceType")||"token"!==o.referenceType||-1===o.id.indexOf("--dl-color")&&-1===o.id.indexOf("--dl-size")&&-1===o.id.indexOf("--dl-space")&&-1===o.id.indexOf("--dl-radius")||i.push(o.id),o.hasOwnProperty("referencedStyles")&&Object.keys(o.referencedStyles).forEach((e=>{const n=o.referencedStyles[e].content.referenceId,a=t.find((e=>e.name===n));a&&!a.isDefault?(Object.keys(a.content).forEach((e=>{if("dynamic"===a.content[e].type){const t=a.content[e].content.id,o=this.projectDoc.designLanguage.tokensById[t],n=(0,$h.iR)(o,this.projectDoc.designLanguage.categoriesById);i.push(n)}})),s.push(n)):r.push(o.referencedStyles[e].content.referenceId)})),o.hasOwnProperty("src")&&"static"===o.src.type&&-1!==o.src.content.indexOf("/playground_assets")){const e=n.find((e=>`${Bh.Bq}/${encodeURIComponent(e.name)}`===o.src.content));if(e){const t=await this.assetsService.getAssetData(e,{skipDownload:!1}),n=null===t||void 0===t?void 0:t.name.split(".")[(null===t||void 0===t?void 0:t.name.split(".").length)-1];o.src.content=`data:image/${n};base64,${null===t||void 0===t?void 0:t.content}`}}await a(o)}}catch(o){}};for(const l of Object.keys(e)){const t=e[l];if(await a(t),t.propDefinitions){const e=Object.keys(t.propDefinitions).reduce(((e,o)=>(-1===o.indexOf("rootClassName")&&t.propDefinitions&&(e[o]=t.propDefinitions[o]),e)),{});t.propDefinitions=e}t.node.content.referencedStyles={}}return{usedDesignTokensNames:i,usedTextStylesNames:r,usedClasses:s}}async copyComponentToClipboard(e){var t,o;const n={},i=[];this.getDependecy(e,i);for(const h of i){const e=this.projectDoc.getProjectPageOrComponent(h);e&&(n[h]=await this.componentCodeGenerationFlow.generateComponentUIDLcomponent(e,"UIDL"))}const{usedDesignTokensNames:r,usedTextStylesNames:s,usedClasses:a}=await this.getTokensClassesAndAssets(n),l=Object.values(this.projectDoc.designLanguage.textStyleSetsById||{}).reduce(((e,t)=>{const o=(0,ft.hN)(t.name);return-1!==s.indexOf(o)&&(e[o]=t.toUIDL()),e}),{}),c=Object.values(this.projectDoc.designLanguage.getTokensAsCustomProperties()||{}).reduce(((e,t)=>{if(-1!==r.indexOf(t.name)){e[t.name]={type:"static",content:t.value}}return e}),{}),d=Object.entries(this.projectDoc.classes.toUIDL()||{}).reduce(((e,[t,o])=>(-1!==a.indexOf(t)&&(e[t]=o),e)),{}),p=null===(t=this.projectDoc.settings.experimentalFeatures)||void 0===t?void 0:t.conditionalRendering,u={hasImages:!1,componentUIDLs:[],components:n,usedDesignTokens:c,usedTextStyles:l,usedClasses:d,isTailwindEnabled:null===(o=this.projectDoc.settings.experimentalFeatures)||void 0===o?void 0:o.tailwindCSS,isConditionalRenderingEnabled:p,globals:{settings:{title:"exported component",language:"english"},meta:[],assets:[]}};zh()(JSON.stringify(u)).then((()=>{this.notificationsManagementFlow.createNotification(K.k.INFO,"Component successfully copied to clipboard!")}))}checkForDesignLanguageConflicts(e,t,o){if(!e)return;const n={classes:[],tokens:[],textStyles:[]},i=this.projectDoc.classes.toUIDL(),r=this.projectDoc.designLanguage.getTokensAsCustomProperties(),s=this.projectDoc.designLanguage.textStyleSetsById;return Object.keys(e).forEach((t=>{if(i[t]){const o=i[t],r=e[t];JSON.stringify(o)!==JSON.stringify(r)&&n.classes.push(t)}})),Object.values(r).forEach((e=>{t[e.name]&&t[e.name].content!==e.value&&n.tokens.push(e.name)})),Object.values(s).forEach((e=>{const t=(0,ft.hN)(e.name);o[t]&&JSON.stringify(e.toUIDL())!==JSON.stringify(o[t])&&n.textStyles.push(t)})),n}},bh=(0,G.Z)(fh.prototype,"projectDoc",[Qu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wh=(0,G.Z)(fh.prototype,"projectUIState",[eh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vh=(0,G.Z)(fh.prototype,"nodeManagementFlow",[th],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ih=(0,G.Z)(fh.prototype,"componentManagementFlow",[oh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sh=(0,G.Z)(fh.prototype,"uidlToComponentMapper",[nh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jh=(0,G.Z)(fh.prototype,"dbSync",[ih],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dh=(0,G.Z)(fh.prototype,"uidlToProjectMapper",[rh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Oh=(0,G.Z)(fh.prototype,"fontsInProjectFlow",[sh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fh=(0,G.Z)(fh.prototype,"notificationsManagementFlow",[ah],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Th=(0,G.Z)(fh.prototype,"htmlToDomainFlow",[lh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nh=(0,G.Z)(fh.prototype,"navbarFlow",[ch],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Eh=(0,G.Z)(fh.prototype,"rtcFlow",[dh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ch=(0,G.Z)(fh.prototype,"projectManagementFlow",[ph],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xh=(0,G.Z)(fh.prototype,"componentCodeGenerationFlow",[uh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ph=(0,G.Z)(fh.prototype,"assetsService",[hh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kh=(0,G.Z)(fh.prototype,"modalManagementFlow",[mh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(fh.prototype,"pasteCopiedUIDL",[gh,Q.P],Object.getOwnPropertyDescriptor(fh.prototype,"pasteCopiedUIDL"),fh.prototype),yh=fh));var Wh,Kh,Yh,Xh,qh,Qh,em,tm,om,nm,im,rm,sm,am,lm,cm,dm,pm,um,hm,mm,gm=o(3054),ym=o(65714),fm=o(92734);function bm(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function wm(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?bm(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):bm(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}Wh=(0,J.JJ)("mainInspectorFlow"),Kh=(0,J.f3)("projectUIState"),Yh=(0,J.f3)("projectDoc"),Xh=(0,J.f3)("sharedbProjectSyncService"),qh=(0,J.f3)("nodeStyleManagmentFlow"),Qh=(0,J.f3)("nodeRichTextFlow"),em=(0,J.f3)("fontsInProjectFlow"),tm=(0,J.f3)("assetsEditFlow"),om=(0,J.f3)("mediaQueryBreakpointManagementFlow"),nm=(0,J.f3)("positioningService"),Wh((rm=class{constructor(){(0,z.Z)(this,"projectUIState",sm,this),(0,z.Z)(this,"projectDoc",am,this),(0,z.Z)(this,"dbSync",lm,this),(0,z.Z)(this,"nodeStyleManagmentFlow",cm,this),(0,z.Z)(this,"nodeRichTextFlow",dm,this),(0,z.Z)(this,"fontsInProjectFlow",pm,this),(0,z.Z)(this,"assetsEditFlow",um,this),(0,z.Z)(this,"mediaQueryBreakpointManagementFlow",hm,this),(0,z.Z)(this,"positioningService",mm,this),(0,$.Z)(this,"handleMultipleActions",(e=>{this.dbSync.mutate(this.projectDoc,(t=>{e(t)}))})),(0,$.Z)(this,"handleChangeInteractionState",((e,t)=>{(0,V.JG)(this.projectUIState,(o=>{o.stage.setInteractionState(e,t)}))})),(0,$.Z)(this,"renderSectionForSelectedNodes",(e=>{const{selection:t,staticNodeInterationsData:o}=this.projectUIState,n=Object.keys(t.nodes||{});if(o.selectionStyles||o.activeSelection)return fm.mX.includes(e);const i={};return n.forEach((e=>{const t=this.projectDoc.nodes.byId[e],o=null===t||void 0===t?void 0:t.primitiveType;o&&!i[o]&&(i[o]=fm.i2[o]||[])})),(0,mt.V3)(Object.values(i)).includes(e)})),(0,$.Z)(this,"getSelectorsListForProperties",((e,t)=>{var o;const n=t||Object.keys(this.projectUIState.selection.nodes)[0],i=this.projectDoc.nodes.byId[n];if(!i)return[];const r=[`nodes/byId/${n}/styles`,`nodes/byId/${n}/styles/*`,`nodes/byId/${n}/styles/*/disabled`,`nodes/byId/${n}/referencedStyles`,`nodes/byId/${n}/referencedStyles/*`,`nodes/byId/${n}/referencedStyles/*/content/*/disabled`,`classes/byId/*/usedInNodes/${n}`,"classes/byId/*/content","classes/byId/*/content/*","classes/byId/*/content/*/disabled","classes/byId/*/conditions","classes/byId/*/conditions/*","classes/byId/*/conditions/*/content/*","classes/byId/*/conditions/*/content/*/disabled","classes/byId/*/linkedTextStyles","classes/byId/*/linkedTextStyles/*"],s=null===(o=i.attrs[gt.Q])||void 0===o?void 0:o.content;return this.projectDoc.nodes.nodeIsCompInstance(i)&&"string"===typeof s&&r.push(`components/byId/${i.compIdOfCompInstance}/styleSetDefinitions/${s}/referencedStyles/*`),e.reduce(((e,t)=>(e.push(`nodes/byId/${n}/styles/${t}`,`nodes/byId/${n}/referencedStyles/*/content/styles/${t}`),this.projectDoc.nodes.nodeIsCompInstance(i)&&"string"===typeof s&&e.push(`components/byId/${i.compIdOfCompInstance}/styleSetDefinitions/${s}/styles/${t}`,`components/byId/${i.compIdOfCompInstance}/styleSetDefinitions/${s}/referencedStyles/*/content/styles/${t}`),e)),r)})),(0,$.Z)(this,"haveStylePropertiesChangedInPatches",((e,t)=>{for(const o of e){const{op:e,pathArray:n,value:i,old:r}=o;if("replace"===e&&4===n.length&&("styles"===n[3]||"referencedStyles"===n[3]))return!0;if("replace"===e&&(5===n.length&&t.includes(n[4])||8===n.length&&t.includes(n[7])))return!0;if(("add"===e||"remove"===e)&&5===n.length&&t.includes(n[4]))return!0;if(("add"===e||"remove"===e)&&8===n.length&&t.includes(n[7]))return!0;if("add"===e&&5===n.length&&"referencedStyles"===n[3]){if("inlined"===i.content.mapType&&t.includes(Object.keys(i.content.styles)[0]))return!0;if("design-language-referenced"===i.content.mapType||"project-referenced"===i.content.mapType)return!0}if("remove"===e&&5===n.length&&"referencedStyles"===n[3]){if(!i)return!0;if("inlined"===i.content.mapType&&t.includes(Object.keys(r.content.styles)[0]))return!0}if("components"===n[0]&&"styleSetDefinitions"===n[3])return!0;if("classes"===n[0]&&["usedInNodes","content","conditions","linkedTextStyles"].includes(n[3]))return!0;if(n.includes("disabled"))return!0}return!1})),(0,$.Z)(this,"getStatesOptionsForSelectedNodes",(e=>{const t=Object.keys(this.projectUIState.selection.nodes);return Object.keys(ct.F).filter((o=>!e.includes(o)&&(o===ct.F.checked?t.every((e=>{const t=this.projectDoc.nodes.byId[e];return(null===t||void 0===t?void 0:t.primitiveType)&&t.primitiveType!==dt.sO.DEV_COMPONENT&&[dt.sO.CHECKBOX,dt.sO.RADIOBUTTON].includes(t.primitiveType)})):o!==ct.F.disabled||t.every((e=>{var t;const o=this.projectDoc.nodes.byId[e];return(null===o||void 0===o?void 0:o.primitiveType)&&(null===(t=Bl.$F[o.primitiveType])||void 0===t?void 0:t.find((e=>"disabled"===e.name)))})))))})),(0,$.Z)(this,"getSelectedNodesParentStyle",(e=>{const t=this.projectUIState.selection.nodes;if(!t)return{};let o={};return Object.keys(t).forEach(((t,n)=>{const i=this.projectDoc.nodes.byId[t];if(!i||!i.parentId)return;const{styles:r,inheritedStyles:s,classesStyles:a}=this.nodeStyleManagmentFlow.getComputedStyleByKeyForCurrentBreakpoint(i.parentId,e,!0),l=wm(wm(wm({},s),a),r);if(0===n)o=l;else for(const e in l)r[e]!==o[e]&&(o[e]=dt.sO.MIXED)})),o})),(0,$.Z)(this,"setFocusedBgImgIndex",(e=>{this.projectUIState.userInteractions.focusedBgImgIndex!==e&&(0,V.JG)(this.projectUIState,(t=>{t.userInteractions.focusedBgImgIndex=e}))})),(0,$.Z)(this,"getOptionsNodesForSelectNode",(e=>{var t;const o=this.projectDoc.nodes.byId[e];if(!o||o.primitiveType!==dt.sO.SELECT)return[];const n=null===(t=this.projectDoc.nodes.byId[e])||void 0===t?void 0:t.childrenIds;if(!n)return[];const i=Object.keys(n).reduce(((e,t)=>{var o,n,i;const r=this.projectDoc.nodes.byId[t],s=r.contentChildren&&(null===(o=Object.values(r.contentChildren))||void 0===o?void 0:o[0]),a="static"===(null===s||void 0===s?void 0:s.type)?s.content.toString():"";return e[t]={id:r.id,value:"static"===(null===(n=r.attrs)||void 0===n||null===(i=n.value)||void 0===i?void 0:i.type)?r.attrs.value.content.toString():"",content:a,pos:r.pos},e}),{});return this.positioningService.orderEntities({entitiyCollection:i}).reduce(((e,t)=>(e.push(i[t]),e)),[])})),(0,$.Z)(this,"getSelectorsForSelectElement",(e=>{const t=this.projectDoc.nodes.byId[e];if(!t)return[];const o=[`nodes/byId/${e}/childrenIds/*`];return Object.keys(t.childrenIds).forEach((e=>{o.push(`nodes/byId/${e}/attrs`,`nodes/byId/${e}/attrs/value`,`nodes/byId/${e}/attrs/pos`,`nodes/byId/${e}/contentChildren/**`,`nodes/byId/${e}/contentChildren`)})),o})),this.handleChangeProperty=this.handleChangeProperty.bind(this),this.handleRemoveProperty=this.handleRemoveProperty.bind(this)}handleChangeProperty(e){const{key:t,value:o,tokenId:n,doc:i,nodeIds:r,overrideInheritedValue:s,removeExistingValueForText:a}=e,l=r||Object.keys(this.projectUIState.selection.nodes||{}),c=1===l.length?this.nodeRichTextFlow.getTextComponentForNode(l[0]):null;if(null!==c&&void 0!==c&&c.handleFormatChange){const e={value:o};return n&&Object.assign(e,{tokenId:n}),void c.handleFormatChange({styles:{[t]:e}})}let{textElements:d,nonTextElements:p}=this.groupNodeIdsByPrimitiveType(l);if("fontFamily"===t&&(p=p.concat(d),d=[]),!o&&p.length){const o=this.checkDeleteOrOverrideValue({key:t,overrideInheritedValue:s,nodeIds:p});return null!==o&&void 0!==o&&o.action&&"delete"!==o.action?void("override"===(null===o||void 0===o?void 0:o.action)&&this.nodeStyleManagmentFlow.setStyleByKeyBasedOnCurrentBreakpoint(wm(wm({},e),{},{value:s,nodeIds:p}))):void this.handleRemoveProperty({doc:i,key:t,nodeIds:p})}if(o&&p.length){var u;const e=(null===(u=this.assetsEditFlow.getAssetBySrc(o.toString()))||void 0===u?void 0:u.id)||o;this.nodeStyleManagmentFlow.setStyleByKeyBasedOnCurrentBreakpoint({nodeIds:p,key:t,value:e,tokenId:n,doc:i})}d.length&&this.handleChangePropertyForTextElements(wm(wm({},e),{},{nodeIds:d,removeExistingValueForText:a}))}handleChangePropertyForTextElements(e){const{key:t,value:o,tokenId:n,doc:i,nodeIds:r,removeExistingValueForText:s}=e,a={value:o,mergeable:"textDecoration"===t};n&&(a.tokenId=n),o?this.nodeRichTextFlow.updateRootNodesFormat({doc:i,nodeIds:r,options:{styles:{[t]:a}},removeFormatIfExists:s}):this.nodeRichTextFlow.removeRootNodesConflictingFormats({doc:i,nodeIds:r,options:{styles:{[t]:a}}})}checkDeleteOrOverrideValue(e){const{key:t,overrideInheritedValue:o,nodeIds:n}=e,i=this.projectUIState.selection.nodes;if(!o)return{};const r=t.includes("margin")?"margin":t.includes("padding")?"padding":null,s=[t];r&&s.push(r);const a=this.getSectionStyleWithBreakpointForNodeIds(null!==n&&void 0!==n&&n.length?n:Object.keys(i),s);return Object.values(null===a||void 0===a?void 0:a.inheritedStyles).find((e=>e))?a.styles[t]===o?{action:"delete"}:{action:"override"}:{}}handleRemoveProperty(e){const{key:t,doc:o,nodeIds:n,basedOnBreakpoint:i=!0}=e,r=n||Object.keys(this.projectUIState.selection.nodes),s=1===r.length?this.nodeRichTextFlow.getTextComponentForNode(r[0]):null;s?s.removeFormatProperty(t):i?this.nodeStyleManagmentFlow.removeStyleByKeyBasedOnCurrentBreakpoint({nodeIds:r,key:t,doc:o}):this.nodeStyleManagmentFlow.removeStyleByKey({nodeIds:r,key:t,doc:o})}resetValuesToPreviousBreakpoint(e){this.handleMultipleActions((t=>{fm.vj[e].forEach((e=>{this.handleRemoveProperty({doc:t,key:e})}))}))}handleRemoveInteractionStateForSelectedNodes(e){const t=Object.keys(this.projectUIState.selection.nodes);(0,V.JG)(this.projectUIState,(t=>{t.stage.interactionState.state===e&&t.stage.setInteractionState(null)})),this.nodeStyleManagmentFlow.removeInteractionStateStyles({nodeIds:t,interactionState:e})}createStateInteractionForSelectedNodes(e){const t=Object.keys(this.projectUIState.selection.nodes);this.nodeStyleManagmentFlow.createInteractionState({nodeIds:t,interactionState:e})}getAllInteractionStatesForSelectedNodes(){const e=Object.keys(this.projectUIState.selection.nodes);return this.nodeStyleManagmentFlow.getAllInteractionStates(e)}getTokenOptionsForKey(e){const t=Object.values((0,gm.F)(Object.values(this.projectDoc.designLanguage.tokensById).map((e=>wm(wm({},e),{},{categoryName:this.projectDoc.designLanguage.categoriesById[e.categoryId].name}))))).flat();return(0,ym.Jw)(e,t)}getHeadingHighlightColor(e,t){const o=this.mediaQueryBreakpointManagementFlow.getCurrentMediaQuery();return t?Ki.z8.PURPLE:e&&e<=(null===o||void 0===o?void 0:o.maxWidth)?Ki.X4.DEFAULT:void 0}getSectionStyleWithBreakpointForSelectedNodes(e){const t=Object.keys(this.projectUIState.selection.nodes),o=this.projectUIState.staticNodeInterationsData.selectionStyles;return o||this.getSectionStyleWithBreakpointForNodeIds(t,e)}getSectionStyleWithBreakpointForNodeIds(e,t){let o,n,i={},r={},s={},a={},l=!1;return e.forEach(((e,c)=>{const d=this.nodeStyleManagmentFlow.getComputedStyleByKeyForCurrentBreakpoint(e,t,!0),{styles:p,classesStyles:u,inheritedClassesStyles:h,breakpointForStyles:m,interactionStateStyles:g,anyKeyHasValueOnBiggerMQ:y}=d;let{inheritedStyles:f}=d;const b=this.nodeStyleManagmentFlow.getDefaultStylesForNodeByType(e),w=this.nodeStyleManagmentFlow.getInheritedStylesBasedOnCurrentBreakpoint(e);if(!l&&y&&(l=y),f=wm(wm({},w),f),0===c)i=p,r=f,s=b,a=wm(wm({},h),u);else{for(const e of[...Object.keys(i),...Object.keys(p)])p[e]!==i[e]&&(i[e]=dt.sO.MIXED);for(const e of[...Object.keys(r),...Object.keys(f)])f[e]!==r[e]&&(r[e]=dt.sO.MIXED);for(const e of[...Object.keys(a),...Object.keys(u),...Object.keys(h)])(u[e]||h[e])!==a[e]&&(a[e]=dt.sO.MIXED);for(const e of[...Object.keys(s),...Object.keys(b)])b[e]!==s[e]&&(s[e]=dt.sO.MIXED)}o=m,n=g})),{styles:i,inheritedStyles:r,defaultStyles:s,breakpointForStyles:o,sectionHasInheritedValues:l,interactionStateStyles:n,classesStyles:a}}groupNodeIdsByPrimitiveType(e){return e.map((e=>this.projectDoc.nodes.byId[e])).reduce(((e,t)=>((null===t||void 0===t?void 0:t.primitiveType)&&(0,mt.xK)(t)?e.textElements.push(null===t||void 0===t?void 0:t.id):e.nonTextElements.push(null===t||void 0===t?void 0:t.id),e)),{textElements:[],nonTextElements:[]})}},sm=(0,G.Z)(rm.prototype,"projectUIState",[Kh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),am=(0,G.Z)(rm.prototype,"projectDoc",[Yh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lm=(0,G.Z)(rm.prototype,"dbSync",[Xh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cm=(0,G.Z)(rm.prototype,"nodeStyleManagmentFlow",[qh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dm=(0,G.Z)(rm.prototype,"nodeRichTextFlow",[Qh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pm=(0,G.Z)(rm.prototype,"fontsInProjectFlow",[em],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),um=(0,G.Z)(rm.prototype,"assetsEditFlow",[tm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hm=(0,G.Z)(rm.prototype,"mediaQueryBreakpointManagementFlow",[om],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mm=(0,G.Z)(rm.prototype,"positioningService",[nm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(rm.prototype,"handleChangeProperty",[Q.P],Object.getOwnPropertyDescriptor(rm.prototype,"handleChangeProperty"),rm.prototype),(0,G.Z)(rm.prototype,"handleChangePropertyForTextElements",[Q.P],Object.getOwnPropertyDescriptor(rm.prototype,"handleChangePropertyForTextElements"),rm.prototype),(0,G.Z)(rm.prototype,"handleRemoveProperty",[Q.P],Object.getOwnPropertyDescriptor(rm.prototype,"handleRemoveProperty"),rm.prototype),im=rm));var vm,Im,Sm,jm,Dm,Om,Fm,Tm,Nm,Em,Cm,xm,Pm;vm=(0,J.JJ)("temporaryStyleFlow"),Im=(0,J.f3)("projectDoc"),Sm=(0,J.f3)("nodeStyleManagmentFlow"),jm=(0,J.f3)("projectUIState"),Dm=(0,J.f3)("sharedbProjectSyncService"),Om=(0,J.f3)("mediaQueryBreakpointManagementFlow"),vm((Tm=class{constructor(){(0,z.Z)(this,"projectDoc",Nm,this),(0,z.Z)(this,"nodeStyleManagmentFlow",Em,this),(0,z.Z)(this,"projectUIState",Cm,this),(0,z.Z)(this,"dbSync",xm,this),(0,z.Z)(this,"mediaQueryBreakpointManagementFlow",Pm,this),(0,$.Z)(this,"getValuesFromTempStyle",(e=>{const t=this.projectUIState.selection.nodes;let o,n;return Object.keys(t).forEach(((t,i)=>{const{style:r,inheritedStyle:s}=this.getComputedTempStyleByKeyForCurrentBreakpoint(t,e);0===i?(o=r,n=s):(o!==r&&(o=dt.sO.MIXED),n!==s&&(n=dt.sO.MIXED))})),{style:o,inheritedStyle:n}})),(0,$.Z)(this,"getComputedTempStyleByKeyForCurrentBreakpoint",((e,t)=>{let o,n;const i=this.projectDoc.nodes.byId[e];if(!i)return{style:o,inheritedStyle:n};const r=this.nodeStyleManagmentFlow.resolveStaticAndDynamicNodes({styles:i.tempStyles}),s=this.mediaQueryBreakpointManagementFlow.getCurrentMediaQuery();if(s.isDefault)o=r[t];else{let e,a;i.getInlineMatchedStyleSetIds(s.maxWidth,!0).forEach((l=>{const c=i.tempInlineStyles[l];if(!e){const o=this.nodeStyleManagmentFlow.resolveStaticAndDynamicNodes({styles:c.content.styles})[t];o&&(e=o,a=c.content.conditions[0].maxWidth)}a===s.maxWidth?o=e||r[t]:n=e||r[t]})),!n&&r[t]&&(n=r[t])}return{style:o,inheritedStyle:n}})),(0,$.Z)(this,"getValueOrTokenIdFromStyle",(e=>{if(!e)return{value:""};if("static"===e.type)return{value:e.content};if("token"===e.content.referenceType)return{value:"",tokenId:e.content.id};throw new Error("Dynamic props not supported in temp styles")})),this.retrievePropertiesFromTempStyle=this.retrievePropertiesFromTempStyle.bind(this),this.movePropertiesToTempStyle=this.movePropertiesToTempStyle.bind(this)}retrievePropertiesFromTempStyle(e){const{properties:t,doc:o,nodeIds:n}=e;if(!o)return;const i=this.mediaQueryBreakpointManagementFlow.getCurrentMediaQuery();(n||Object.keys(this.projectUIState.selection.nodes)).forEach((e=>{const n=o.nodes.byId[e];if(!n)return;if(i.isDefault){for(const i of t){const{value:t,tokenId:r}=this.getValueOrTokenIdFromStyle(n.tempStyles[i]);t||r?this.nodeStyleManagmentFlow.setStyleByKey({doc:o,nodeIds:[e],key:i,value:t,tokenId:r}):this.nodeStyleManagmentFlow.removeStyleByKey({doc:o,nodeIds:[e],key:i}),delete n.tempStyles[i]}return}let r=this.getNodeStyleMap({nodeId:e,doc:o,matchedBreakpoint:i.maxWidth}),s=!1;r&&"inlined"===r.content.mapType||(r={type:"style-map",id:(0,lt.Z)(),content:{mapType:"inlined",conditions:[{conditionType:"screen-size",maxWidth:i.maxWidth}],styles:{}}},s=!0);const a=Object.values(n.tempInlineStyles).find((e=>e.content.conditions.find((e=>"screen-size"===e.conditionType&&e.maxWidth===i.maxWidth))));if(a){for(const n of t){const{value:t,tokenId:r}=this.getValueOrTokenIdFromStyle(null===a||void 0===a?void 0:a.content.styles[n]);t||r?this.nodeStyleManagmentFlow.setConditionalInlineStyleByKey({doc:o,nodeIds:[e],key:n,value:t,tokenId:r,condition:{conditionType:"screen-size",maxWidth:i.maxWidth}}):this.nodeStyleManagmentFlow.removeConditionalInlineStyleByKey({doc:o,nodeIds:[e],key:n,condition:{conditionType:"screen-size",maxWidth:i.maxWidth}}),a&&delete a.content.styles[n]}s&&Object.keys(r.content.styles).length&&n.primitiveType!==dt.sO.COMPONENT&&(n.referencedStyles[r.id]=r)}else for(const o of t)delete r.content.styles[o]}))}movePropertiesToTempStyle(e){const{properties:t,doc:o,nodeIds:n}=e;if(!o)return;const i=this.mediaQueryBreakpointManagementFlow.getCurrentMediaQuery();(n||Object.keys(this.projectUIState.selection.nodes)).forEach((e=>{const n=o.nodes.byId[e];if(!n)return;if(i.isDefault){for(const i of t){var r;const t=null===(r=this.getNodeStyles({nodeId:e,doc:o})[i])||void 0===r?void 0:r.clone();t&&(n.tempStyles[i]=t,this.nodeStyleManagmentFlow.removeStyleByKey({doc:o,nodeIds:[e],key:i}))}return}const s=this.getNodeStyleMap({nodeId:e,matchedBreakpoint:i.maxWidth,doc:o});if(!s||"inlined"!==s.content.mapType)return;let a=Object.values(n.tempInlineStyles).find((e=>e.content.conditions.find((e=>"screen-size"===e.conditionType&&e.maxWidth===i.maxWidth)))),l=!1;a||(a={type:"style-map",id:(0,lt.Z)(),content:{mapType:"inlined",conditions:[{conditionType:"screen-size",maxWidth:i.maxWidth}],styles:{}}},l=!0);for(const d of t){var c;const t=null===(c=s.content.styles[d])||void 0===c?void 0:c.clone();t?(a.content.styles[d]=t,this.nodeStyleManagmentFlow.removeConditionalInlineStyleByKey({doc:o,nodeIds:[e],key:d,condition:{conditionType:"screen-size",maxWidth:i.maxWidth}})):delete a.content.styles[d]}l&&Object.keys(a.content.styles).length&&(n.tempInlineStyles[a.id]=a)}))}getNodeStyleMap(e){const{nodeId:t,doc:o,matchedBreakpoint:n}=e;if(!o)return;const i=o.nodes.byId[t];if(!i)return;let r;if(o.nodes.nodeIsCompInstance(i)){var s,a;const e=null===(s=i.attrs[gt.Q])||void 0===s?void 0:s.content,t=o.components.byId[i.compIdOfCompInstance];r=Object.values((null===(a=t.styleSetDefinitions[e])||void 0===a?void 0:a.referencedStyles)||{}).find((e=>"inlined"===e.content.mapType&&e.content.conditions.find((e=>"screen-size"===e.conditionType&&e.maxWidth===n))))}else r=Object.values(i.referencedStyles).find((e=>"inlined"===e.content.mapType&&e.content.conditions.find((e=>"screen-size"===e.conditionType&&e.maxWidth===n))));return r}getNodeStyles(e){const{doc:t,nodeId:o}=e;let n={};if(!t)return n;const i=t.nodes.byId[o];if(!i)return n;if(n=i.styles,t.nodes.nodeIsCompInstance(i)){var r,s;const e=null===(r=i.attrs[gt.Q])||void 0===r?void 0:r.content;n=(null===(s=(null===t||void 0===t?void 0:t.components.byId[i.compIdOfCompInstance]).styleSetDefinitions[e])||void 0===s?void 0:s.styles)||n}return n}},Nm=(0,G.Z)(Tm.prototype,"projectDoc",[Im],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Em=(0,G.Z)(Tm.prototype,"nodeStyleManagmentFlow",[Sm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cm=(0,G.Z)(Tm.prototype,"projectUIState",[jm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xm=(0,G.Z)(Tm.prototype,"dbSync",[Dm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pm=(0,G.Z)(Tm.prototype,"mediaQueryBreakpointManagementFlow",[Om],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(Tm.prototype,"retrievePropertiesFromTempStyle",[Q.P],Object.getOwnPropertyDescriptor(Tm.prototype,"retrievePropertiesFromTempStyle"),Tm.prototype),(0,G.Z)(Tm.prototype,"movePropertiesToTempStyle",[Q.P],Object.getOwnPropertyDescriptor(Tm.prototype,"movePropertiesToTempStyle"),Tm.prototype),Fm=Tm));var km,Mm,Zm,Um,Am,Lm,_m,Rm,Bm,Hm,zm,$m,Gm,Vm,Jm,Wm=o(72579);function Km(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Ym(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Km(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Km(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}km=(0,J.JJ)("navbarFlow"),Mm=(0,J.f3)("projectDoc"),Zm=(0,J.f3)("projectUIState"),Um=(0,J.f3)("positioningService"),Am=(0,J.f3)("routerService"),Lm=(0,J.f3)("projectFilesFlow"),_m=(0,J.f3)("githubFlow"),km((Bm=class{constructor(){(0,z.Z)(this,"projectDoc",Hm,this),(0,z.Z)(this,"projectUIState",zm,this),(0,z.Z)(this,"positioningService",$m,this),(0,z.Z)(this,"routerService",Gm,this),(0,z.Z)(this,"projectFilesFlow",Vm,this),(0,z.Z)(this,"githubFlow",Jm,this),(0,$.Z)(this,"getCurrentTabs",(()=>this.projectUIState.layout.mainPanel===Y.iW.DEV?this.projectUIState.navbar.devModeTabs||{}:this.projectUIState.navbar.tabs)),(0,$.Z)(this,"getCurrentNewTabId",(()=>this.projectUIState.layout.mainPanel===Y.iW.DEV?this.projectUIState.navbar.newDevTabId:this.projectUIState.navbar.newTabId)),(0,$.Z)(this,"createStarterFileTab",(e=>{if(e===Qt.O2)return null;const t=this.positioningService.getHighestAvailablePosition({entitiyCollection:this.projectUIState.navbar.devModeTabs}),o={id:(0,lt.Z)(),entityId:e,type:"file",pos:t};return(0,V.JG)(this.projectUIState,(e=>{e.navbar.devModeTabs||(e.navbar.devModeTabs={}),e.navbar.devModeTabs[o.id]=o})),this.projectFilesFlow.setSelectedFile({path:e,fromTab:!0}),o.id})),(0,$.Z)(this,"renameFilesTab",((e,t)=>{const o=this.getTabByEntityId(e);o&&e!==t&&(0,V.JG)(this.projectUIState,(e=>{e.navbar.devModeTabs[o.id].entityId=t}))}))}getTabByEntityId(e){return Object.values(this.getCurrentTabs()||{}).find((t=>t.entityId===e))||null}deleteTab(e,t){if(this.getSelectedTab().id===e){var o,n;let i=(null===(o=this.getNextTab(e))||void 0===o?void 0:o.id)||(null===(n=this.getPreviousTab(e))||void 0===n?void 0:n.id)||"";this.projectUIState.layout.mainPanel===Y.iW.DEV?i?this.selectTab({tabId:i,routerReplace:t}):this.projectFilesFlow.setSelectedFile({path:Qt.O2,fromTab:!0}):(i||(i=this.createNewTab({entityId:this.projectDoc.pages.getHomePageId()||""})),this.selectTab({tabId:i,routerReplace:t}))}(0,V.JG)(this.projectUIState,(t=>{t.layout.mainPanel!==Y.iW.DEV?delete t.navbar.tabs[e]:delete t.navbar.devModeTabs[e]}))}deleteOtherTabs(e){(0,V.JG)(this.projectUIState,(t=>{t.layout.mainPanel!==Y.iW.DEV?Object.keys(Ym({},t.navbar.tabs)).forEach((o=>{o!==e&&delete t.navbar.tabs[o]})):Object.keys(Ym({},t.navbar.devModeTabs)).forEach((o=>{o!==e&&delete t.navbar.devModeTabs[o]}))})),this.selectTab({tabId:e})}deleteTabsToTheRight(e){const t=this.getTabIdsInOrder(),o=t.findIndex((t=>t===e)),n=this.getSelectedTab();let i=!1;(0,V.JG)(this.projectUIState,(e=>{for(let r=o+1;r<t.length;r++)i||t[r]!==n.id||(i=!0),e.layout.mainPanel===Y.iW.DEV?delete e.navbar.devModeTabs[t[r]]:delete e.navbar.tabs[t[r]]})),i&&this.selectTab({tabId:e})}deleteAllDevModeTabs(){(0,V.JG)(this.projectUIState,(e=>{Object.keys(Ym({},e.navbar.devModeTabs)).forEach((t=>{delete e.navbar.devModeTabs[t]}))})),this.projectFilesFlow.setSelectedFile({path:Qt.O2,fromTab:!0})}getTabIdsInOrder(){return this.positioningService.orderEntities({entitiyCollection:this.getCurrentTabs()})}getNextTab(e){const t=this.getCurrentTabs()[e];return this.positioningService.getNextEntity({entitiyCollection:this.getCurrentTabs(),entity:t})}getPreviousTab(e){const t=this.getCurrentTabs()[e];return this.positioningService.getPrevEntity({entitiyCollection:this.getCurrentTabs(),entity:t})}createNewTab(e){const{entityId:t,forceSave:o}=e,n=this.computeNavType(t);if(!n)return null;const i=o?void 0:this.getCurrentTabs()[this.getCurrentNewTabId()||""],r=e.pos||(null===i||void 0===i?void 0:i.pos)||this.positioningService.getHighestAvailablePosition({entitiyCollection:this.getCurrentTabs()}),s={id:(null===i||void 0===i?void 0:i.id)||(0,lt.Z)(),entityId:t,type:n,pos:r};return(0,V.JG)(this.projectUIState,(e=>{if(e.layout.mainPanel===Y.iW.DEV)return e.navbar.devModeTabs[s.id]=s,void(o||(e.navbar.newDevTabId=s.id));e.navbar.tabs[s.id]=s,o||(e.navbar.newTabId=s.id)})),s.id}saveNewTab(){(0,V.JG)(this.projectUIState,(e=>{e.layout.mainPanel!==Y.iW.DEV?e.navbar.newTabId&&delete e.navbar.newTabId:e.navbar.newDevTabId&&delete e.navbar.newDevTabId}))}moveTab(e,t){(0,V.JG)(this.projectUIState,(o=>{o.layout.mainPanel!==Y.iW.DEV?o.navbar.tabs[e].pos=t:o.navbar.devModeTabs[e].pos=t}))}selectTab(e){const{tabId:t,routerReplace:o}=e,n=this.getCurrentTabs()[t];n&&this.projectUIState.selection.componentId!==n.entityId&&this.projectUIState.devMode.selectedFile!==n.entityId&&(this.projectUIState.layout.mainPanel!==Y.iW.DEV?(this.setSelectedComponent(n.entityId),o?this.routerService.replace((0,qo.aZ)(this.projectUIState.slug,n.entityId)):this.routerService.push((0,qo.aZ)("[slug]","[compId]"),(0,qo.aZ)(this.projectUIState.slug,n.entityId))):this.projectFilesFlow.setSelectedFile({path:n.entityId,fromTab:!0,type:n.type}))}setSelectedComponent(e){(0,V.JG)(this.projectUIState,(t=>{t.previousSelectedPageOrCompId=t.selection.componentId,t.selection.componentId=e}))}getSelectedTab(){let e=this.projectUIState.selection.componentId||"";if(this.projectUIState.layout.mainPanel===Y.iW.DEV){var t,o;const n=this.projectUIState.devMode.selectedDiffingFile,i=this.projectUIState.devMode.selectedStagedFile,r=this.projectUIState.devMode.selectedCommitFile;e=n?`${n.path}-${n.status}`:i?`${i.path}${Qt.Wj}`:r?`${r.path}-${r.sha}${Qt.Vf}`:(null===(t=this.projectUIState)||void 0===t||null===(o=t.devMode)||void 0===o?void 0:o.selectedFile)||Qt.e3}return this.getTabByEntityId(e)||Object.values(this.getCurrentTabs())[0]}getLastTab(){const e=this.getTabIdsInOrder();return this.projectUIState.navbar.tabs[e[e.length-1]]||null}selectOrCreateTabByEntityId(e,t){if(e===Qt.O2)return;const o=this.getTabByEntityId(e),n=this.getCurrentNewTabId();if(o&&o.id===n)return(0,V.JG)(this.projectUIState,(t=>{(t.layout.mainPanel===Y.iW.DEV?t.navbar.devModeTabs[o.id]:t.navbar.tabs[o.id]).entityId=e})),void this.selectTab({tabId:o.id,routerReplace:t});if(!Object.keys(this.getCurrentTabs()||{}).length){const o=this.createNewTab({entityId:e,forceSave:!0});if(o)return void this.selectTab({tabId:o,routerReplace:t});setTimeout((()=>{this.selectTab({tabId:this.createNewTab({entityId:e,forceSave:!0})||"",routerReplace:t})}),500)}if(o&&this.getCurrentNewTabId()!==(null===o||void 0===o?void 0:o.id))return void this.selectTab({tabId:o.id,routerReplace:t});const i=this.createNewTab({entityId:e});i?this.selectTab({tabId:i,routerReplace:t}):setTimeout((()=>{this.selectTab({tabId:this.createNewTab({entityId:e})||"",routerReplace:t})}),500)}syncDevTabsAfterFileStage(e){var t;const{doc:o,file:n}=e;if(!o)return;if((null===(t=this.projectUIState.devMode.selectedDiffingFile)||void 0===t?void 0:t.path)===n){const e=this.getSelectedTab(),t=this.projectUIState.navbar.newDevTabId===e.id;return this.projectFilesFlow.setSelectedStagedFile({doc:o,fileId:n}),void(t||(0,V.JG)(this.projectUIState,(t=>{delete t.navbar.devModeTabs[e.id]})))}const i=this.projectUIState.navbar.devModeTabs;Object.keys(i).forEach((e=>{i[e].entityId===`${n}-${Wm.E.MODIFIED}`&&this.deleteTab(e)}))}syncDevTabsAfterUnstageFile(e,t){var o;if((null===(o=this.projectUIState.devMode.selectedStagedFile)||void 0===o?void 0:o.path)===e){const o=this.getSelectedTab(),n=this.projectUIState.navbar.newDevTabId===o.id;return this.projectFilesFlow.setSelectedDiffingFile(e,t),void(n||(0,V.JG)(this.projectUIState,(e=>{delete e.navbar.devModeTabs[o.id]})))}const n=this.projectUIState.navbar.devModeTabs;Object.keys(n).forEach((t=>{n[t].entityId===`${e}${Qt.Wj}`&&this.deleteTab(t)}))}computeNavType(e){const t=this.projectUIState.devMode.selectedBranch;if(this.projectDoc.pages.byId[e])return"page";if(this.projectDoc.components.byId[e])return"component";if(this.projectUIState.layout.mainPanel!==Y.iW.DEV)return null;if(e.endsWith(Qt.Wj))return"staged-file";const o=e.endsWith(`-${Wm.E.MODIFIED}`),n=e.endsWith(`-${Wm.E.NEW}`),i=e.endsWith(`-${Wm.E.REMOVED}`);if(o||n||i)return"git-file";if(e.endsWith(Qt.Vf))return"commited-file";return this.projectDoc.projectFiles.local[t].byId[e]?"file":null}},Hm=(0,G.Z)(Bm.prototype,"projectDoc",[Mm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zm=(0,G.Z)(Bm.prototype,"projectUIState",[Zm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$m=(0,G.Z)(Bm.prototype,"positioningService",[Um],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gm=(0,G.Z)(Bm.prototype,"routerService",[Am],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vm=(0,G.Z)(Bm.prototype,"projectFilesFlow",[Lm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jm=(0,G.Z)(Bm.prototype,"githubFlow",[_m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(Bm.prototype,"syncDevTabsAfterFileStage",[Q.P],Object.getOwnPropertyDescriptor(Bm.prototype,"syncDevTabsAfterFileStage"),Bm.prototype),Rm=Bm));o(88601),o(96319),o(54444);const Xm=e=>{const{onDismiss:t,tokens:o,categoryName:n}=e;return(0,gr.jsxs)("div",{className:"delete-token-modal",children:[(0,gr.jsx)(hr.J,{type:"error",size:32}),(0,gr.jsxs)("p",{className:"warning-message",children:["You are trying to delete the ",n," category that has the following tokens with specific roles in it."]}),(0,gr.jsx)("div",{className:"token-card-container",children:o.map((e=>(0,gr.jsxs)("div",{className:"token-card",children:[(0,gr.jsx)("div",{className:"color-token",style:{backgroundColor:`${e.value}`},children:e.role&&(0,gr.jsx)(hr.J,{type:e.role.replace("-color",""),color:(0,ft.lF)(e.value.toString()),size:32})}),(0,gr.jsx)("span",{children:e.role})]},e.id)))}),(0,gr.jsxs)("p",{className:"warning-message",children:["In order to delete the ",n," category please assign the previously mentioned roles to other tokens."]}),(0,gr.jsx)("div",{className:"modal-buttons",children:(0,gr.jsx)(ur.z,{style:"solid",colorScheme:"neutral",onClick:t,children:"Dismiss"})}),(0,gr.jsx)("style",{children:mr.mZ})]})},qm=e=>{const{onDismiss:t,token:o,categoryName:n,onSubmit:i}=e,r=Object.keys(o.usedInNodes).length;return(0,gr.jsxs)("div",{className:"delete-token-modal",children:[(0,gr.jsxs)("div",{className:"modal-title",children:["Delete ",n,"-",o.name]}),(0,gr.jsx)(hr.J,{type:"error",size:32}),(0,gr.jsx)("p",{className:"warning-message",children:"You are about to remove a token that is bound to nodes in the project. Doing this will unbind the token from all the nodes but they will retain the value found in the token as a static one."}),(0,gr.jsxs)("p",{className:"warning-message",children:[r," ",1===r?"node is":"nodes are"," bound to the token."]}),(0,gr.jsxs)("p",{className:"warning-message",children:["Are you sure you want to delete ",o.name," from the ",n," category?"]}),(0,gr.jsxs)("div",{className:"modal-buttons",children:[(0,gr.jsx)(ur.z,{style:"solid",colorScheme:"neutral",onClick:t,children:"Cancel"}),(0,gr.jsx)(ur.z,{style:"solid",colorScheme:"danger",onClick:i,children:"Delete"})]}),(0,gr.jsx)("style",{children:mr.mZ})]})};var Qm=o(72307),eg=o.n(Qm),tg=o(27789);const og=e=>{const{onDismiss:t,textStyle:o,onSubmit:n}=e,i=Object.keys(o.usedInNodes).length;return(0,gr.jsxs)("div",{className:"delete-token-modal",children:[(0,gr.jsxs)("div",{className:"modal-title",children:["Delete ",o.name]}),(0,gr.jsx)(hr.J,{type:"error",size:32}),(0,gr.jsx)("p",{className:"warning-message",children:"You are about to remove a text style that is bound to nodes in the project. Doing this will unbind the text style from all the nodes but they will retain the value found in the text style as a static one."}),(0,gr.jsxs)("p",{className:"warning-message",children:[i," ",1===i?"node is":"nodes are"," bound to the text style."]}),(0,gr.jsxs)("p",{className:"warning-message",children:["Are you sure you want to delete ",o.name,"?"]}),(0,gr.jsxs)("div",{className:"modal-buttons",children:[(0,gr.jsx)(ur.z,{style:"solid",colorScheme:"neutral",onClick:t,children:"Cancel"}),(0,gr.jsx)(ur.z,{style:"solid",colorScheme:"danger",onClick:n,children:"Delete"})]}),(0,gr.jsx)("style",{children:mr.mZ})]})};var ng,ig,rg,sg,ag,lg,cg,dg,pg,ug,hg,mg,gg,yg,fg,bg,wg,vg,Ig,Sg,jg,Dg,Og,Fg,Tg,Ng,Eg,Cg,xg,Pg,kg,Mg,Zg,Ug;function Ag(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}ng=(0,J.JJ)("designLanguageManagementFlow"),ig=(0,J.f3)("sharedbProjectSyncService"),rg=(0,J.f3)("projectDoc"),sg=(0,J.f3)("projectUIState"),ag=(0,J.f3)("nodeStyleManagmentFlow"),lg=(0,J.f3)("modalManagementFlow"),cg=(0,J.f3)("fontsInProjectFlow"),dg=(0,J.f3)("nodeRichTextFlow"),pg=(0,J.f3)("projectClassManagementFlow"),ug=(0,q.G)(te.l.CREATE_TOKEN_CATEGORY),hg=(0,q.G)(te.l.DUPLICATE_TOKEN_CATEGORY),mg=(0,q.G)(te.l.DELETE_TOKEN_CATEGORY),gg=(0,q.G)(te.l.DELETE_TOKEN_CATEGORY),yg=(0,q.G)(te.l.CREATE_TOKEN),fg=(0,q.G)(te.l.DUPLICATE_TOKEN),bg=(0,q.G)(te.l.DELETE_TOKEN),wg=(0,q.G)(te.l.DELETE_TOKEN),vg=(0,q.G)(te.l.CREATE_TEXT_STYLE),Ig=(0,q.G)(te.l.DUPLICATE_TEXT_STYLE),Sg=(0,q.G)(te.l.EDIT_TEXT_STYLE),jg=(0,q.G)(te.l.DELETE_TEXT_STYLE),Dg=(0,q.G)(te.l.DELETE_TEXT_STYLE),Og=(0,q.G)(te.l.OPEN_TOKEN_SIDE_PANEL),Fg=(0,q.G)(te.l.MOVE_CATEGORY_IN_DIRECTION),ng((Ng=class{constructor(){(0,z.Z)(this,"dbSync",Eg,this),(0,z.Z)(this,"projectDoc",Cg,this),(0,z.Z)(this,"projectUIState",xg,this),(0,z.Z)(this,"nodeStyleManagmentFlow",Pg,this),(0,z.Z)(this,"modalManagementFlow",kg,this),(0,z.Z)(this,"fontsInProjectFlow",Mg,this),(0,z.Z)(this,"nodeRichTextFlow",Zg,this),(0,z.Z)(this,"projectClassManagementFlow",Ug,this),(0,$.Z)(this,"getSelectedNodesTextStyles",(()=>{const e=Object.keys(this.projectUIState.selection.nodes),t=this.projectDoc.nodes.byId[e[0]];if(!t)return null;const o=1===e.length?this.nodeRichTextFlow.getTextComponentForNode(e[0]):null;if(null!==o&&void 0!==o&&o.getSelectionTextStyles)return o.getSelectionTextStyles();const n=(0,tg.hm)(t);return-1!==e.findIndex((e=>{const t=this.projectDoc.nodes.byId[e];return t?(0,tg.hm)(t)!==n:null}))?null:this.projectDoc.designLanguage.textStyleSetsById[n]})),(0,$.Z)(this,"closeSidePanel",(()=>{(0,V.JG)(this.projectUIState,(e=>{e.designLanguage.sidebarPanel=null}))})),(0,$.Z)(this,"calculateNewPosition",((e,t,o)=>{let n=0;return n="before"===e?0===o?(t[o].position-Number.MAX_SAFE_INTEGER)/2:(t[o].position+t[o-1].position)/2:o===t.length-1?t[o].position+Number.MAX_SAFE_INTEGER:(t[o].position+t[o+1].position)/2,n}))}createCategory(e,t){this.dbSync.mutate(this.projectDoc,(o=>{o.designLanguage.createCategory(e,t)}))}duplicateCategory(e){this.dbSync.mutate(this.projectDoc,(t=>{t.designLanguage.duplicateCategory(e)}))}startEditingCategoryName(e){e&&this.projectDoc.designLanguage.categoriesById[e]&&(0,V.JG)(this.projectUIState,(t=>{t.designLanguage.currentlyEditedCategoryName=this.projectDoc.designLanguage.categoriesById[e].name}))}editCategoryName(e,t){this.dbSync.mutate(this.projectDoc,(o=>{o.designLanguage.editCategoryName(e,t)})),(0,V.JG)(this.projectUIState,(e=>{e.designLanguage.currentlyEditedCategoryName=""}))}deleteCategory(e){if(!this.projectDoc.designLanguage.getTokensByCategoryId(e).length)return void this.dbSync.mutate(this.projectDoc,(t=>{t.designLanguage.deleteCategory(e)}));const t=this.projectDoc.designLanguage.getTokensByCategoryId(e).filter((e=>e.role));if(t.length){const o=Jo.d.createCustomModal({data:{tokens:t,categoryName:this.projectDoc.designLanguage.categoriesById[e].name},Component:Xm});return void this.modalManagementFlow.showModal(o)}const o=Jo.d.createDeleteModal({deletedEntity:"Color Category",onSubmit:()=>this.deleteCategoryAndUnbindNodesFromIt({categoryId:e})});this.modalManagementFlow.showModal(o)}deleteCategoryAndUnbindNodesFromIt(e){const{doc:t,categoryId:o}=e;if(!t)return;t.designLanguage.getTokensByCategoryId(o).forEach((e=>{const o=Object.keys(e.usedInNodes);o.length&&this.nodeStyleManagmentFlow.unbindTokenFromNodes({tokenId:e.id,nodeIds:o}),this.projectClassManagementFlow.unbindTokenFromClasses({doc:t,tokenId:e.id})})),t.designLanguage.deleteCategory(o)}createToken(e,t,o,n){this.dbSync.mutate(this.projectDoc,(i=>{i.designLanguage.createToken({name:e,value:t,categoryId:o,type:n})}))}duplicateToken(e){this.dbSync.mutate(this.projectDoc,(t=>{t.designLanguage.duplicateToken(e)}))}deleteTokenAndUnbind(e){const{doc:t,tokenId:o,nodeIds:n}=e;t&&(n&&this.nodeStyleManagmentFlow.unbindTokenFromNodes({tokenId:o,nodeIds:n}),this.projectClassManagementFlow.unbindTokenFromClasses({doc:t,tokenId:o}),t.designLanguage.deleteToken(o))}deleteTokenAndCheckBoundNodes(e){const t=this.projectDoc.designLanguage.tokensById[e],o=Object.keys(t.usedInNodes);if(o.length){const n=Jo.d.createCustomModal({data:{token:t,categoryName:this.projectDoc.designLanguage.categoriesById[t.categoryId].name},Component:qm,onSubmit:()=>{this.deleteTokenAndUnbind({tokenId:e,nodeIds:o}),this.modalManagementFlow.hideModal()}});this.modalManagementFlow.showModal(n)}else this.deleteTokenAndUnbind({tokenId:e})}editTokenValue(e,t){this.dbSync.mutate(this.projectDoc,(o=>{o.designLanguage.editTokenValue(e,t)}))}editTokenName(e,t){this.dbSync.mutate(this.projectDoc,(o=>{o.designLanguage.editTokenName(e,t)}))}switchBackgroundWithForegroundColors(){this.dbSync.mutate(this.projectDoc,(e=>{e.designLanguage.switchTokenRoles("background-color","foreground-color")}))}changeTokenRole(e,t){this.dbSync.mutate(this.projectDoc,(o=>{o.designLanguage.changeTokenRole(e,t)}))}createTextStyle(e){const{name:t,content:o,doc:n,nodeIds:i}=e;if(!n)return;const r={content:Object.keys(o||{}).reduce(((e,t)=>(e[t]=new ar.F({content:o[t]}),e)),{}),name:t,usedInNodes:{}},s=n.designLanguage.createTextStyle(r);s&&(o.fontFamily&&this.fontsInProjectFlow.addFont({doc:n,fontName:o.fontFamily,tokens:[s.id]}),i&&this.bindTextStyleToNodes({textStyleId:s.id,nodeIds:i}))}bindTextStyleToNodes(e){const{doc:t,textStyleId:o,nodeIds:n}=e;if(!t||!o)return;const i=t.designLanguage.textStyleSetsById[o];if(!i)return;this.nodeStyleManagmentFlow.bindTextStyleOnSelectedNodes({textStyleId:o,nodeIds:n});const r=Object.keys(i.content);this.nodeStyleManagmentFlow.removeMultipleStylesByKey({nodeIds:n,keys:r})}duplicateTextStyle(e){this.dbSync.mutate(this.projectDoc,(t=>{t.designLanguage.duplicateTextStyle(e)}))}unBindTextStyleFromNodes(e){const{textStyleId:t,nodeIds:o,doc:n}=e;if(!n)return;n.designLanguage.textStyleSetsById[t]&&this.nodeStyleManagmentFlow.unbindTextStyleFromNode({textStyleId:t,nodeIds:o})}editTextStyle(e){const{id:t,name:o,content:n,doc:i}=e;if(!i)return;const r=i.designLanguage.getFlatTextStyleContent(t),s=!eg()(e.content,r);let a;if(!s&&r||(a=Object.keys(n||{}).reduce(((e,t)=>(n[t]&&(e[t]=new ar.F({content:n[t]})),e)),{})),r&&a&&r.fontFamily!==a.fontFamily.content){const e=i.fonts.getFontIdByName(r.fontFamily);e&&delete i.fonts.byId[e.id].usedInTokens[t],this.fontsInProjectFlow.addFont({doc:i,fontName:a.fontFamily.content,tokens:[t]})}i.designLanguage.editTextStyle(function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Ag(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Ag(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({id:t,name:o},a&&s&&{content:a}))}deleteTextStyle(e){const t=this.projectDoc.designLanguage.textStyleSetsById[e];if(Object.keys(t.usedInNodes).length){const o=Jo.d.createCustomModal({data:{textStyle:t,textStyleName:this.projectDoc.designLanguage.textStyleSetsById[e].name},Component:og,onSubmit:()=>{this.deleteTextStyleAndUnbind({textStyleId:e}),this.modalManagementFlow.hideModal()}});this.modalManagementFlow.showModal(o)}else this.deleteTextStyleAndUnbind({textStyleId:e})}deleteTextStyleAndUnbind(e){const{doc:t,textStyleId:o}=e;if(!t)return;const n=t.designLanguage.textStyleSetsById[o],{content:i}=n;if(i.fontFamily){const e=t.fonts.getFontIdByName(i.fontFamily.content);var r;if(e)null===(r=t.fonts.byId[e.id])||void 0===r||delete r.usedInTokens[o]}const s=Object.keys(n.usedInNodes);s&&this.unBindTextStyleFromNodes({textStyleId:o,nodeIds:s}),this.projectClassManagementFlow.removeTextStyleReferenceFromAllClass({doc:t,textStyleId:o}),t.designLanguage.deleteTextStyle(o)}setTextStyleAsBodyDefault(e){this.dbSync.mutate(this.projectDoc,(t=>{t.designLanguage.setDefaultTextStyle(e)}))}openSidePanel(e,t){(0,V.JG)(this.projectUIState,(o=>{o.designLanguage.sidebarPanel={categoryId:e,tokenId:t}}))}changeTokenPosition(e){const{draggedTokenId:t,closestToDropTokenId:o,direction:n,doc:i}=e;if(!i)return;const r=i.designLanguage.tokensById[o];if(!r)return;const s=i.designLanguage.tokensById[t].categoryId,a=[...Object.values(i.designLanguage.tokensById)].filter((e=>e.categoryId===s)).sort(((e,t)=>e.position<t.position?-1:1)),l=a.indexOf(r),c=this.calculateNewPosition(n,a,l);i.designLanguage.changeTokenOrTextStylePosition(t,c)}changeTextStylePosition(e){const{draggedTokenId:t,closestToDropTokenId:o,direction:n,doc:i}=e;if(!i)return;const r=i.designLanguage.textStyleSetsById[o];if(!r)return;const s=i.designLanguage.textStyleSetsById[t].categoryId,a=[...Object.values(i.designLanguage.textStyleSetsById)].filter((e=>e.categoryId===s)).sort(((e,t)=>e.position<t.position?-1:1)),l=a.indexOf(r),c=this.calculateNewPosition(n,a,l);i.designLanguage.changeTokenOrTextStylePosition(t,c)}moveCategoryInDirection(e){const{direction:t,id:o,section:n,doc:i}=e;if(!i)return;const r=[...i.designLanguage.getCategoriesBySection(n).sort(((e,t)=>e.position<t.position?-1:1))],s=r.indexOf(i.designLanguage.categoriesById[o]);let a=0;switch(t){case"up":if(-1===s||0===s)return;a=this.calculateNewPosition("before",r,s-1);break;case"down":if(-1===s||s===r.length-1)return;a=this.calculateNewPosition("after",r,s+1)}i.designLanguage.changeCategoryPosition(o,a)}},Eg=(0,G.Z)(Ng.prototype,"dbSync",[ig],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cg=(0,G.Z)(Ng.prototype,"projectDoc",[rg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xg=(0,G.Z)(Ng.prototype,"projectUIState",[sg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pg=(0,G.Z)(Ng.prototype,"nodeStyleManagmentFlow",[ag],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kg=(0,G.Z)(Ng.prototype,"modalManagementFlow",[lg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mg=(0,G.Z)(Ng.prototype,"fontsInProjectFlow",[cg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zg=(0,G.Z)(Ng.prototype,"nodeRichTextFlow",[dg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ug=(0,G.Z)(Ng.prototype,"projectClassManagementFlow",[pg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(Ng.prototype,"createCategory",[ug],Object.getOwnPropertyDescriptor(Ng.prototype,"createCategory"),Ng.prototype),(0,G.Z)(Ng.prototype,"duplicateCategory",[hg],Object.getOwnPropertyDescriptor(Ng.prototype,"duplicateCategory"),Ng.prototype),(0,G.Z)(Ng.prototype,"deleteCategory",[mg],Object.getOwnPropertyDescriptor(Ng.prototype,"deleteCategory"),Ng.prototype),(0,G.Z)(Ng.prototype,"deleteCategoryAndUnbindNodesFromIt",[gg,Q.P],Object.getOwnPropertyDescriptor(Ng.prototype,"deleteCategoryAndUnbindNodesFromIt"),Ng.prototype),(0,G.Z)(Ng.prototype,"createToken",[yg],Object.getOwnPropertyDescriptor(Ng.prototype,"createToken"),Ng.prototype),(0,G.Z)(Ng.prototype,"duplicateToken",[fg],Object.getOwnPropertyDescriptor(Ng.prototype,"duplicateToken"),Ng.prototype),(0,G.Z)(Ng.prototype,"deleteTokenAndUnbind",[bg,Q.P],Object.getOwnPropertyDescriptor(Ng.prototype,"deleteTokenAndUnbind"),Ng.prototype),(0,G.Z)(Ng.prototype,"deleteTokenAndCheckBoundNodes",[wg],Object.getOwnPropertyDescriptor(Ng.prototype,"deleteTokenAndCheckBoundNodes"),Ng.prototype),(0,G.Z)(Ng.prototype,"createTextStyle",[vg,Q.P],Object.getOwnPropertyDescriptor(Ng.prototype,"createTextStyle"),Ng.prototype),(0,G.Z)(Ng.prototype,"bindTextStyleToNodes",[Q.P],Object.getOwnPropertyDescriptor(Ng.prototype,"bindTextStyleToNodes"),Ng.prototype),(0,G.Z)(Ng.prototype,"duplicateTextStyle",[Ig],Object.getOwnPropertyDescriptor(Ng.prototype,"duplicateTextStyle"),Ng.prototype),(0,G.Z)(Ng.prototype,"unBindTextStyleFromNodes",[Q.P],Object.getOwnPropertyDescriptor(Ng.prototype,"unBindTextStyleFromNodes"),Ng.prototype),(0,G.Z)(Ng.prototype,"editTextStyle",[Sg,Q.P],Object.getOwnPropertyDescriptor(Ng.prototype,"editTextStyle"),Ng.prototype),(0,G.Z)(Ng.prototype,"deleteTextStyle",[jg],Object.getOwnPropertyDescriptor(Ng.prototype,"deleteTextStyle"),Ng.prototype),(0,G.Z)(Ng.prototype,"deleteTextStyleAndUnbind",[Dg,Q.P],Object.getOwnPropertyDescriptor(Ng.prototype,"deleteTextStyleAndUnbind"),Ng.prototype),(0,G.Z)(Ng.prototype,"openSidePanel",[Og],Object.getOwnPropertyDescriptor(Ng.prototype,"openSidePanel"),Ng.prototype),(0,G.Z)(Ng.prototype,"changeTokenPosition",[Q.P],Object.getOwnPropertyDescriptor(Ng.prototype,"changeTokenPosition"),Ng.prototype),(0,G.Z)(Ng.prototype,"changeTextStylePosition",[Q.P],Object.getOwnPropertyDescriptor(Ng.prototype,"changeTextStylePosition"),Ng.prototype),(0,G.Z)(Ng.prototype,"moveCategoryInDirection",[Fg,Q.P],Object.getOwnPropertyDescriptor(Ng.prototype,"moveCategoryInDirection"),Ng.prototype),Tg=Ng));var Lg,_g,Rg,Bg,Hg;Lg=(0,J.JJ)("keyboardInteractionFlow"),_g=(0,J.f3)("projectUIState"),Lg((Bg=class{constructor(){(0,z.Z)(this,"projectUIState",Hg,this)}executeKeyDown(e){(0,V.JG)(this.projectUIState,(({userInteractions:t})=>{t.pressedKeys[e]=!0}))}executeKeyUp(e){(0,V.JG)(this.projectUIState,(({userInteractions:t})=>{delete t.pressedKeys[e]}))}},Hg=(0,G.Z)(Bg.prototype,"projectUIState",[_g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rg=Bg));o(95681);var zg,$g,Gg,Vg,Jg,Wg,Kg,Yg,Xg,qg,Qg,ey,ty,oy,ny,iy,ry,sy,ay,ly,cy,dy=o(12154),py=o(2318);zg=(0,J.JJ)("commandPaletteFlow"),$g=(0,J.f3)("projectDoc"),Gg=(0,J.f3)("projectUIState"),Vg=(0,J.f3)("componentManagementFlow"),Jg=(0,J.f3)("layoutManagementFlow"),Wg=(0,J.f3)("pageManagementFlow"),Kg=(0,J.f3)("projectDownloadFlow"),Yg=(0,J.f3)("notificationsManagementFlow"),Xg=(0,J.f3)("projectPublishFlow"),qg=(0,J.f3)("customCodeCommandsFlow"),zg((ey=class{constructor(){(0,z.Z)(this,"projectDoc",ty,this),(0,z.Z)(this,"projectUIState",oy,this),(0,z.Z)(this,"componentManagementFlow",ny,this),(0,z.Z)(this,"layoutManagementFlow",iy,this),(0,z.Z)(this,"pageManagementFlow",ry,this),(0,z.Z)(this,"projectDownloadFlow",sy,this),(0,z.Z)(this,"notificationsManagementFlow",ay,this),(0,z.Z)(this,"projectPublishFlow",ly,this),(0,z.Z)(this,"customCodeCommandsFlow",cy,this),(0,$.Z)(this,"handleCommand",(e=>{if(!e)return;this.triggerActionCommand(e)||(this.close(),this.componentManagementFlow.select(e))}))}open(e=!1){(0,V.JG)(this.projectUIState,(t=>{t.commandPalette.opened=!0,t.commandPalette.actionCommandActive=e}))}close(){(0,V.JG)(this.projectUIState,(e=>{e.commandPalette.actionCommandActive=!1,e.commandPalette.opened=!1}))}triggerActionCommand(e){switch(e){case dy.F.ADD_PAGE:return this.projectUIState.sidebarSettings.expanded.pages||this.layoutManagementFlow.toggleFolders(py.S.PAGES),this.pageManagementFlow.createEmptyPage(),!0;case dy.F.ADD_COMPONENT:return this.projectUIState.sidebarSettings.expanded.components||this.layoutManagementFlow.toggleFolders(py.S.COMPONENTS),this.componentManagementFlow.createEmptyComponent(),!0;case dy.F.PREVIEW_COMPONENT:{const e=this.projectUIState.selection.componentId,t=this.projectUIState.slug;return window.open((0,qo.zg)(t,e||""),"_blank"),!0}case dy.F.VIEW_CODE:return this.layoutManagementFlow.toggleCodeview(),!0;case dy.F.PROJECT_SETTINGS:{const e=this.projectUIState.slug;return Vo.default.push((0,qo.No)(e,"general")),!0}case dy.F.CONTINUE_ON_SANDBOX:{const e=this.projectUIState.userPreferences.projectType;return this.projectDownloadFlow.exportToCodesandbox(e),!0}case dy.F.CONTINUE_ON_GITHUB:{const e=this.projectUIState.tokens.githubToken,t=this.projectUIState.userPreferences.projectType;return e?(this.projectDownloadFlow.exportToGithub(t),!0):(this.notificationsManagementFlow.handleError("Github token is not set in project settings."),!0)}case dy.F.DOWNLOAD_REACT:return this.projectDownloadFlow.downloadZip(et.cd.REACT),!0;case dy.F.DOWNLOAD_ANGULAR:return this.projectDownloadFlow.downloadZip(et.cd.ANGULAR),!0;case dy.F.DOWNLOAD_VUE:return this.projectDownloadFlow.downloadZip(et.cd.VUE),!0;case dy.F.DOWNLOAD_PREACT:return this.projectDownloadFlow.downloadZip(et.cd.PREACT),!0;case dy.F.DOWNLOAD_GATSBY:return this.projectDownloadFlow.downloadZip(et.cd.GATSBY),!0;case dy.F.DOWNLOAD_NEXT:return this.projectDownloadFlow.downloadZip(et.cd.NEXT),!0;case dy.F.DOWNLOAD_NUXT:return this.projectDownloadFlow.downloadZip(et.cd.NUXT),!0;case dy.F.DOWNLOAD_GRIDSOME:return this.projectDownloadFlow.downloadZip(et.cd.GRIDSOME),!0;case dy.F.DOWNLOAD_STENCIL:return this.projectDownloadFlow.downloadZip(et.cd.STENCIL),!0;case dy.F.PUBLISH_PROJECT:return this.projectDoc.assets.getAssetsUsedInProject().reduce(((e,t)=>e+Number(t.size)),0)/1024/1024>10&&this.notificationsManagementFlow.createNotification(K.k.WARNING,X.N9.USED_ASSETS,{duration:15e3}),this.projectPublishFlow.publishToTeleport(!1),this.notificationsManagementFlow.createNotification(K.k.INFO,"Publish started. We will notify you when it's done."),!0;case dy.$.PRETTIER:return this.customCodeCommandsFlow.prettify(),!0;default:return!1}}},ty=(0,G.Z)(ey.prototype,"projectDoc",[$g],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oy=(0,G.Z)(ey.prototype,"projectUIState",[Gg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ny=(0,G.Z)(ey.prototype,"componentManagementFlow",[Vg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iy=(0,G.Z)(ey.prototype,"layoutManagementFlow",[Jg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ry=(0,G.Z)(ey.prototype,"pageManagementFlow",[Wg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sy=(0,G.Z)(ey.prototype,"projectDownloadFlow",[Kg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ay=(0,G.Z)(ey.prototype,"notificationsManagementFlow",[Yg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ly=(0,G.Z)(ey.prototype,"projectPublishFlow",[Xg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cy=(0,G.Z)(ey.prototype,"customCodeCommandsFlow",[qg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qg=ey));var uy,hy,my,gy,yy,fy,by,wy,vy,Iy,Sy,jy,Dy;uy=(0,J.JJ)("customCodeCommandsFlow"),hy=(0,J.f3)("projectUIState"),my=(0,J.f3)("workersProvider"),gy=(0,J.f3)("projectDoc"),yy=(0,J.f3)("notificationsManagementFlow"),fy=(0,J.f3)("yDocumentManagementFlow"),uy((wy=class{constructor(){(0,z.Z)(this,"projectUIState",vy,this),(0,z.Z)(this,"workersProvider",Iy,this),(0,z.Z)(this,"projectDoc",Sy,this),(0,z.Z)(this,"notificationsManagementFlow",jy,this),(0,z.Z)(this,"yDocumentManagementFlow",Dy,this)}async prettify(){const{selectedFile:e}=this.projectUIState.devMode;if(!e)return;const t=this.yDocumentManagementFlow.getText(e);t&&this.workersProvider.prettify(t.toString(),e,(async t=>{await this.yDocumentManagementFlow.replaceText(e,t)}),(()=>{this.notificationsManagementFlow.createNotification(K.k.ERROR,"Failed to run prettier, please check the syntax.")}))}},vy=(0,G.Z)(wy.prototype,"projectUIState",[hy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Iy=(0,G.Z)(wy.prototype,"workersProvider",[my],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sy=(0,G.Z)(wy.prototype,"projectDoc",[gy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jy=(0,G.Z)(wy.prototype,"notificationsManagementFlow",[yy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dy=(0,G.Z)(wy.prototype,"yDocumentManagementFlow",[fy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),by=wy));o(16853);var Oy=o(94430);function Fy(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Ty(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Fy(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Fy(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const Ny=(e,t)=>{const{contentChildren:o={}}=e;return Object.keys(o).length?Object.keys(o).reduce(((e,n)=>{const i=o[n];if("static"===i.type)return e[n]=i,e;if("dynamic"===i.type&&t){const o=t(i);return e[n]=o,e}return e}),{}):{}},Ey=(e,t)=>{const{attrs:o={}}=e;return Object.keys(o).reduce(((e,n)=>{const i=o[n];if("static"===i.type||"comp-style"===i.type)return e[n]=i.content,e;if(!t)return e;const r=t(i);return r&&(e[n]=r.content),e}),{})},Cy=(e,t)=>{const{abilities:o={}}=e;return Object.keys(o).length?Object.keys(o).reduce(((e,n)=>{const i=o[n],{type:r,content:s}=i;switch(r){case pt.RZ.URL:const o=s,a=xy(o.url,t);e[n]={type:r,content:Ty(Ty({},o),{},{url:a})};break;case pt.RZ.MAIL:const l=s,c=xy(l.mail,t),d=l.body?xy(l.body,t):"",p=l.subject?xy(l.subject,t):"";e[n]={type:r,content:Ty(Ty({},l),{},{mail:c,body:d,subject:p})};break;case pt.RZ.PHONE:const u=s,h=xy(u.phone,t);e[n]={type:r,content:Ty(Ty({},u),{},{phone:h})};break;default:e[n]=i}return e}),{}):{}},xy=(e,t)=>{var o;return"string"===typeof e?e:"static"===e.type?e.content:null===(o=t(e))||void 0===o?void 0:o.content};var Py,ky,My,Zy,Uy,Ay,Ly,_y,Ry,By,Hy,zy,$y,Gy,Vy;function Jy(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Wy(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Jy(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Jy(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}Py=(0,J.JJ)("propDefinitionManagementFlow"),ky=(0,J.f3)("projectDoc"),My=(0,J.f3)("projectUIState"),Zy=(0,J.f3)("nodeAttributeManagmentFlow"),Uy=(0,J.f3)("nodeAbilityManagmentFlow"),Ay=(0,J.f3)("nodeEditingFlow"),Ly=(0,J.f3)("nodeEventManagmentFlow"),Py((Ry=class{constructor(){(0,z.Z)(this,"projectDoc",By,this),(0,z.Z)(this,"projectUIState",Hy,this),(0,z.Z)(this,"nodeAttributeManagmentFlow",zy,this),(0,z.Z)(this,"nodeAbilityManagmentFlow",$y,this),(0,z.Z)(this,"nodeEditingFlow",Gy,this),(0,z.Z)(this,"nodeEventManagmentFlow",Vy,this),(0,$.Z)(this,"getResolvedNodeData",((e,t)=>{const o=this.generateDynamicResolver(e.id,t);return Wy(Wy({},e),{},{attrs:Ey(e,o),abilities:Cy(e,o),contentChildren:Ny(e,o)})})),(0,$.Z)(this,"generateDynamicResolver",((e,t)=>o=>this.resolveDynamicValue(o,"root"!==e?e:void 0,"root"!==t?t:void 0))),(0,$.Z)(this,"resolveDynamicValue",((e,t,o)=>{if(!e||!e.content)return null;const{id:n,referenceType:i}=e.content;if("prop"!==i)throw new Error(`Unsupported dynamic prop type: ${i}`);const r=this.getNodeComponentPropDefinitions(t);if(!r)throw new Error("Prop definitions not found in the parent component");const s=r[n];if(!s)throw new Error(`Assigned a dynamic prop "${n}" in a component that does not hold that prop definition.`);let a=s.defaultValue;if(o){const e=this.projectDoc.nodes.byId[o];if(!e)throw new Error(`Attempted to render a dynamic prop and the root node was not found: ${o}`);const t=e.attrs[s.name];if(t){if("static"!==t.type)throw new Error(`The value that was set on key ${s.name} was not a static value. This means we have a dynamic value being set as the attrs of another dynamic value. This case is not supported yet and might require a re-write of the rendering system.`);a=t.content}}return new ar.F({content:a})}))}getPropDefForDynamicNode(e,t){var o;const n=this.projectDoc.getComponentIdForNode(e.id);if(!n)return;const i=null===(o=this.projectDoc.components.byId[n])||void 0===o?void 0:o.propDefinitions;if(!i)return;return i[t.content.id]}updatePropDefinition(e){const{doc:t,propId:o,propData:n}=e;if(!t)return;const i=e.compId||this.projectUIState.selection.componentId;if(!i)throw new Error("Component id not found");const r=t.components.byId[i];if(!r)throw new Error("Component not found while trying to update prop definition");const{name:s}=n,a=r.propDefinitions[o];if(s&&(Object.keys(r.instantiatedByNodes).forEach((e=>{const o=t.nodes.byId[e];if(!o)return;const n=o.attrs[a.name];n&&("comp-style"===n.type?o.attrs[s]=new Oy.j(n.content):o.attrs[s]=n.clone(),delete o.attrs[a.name])})),"func"===a.type)){Object.keys(a.locations).map((e=>Object.values(a.locations[e]).map((t=>({nodeId:e,supportedEvent:t.sufix}))))).flat().forEach((({nodeId:e,supportedEvent:n})=>{const i=t.nodes.byId[e];i&&Object.values(i.events[n]).forEach((e=>{const t="propCall"===e.type;e.id===o&&t&&(e.calls=s)}))}))}if(n.defaultValue){const e=t.assets.byId[a.defaultValue],o=t.assets.byId[n.defaultValue];if((null===e||void 0===e?void 0:e.id)!==(null===o||void 0===o?void 0:o.id)){Object.keys(a.locations).forEach((t=>{null===e||void 0===e||e.removeNodeRelation(t)}));const t=n.locations||a.locations;Object.keys(t).forEach((e=>{null===o||void 0===o||o.createNodeRelation(e)}))}}r.updatePropDefinition(o,n)}addPropLocationForNode(e){const{doc:t,nodeId:o,propId:n,location:i}=e;if(!t)return;const r=this.projectUIState.selection.componentId;if(!r)throw new Error("No selected component");const s=t.components.byId[r];if(!s)throw new Error("Component not found while trying to update prop definition");s.addLocationToPropDefinition(n,o,i)}removePropLocationForNode(e){const{doc:t,nodeId:o,propId:n,location:i,unlink:r}=e;if(!t)return;const s=this.projectUIState.selection.componentId;if(!s)throw new Error("No selected component");const a=t.components.byId[s];if(!a)throw new Error("Component not found while trying to update prop definition");a.propDefinitions[n].locations[o]&&a.removeLocationFromPropDefinition(n,o,i,r)}removePropDefinition(e){const{locations:t,unlink:o,affectedNodes:n,propId:i,doc:r}=e;if(!r)return;const s=this.projectUIState.selection.componentId;if(!s)throw new Error("No selected component");const a=r.components.byId[s];if(!a)throw new Error("Component not found while trying to update prop definition");const l=a.propDefinitions[i].defaultValue,c=a.propDefinitions[i].name;null!==t&&void 0!==t&&t.length&&this.handleUnlinkProp({locations:t,unlink:o,affectedNodes:n,defaultPropValue:l,propName:c,doc:r}),a.removePropDefinitionFromComp(i)}handleUnlinkProp(e){const{doc:t,locations:o,unlink:n,defaultPropValue:i,propName:r,propId:s}=e;let{affectedNodes:a}=e;a||(a=Object.keys(this.projectUIState.selection.nodes)),o.map(((e,o)=>{switch(e.base){case jl.hD.ATTR:a&&this.nodeAttributeManagmentFlow.removeAttrByKey({nodeId:a[o],key:e.sufix||"",unlink:n,defaultPropValue:i,doc:t});break;case jl.hD.ABILITY:a&&this.nodeAbilityManagmentFlow.removeNodeLink({nodeId:a[o],linkLocations:[e.sufix||""],removeOnlyProp:!0,unlink:n,defaultPropValue:i,doc:t});break;case jl.hD.CONTENT:a&&(this.nodeEditingFlow.replaceDynamicContentWithPropDefaultValue({nodeId:a[o],defaultPropValue:i,doc:t}),n&&s&&this.removePropLocationForNode({nodeId:a[o],propId:s,location:e,unlink:n}));break;case jl.hD.EVENT:a&&e.sufix&&this.nodeEventManagmentFlow.removeAllEventsByType({nodeIds:a,supportedEvent:e.sufix,propName:r,doc:t});break;default:return}}))}getNodeComponentPropDefinitions(e){if(!e){const e=this.projectUIState.selection.componentId;if(!e)return null;const t=this.projectDoc.components.byId[e];return t?t.propDefinitions:null}const t=this.projectDoc.nodes.getComponentIdOf(e);if(!t)return null;const o=this.projectDoc.components.byId[t];return o?o.propDefinitions:null}},By=(0,G.Z)(Ry.prototype,"projectDoc",[ky],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hy=(0,G.Z)(Ry.prototype,"projectUIState",[My],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zy=(0,G.Z)(Ry.prototype,"nodeAttributeManagmentFlow",[Zy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$y=(0,G.Z)(Ry.prototype,"nodeAbilityManagmentFlow",[Uy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gy=(0,G.Z)(Ry.prototype,"nodeEditingFlow",[Ay],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vy=(0,G.Z)(Ry.prototype,"nodeEventManagmentFlow",[Ly],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(Ry.prototype,"updatePropDefinition",[Q.P],Object.getOwnPropertyDescriptor(Ry.prototype,"updatePropDefinition"),Ry.prototype),(0,G.Z)(Ry.prototype,"addPropLocationForNode",[Q.P],Object.getOwnPropertyDescriptor(Ry.prototype,"addPropLocationForNode"),Ry.prototype),(0,G.Z)(Ry.prototype,"removePropLocationForNode",[Q.P],Object.getOwnPropertyDescriptor(Ry.prototype,"removePropLocationForNode"),Ry.prototype),(0,G.Z)(Ry.prototype,"removePropDefinition",[Q.P],Object.getOwnPropertyDescriptor(Ry.prototype,"removePropDefinition"),Ry.prototype),(0,G.Z)(Ry.prototype,"handleUnlinkProp",[Q.P],Object.getOwnPropertyDescriptor(Ry.prototype,"handleUnlinkProp"),Ry.prototype),_y=Ry));var Ky,Yy,Xy,qy,Qy,ef,tf,of,nf,rf,sf,af,lf,cf,df;function pf(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function uf(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?pf(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):pf(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}Ky=(0,J.JJ)("stateDefinitionManagementFlow"),Yy=(0,J.f3)("sharedbProjectSyncService"),Xy=(0,J.f3)("projectDoc"),qy=(0,J.f3)("projectUIState"),Qy=(0,J.f3)("nodeManagementFlow"),ef=(0,J.f3)("nodeEventManagmentFlow"),tf=(0,J.f3)("notificationsManagementFlow"),Ky((nf=class{constructor(){(0,z.Z)(this,"dbSync",rf,this),(0,z.Z)(this,"projectDoc",sf,this),(0,z.Z)(this,"projectUIState",af,this),(0,z.Z)(this,"nodeManagementFlow",lf,this),(0,z.Z)(this,"nodeEventManagmentFlow",cf,this),(0,z.Z)(this,"notificationsManagementFlow",df,this)}getStateCurrentValues(e){if(!e)return null;const t=this.projectDoc.components.byId[e];if(!t)return null;const{stateDefinitions:o}=t;return Object.keys(o).reduce(((t,n)=>{var i;const r=null===(i=this.projectUIState.componentList.stateValues[e])||void 0===i?void 0:i[n];return t[n]={id:n,type:o[n].type,value:(null===r||void 0===r?void 0:r.value)||o[n].defaultValue,name:o[n].name,meta:{highlightInTreeView:!(null===r||void 0===r||!r.meta.highlightInTreeView)},componentInstanceValues:uf({},null===r||void 0===r?void 0:r.componentInstanceValues)},t}),{})}getNodesBoundToStateDefinition(e){var t;const o=this.projectUIState.selection.componentId;if(!o)return[];const n=this.projectDoc.components.byId[o];if(!n)return[];const{rootNodeId:i}=n;if(!i)return[];const r=this.projectDoc.nodes.getNodeSubtreeIds(i),s=null===(t=n.stateDefinitions[e])||void 0===t?void 0:t.name;return r.filter((e=>{const t=this.projectDoc.nodes.byId[e];return t&&t.renderingConditions&&t.renderingConditions.reference.content.id===s}))}getNodesBoundToStateChangeEvent(e){const t=this.projectUIState.selection.componentId;if(!t)return[];return this.projectDoc.components.byId[t]?Object.keys(this.projectDoc.nodes.byId).reduce(((t,o)=>{const n=this.projectDoc.nodes.byId[o];if(!n||!Object.keys(n.events).length)return t;const{events:i}=n;return Object.keys(i).forEach((n=>{const r=i[n];Object.keys(r).forEach((n=>{r[n].id===e&&t.push({nodeId:o,eventId:n})}))})),t}),[]):[]}createStateDefinition(e){const{doc:t,name:o,type:n,defaultValue:i}=e,r=this.projectUIState.selection.componentId;if(!t||!r)return;const s=t.components.byId[r];if(!s)return;const a=s.createStateDefinition({name:o,type:n,defaultValue:i});(0,V.JG)(this.projectUIState,(e=>{e.componentList.stateValues[s.id][a.id]={id:a.id,type:a.type,value:a.defaultValue,name:o,meta:{highlightInTreeView:!1},componentInstanceValues:{}}}))}deleteStateDefinition(e){const{doc:t,stateId:o}=e,n=this.projectUIState.selection.componentId;if(!t||!n)return;const i=t.components.byId[n];if(!i)return;this.getNodesBoundToStateDefinition(o).forEach((e=>{this.nodeManagementFlow.removeRenderingCondition({nodeId:e})}));this.getNodesBoundToStateChangeEvent(o).forEach((e=>this.nodeEventManagmentFlow.removeEventFromNode({nodeId:e.nodeId,eventId:e.eventId}))),(0,V.JG)(this.projectUIState,(e=>{delete e.componentList.stateValues[n][o]})),i.deleteStateDefinition(o)}updateStateDefinitionInternalValue(e,t){const o=this.projectUIState.selection.componentId;o&&(0,V.JG)(this.projectUIState,(n=>{var i;if(null!==(i=n.componentList.stateValues[o])&&void 0!==i&&i[e])n.componentList.stateValues[o][e].value=t;else{var r;const t=null===(r=this.projectDoc.components.byId[o])||void 0===r?void 0:r.stateDefinitions[e];if(!t)return;n.componentList.stateValues[o][e]={id:t.id,type:t.type,value:t.defaultValue,name:t.name,meta:{highlightInTreeView:!1},componentInstanceValues:{}}}}))}toggleHighlightInTreeView(e,t){const o=this.projectUIState.selection.componentId;o&&(0,V.JG)(this.projectUIState,(n=>{n.componentList.stateValues[o][e].meta.highlightInTreeView=t}))}setComponentInstanceStateValues(e,t,o){const n=this.projectDoc.nodes.byId[e];if(n&&!this.projectDoc.nodes.nodeIsCompInstance(n))return;const i=n.compIdOfCompInstance;(0,V.JG)(this.projectUIState,(n=>{n.componentList.stateValues[i][t].componentInstanceValues[e]=o}))}},rf=(0,G.Z)(nf.prototype,"dbSync",[Yy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sf=(0,G.Z)(nf.prototype,"projectDoc",[Xy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),af=(0,G.Z)(nf.prototype,"projectUIState",[qy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lf=(0,G.Z)(nf.prototype,"nodeManagementFlow",[Qy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cf=(0,G.Z)(nf.prototype,"nodeEventManagmentFlow",[ef],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),df=(0,G.Z)(nf.prototype,"notificationsManagementFlow",[tf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(nf.prototype,"createStateDefinition",[Q.P],Object.getOwnPropertyDescriptor(nf.prototype,"createStateDefinition"),nf.prototype),(0,G.Z)(nf.prototype,"deleteStateDefinition",[Q.P],Object.getOwnPropertyDescriptor(nf.prototype,"deleteStateDefinition"),nf.prototype),of=nf));var hf;(0,J.JJ)("webComponentsFlow")(hf=class{async register(){const[{SvgNodeInstanceWrapperWebComponent:e},{TextNodeInstanceWrapperWebComponent:t},{TeleportZoomableContainer:n},{EmbedNodeWrapperWebComponent:i},{LottieNodeWrapperWebComponent:r},{InteractiveNodeWrapperWebComponent:s}]=await Promise.all([Promise.all([o.e(26254),o.e(75180)]).then(o.bind(o,75180)),Promise.all([o.e(22937),o.e(58153)]).then(o.bind(o,58153)),Promise.all([o.e(26254),o.e(11567)]).then(o.bind(o,11567)),o.e(87044).then(o.bind(o,87044)),o.e(83477).then(o.bind(o,83477)),Promise.all([o.e(67076),o.e(24299)]).then(o.bind(o,24299))]);e.registerSelf(),t.registerSelf(),n.registerSelf(),i.registerSelf(),s.registerSelf(),r.registerSelf()}async registerPreviewComponents(){const[{EmbedNodeWrapperWebComponent:e},{LottieNodeWrapperWebComponent:t}]=await Promise.all([o.e(87044).then(o.bind(o,87044)),o.e(83477).then(o.bind(o,83477))]);e.registerSelf(),t.registerSelf()}});var mf={importmap:{imports:{"prop-types":"https://ga.jspm.io/npm:prop-types@15.7.2/index.js",react:"https://ga.jspm.io/npm:react@17.0.2/index.js","react-dom":"https://ga.jspm.io/npm:react-dom@17.0.2/index.js","react-helmet":"https://ga.jspm.io/npm:react-helmet@6.1.0/lib/Helmet.js","react-router":"https://ga.jspm.io/npm:react-router@5.2.1/esm/react-router.js","react-router-dom":"https://ga.jspm.io/npm:react-router-dom@5.3.0/esm/react-router-dom.js"},scopes:{"https://ga.jspm.io/":{"@babel/runtime/helpers/esm/extends":"https://ga.jspm.io/npm:@babel/runtime@7.16.5/helpers/esm/extends.js","@babel/runtime/helpers/esm/inheritsLoose":"https://ga.jspm.io/npm:@babel/runtime@7.16.5/helpers/esm/inheritsLoose.js","@babel/runtime/helpers/esm/objectWithoutPropertiesLoose":"https://ga.jspm.io/npm:@babel/runtime@7.16.5/helpers/esm/objectWithoutPropertiesLoose.js","@babel/runtime/helpers/inheritsLoose":"https://ga.jspm.io/npm:@babel/runtime@7.16.5/helpers/inheritsLoose.js",history:"https://ga.jspm.io/npm:history@4.10.1/index.js","hoist-non-react-statics":"https://ga.jspm.io/npm:hoist-non-react-statics@3.3.2/dist/hoist-non-react-statics.cjs.js",isarray:"https://ga.jspm.io/npm:isarray@0.0.1/index.js","mini-create-react-context":"https://ga.jspm.io/npm:mini-create-react-context@0.4.1/dist/cjs/index.js","object-assign":"https://ga.jspm.io/npm:object-assign@4.1.1/index.js","path-to-regexp":"https://ga.jspm.io/npm:path-to-regexp@1.8.0/index.js","react-fast-compare":"https://ga.jspm.io/npm:react-fast-compare@3.2.0/index.js","react-is":"https://ga.jspm.io/npm:react-is@16.13.1/index.js","react-side-effect":"https://ga.jspm.io/npm:react-side-effect@2.1.1/lib/index.js","resolve-pathname":"https://ga.jspm.io/npm:resolve-pathname@3.0.0/index.js",scheduler:"https://ga.jspm.io/npm:scheduler@0.20.2/index.js","tiny-invariant":"https://ga.jspm.io/npm:tiny-invariant@1.1.0/dist/tiny-invariant.cjs.js","tiny-warning":"https://ga.jspm.io/npm:tiny-warning@1.0.3/dist/tiny-warning.esm.js","value-equal":"https://ga.jspm.io/npm:value-equal@1.0.1/index.js"}}}},gf=o(79113);const yf=["package","tsconfig",".eslintrc","babel.config","global.d","tailwind.config.js","postcss.config.js","teleport.config.json"],ff=["teleporthq","webpack"],bf=(e,t)=>e.includes("/teleporthq/")||ff.some((t=>e.includes(t)))||yf.includes(t),wf=["base","components","utilities"].reduce(((e,t)=>e+=`@tailwind ${t};\n`),""),vf={theme:{extend:{}},plugins:[]};var If,Sf,jf,Df,Of,Ff,Tf,Nf,Ef,Cf,xf,Pf,kf,Mf,Zf,Uf,Af,Lf,_f,Rf,Bf,Hf,zf,$f,Gf,Vf,Jf,Wf,Kf,Yf,Xf,qf,Qf,eb,tb,ob,nb,ib,rb,sb,ab,lb,cb,db,pb,ub,hb,mb,gb,yb,fb,bb=o(15455);function wb(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function vb(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?wb(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):wb(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}If=(0,J.JJ)("projectFilesFlow"),Sf=(0,J.f3)("projectDoc"),jf=(0,J.f3)("projectUIState"),Df=(0,J.f3)("projectDownloadFlow"),Of=(0,J.f3)("assetsService"),Ff=(0,J.f3)("packerService"),Tf=(0,J.f3)("localHistoryStackFlow"),Nf=(0,J.f3)("sharedbProjectSyncService"),Ef=(0,J.f3)("modalManagementFlow"),Cf=(0,J.f3)("assetsEditFlow"),xf=(0,J.f3)("assetsManagementFlow"),Pf=(0,J.f3)("bundlerService"),kf=(0,J.f3)("navbarFlow"),Mf=(0,J.f3)("codeEditorFlow"),Zf=(0,J.f3)("yDocumentManagementFlow"),Uf=(0,J.f3)("guardsService"),Af=(0,J.f3)("tailwindService"),Lf=(0,J.f3)("propsDetectionService"),_f=(0,J.f3)("elementRefProvider"),Rf=(0,J.f3)("notificationsManagementFlow"),Bf=(0,q.G)(te.l.DEV_GENERATE_PROJECT),Hf=(0,q.G)(te.l.DEV_SAVE_FILE),zf=(0,q.G)(te.l.DEV_UPDATE_FILE),$f=(0,q.G)(te.l.DEV_RENAME_FILE),Gf=(0,q.G)(te.l.DEV_CREATE_FILE),Vf=(0,q.G)(te.l.DEV_CREATE_FOLDER),Jf=(0,q.G)(te.l.DEV_MOVE_FILE),Wf=(0,q.G)(te.l.DEV_DELETE_FILE),Kf=(0,q.G)(te.l.DEV_DELETE_ASSET),Yf=(0,q.G)(te.l.DEV_UPDATE_IMPORT_MAP),If((qf=class{constructor(){(0,z.Z)(this,"projectDoc",Qf,this),(0,z.Z)(this,"projectUIState",eb,this),(0,z.Z)(this,"projectDownloadFlow",tb,this),(0,z.Z)(this,"assetsService",ob,this),(0,z.Z)(this,"packerService",nb,this),(0,z.Z)(this,"localHistoryStackFlow",ib,this),(0,z.Z)(this,"dbSync",rb,this),(0,z.Z)(this,"modalManagementFlow",sb,this),(0,z.Z)(this,"assetsEditFlow",ab,this),(0,z.Z)(this,"assetsManagementFlow",lb,this),(0,z.Z)(this,"bundlerService",cb,this),(0,z.Z)(this,"navbarFlow",db,this),(0,z.Z)(this,"codeEditorFlow",pb,this),(0,z.Z)(this,"yDocumentManagementFlow",ub,this),(0,z.Z)(this,"guardsService",hb,this),(0,z.Z)(this,"tailwindService",mb,this),(0,z.Z)(this,"propsDetectionService",gb,this),(0,z.Z)(this,"elementRefProvider",yb,this),(0,z.Z)(this,"notificationsManagementFlow",fb,this),(0,$.Z)(this,"generateDevComponents",(async()=>{var e;const t=this.projectUIState.devMode.selectedBranch,o=this.projectDoc.projectFiles.local[t].byId,n=Object.keys(o).filter((e=>-1!==e.indexOf("src/widgets/")&&(0,gf.YP)((0,at.extname)(e)))),i={};let r=0;for(const d of n){const e=o[d];if(e)try{var s;const t=null===(s=window.exports)||void 0===s?void 0:s[d];if(!t)continue;r+=1;try{const o=await this.propsDetectionService.detectPropsInContent(e.code,d);i[d]={component:t,props:o}}catch(l){i[d]={component:t,props:{}},console.warn(`Failed to parse props for ${d}`)}}catch(c){console.error(`Could not generate dev component: ${d}`)}}this.addDevStylesToDocument();const a=(null===(e=window.exports)||void 0===e?void 0:e.CustomStyles)||{};return(0,V.JG)(this.projectUIState,(e=>{e.devMode.devComponents=i,e.devMode.devStyles=a})),{generated:r,existing:n.length}}))}async init(){var e;const{selectedFile:t,selectedBranch:o}=this.projectUIState.devMode;var n;(0===Object.keys(this.projectDoc.projectFiles.local[o].byId||{}).length&&await this.generateProject({reSync:!1}),!t||null!==(e=this.projectDoc.projectFiles.local[o].byId)&&void 0!==e&&e[t])||(this.navbarFlow.deleteTab((null===(n=this.navbarFlow.getTabByEntityId(t))||void 0===n?void 0:n.id)||""),this.selectNextAvailableFile({fileToStartFrom:t}));0===Object.keys(this.projectUIState.navbar.devModeTabs).length&&this.navbarFlow.createStarterFileTab(this.projectUIState.devMode.selectedFile||Qt.e3)}transferLocalFilesToRemote(e){const{doc:t,branch:o,stagedOnly:n}=e;if(!t)return;if(!n)return void(t.projectFiles.remote[o]=JSON.parse(JSON.stringify(t.projectFiles.local[o])));t.projectFiles.remote[o]||(t.projectFiles.remote[o]={byId:{}});const i=t.projectFiles.staged[o].byId;Object.keys(i).forEach((e=>{"removed"===i[e].status?delete t.projectFiles.remote[o].byId[e]:-1!==e.indexOf(Qt._C)?t.projectFiles.remote[o].byId[e]={code:"",is_asset:!0}:t.projectFiles.remote[o].byId[e]=i[e],delete i[e]}))}copyFilesToDifferentBranch(e){const{doc:t,sourceBranch:o,destBranch:n}=e;if(!t)return;const{byId:i,lastSha:r}=t.projectFiles.local[o];t.projectFiles.local[n]={byId:{},sourceBranch:o,lastSha:r},t.projectFiles.staged[n]={byId:{}},t.projectFiles.remote[n]={byId:{}},Object.keys(i).forEach((e=>{t.projectFiles.local[n].byId[e]=JSON.parse(JSON.stringify(i[e])),t.projectFiles.remote[n].byId[e]=JSON.parse(JSON.stringify(i[e]))}))}setSelectedDiffingFile(e,t,o=!0){(0,V.JG)(this.projectUIState,(o=>{e?(o.devMode.selectedDiffingFile={path:e,status:t},o.devMode.selectedStagedFile=null,o.devMode.selectedCommitFile=null):o.devMode.selectedDiffingFile=null})),e&&o&&this.navbarFlow.selectOrCreateTabByEntityId(`${e}-${t}`)}setSelectedCommitFile(e,t=!0){(0,V.JG)(this.projectUIState,(t=>{e?(t.devMode.selectedCommitFilesHistory[e.path]=vb({},e),t.devMode.selectedCommitFile=vb({},e),t.devMode.selectedStagedFile=null,t.devMode.selectedDiffingFile=null):t.devMode.selectedCommitFile=null})),e&&t&&this.navbarFlow.selectOrCreateTabByEntityId(`${e.path}-${e.sha}${Qt.Vf}`)}setSelectedStagedFile(e){var t,o;const{doc:n,fileId:i,createTab:r=!0}=e;if(!n)return;if(!i)return void(0,V.JG)(this.projectUIState,(e=>{e.devMode.selectedStagedFile=null}));const s=this.projectUIState.devMode.selectedBranch,a=null===(t=n.projectFiles.staged)||void 0===t||null===(o=t[s])||void 0===o?void 0:o.byId;if(!a)return;const l=a[i];l&&((0,V.JG)(this.projectUIState,(e=>{e.devMode.selectedStagedFile={path:i,status:l.status},e.devMode.selectedDiffingFile=null,e.devMode.selectedCommitFile=null})),l&&r&&this.navbarFlow.selectOrCreateTabByEntityId(`${i}${Qt.Wj}`))}async generateProject(e){const t=(null===e||void 0===e?void 0:e.reSync)||!1;try{var o;const e=this.projectDoc.assets.getAssetsUsedInProject(),n=this.projectDoc.assets.mapClassesAndNodesToOptimisedAssets(e,!0),i=this.projectDownloadFlow.domainProjectToUIDL({assetsMapping:n,skipDevModeWidgets:!1,projectType:et.cd.REACT}),r=await this.packerService.generateCustomCodeProject(vb({overwrite:t,uidl:i},(null===(o=this.projectDoc.settings.experimentalFeatures)||void 0===o?void 0:o[bb.Q.TAILWINDCSS])&&{tailwind:{config:this.tailwindService.getTailwindConfig(),css:wf}})),s=this.projectUIState.devMode.selectedBranch,a=this.projectDoc.projectFiles.local[s].byId[Qt.BQ];r.files||(r.files=[]),a||r.files.push({name:"teleport.config",fileType:et.Tv.JSON,content:JSON.stringify(mf,null,2)});const l=r.files.findIndex((e=>"package"===e.name&&"json"===e.fileType));if(r.files.splice(l,1),!r)return;this.saveProjectGeneratedFiles({overwrite:t,folder:r})}catch(n){this.notificationsManagementFlow.createNotification(K.k.ERROR,"There was a problem when syncing the project"),console.error(n)}}saveProjectGeneratedFiles(e){var t;const{doc:o,overwrite:n,folder:i}=e;if(!o)return;n&&this.removeTeleportFiles({doc:o});const r=this.projectUIState.devMode.selectedFile,s=this.mapToFlatFiles(i),a=this.projectUIState.devMode.selectedBranch,l=o.projectFiles.local[a].byId;Object.keys(s).forEach((e=>{if(e.includes(Qt.qG)&&n)return;const t=s[e];if(".html"===(0,at.extname)(e)&&n){const i=(new DOMParser).parseFromString(s[e].content,"text/html"),r=(new DOMParser).parseFromString(l[e].code,"text/html"),a=e=>{const t=i.querySelector(`[data-tag="${e}"]`),o=r.querySelector(`[data-tag="${e}"]`);o&&t&&(o.innerHTML=t.innerHTML)};a("default-style-sheet"),a("reset-style-sheet"),(r.head.querySelectorAll('[data-tag="font"]')||[]).forEach((e=>{r.head.removeChild(e)})),(i.head.querySelectorAll('[data-tag="font"]')||[]).forEach((e=>{r.head.appendChild(e)}));const c=`\n<!DOCTYPE html>\n\n<html lang="en">\n${r.documentElement.innerHTML}\n</html>\n`;this.saveFile(vb(vb({doc:o,overwrite:n,fileName:e},t),{},{content:c.trim()}))}else this.saveFile(vb({doc:o,overwrite:n,fileName:e},t))}));const c=Object.keys((null===(t=this.projectUIState.navbar)||void 0===t?void 0:t.devModeTabs)||{}).filter((e=>{const t=this.projectUIState.navbar.devModeTabs[e];return!s[t.entityId]&&t.entityId.startsWith(`${Qt.y$}/${Qt.Xh}/`)})),d=c.map((e=>this.projectUIState.navbar.devModeTabs[e].entityId)).includes(r||"");r&&!s[r]&&d&&this.selectNextAvailableFile({doc:o,fileToStartFrom:r}),(0,V.JG)(this.projectUIState,(e=>{c.forEach((t=>{delete e.navbar.devModeTabs[t]}))})),o.projectFiles.lastSync=Date.now()}removeTeleportFiles(e){const{doc:t}=e;if(!t)return;const o=this.projectUIState.devMode.selectedBranch,n=t.projectFiles.local[o].byId;Object.keys(n).filter((e=>e.includes("/teleporthq/")&&!e.includes(Qt.qG))).forEach((e=>{this.deleteFileViewState(e),delete n[e]}))}mapToFlatFiles(e,t=""){const{files:o,subFolders:n}=e,i={};return o.map((o=>{const n=`${o.name}${o.fileType?"."+o.fileType:""}`,r=`${(0,at.join)(t,`${e.name}/${n}`)}`;i[r]={content:o.content,is_protected:bf(r,o.name)}})),n.forEach((o=>{const n=this.mapToFlatFiles(o,(0,at.join)(t,e.name));Object.assign(i,n)})),i}toggleFileUnderUpdate(e){(0,V.JG)(this.projectUIState,(t=>{const o=null!==e&&void 0!==e?e:!t.devMode.fileUnderUpdate;t.devMode.fileUnderUpdate=o}))}toggleLoadingPackages(){(0,V.JG)(this.projectUIState,(e=>{e.devMode.loadingPackages=!e.devMode.loadingPackages}))}detachPreviewer(){(0,V.JG)(this.projectUIState,(e=>{e.devMode.showPreviewer=!e.devMode.showPreviewer}))}saveFile(e){const{doc:t,fileName:o,content:n,is_protected:i=!1,overwrite:r}=e;if(!t)return;const s=this.projectUIState.devMode.selectedBranch,a=t.projectFiles.local[s].byId,l=a[o];l?r&&(l.is_protected||`${Qt.y$}/index.html`)&&(l.code=n,l.synced_at=Date.now()):a[o]={code:n,created_at:Date.now(),is_protected:i};const c=this.yDocumentManagementFlow.getText(o);c&&c.toString()!==n&&this.yDocumentManagementFlow.replaceText(o,n)}updateFile(e){const{doc:t,content:o,fileId:n}=e;if(!t)return;const i=n||(this.projectUIState.devMode.conflictModalOpened?this.projectUIState.devMode.selectedConflictFile:this.projectUIState.devMode.selectedFile);if(!i)return;const r=this.projectUIState.devMode.selectedBranch,s=t.projectFiles.local[r].byId[i];if(!s)throw this.setSelectedFile({doc:t,path:Qt.e3}),new Error(`File record is missing ${this.projectUIState.devMode.selectedFile}`);s.code=o,s.synced_at=Date.now()}setSelectedFile(e){var t;const{doc:o,path:n,fromTab:i,type:r}=e;if(!o)return;if("git-file"===r||"staged-file"===r||"commited-file"===r){const e=n.split("-");switch(r){case"git-file":const t=e.pop();this.setSelectedDiffingFile(e.join("-"),t,!1);break;case"staged-file":e.pop(),this.setSelectedStagedFile({doc:o,fileId:e.join("-"),createTab:!1});break;case"commited-file":e.pop(),e.pop();const n=e.join("-"),i=this.projectUIState.devMode.selectedCommitFilesHistory[n];i&&this.setSelectedCommitFile(i,!1)}return(0,V.JG)(this.projectUIState,(e=>{e.devMode.selectedFile=null})),void(this.projectUIState.devMode.sidebarSettings.panel===Y.Xk.FILES&&this.codeEditorFlow.handleDevSidebarChange(Y.Xk.SOURCE_CONTROL))}this.setSelectedDiffingFile(null),this.setSelectedStagedFile({doc:o,fileId:null}),this.setSelectedCommitFile(null);const s=this.projectUIState.devMode.selectedFile,a=this.projectUIState.devMode.previouslySelectedFile;s!==a&&(0,V.JG)(this.projectUIState,(e=>{e.devMode.previouslySelectedFile=s})),i||this.navbarFlow.selectOrCreateTabByEntityId(n),(0,V.JG)(this.projectUIState,(e=>{e.devMode.selectedFile=n})),(null===(t=this.projectUIState.devMode.sidebarSettings)||void 0===t?void 0:t.panel)===Y.Xk.SOURCE_CONTROL&&this.codeEditorFlow.handleDevSidebarChange(Y.Xk.FILES)}rename(e){const{doc:t,path:o,newPath:n}=e;if(!t)return;const i=this.projectUIState.devMode.selectedBranch,r=t.projectFiles.local[i].byId;r[o]&&(this.yDocumentManagementFlow.deleteText(o),r[n]=r[o],this.navbarFlow.renameFilesTab(o,n),this.replaceFileViewState(o,n),delete r[o],this.bundlerService.renameFile(o,n,r[n].code),this.renameChildren({doc:t,path:o,newPath:n}))}renameChildren(e){const{doc:t,path:o,newPath:n}=e;if(!t)return;const i=this.projectUIState.devMode.selectedBranch,r=t.projectFiles.local[i].byId,s=Object.keys(r).filter((e=>0===e.indexOf(`${o}/`)));s.length&&s.forEach((e=>{const i=e.replace(o,n);this.navbarFlow.renameFilesTab(e,i),this.replaceFileViewState(e,i),this.yDocumentManagementFlow.deleteText(e),this.projectUIState.devMode.selectedFile===e&&this.setSelectedFile({doc:t,path:i}),r[i]=r[e],delete r[e]}))}createFile(e){const{doc:t,fileId:o,content:n="",remote:i=!1}=e;if(!t)return;const r=this.projectUIState.devMode.selectedBranch,s={code:n,is_protected:!1,created_at:Date.now()};t.projectFiles.local[r].byId[o]=s,i&&(t.projectFiles.remote[r].byId[o]=s),this.bundlerService.updateFile(o,n)}createFolder(e){const{doc:t,folderId:o}=e;if(!t)return;const n=this.projectUIState.devMode.selectedBranch;t.projectFiles.local[n].byId[o]={code:"",is_protected:!1,created_at:Date.now()}}async moveFile(e){const{doc:t,toMovePath:o,destinationFolderPath:n}=e;if(!t||o===n)return;const i=this.projectUIState.devMode.selectedBranch,r=[...t.projectFiles.getFileChildren(o,i),o],s=(0,at.relative)(o,n),a=o.split("/").pop()||"",l=1===a.split(".").length;if(l&&o.replace(`${n}/`,"")===a)return;const c=(0,at.join)(o,s,a),d=t.projectFiles.getUniqueName(c,i),p=t.projectFiles.local[i].byId;for(const u of r){this.yDocumentManagementFlow.deleteText(u);const e=u.split("/").pop(),t=l?u===o?u:`${d}/${e||""}`:d,n=p[u];p[t]=n,delete p[u],this.navbarFlow.renameFilesTab(u,t),this.replaceFileViewState(u,t),this.projectUIState.devMode.selectedFile===u&&(0,V.JG)(this.projectUIState,(e=>{e.devMode.selectedFile=t}))}}deleteFile(e){const{doc:t,fileId:o,permanent:n=!1}=e;if(!t||!o)return;const i=this.projectUIState.devMode.selectedBranch,{selectedFile:r}=this.projectUIState.devMode;(e.fileId===r||-1!==(null===r||void 0===r?void 0:r.indexOf(`${e.fileId}/`)))&&this.selectNextAvailableFile({doc:t,fileToStartFrom:o});const s=t.projectFiles.local[i].byId,a=t.projectFiles.getFileChildren(o,i),l=[o,...a],c=t.projectFiles.getUniqueName(o,i);l.forEach((e=>{var r;this.yDocumentManagementFlow.deleteText(e),this.navbarFlow.deleteTab((null===(r=this.navbarFlow.getTabByEntityId(e))||void 0===r?void 0:r.id)||""),this.deleteFileViewState(e),delete s[e],this.yDocumentManagementFlow.deleteText(e),n&&delete t.projectFiles.remote[i].byId[e];const a=(e===o?c:e.replace(o,c)).split("/");for(let t=1;t<a.length;t++)this.bundlerService.deleteFile(e)}))}selectNextAvailableFile(e){const{doc:t,fileToStartFrom:o}=e;if(!t)return;const n=this.computeCandidateForFileToSelect(t,o);if(!n)throw new Error("No file was found");this.setSelectedFile({doc:t,path:n})}setFileUnderExternalUpdate(e){(0,V.JG)(this.projectUIState,(t=>{t.devMode.fileUnderExternalUpdate=e}))}deleteAssetUsingFilePath(e){const{doc:t,fileId:o}=e;if(!t)return;const n=(0,at.parse)(o),i=this.projectDoc.assets.findAssetUsingName(`${n.name}${n.ext}`);if(!i)throw new Error(`Attempted to delete asset with file id "${o}" but it does not exist.`);this.assetsEditFlow.delete([i.id])}saveFileAction(){this.guardsService.executeFunctionGuarded(to._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{e.projectFiles.lastSave=Date.now()}))}))}updateImportMap(e){const{importmap:t,doc:o}=e;if(!o)return;const n=this.projectUIState.devMode.selectedBranch,i=o.projectFiles.local[n].byId[Qt.BQ];if(!i)throw new Error("Teleport config file is missing from the project");const r=JSON.parse(i.code);r.importmap=JSON.parse(t);const s=JSON.stringify(r,null,2);this.yDocumentManagementFlow.replaceText(Qt.BQ,s),this.updateFile({doc:o,fileId:Qt.BQ,content:s}),this.modalManagementFlow.hideModal(),this.bundlerService.hardRefresh(),o.projectFiles.isAddingExternalDependency=null}addDevStylesToDocument(){var e,t,o;const n=null===(e=this.elementRefProvider.getIframeRef())||void 0===e||null===(t=e.current)||void 0===t?void 0:t.contentDocument;if(!n)return;const i="dev-mode-style",r=(null===(o=window.exports)||void 0===o?void 0:o.CustomStyles)||{},s=n.head.getElementsByClassName(i);Array.from(s).forEach((e=>e.remove()));const a=n.createElement("style");a.innerHTML=Object.values(r).join(""),a.classList.add(i),n.head.appendChild(a)}computeCandidateForFileToSelect(e,t){var o;const n=this.projectUIState.devMode.selectedBranch,{previouslySelectedFile:i,selectedFile:r}=this.projectUIState.devMode;return r!==i&&(null===(o=e.projectFiles.local[n])||void 0===o?void 0:o.byId[i||""])?i:e.projectFiles.getNextFileId(t,n)||e.projectFiles.getFirstFileId(n)}getSelectedEditorFileAndType(){return this.projectUIState.devMode.selectedDiffingFile?{fileType:"diffing",file:this.projectUIState.devMode.selectedDiffingFile.path}:this.projectUIState.devMode.selectedStagedFile?{fileType:"staged",file:this.projectUIState.devMode.selectedStagedFile.path}:this.projectUIState.devMode.selectedCommitFile?{fileType:"commit",file:this.projectUIState.devMode.selectedCommitFile.path}:{fileType:"local",file:this.projectUIState.devMode.selectedFile}}updateFileViewState(e){if(!e)return;const{fileType:t,file:o}=this.getSelectedEditorFileAndType();(0,V.JG)(this.projectUIState,(({userPreferences:n})=>{var i,r;null!==(i=n.devFileViewState)&&void 0!==i&&i[t]||(n.devFileViewState=vb(vb({},n.devFileViewState),{},{[t]:{}})),n.devFileViewState[t]=vb(vb({},null===(r=n.devFileViewState)||void 0===r?void 0:r[t]),{},{[o]:e})}))}replaceFileViewState(e,t,o="local",n="local"){(0,V.JG)(this.projectUIState,(({userPreferences:i})=>{var r,s;null!==(r=i.devFileViewState[o])&&void 0!==r&&r[e]&&(i.devFileViewState[n]=vb(vb({},null===(s=i.devFileViewState)||void 0===s?void 0:s[n]),{},{[t]:i.devFileViewState[o][e]}),delete i.devFileViewState[o][e])}))}deleteFileViewState(e,t="local"){(0,V.JG)(this.projectUIState,(({userPreferences:o})=>{var n,i;null===(n=o.devFileViewState)||void 0===n||(null===(i=n[t])||void 0===i||delete i[e])}))}deleteAllFileViewState(){(0,V.JG)(this.projectUIState,(({userPreferences:e})=>{Object.keys(e.devFileViewState).forEach((t=>{delete e.devFileViewState[t]}))}))}getSelectedFileViewState(){var e,t;const{fileType:o,file:n}=this.getSelectedEditorFileAndType();return null===(e=this.projectUIState.userPreferences.devFileViewState)||void 0===e||null===(t=e[o])||void 0===t?void 0:t[n]}async getPackedDesignProject(e){var t,o,n,i;const{projectType:r,skipDownload:s,publisher:a,projectCssFlavour:l,includeAnalytics:c}=e,d=await this.assetsManagementFlow.getOptimisedUsedAssets(),p=this.projectDoc.assets.mapClassesAndNodesToOptimisedAssets(d),u=await this.assetsService.downloadAssets(d,{skipDownload:s}),h=Jt({title:this.projectUIState.title,slug:this.projectUIState.slug,doc:this.projectDoc,projectType:r,assetSrcMapping:p,options:{skipDevModeWidgets:!0}});return await this.packerService.packAndPublish(vb(vb(vb({uidl:h,options:{assets:u,projectType:r,publisher:a},projectCssFlavour:l?null===(t=window)||void 0===t?void 0:t.projectCssFlavour:void 0},(null===(o=window)||void 0===o?void 0:o.analytics)&&c&&{teleportAnalytics:window.analytics}),Object.keys((null===(n=this.projectDoc.customFiles)||void 0===n?void 0:n.byId)||{}).length>0&&{customFiles:this.projectDoc.customFiles.byId}),(null===(i=this.projectDoc.settings.experimentalFeatures)||void 0===i?void 0:i[bb.Q.TAILWINDCSS])&&{tailwind:{config:this.tailwindService.getTailwindConfig(),css:wf}}))}getPackedDevProjectFromCurrentBranch(){var e;const t=this.projectUIState.devMode.selectedBranch;return this.projectDoc.projectFiles.pack(vb({toDeploy:!0,branch:t,assets:{}},Object.keys((null===(e=this.projectDoc.customFiles)||void 0===e?void 0:e.byId)||{}).length>0&&{customFiles:this.projectDoc.customFiles.byId}))}},Qf=(0,G.Z)(qf.prototype,"projectDoc",[Sf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eb=(0,G.Z)(qf.prototype,"projectUIState",[jf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tb=(0,G.Z)(qf.prototype,"projectDownloadFlow",[Df],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ob=(0,G.Z)(qf.prototype,"assetsService",[Of],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nb=(0,G.Z)(qf.prototype,"packerService",[Ff],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ib=(0,G.Z)(qf.prototype,"localHistoryStackFlow",[Tf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rb=(0,G.Z)(qf.prototype,"dbSync",[Nf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sb=(0,G.Z)(qf.prototype,"modalManagementFlow",[Ef],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ab=(0,G.Z)(qf.prototype,"assetsEditFlow",[Cf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lb=(0,G.Z)(qf.prototype,"assetsManagementFlow",[xf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cb=(0,G.Z)(qf.prototype,"bundlerService",[Pf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),db=(0,G.Z)(qf.prototype,"navbarFlow",[kf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pb=(0,G.Z)(qf.prototype,"codeEditorFlow",[Mf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ub=(0,G.Z)(qf.prototype,"yDocumentManagementFlow",[Zf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hb=(0,G.Z)(qf.prototype,"guardsService",[Uf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mb=(0,G.Z)(qf.prototype,"tailwindService",[Af],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gb=(0,G.Z)(qf.prototype,"propsDetectionService",[Lf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yb=(0,G.Z)(qf.prototype,"elementRefProvider",[_f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fb=(0,G.Z)(qf.prototype,"notificationsManagementFlow",[Rf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(qf.prototype,"transferLocalFilesToRemote",[io],Object.getOwnPropertyDescriptor(qf.prototype,"transferLocalFilesToRemote"),qf.prototype),(0,G.Z)(qf.prototype,"copyFilesToDifferentBranch",[io],Object.getOwnPropertyDescriptor(qf.prototype,"copyFilesToDifferentBranch"),qf.prototype),(0,G.Z)(qf.prototype,"setSelectedStagedFile",[io],Object.getOwnPropertyDescriptor(qf.prototype,"setSelectedStagedFile"),qf.prototype),(0,G.Z)(qf.prototype,"generateProject",[Bf],Object.getOwnPropertyDescriptor(qf.prototype,"generateProject"),qf.prototype),(0,G.Z)(qf.prototype,"saveProjectGeneratedFiles",[io],Object.getOwnPropertyDescriptor(qf.prototype,"saveProjectGeneratedFiles"),qf.prototype),(0,G.Z)(qf.prototype,"removeTeleportFiles",[io],Object.getOwnPropertyDescriptor(qf.prototype,"removeTeleportFiles"),qf.prototype),(0,G.Z)(qf.prototype,"saveFile",[Hf,io],Object.getOwnPropertyDescriptor(qf.prototype,"saveFile"),qf.prototype),(0,G.Z)(qf.prototype,"updateFile",[zf,io],Object.getOwnPropertyDescriptor(qf.prototype,"updateFile"),qf.prototype),(0,G.Z)(qf.prototype,"setSelectedFile",[io],Object.getOwnPropertyDescriptor(qf.prototype,"setSelectedFile"),qf.prototype),(0,G.Z)(qf.prototype,"rename",[$f,io],Object.getOwnPropertyDescriptor(qf.prototype,"rename"),qf.prototype),(0,G.Z)(qf.prototype,"createFile",[Gf,io],Object.getOwnPropertyDescriptor(qf.prototype,"createFile"),qf.prototype),(0,G.Z)(qf.prototype,"createFolder",[Vf,io],Object.getOwnPropertyDescriptor(qf.prototype,"createFolder"),qf.prototype),(0,G.Z)(qf.prototype,"moveFile",[Jf,io],Object.getOwnPropertyDescriptor(qf.prototype,"moveFile"),qf.prototype),(0,G.Z)(qf.prototype,"deleteFile",[Wf,io],Object.getOwnPropertyDescriptor(qf.prototype,"deleteFile"),qf.prototype),(0,G.Z)(qf.prototype,"selectNextAvailableFile",[io],Object.getOwnPropertyDescriptor(qf.prototype,"selectNextAvailableFile"),qf.prototype),(0,G.Z)(qf.prototype,"deleteAssetUsingFilePath",[Kf,io],Object.getOwnPropertyDescriptor(qf.prototype,"deleteAssetUsingFilePath"),qf.prototype),(0,G.Z)(qf.prototype,"updateImportMap",[Yf,io],Object.getOwnPropertyDescriptor(qf.prototype,"updateImportMap"),qf.prototype),Xf=qf));var Ib=o(27709),Sb=o(49616),jb=o(37659),Db=o(6566);const Ob=e=>{const{addDependency:t,onDismiss:o,addInProgress:n,loadExportsMap:i,exports:r,resetExports:s,isLoadingExportsMap:a}=e,{0:l,1:c}=(0,pr.useState)("react-query@3.34.6"),{0:d,1:p}=(0,pr.useState)([]);(0,pr.useEffect)((()=>()=>o()),[]),(0,pr.useEffect)((()=>{s(),p([])}),[l]);return(0,gr.jsxs)(gr.Fragment,{children:[(0,gr.jsx)("div",{className:"jsx-573546598 "+ss.default.dynamic([["3755600568",[Ki.N_.TWO_UNITS]]])+" deps-modal-wrapper",children:(0,gr.jsxs)(Db.K,{gap:"one",children:[(0,gr.jsx)("h3",{className:"jsx-573546598 "+ss.default.dynamic([["3755600568",[Ki.N_.TWO_UNITS]]]),children:"Add External Dependency"}),(0,gr.jsx)(Ib.S,{value:l,style:"boxed",size:"flexible",onChange:e=>{c(e.target.value)}}),(0,gr.jsxs)(Db.K,{gap:"one",children:[(0,gr.jsxs)(cs.g,{gap:"one",children:[(0,gr.jsx)("h4",{className:"jsx-573546598 "+ss.default.dynamic([["3755600568",[Ki.N_.TWO_UNITS]]]),children:"Package exports"}),(0,gr.jsx)("a",{rel:"noopener noreferrer",href:"https://jspm.org/docs/cdn#exports-field",target:"_blank","data-tool-tip-name":"Package Exports Field",className:"jsx-573546598 "+ss.default.dynamic([["3755600568",[Ki.N_.TWO_UNITS]]]),children:(0,gr.jsx)(hr.J,{type:"info",size:8})})]}),(0,gr.jsx)("p",{className:"jsx-573546598 "+ss.default.dynamic([["3755600568",[Ki.N_.TWO_UNITS]]]),children:"By manually selecting a specific module from the package, you can reduce the amount of JS loaded into the browsers."}),(0,gr.jsxs)(ur.z,{style:"solid",colorScheme:"neutral",size:"small",onClick:()=>{l&&i(l)},children:["Fetch ",a?(0,gr.jsx)(hr.J,{type:"loading"}):null]}),r&&(null===r||void 0===r?void 0:r.length)>0?(0,gr.jsx)("div",{className:"jsx-573546598 "+ss.default.dynamic([["3755600568",[Ki.N_.TWO_UNITS]]])+" deps-exports-list",children:(0,gr.jsx)(Sb.E,{noPadding:!0,onSelect:e=>{d.includes(e)?p(d.filter((t=>t!==e))):p([...d,e])},children:null===r||void 0===r?void 0:r.map((e=>(0,gr.jsx)(jb.p,{selected:d.includes(e),itemId:e,children:(0,gr.jsx)("div",{className:"jsx-573546598 "+ss.default.dynamic([["3755600568",[Ki.N_.TWO_UNITS]]])+" deps-export-list-item",children:(0,gr.jsx)("span",{className:"jsx-573546598 "+ss.default.dynamic([["3755600568",[Ki.N_.TWO_UNITS]]])+" dep-path-name",children:e})})},e)))})}):null]}),(0,gr.jsxs)(cs.g,{align:"center",children:[(0,gr.jsx)(ur.z,{isDisabled:n===Wm.B.ADDING||!1,style:"outline",colorScheme:"gray",onClick:o,children:"Cancel"}),(0,gr.jsxs)(ur.z,{isDisabled:n===Wm.B.ADDING||!1,style:"solid",colorScheme:"accent",onClick:()=>{0!==d.length?t(d):t(l)},children:["Add ",n===Wm.B.ADDING?(0,gr.jsx)(hr.J,{type:"loading"}):null]})]})]})}),(0,gr.jsx)(ss.default,{id:"573546598",children:[".modal-content{max-width:500px;}"]}),(0,gr.jsx)(ss.default,{id:"3755600568",dynamic:[Ki.N_.TWO_UNITS],children:[".deps-modal-wrapper.__jsx-style-dynamic-selector{width:100%;min-height:130px;}",".deps-exports-list.__jsx-style-dynamic-selector{width:100%;max-height:400px;overflow:scroll;}",`.deps-package-exports.__jsx-style-dynamic-selector{margin-top:${Ki.N_.TWO_UNITS};}`,".deps-export-list-item.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100%;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;}"]})]})};var Fb,Tb,Nb,Eb,Cb,xb,Pb,kb,Mb;function Zb(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}let Ub=(Fb=(0,J.f3)("projectDoc"),Tb=(0,J.f3)("projectUIState"),Nb=(0,J.f3)("notificationsManagementFlow"),Eb=(0,J.f3)("dependencyManagementFlow"),Cb=class extends pr.Component{constructor(...e){super(...e),(0,z.Z)(this,"projectDoc",xb,this),(0,z.Z)(this,"projectUIState",Pb,this),(0,z.Z)(this,"notificationsManagementFlow",kb,this),(0,z.Z)(this,"dependencyManagementFlow",Mb,this),(0,$.Z)(this,"unsubs",[]),(0,$.Z)(this,"state",{exports:null,isAddingExternalDependency:this.projectDoc.projectFiles.isAddingExternalDependency,isLoadingExportsMap:!1}),(0,$.Z)(this,"loadExportsMap",(async e=>{this.setState({isLoadingExportsMap:!0}),this.dependencyManagementFlow.loadExportsMap(e)})),(0,$.Z)(this,"hanldeResetExports",(()=>{this.setState({exports:null})})),(0,$.Z)(this,"addDependency",(e=>{"string"!==typeof e?this.dependencyManagementFlow.addDependenciesWithSubPaths(e):this.dependencyManagementFlow.addExternalDependency(e)}))}componentDidMount(){const e=(0,V.Ys)(this.projectDoc,["projectFiles/isAddingExternalDependency"],(({projectFiles:{isAddingExternalDependency:e}})=>{this.setState({isAddingExternalDependency:e})}),"ExternalDependencyModalWrapper"),t=(0,V.Ys)(this.projectUIState,["devMode/packageExports"],(e=>{e.devMode.packageExports?this.setState({exports:e.devMode.packageExports,isLoadingExportsMap:!1}):this.setState({exports:null,isLoadingExportsMap:!1})}),"ExternalDependencyModalWrapper1");this.unsubs.push((()=>e.dispose()),(()=>t.dispose()))}componentWillUnmount(){this.dependencyManagementFlow.resetExternalDependencyState({}),this.unsubs.forEach((e=>e()))}render(){const{isAddingExternalDependency:e,exports:t,isLoadingExportsMap:o}=this.state;return(0,gr.jsx)(Ob,function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Zb(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Zb(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({isLoadingExportsMap:o,addDependency:this.addDependency,addInProgress:e,loadExportsMap:this.loadExportsMap,resetExports:this.hanldeResetExports,exports:t},this.props))}},xb=(0,G.Z)(Cb.prototype,"projectDoc",[Fb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pb=(0,G.Z)(Cb.prototype,"projectUIState",[Tb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kb=(0,G.Z)(Cb.prototype,"notificationsManagementFlow",[Nb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mb=(0,G.Z)(Cb.prototype,"dependencyManagementFlow",[Eb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cb);var Ab,Lb,_b,Rb,Bb,Hb,zb,$b,Gb,Vb,Jb;Ab=(0,J.JJ)("dependencyManagementFlow"),Lb=(0,J.f3)("bundlerService"),_b=(0,J.f3)("modalManagementFlow"),Rb=(0,J.f3)("projectDoc"),Bb=(0,J.f3)("projectUIState"),Ab((zb=class{constructor(){(0,z.Z)(this,"bundlerService",$b,this),(0,z.Z)(this,"modalManagementFlow",Gb,this),(0,z.Z)(this,"projectDoc",Vb,this),(0,z.Z)(this,"projectUIState",Jb,this)}resetExternalDependencyState(e){const{doc:t}=e;t&&(t.projectFiles.isAddingExternalDependency=null)}addDependencyModal(){const e=Jo.d.createCustomModal({Component:Ub,onDismiss:()=>{this.modalManagementFlow.hideModal()}});this.modalManagementFlow.showModal(e)}getImportsFromDeps(){return Object.keys(this.computeDepsFromImportMap()).map((e=>`import * as ${(0,mt.dE)(e.replaceAll(/-/g,""))} from '${e}'`)).join("\n")}computeDepsFromImportMap(){try{var e,t,o,n;const i=(null===(e=this.projectDoc.projectFiles.local[this.projectUIState.devMode.selectedBranch])||void 0===e||null===(t=e.byId[Qt.BQ])||void 0===t?void 0:t.code)||"{}",r=(null===(o=JSON.parse(i))||void 0===o||null===(n=o.importmap)||void 0===n?void 0:n.imports)||{};return Object.keys(r).reduce(((e,t)=>{const o=r[t].match(/@[~^]?([\dvx*]+(?:[-.](?:[\dx*]+|alpha|beta))*)/gm),n=null===o||void 0===o?void 0:o[0];if(!n)throw new Error(`Version missing for the dependency ${t}`);return e[t]=n,e}),{})}catch(i){return{}}}addExternalDependency(e){this.bundlerService.addExternalDependency({pkgName:e})}addDependenciesWithSubPaths(e){const t=[...this.parseDepsIntoJSPMRedable(this.computeDepsFromImportMap()),...e];this.bundlerService.addExternalDependency({pkgName:t})}updateDependencies(e){this.bundlerService.addExternalDependency({pkgName:this.parseDepsIntoJSPMRedable(e)})}loadExportsMap(e){this.bundlerService.loadExports(e)}parseDepsIntoJSPMRedable(e){return Object.keys(e).map((t=>{const o=t.split("/");return t.startsWith("@")?3===o.length?`${o.splice(0,2).join("/")}${e[t]}/${o.splice(3,o.length-1).join("/")}`:`${o.splice(0,1).join("/")}${e[t]}/${o.splice(2,o.length-1).join("/")}`:1===o.length?`${o[0]}${e[t]}`:`${o[0]}${e[t]}/${o.splice(1,o.length-1).join("/")}`}))}},$b=(0,G.Z)(zb.prototype,"bundlerService",[Lb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gb=(0,G.Z)(zb.prototype,"modalManagementFlow",[_b],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vb=(0,G.Z)(zb.prototype,"projectDoc",[Rb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jb=(0,G.Z)(zb.prototype,"projectUIState",[Bb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(zb.prototype,"resetExternalDependencyState",[io],Object.getOwnPropertyDescriptor(zb.prototype,"resetExternalDependencyState"),zb.prototype),Hb=zb));var Wb,Kb,Yb,Xb,qb,Qb=o(29527),ew=o(53952),tw=o(21371),ow=o(7206),nw=o(55913),iw=o(58778),rw=o(74262),sw=o(47626),aw=o(75642),lw=o(46320),cw=o(40909);const dw=[];dw[0]=e=>{const{encoder:t,decoder:o,provider:n,emitSynced:i}=e;ow.uE(t,0);const r=iw.zu(o,t,n.doc,n);i&&r===iw.Px&&!n.synced&&(n.synced=!0)},dw[3]=e=>{const{encoder:t,provider:o}=e;ow.uE(t,1),ow.mP(t,sw.xq(o.awareness,Array.from(o.awareness.getStates().keys())))},dw[1]=e=>{const{decoder:t,provider:o}=e;sw.oy(o.awareness,nw.HN(t),o)},dw[2]=e=>{const{decoder:t,provider:o}=e;rw.nw(t,o.doc,pw)};const pw=(e,t)=>console.warn(`Permission denied to access url.\n${t}`),uw=(e,t,o)=>{const n=nw.l1(t),i=ow.Mf(),r=nw.yg(n);if(4===r){const t=nw.kf(n);return e.emit(t,[]),i}if(5===r)return e.heartbeat(),e.sendCustomMessage(JSON.stringify({type:"pong"})),i;const s=e.messageHandlers[r];return s?s({encoder:i,decoder:n,provider:e,emitSynced:o}):console.error("Unable to compute message"),i},hw=async e=>{if(!e.shouldConnect)return;const t=await e.authService.getAuthUserAsync(),o=t?await t.getIdToken():"",n=new WebSocket(`wss://playground-api-production-v5.services.teleporthq.io/yws/${e.projectDoc.id}?token=${o}`);n&&(n.binaryType="arraybuffer",e.ws=n,e.wsconnecting=!0,e.wsconnected=!1,e.synced=!1,n.onmessage=t=>{e.wsLastMessageReceived=tw.ZG();const o=uw(e,new Uint8Array(t.data),!0);ow.kE(o)>1&&n.send(ow._f(o))},n.onclose=()=>{if(e.ws=null,e.wsconnecting=!1,e.wsconnected){e.wsconnected=!1,e.synced=!1;const t=Array.from(e.awareness.getStates().keys()).filter((t=>t!==e.doc.clientID));sw.Ag(e.awareness,t,e),e.emit("status",[{status:"disconnected"}])}else e.wsUnsuccessfulReconnects++;setTimeout(hw,cw.VV(1200*cw.mv(e.wsUnsuccessfulReconnects+1),2500),e)},n.onopen=()=>{e.wsLastMessageReceived=tw.ZG(),e.wsconnecting=!1,e.wsconnected=!0,e.wsUnsuccessfulReconnects=0,e.emit("status",[{status:"connected"}]);const t=ow.Mf();if(ow.uE(t,0),iw._J(t,e.doc),n.send(ow._f(t)),null!==e.awareness.getLocalState()){const t=ow.Mf();ow.uE(t,1),ow.mP(t,sw.xq(e.awareness,[e.doc.clientID])),n.send(ow._f(t))}},e.emit("status",[{status:"connecting"}]))};let mw=(Wb=(0,J.f3)("authService"),Kb=(0,J.f3)("projectDoc"),Yb=class extends lw.y{constructor(e,t=new sw.GL(e)){super(),(0,$.Z)(this,"doc",void 0),(0,$.Z)(this,"awareness",void 0),(0,$.Z)(this,"shouldConnect",void 0),(0,$.Z)(this,"wsconnected",void 0),(0,$.Z)(this,"wsconnecting",void 0),(0,$.Z)(this,"bcconnected",void 0),(0,$.Z)(this,"wsLastMessageReceived",void 0),(0,$.Z)(this,"wsUnsuccessfulReconnects",void 0),(0,$.Z)(this,"messageHandlers",void 0),(0,$.Z)(this,"bcChannel",void 0),(0,$.Z)(this,"ws",void 0),(0,$.Z)(this,"mux",void 0),(0,$.Z)(this,"_synced",void 0),(0,$.Z)(this,"resyncInterval",void 0),(0,$.Z)(this,"checkInterval",void 0),(0,$.Z)(this,"heartbeatTimeout",null),(0,z.Z)(this,"authService",Xb,this),(0,z.Z)(this,"projectDoc",qb,this),(0,$.Z)(this,"bcSubscriber",(e=>{this.mux((()=>{const t=uw(this,new Uint8Array(e),!1);ow.kE(t)>1&&ew.nY(this.bcChannel,ow._f(t))}))})),(0,$.Z)(this,"updateHandler",((e,t)=>{if(t!==this){const t=ow.Mf();ow.uE(t,0),iw.lr(t,e),this.broadcastMessage(ow._f(t))}})),(0,$.Z)(this,"awarenessUpdateHandler",(e=>{const{added:t,updated:o,removed:n}=e,i=t.concat(o).concat(n),r=ow.Mf();ow.uE(r,1),ow.mP(r,sw.xq(this.awareness,i)),this.broadcastMessage(ow._f(r))})),(0,$.Z)(this,"beforeUnloadHandler",(()=>{sw.Ag(this.awareness,[this.doc.clientID],"window unload")})),(0,$.Z)(this,"broadcastMessage",(e=>{var t;this.wsconnected&&(null===(t=this.ws)||void 0===t||t.send(e));this.bcconnected&&this.mux((()=>{ew.nY(this.bcChannel,e)}))})),this.ws=null,this.bcChannel=`wss://playground-api-production-v5.services.teleporthq.io/ws/${this.projectDoc.id}`,this.doc=e,this.awareness=t,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.wsUnsuccessfulReconnects=0,this.messageHandlers=dw.slice(),this.mux=aw.M(),this._synced=!1,this.wsLastMessageReceived=0,this.shouldConnect=!0,this.resyncInterval=0,this.doc.on("update",this.updateHandler),window.addEventListener("beforeunload",this.beforeUnloadHandler),t.on("update",this.awarenessUpdateHandler),this.checkInterval=setInterval((()=>{const e=3e4<tw.ZG()-this.wsLastMessageReceived;var t;this.wsconnected&&e&&(null===(t=this.ws)||void 0===t||t.close())}),3e3),this.connect()}heartbeat(){this.heartbeatTimeout&&clearTimeout(this.heartbeatTimeout),this.heartbeatTimeout=setTimeout((()=>{var e,t,o;(null===(e=this.ws)||void 0===e?void 0:e.readyState)===(null===(t=this.ws)||void 0===t?void 0:t.OPEN)&&(null===(o=this.ws)||void 0===o||o.close())}),4e3)}sendCustomMessage(e,t=0){try{var o;const t=ow.Mf();ow.uE(t,3),ow.uw(t,e),null===(o=this.ws)||void 0===o||o.send(ow._f(t))}catch(n){if(t>=5)throw n;const o=setTimeout((()=>{clearTimeout(o),this.sendCustomMessage(e,++t)}),200)}}get synced(){return this._synced}set synced(e){this._synced!==e&&(this._synced=e,this.emit("synced",[e]),this.emit("sync",[e]))}destroy(){0!==this.resyncInterval&&"number"!==typeof this.resyncInterval&&clearInterval(this.resyncInterval),clearInterval(this.checkInterval),this.disconnect(),window.removeEventListener("beforeunload",this.beforeUnloadHandler),this.awareness.off("update",this.awarenessUpdateHandler),this.doc.off("update",this.updateHandler),super.destroy()}connectBc(){this.bcconnected||(ew.Ld(this.bcChannel,this.bcSubscriber),this.bcconnected=!0),this.mux((()=>{const e=ow.Mf();ow.uE(e,0),iw._J(e,this.doc),ew.nY(this.bcChannel,ow._f(e));const t=ow.Mf();ow.uE(t,0),iw.K0(t,this.doc),ew.nY(this.bcChannel,ow._f(t));const o=ow.Mf();ow.uE(o,3),ew.nY(this.bcChannel,ow._f(o));const n=ow.Mf();ow.uE(n,1),ow.mP(n,sw.xq(this.awareness,[this.doc.clientID])),ew.nY(this.bcChannel,ow._f(n))}))}disconnectBc(){const e=ow.Mf();ow.uE(e,1),ow.mP(e,sw.xq(this.awareness,[this.doc.clientID],new Map)),this.broadcastMessage(ow._f(e)),this.bcconnected&&(ew.r1(this.bcChannel,this.bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),null!==this.ws&&this.ws.close()}connect(){this.shouldConnect=!0,this.wsconnected||(hw(this),this.connectBc())}},Xb=(0,G.Z)(Yb.prototype,"authService",[Wb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qb=(0,G.Z)(Yb.prototype,"projectDoc",[Kb],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yb);var gw,yw,fw,bw,ww,vw,Iw,Sw,jw;gw=(0,J.JJ)("yDocumentManagementFlow"),yw=(0,J.f3)("projectDoc"),fw=(0,J.f3)("projectUIState"),bw=(0,J.f3)("projectFilesFlow"),gw((vw=class{constructor(){(0,z.Z)(this,"projectDoc",Iw,this),(0,z.Z)(this,"projectUIState",Sw,this),(0,z.Z)(this,"projectFilesFlow",jw,this),(0,$.Z)(this,"ydoc",void 0),(0,$.Z)(this,"documentList",void 0),(0,$.Z)(this,"provider",void 0),(0,$.Z)(this,"createOpsInProgress",{}),(0,$.Z)(this,"replaceOpsInProgress",{}),(0,$.Z)(this,"deleteOpsInProgress",{}),(0,$.Z)(this,"branch",null),(0,$.Z)(this,"init",(async()=>{this.ydoc=new Qb.QW({guid:this.projectDoc.id,autoLoad:!0}),this.ydoc.load(),this.provider=new mw(this.ydoc,new sw.GL(this.ydoc)),this.documentList=this.ydoc.getMap(this.projectDoc.id)})),(0,$.Z)(this,"destroy",(()=>{var e,t;null===(e=this.provider)||void 0===e||e.destroy(),null===(t=this.ydoc)||void 0===t||t.destroy()})),(0,$.Z)(this,"getDocument",(()=>this.ydoc)),(0,$.Z)(this,"getAwareness",(()=>this.provider.awareness)),(0,$.Z)(this,"getText",(e=>{const t=this.generateKey(e);return this.documentList.get(t)})),(0,$.Z)(this,"setText",(async(e,t,o=!1)=>{if(this.getText(e)&&"string"===typeof t)return void(await this.replaceText(e,t,o));const n=this.generateKey(e);if(this.createOpsInProgress[n])return;if(o){const e=new Qb.xv(t);return void this.documentList.set(n,e)}const i=setTimeout((()=>{this.projectFilesFlow.toggleFileUnderUpdate(!0)}),500);this.createOpsInProgress[n]=!0;const r=await this.createRemoteFile(n,t);delete this.createOpsInProgress[n],clearTimeout(i),this.projectFilesFlow.toggleFileUnderUpdate(!1),r||this.setText(e,t,!0)})),(0,$.Z)(this,"setTextOnBranch",(async(e,t,o)=>{this.branch=o,await this.setText(e,t),this.branch=null})),(0,$.Z)(this,"replaceText",(async(e,t,o=!1)=>{const n=this.getText(e);if(!n)return void(await this.setText(e,t,o));const i=n.toString();if(i===t)return;const r=this.generateKey(e);if(this.replaceOpsInProgress[r])return;if(o)return void n.applyDelta([{delete:i.length},{insert:t}]);const s=setTimeout((()=>{this.projectFilesFlow.toggleFileUnderUpdate(!0)}),500);this.replaceOpsInProgress[r]=!0;const a=await this.replaceRemoteFile(r,t);delete this.replaceOpsInProgress[r],clearTimeout(s),this.projectFilesFlow.toggleFileUnderUpdate(!1),a||this.replaceText(e,t,!0)})),(0,$.Z)(this,"deleteText",(async(e,t=!1)=>{if(!this.getText(e))return;const o=this.generateKey(e);if(this.deleteOpsInProgress[o])return;if(t)return void this.documentList.delete(o);this.deleteOpsInProgress[o]=!0;const n=await this.deleteRemoteFile(o);delete this.deleteOpsInProgress[o],n||this.deleteText(e,!0)})),(0,$.Z)(this,"initProjectFiles",(async(e,t=0)=>{e=e||this.projectUIState.devMode.selectedBranch;const o=this.projectDoc.projectFiles.local[e].byId,n=Object.keys(o).reduce(((t,n)=>(this.getText(n)||(t[`${e}-${n}`]=o[n].code),t)),{});if(!Object.keys(n).length)return;const i=(0,lt.Z)();this.provider.sendCustomMessage(JSON.stringify({actionId:i,type:"content-init",files:n}));await this.waitForCustomActionResponse(i)||t>=10||await this.initProjectFiles(e,t++)})),(0,$.Z)(this,"addTextAtLine",((e,t,o)=>{const n=this.getText(e);if(!n)return;const i=n.toString().split("\n").slice(0,t-1).join("\n").length;i||"\n"!==o[0]||(o=o.substring(1),o+="\n"),n.insert(i,o)})),(0,$.Z)(this,"removeTextFromLine",((e,t)=>{const o=this.getText(e);if(!o)return;const n=o.toString().split("\n"),i=n.slice(0,t).join("\n").length;if(void 0===n[t])return;const r=n[t].length;o.delete(i,r+1)}))}async createRemoteFile(e,t,o=0){const n=(0,lt.Z)();this.provider.sendCustomMessage(JSON.stringify({actionId:n,type:"content-create",file:e,content:t}));const i=await this.waitForCustomActionResponse(n);return!(!i&&o>=10)&&(!!i||new Promise((n=>{setTimeout((async()=>{const i=await this.createRemoteFile(e,t,++o);n(i)}),1e3)})))}async replaceRemoteFile(e,t,o=0){const n=(0,lt.Z)();this.provider.sendCustomMessage(JSON.stringify({actionId:n,type:"content-replace",file:e,content:t}));const i=await this.waitForCustomActionResponse(n);return!(!i&&o>=10)&&(!!i||this.replaceRemoteFile(e,t,++o))}async deleteRemoteFile(e,t=0){const o=(0,lt.Z)();this.provider.sendCustomMessage(JSON.stringify({actionId:o,type:"content-delete",file:e}));const n=await this.waitForCustomActionResponse(o);return!(!n&&t>=10)&&(!!n||this.deleteRemoteFile(e,++t))}generateKey(e){return`${this.branch||this.projectUIState.devMode.selectedBranch}-${e}`}async waitForCustomActionResponse(e){return new Promise((t=>{const o=setTimeout((()=>{clearTimeout(o),t(!1)}),1e3);this.provider.on(e,(()=>{clearTimeout(o),t(!0)}))}))}async waitForPeersConnection(){return new Promise((e=>{const t=setTimeout((async()=>{var t,o;null===(t=this.provider)||void 0===t||t.disconnect(),null===(o=this.provider)||void 0===o||o.destroy(),this.provider=new mw(this.ydoc,new sw.GL(this.ydoc)),await this.waitForPeersConnection(),e(!0)}),1e4);this.provider.on("synced",(()=>{clearTimeout(t),e(!0)}))}))}},Iw=(0,G.Z)(vw.prototype,"projectDoc",[yw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sw=(0,G.Z)(vw.prototype,"projectUIState",[fw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jw=(0,G.Z)(vw.prototype,"projectFilesFlow",[bw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ww=vw));var Dw,Ow,Fw,Tw,Nw,Ew,Cw,xw,Pw,kw,Mw,Zw,Uw,Aw,Lw,_w,Rw,Bw,Hw,zw,$w,Gw,Vw,Jw,Ww,Kw,Yw,Xw,qw,Qw,ev,tv,ov,nv,iv,rv,sv;function av(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function lv(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?av(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):av(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}Dw=(0,J.JJ)("githubFlow"),Ow=(0,J.f3)("projectDoc"),Fw=(0,J.f3)("projectUIState"),Tw=(0,J.f3)("globalAppState"),Nw=(0,J.f3)("githubRepository"),Ew=(0,J.f3)("notificationsManagementFlow"),Cw=(0,J.f3)("userAccountRepository"),xw=(0,J.f3)("projectFilesFlow"),Pw=(0,J.f3)("navbarFlow"),kw=(0,J.f3)("yDocumentManagementFlow"),Mw=(0,J.f3)("rtcFlow"),Zw=(0,J.f3)("guardsService"),Uw=(0,J.f3)("modalManagementFlow"),Aw=(0,J.f3)("sharedbProjectSyncService"),Lw=(0,J.f3)("conflictManagementFlow"),_w=(0,J.f3)("remoteChangesFlow"),Rw=(0,J.f3)("sentryService"),Bw=(0,q.G)(te.l.DEV_LOAD_COMMITS),Hw=(0,q.G)(te.l.DEV_LOAD_BRANCHES),Dw(($w=class{constructor(){(0,z.Z)(this,"projectDoc",Gw,this),(0,z.Z)(this,"projectUIState",Vw,this),(0,z.Z)(this,"globalAppState",Jw,this),(0,z.Z)(this,"githubRepository",Ww,this),(0,z.Z)(this,"notificationsManagementFlow",Kw,this),(0,z.Z)(this,"userAccountRepository",Yw,this),(0,z.Z)(this,"projectFilesFlow",Xw,this),(0,z.Z)(this,"navbarFlow",qw,this),(0,z.Z)(this,"yDocumentManagementFlow",Qw,this),(0,z.Z)(this,"rtcFlow",ev,this),(0,z.Z)(this,"guardsService",tv,this),(0,z.Z)(this,"modalManagementFlow",ov,this),(0,z.Z)(this,"dbSync",nv,this),(0,z.Z)(this,"conflictManagementFlow",iv,this),(0,z.Z)(this,"remoteChangesFlow",rv,this),(0,z.Z)(this,"sentryService",sv,this),(0,$.Z)(this,"loadCommitDetails",(async e=>{const t=await this.loadCommitFiles(e);if(!t)return;const o=t.files.reduce(((e,t)=>(e[`${Qt.y$}/${t.filename}`]={code:t.content,status:t.status},e)),{}),n=this.projectDoc.projectFiles.pack({filesToPack:o,assets:{}});(0,V.JG)(this.projectUIState,(i=>{const r=i.devMode.githubCommits[e];r&&(r.details={files:o,stats:t.stats,hierarchy:n})}))})),(0,$.Z)(this,"mergeBranches",(async(e,t)=>{if(!this.projectDoc.stats.github)return;const{repositoryName:o,repositoryOwner:n}=this.projectDoc.stats.github;if(o&&n){(0,V.JG)(this.projectUIState,(e=>{e.devMode.githubOperationInProgress="merge"}));try{await this.githubRepository.mergeBranches(this.projectDoc.id,{repository:o,owner:n,base:e,head:t}),this.loadProjectCommits(),this.notificationsManagementFlow.createNotification(K.k.SUCCESS,`${t} was merged into ${e}`)}catch(i){(0,V.JG)(this.projectUIState,(e=>{e.devMode.githubOperationInProgress=null}));try{if("merge conflict"===JSON.parse(i.message).error.toLowerCase())return void(await this.conflictManagementFlow.handleMergeConflict(e,t))}catch(i){}this.notificationsManagementFlow.createNotification(K.k.ERROR,"Could not merge branches")}(0,V.JG)(this.projectUIState,(e=>{e.devMode.githubOperationInProgress=null}))}})),(0,$.Z)(this,"deleteBranch",(async e=>{var t;if(!this.projectDoc.stats.github)return;const{repositoryName:o,repositoryOwner:n}=this.projectDoc.stats.github;if(!o||!n)return;if(Object.keys(null===(t=this.projectDoc.projectFiles.staged[e])||void 0===t?void 0:t.byId).length)return void this.notificationsManagementFlow.createNotification(K.k.ERROR,"You have staged changes inside this branch. Commit or discard them before");if(this.computeFilesWithDiffs(e).length)this.notificationsManagementFlow.createNotification(K.k.ERROR,"You have changes inside this branch. Commit or discard them before");else try{await this.githubRepository.deleteBranch(this.projectDoc.id,{repository:o,owner:n,branch:e}),this.guardsService.executeAsyncFunctionGuarded(to._.DISABLE_HISTORY,(async()=>{this.dbSync.mutate(this.projectDoc,(t=>{delete t.projectFiles.local[e],delete t.projectFiles.remote[e]}))})),this.notificationsManagementFlow.createNotification(K.k.SUCCESS,`${e} branch was removed`)}catch(i){this.notificationsManagementFlow.createNotification(K.k.ERROR,"Could not delete branches")}})),(0,$.Z)(this,"changeBranch",(async(e,t=!0,o=0)=>{const n=this.projectUIState.devMode.githubBranches.byId[e];if(!n){if(0!==o)return;return await this.loadProjectBranches(),void(await this.changeBranch(e,t,++o))}if(this.projectUIState.devMode.selectedBranch===n.name)return;this.projectFilesFlow.deleteAllFileViewState();const i="remote"===n.type;i&&(0,V.JG)(this.projectUIState,(e=>{e.devMode.githubOperationInProgress="pull-branch"})),await this.loadProjectCommits(n.name),"remote"===n.type&&await this.loadProjectBranches(),(0,V.JG)(this.projectUIState,(t=>{t.devMode.githubBranches.underRename=null,t.devMode.selectedBranch=e,t.devMode.githubOperationInProgress=null})),this.computeFilesWithDiffs();const r=this.navbarFlow.getCurrentTabs();Object.values(r).forEach((t=>{var o;null!==(o=this.projectDoc.projectFiles.local[e])&&void 0!==o&&o.byId[t.entityId]||this.navbarFlow.deleteTab(t.id)})),t&&(await this.storeCurrentBranch(e),this.rtcFlow.changeGithubBranch(e)),i&&await this.projectFilesFlow.generateProject({reSync:!0})})),(0,$.Z)(this,"storeCurrentBranch",(async e=>{(0,V.JG)(this.globalAppState,(({user:t})=>{t&&t.userData&&(t.userData.meta.githubBranches=lv(lv({},t.userData.meta.githubBranches),{},{[this.projectDoc.id]:e}))}));const{userData:t}=this.globalAppState.user;t&&await this.userAccountRepository.update({meta:t.meta})})),(0,$.Z)(this,"toggleTokenValidity",(e=>{(0,V.JG)(this.projectUIState,(t=>{const o=null!==e&&void 0!==e?e:!t.devMode.githubTokenValid;t.devMode.githubTokenValid=o}))}))}async init(){(0,V.JG)(this.projectUIState,(e=>{e.devMode.githubInitializing=!0}));const e=await this.checkUserAccessToRepository();(0,V.JG)(this.projectUIState,(e=>{e.devMode.githubInitializing=!1})),e&&(this.loadProjectBranches(),this.loadProjectCommits())}computeFilesWithDiffs(e){var t,o,n,i,r;e=null!==(t=e)&&void 0!==t?t:this.projectUIState.devMode.selectedBranch;const s=(null===(o=this.projectDoc.projectFiles.local)||void 0===o||null===(n=o[e])||void 0===n?void 0:n.byId)||{},a=(null===(i=this.projectDoc.projectFiles.remote)||void 0===i||null===(r=i[e])||void 0===r?void 0:r.byId)||{},l=this.projectDoc.assets.byId,c=Object.keys(l).reduce(((e,t)=>(e[`${Qt.Wn}/playground_assets/${l[t].name}`]={code:"",is_asset:!0},e)),{}),d=new Set([...Object.keys(s),...Object.keys(a),...Object.keys(c)]);return Array.from(d).map((t=>{var o,n;const i=this.computeFileDiffType({file:t,branch:e,isAsset:(null===(o=c[t])||void 0===o?void 0:o.is_asset)||(null===(n=a[t])||void 0===n?void 0:n.is_asset)});return i?{path:t,diffType:i}:null})).filter(Boolean)}stageFiles(e){var t,o,n,i;const{doc:r,files:s}=e;if(!r||!s.length)return;const a=this.projectUIState.devMode.selectedBranch,l=(null===(t=r.projectFiles.local)||void 0===t||null===(o=t[a])||void 0===o?void 0:o.byId)||{},c=(null===(n=r.projectFiles.remote)||void 0===n||null===(i=n[a])||void 0===i?void 0:i.byId)||{};r.projectFiles.staged[a]||(r.projectFiles.staged[a]={byId:{}});for(const d of s){let e;switch(d.diffType){case Wm.E.REMOVED:e=c[d.path];break;case Wm.E.MODIFIED:case Wm.E.NEW:e=l[d.path];break;default:throw new Error(`Could not find file to stag: ${d.path}`)}r.projectFiles.staged[a].byId[d.path]=lv(lv({},e),{},{status:d.diffType}),this.navbarFlow.syncDevTabsAfterFileStage({doc:r,file:d.path})}}unstageFile(e){const{doc:t,fileId:o}=e;if(!t)return;const n=this.projectUIState.devMode.selectedBranch,i=t.projectFiles.staged[n].byId;Object.keys(i).forEach((e=>{if(e===o||e.startsWith(`${o}/`)){delete i[e];const o=this.computeFileDiffType({doc:t,file:e});if(!o)return;this.navbarFlow.syncDevTabsAfterUnstageFile(e,o)}}))}discardChanges(e){const{doc:t,files:o}=e;if(!t||!o.length)return;const n=this.projectUIState.devMode.selectedBranch,i=t.projectFiles.remote[n].byId;for(const s of o){var r;switch(s.diffType){case Wm.E.REMOVED:{const e=i[s.path];if(!e)throw new Error(`Tried to discard deleted file and remote does not exist:${s.path} `);return void this.projectFilesFlow.saveFile({doc:t,fileName:s.path,overwrite:!0,content:e.code})}case Wm.E.NEW:this.projectFilesFlow.deleteFile({doc:t,fileId:s.path});break;case Wm.E.MODIFIED:{const e=i[s.path];if(!e)throw new Error(`Tried to discard updated file and remote does not exist:${s.path} `);this.projectFilesFlow.updateFile({doc:t,fileId:s.path,content:e.code}),this.yDocumentManagementFlow.replaceText(s.path,e.code);break}}if((null===(r=this.projectUIState.devMode.selectedDiffingFile)||void 0===r?void 0:r.path)===s.path){const e=this.navbarFlow.getSelectedTab();s.diffType===Wm.E.NEW?this.projectFilesFlow.selectNextAvailableFile({doc:t,fileToStartFrom:s.path}):this.projectFilesFlow.setSelectedFile({doc:t,path:s.path}),e.id!==this.projectUIState.navbar.newTabId&&(0,V.JG)(this.projectUIState,(t=>{delete t.navbar.devModeTabs[e.id]}))}}}async checkUserAccessToRepository(){var e;const t=this.globalAppState.user.userData;if(!this.projectDoc.stats.github||null===t||void 0===t||!t.githubToken||null===(e=t.githubScope)||void 0===e||!e.includes("repo"))return!1;const{repositoryName:o,repositoryOwner:n}=this.projectDoc.stats.github;if(!o||!n)return!1;try{const e=await this.githubRepository.checkIfUserHasAccessToRepo(this.projectDoc.id,n,o);return(0,V.JG)(this.projectUIState,(t=>{t.devMode.hasAccessToGithubRepo=e})),e}catch(i){return this.sentryService.captureException(i),!1}}async loadProjectCommits(e){var t;const o=this.globalAppState.user.userData;if(!this.projectDoc.stats.github||null===o||void 0===o||!o.githubToken||null===(t=o.githubScope)||void 0===t||!t.includes("repo"))return;const{repositoryName:n,repositoryOwner:i}=this.projectDoc.stats.github;if(!n||!i)return;e=e||this.projectUIState.devMode.selectedBranch;this.projectDoc.projectFiles.remote[e]||(0,V.JG)(this.projectUIState,(e=>{e.devMode.githubCommits={}}));try{const t=await this.githubRepository.getCommits(this.projectDoc.id,{sha:e,repository:n,owner:i});await this.remoteChangesFlow.applyRemoteChanges(t,e),(0,V.JG)(this.projectUIState,(e=>{e.devMode.githubCommits={},t.forEach((t=>{e.devMode.githubCommits[t.sha]=t}))}))}catch(r){const e="Could not get project commits";if(this.parseGithubError(r,e))return;this.notificationsManagementFlow.createNotification(K.k.ERROR,e)}}async createNewBranch(){await this.loadProjectBranches();const e=Object.values(this.projectUIState.devMode.githubBranches.byId).map((e=>e.name)),t=(0,W.Zu)(e,"new-branch").trim(),o=(0,lt.Z)();(0,V.JG)(this.projectUIState,(e=>{e.devMode.githubBranches.byId[o]={name:t,type:"local"},e.devMode.githubBranches.underRename=o,e.devMode.githubBranches.underCreationSource=`${e.devMode.selectedBranch}`,e.devMode.selectedBranch=t})),this.computeFilesWithDiffs()}async confirmBranchName(e){const{branchId:t,newName:o}=e;if(!this.projectDoc.stats.github)return;const n=this.projectUIState.devMode.githubBranches.underCreationSource;if(!n)return;const{repositoryName:i,repositoryOwner:r}=this.projectDoc.stats.github;if(!i||!r)return;const s=Object.values(this.projectUIState.devMode.githubBranches.byId).map((e=>e.name)),a=o.replace(/\s+/g," ").trim().replace(/^-+/,"").replace(/^\.|\/\.|\.\.|~|\^|:|\/$|\.lock$|\.lock\/|\\|\*|\s|^\s*$|\.$|\[|\]$/g,"-").toLowerCase();const l=(0,W.Zu)(s,a).trim();try{await this.githubRepository.createBranch(this.projectDoc.id,{repository:i,owner:r,sourceBranch:n,newBranch:l}),this.projectFilesFlow.copyFilesToDifferentBranch({sourceBranch:n,destBranch:l})}catch(c){throw new Error("Could not create branch")}await this.storeCurrentBranch(l),await this.yDocumentManagementFlow.initProjectFiles(l),this.computeFilesWithDiffs(),(0,V.JG)(this.projectUIState,(e=>{e.devMode.githubBranches.byId[l]=lv(lv({},e.devMode.githubBranches.byId[t]),{},{name:l}),delete e.devMode.githubBranches.byId[t],e.devMode.selectedBranch=l,e.devMode.githubBranches.underRename=null,e.devMode.githubBranches.underCreationSource=null})),this.rtcFlow.changeGithubBranch(l)}async loadProjectBranches(){var e;const t=this.globalAppState.user.userData;if(!this.projectDoc.stats.github||null===t||void 0===t||!t.githubToken||null===(e=t.githubScope)||void 0===e||!e.includes("repo"))return;const{repositoryName:o,repositoryOwner:n}=this.projectDoc.stats.github;if(o&&n)try{const e=(await this.githubRepository.getBranches(this.projectDoc.id,n,o)).map((e=>({name:e.name,type:"remote"}))),t=Object.keys(this.projectDoc.projectFiles.local).map((t=>{const o=e.some((e=>e.name===t));return{name:t,type:o?"both":"local"}})),i=e.filter((e=>!t.some((t=>t.name===e.name)))),r=[...t,...i];(0,V.JG)(this.projectUIState,(e=>{e.devMode.githubBranches.byId={},r.forEach((t=>{e.devMode.githubBranches.byId[t.name]=t}))}))}catch(i){const e="Could not get project branches";if(this.parseGithubError(i,e))return;this.notificationsManagementFlow.createNotification(K.k.ERROR,e)}}async loadCommitFiles(e){if(!this.projectDoc.stats.github)return null;const{repositoryName:t,repositoryOwner:o}=this.projectDoc.stats.github;if(!t||!o)return null;try{return await this.githubRepository.getCommitDetails(this.projectDoc.id,{ref:e,repository:t,owner:o})}catch(n){return this.notificationsManagementFlow.createNotification(K.k.ERROR,"Could not get commit details"),null}}cleanupUnexistingRepoData(e){var t,o;e&&(null!==(t=e.stats.github)&&void 0!==t&&t.repositoryUrl||(Object.keys(e.projectFiles.conflicts).length&&(e.projectFiles.conflicts={}),Object.keys(e.projectFiles.remote).length&&(e.projectFiles.remote={}),(Object.keys(e.projectFiles.staged).length>1||Object.keys((null===(o=e.projectFiles.staged[Qt.y$])||void 0===o?void 0:o.byId)||{}).length)&&(e.projectFiles.staged={[Qt.cY]:{byId:{}}}),Object.keys(e.projectFiles.local).forEach((t=>{e.projectFiles.local[t].lastSha=void 0,e.projectFiles.local[t].sourceBranch=void 0}))))}computeFileDiffType(e){var t,o,n,i,r,s,a,l,c,d,p;const{doc:u,file:h,isAsset:m}=e;if(!u)return;let{branch:g}=e;g=g||this.projectUIState.devMode.selectedBranch;const y=(null===(t=u.projectFiles.local)||void 0===t||null===(o=t[g])||void 0===o?void 0:o.byId)||{},f=(null===(n=u.projectFiles.staged)||void 0===n||null===(i=n[g])||void 0===i?void 0:i.byId)||{},b=(null===(r=u.projectFiles.remote)||void 0===r||null===(s=r[g])||void 0===s?void 0:s.byId)||{};if(m){const e=h.split("/").pop()||"",t=u.assets.findAssetUsingName(e);return!b[h]||t||f[h]?!t||b[h]||f[h]?null:Wm.E.NEW:Wm.E.REMOVED}const w=null===(a=y[h])||void 0===a?void 0:a.code,v=null!==(l=null===(c=f[h])||void 0===c?void 0:c.code)&&void 0!==l?l:null===(d=b[h])||void 0===d?void 0:d.code,I=void 0!==w,S=void 0!==v,j=void 0!==(null===(p=f[h])||void 0===p?void 0:p.code),D=I&&S&&w!==v,O=I&&!S;return D||O||S&&!I?!I&&j?null:D?Wm.E.MODIFIED:O?Wm.E.NEW:Wm.E.REMOVED:null}parseGithubError(e,t){try{var o;const n=JSON.parse(e.message).error.toLowerCase(),i=-1!==n.indexOf("unauthorized")||-1!==n.indexOf("bad credentials"),r=-1!==n.indexOf("not found");if(!i&&!r)return!1;if(r)return this.notificationsManagementFlow.createNotification(K.k.ERROR,`Make sure the repository exists and you have enough permissions. ${t}`),!0;return(null===(o=this.globalAppState.user.userData)||void 0===o?void 0:o.githubToken)&&this.userAccountRepository.update({githubScope:null,githubToken:null}),this.notificationsManagementFlow.createNotification(K.k.ERROR,`Your GitHub access token is invalid or expired. ${t}`),this.toggleTokenValidity(!1),!0}catch(n){return!1}}},Gw=(0,G.Z)($w.prototype,"projectDoc",[Ow],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vw=(0,G.Z)($w.prototype,"projectUIState",[Fw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jw=(0,G.Z)($w.prototype,"globalAppState",[Tw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ww=(0,G.Z)($w.prototype,"githubRepository",[Nw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kw=(0,G.Z)($w.prototype,"notificationsManagementFlow",[Ew],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yw=(0,G.Z)($w.prototype,"userAccountRepository",[Cw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xw=(0,G.Z)($w.prototype,"projectFilesFlow",[xw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qw=(0,G.Z)($w.prototype,"navbarFlow",[Pw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Qw=(0,G.Z)($w.prototype,"yDocumentManagementFlow",[kw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ev=(0,G.Z)($w.prototype,"rtcFlow",[Mw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tv=(0,G.Z)($w.prototype,"guardsService",[Zw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ov=(0,G.Z)($w.prototype,"modalManagementFlow",[Uw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nv=(0,G.Z)($w.prototype,"dbSync",[Aw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iv=(0,G.Z)($w.prototype,"conflictManagementFlow",[Lw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rv=(0,G.Z)($w.prototype,"remoteChangesFlow",[_w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sv=(0,G.Z)($w.prototype,"sentryService",[Rw],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)($w.prototype,"stageFiles",[io],Object.getOwnPropertyDescriptor($w.prototype,"stageFiles"),$w.prototype),(0,G.Z)($w.prototype,"unstageFile",[io],Object.getOwnPropertyDescriptor($w.prototype,"unstageFile"),$w.prototype),(0,G.Z)($w.prototype,"discardChanges",[io],Object.getOwnPropertyDescriptor($w.prototype,"discardChanges"),$w.prototype),(0,G.Z)($w.prototype,"loadProjectCommits",[Bw],Object.getOwnPropertyDescriptor($w.prototype,"loadProjectCommits"),$w.prototype),(0,G.Z)($w.prototype,"loadProjectBranches",[Hw],Object.getOwnPropertyDescriptor($w.prototype,"loadProjectBranches"),$w.prototype),(0,G.Z)($w.prototype,"cleanupUnexistingRepoData",[Q.P],Object.getOwnPropertyDescriptor($w.prototype,"cleanupUnexistingRepoData"),$w.prototype),(0,G.Z)($w.prototype,"computeFileDiffType",[Q.P],Object.getOwnPropertyDescriptor($w.prototype,"computeFileDiffType"),$w.prototype),zw=$w));var cv=o(19604),dv=o(24642);function pv(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function uv(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?pv(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):pv(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const hv=e=>{const{0:t,1:o}=(0,pr.useState)(window.innerWidth-500);(0,pr.useEffect)((()=>(window.addEventListener("resize",n),()=>window.removeEventListener("resize",n))),[]);const n=()=>{o(window.innerWidth-500)};return(0,gr.jsxs)("div",{tabIndex:0,className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]]),children:[(0,gr.jsxs)("div",{className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]])+" merge-title",children:[(0,gr.jsxs)("div",{className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]]),children:[" ",e.title]}),(0,gr.jsx)("div",{className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]]),children:(0,gr.jsx)(ur.z,{style:"solid",size:"medium",isDisabled:!e.canSave||e.solveInProgress,isLoading:e.solveInProgress,onClick:e.handleSave,children:"Save"})})]}),(0,gr.jsx)("div",{tabIndex:0,className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]])+" merge-root",children:(0,gr.jsx)(dv.Z,{cursor:"col-resize",columnMinSizes:[286,0,t],render:({getGridProps:t,getGutterProps:o})=>(0,gr.jsxs)("div",uv(uv({},t()),{},{className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]])+" merge-grid",children:[(0,gr.jsx)("div",{className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]])+" merge-sidebar",children:e.sidebar}),(0,gr.jsx)("div",uv(uv({},o("column",1)),{},{className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]])+" gutter-column"})),(0,gr.jsx)("div",{className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]]),children:(0,gr.jsx)(dv.Z,{cursor:"row-resize",rowMinSizes:{0:250,1:0,2:250},render:({getGridProps:t,getGutterProps:o})=>(0,gr.jsxs)("div",uv(uv({},t()),{},{className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]])+" merge-row-grid",children:[(0,gr.jsx)("div",{className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]])+" split-container",children:(0,gr.jsx)(dv.Z,{cursor:"col-resize",columnMinSizes:[100,0,100],render:({getGridProps:t,getGutterProps:o})=>(0,gr.jsxs)("div",uv(uv({},t()),{},{className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]])+" editors-merge-grid",children:[(0,gr.jsxs)("div",{className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]]),children:[(0,gr.jsx)("div",{className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]])+" merge-diff-header",children:(0,gr.jsx)("div",{className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]]),children:"Local changes"})}),e.localContentEditor]}),(0,gr.jsx)("div",uv(uv({},o("column",1)),{},{className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]])+" gutter-column"})),(0,gr.jsxs)("div",{className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]]),children:[(0,gr.jsx)("div",{className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]])+" merge-diff-header",children:(0,gr.jsx)("div",{className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]]),children:"Remote changes"})}),e.remoteContentEditor]})]}))})}),(0,gr.jsx)("div",uv(uv({},o("row",1)),{},{className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]])+" gutter-row"})),(0,gr.jsxs)("div",{className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]])+" split-container",children:[(0,gr.jsxs)("div",{className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]])+" merge-output-header",children:[(0,gr.jsx)("span",{className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]]),children:"Output"}),(0,gr.jsxs)("div",{className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]])+" merge-output-actions-container",children:[(0,gr.jsx)("div",{className:ss.default.dynamic([["4173912909",[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT]]])+" merge-output-action",children:(0,gr.jsxs)(ur.z,{size:"tiny",onClick:e.handleResolve,isDisabled:e.resolved,children:["Mark resolved"," "]})}),(0,gr.jsx)(ur.z,{size:"tiny",style:"outline",isDisabled:e.resetInProgress,isLoading:e.resetInProgress,onClick:e.handleReset,children:"Reset"})]})]}),e.outputEditor]})]}))})})]}))})}),(0,gr.jsx)(ss.default,{id:"4173912909",dynamic:[Ki.Pt.DARK_01,Ki.Pt.DARK_01,Ki.kg.ONEHUNDRED,Ki.kg.ONEHUNDRED,Ki.X4.DEFAULT],children:[".merge-root.__jsx-style-dynamic-selector{height:90vh;width:90vw;border-radius:0 0 4px 4px;}",`.merge-sidebar.__jsx-style-dynamic-selector{background-color:${Ki.Pt.DARK_01};padding:10px;border-radius:0 0 0 4px;}`,".split-container.__jsx-style-dynamic-selector{overflow:hidden;}",`.merge-title.__jsx-style-dynamic-selector{height:50px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;background-color:${Ki.Pt.DARK_01};margin-bottom:2px;border-radius:4px 4px 0 0;padding:10px;}`,".merge-grid.__jsx-style-dynamic-selector{display:grid;height:100%;grid-template-rows:100%;grid-template-columns:286px 0px 1fr;}",".editors-merge-grid.__jsx-style-dynamic-selector{display:grid;height:100%;grid-template-rows:100%;grid-template-columns:1fr 0px 1fr;}",".merge-row-grid.__jsx-style-dynamic-selector{display:grid;height:100%;grid-template-rows:1fr 5px 1fr;grid-template-columns:100%;}",`.gutter-row.__jsx-style-dynamic-selector{cursor:row-resize;width:100%;height:5px;-webkit-transition:0.4s all;transition:0.4s all;z-index:${Ki.kg.ONEHUNDRED};}`,`.gutter-column.__jsx-style-dynamic-selector{cursor:col-resize;width:5px;height:100%;-webkit-transition:0.4s all;transition:0.4s all;z-index:${Ki.kg.ONEHUNDRED};}`,`.gutter-column.__jsx-style-dynamic-selector:active,.gutter-row.__jsx-style-dynamic-selector:active,.gutter-row.__jsx-style-dynamic-selector:hover,.gutter-column.__jsx-style-dynamic-selector:hover{background:${Ki.X4.DEFAULT};}`,".merge-diff-header.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;padding:4px;height:28px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}",".merge-diff-header.__jsx-style-dynamic-selector>div.__jsx-style-dynamic-selector{margin-left:16px;}",".merge-output-header.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:4px 8px;height:28px;}",".merge-output-actions-container.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}",".merge-output-action.__jsx-style-dynamic-selector{margin-right:8px;}"]})]})},mv=(e,t)=>{let o=!0,n=e.startLine;for(;n<=e.endLine&&o;){t.some((e=>e.line===n))||(o=!1),n+=1}return o},gv=(e,t)=>Object.keys(e).every((o=>t[o]&&mv(e[o],t[o]||[]))),yv=(e,t=[],o,n)=>{const i=o.split("\n"),r=[];if(e.negativeRange)for(let s=e.endLine-2;s>e.startLine;s--){t.find((e=>e.line===s+1&&e.source===n))||r.push({content:i[s],line:s+1,source:n})}else for(let s=e.startLine-1;s<e.endLine;s++){t.find((e=>e.line===s+1&&e.source===n))||r.push({content:i[s],line:s+1,source:n})}return r};class fv{constructor(e){(0,$.Z)(this,"diffDecorations",{}),(0,$.Z)(this,"fullySelectedDiffs",[]),(0,$.Z)(this,"editor",void 0),(0,$.Z)(this,"monaco",void 0),(0,$.Z)(this,"diffs",void 0),(0,$.Z)(this,"usedLines",void 0),(0,$.Z)(this,"usedZones",[]),(0,$.Z)(this,"highlightDiffs",(e=>{this.addUsedLinesDecorations(),Object.keys(this.diffs).forEach((t=>{const o=this.diffs[t];if(o.negativeRange)return;const n=this.diffDecorations[t].highlight;this.diffDecorations[t].highlight=this.editor.deltaDecorations(n,this.generateDiffHighlightDecoration(o,e));const i=this.generateSelectAllDiffDecoration(o.middleLine),r=this.diffDecorations[t].selectAll;this.diffDecorations[t].selectAll=this.editor.deltaDecorations(r,i)}))}));const{diffs:t,usedLines:o,editor:n,monaco:i}=e;n&&(this.editor=n),i&&(this.monaco=i),this.diffs=t||{},this.usedLines=o||{},Object.keys(this.diffs).forEach((e=>{this.diffDecorations[e]={selectAll:[],hoveredLines:[],usedLines:[],highlight:[]}}))}setEditor(e,t){this.editor=e,this.monaco=t}addActionOnUsedLines(e){this.usedLines=e,this.addUsedLinesDecorations()}addConflictingZones(e){this.editor.changeViewZones((t=>{this.usedZones.forEach((e=>{t.removeZone(e)})),Object.values(e).forEach((e=>{const o=document.createElement("div");o.style.backgroundImage="linear-gradient( -45deg, #808080 12.5%, #262626 12.5%, #262626 50%, #808080 50%, #808080 62.5%, #262626 62.5%, #262626 100% )",o.style.backgroundSize="8px 8px";const n={afterLineNumber:e.start,heightInLines:e.height,domNode:o};this.usedZones.push(t.addZone(n))}))}))}handleHoverOverLine(e,t){var o,n;const i=this.diffDecorations[e].hoveredLines||[];(null===(o=this.usedLines)||void 0===o||null===(n=o[e])||void 0===n?void 0:n.some((e=>e.line===t)))?this.diffDecorations[e].hoveredLines=this.editor.deltaDecorations(i,this.generateLineActionDecoration(t,!1)):this.diffDecorations[e].hoveredLines=this.editor.deltaDecorations(i,this.generateLineActionDecoration(t))}handleMouseLeave(){Object.keys(this.diffDecorations).forEach((e=>{const t=this.diffDecorations[e].hoveredLines||[];this.diffDecorations[e].hoveredLines=this.editor.deltaDecorations(t,[])}))}highlightUsedDiff(e){const t=this.diffs[e];if(!t)return;this.fullySelectedDiffs.push(e);const o=this.diffDecorations[e].selectAll||[];this.diffDecorations[e].selectAll=this.editor.deltaDecorations(o,this.generateCheckedDecoration(t.middleLine));const n=this.diffDecorations[e].usedLines||[],i=[];for(let r=t.startLine;r<=t.endLine;r++)i.push(...this.generateLineActionDecoration(r));this.diffDecorations[e].usedLines=this.editor.deltaDecorations(n,i)}removeUsedDiffHighlight(e){const t=this.diffs[e];if(!t)return;const o=this.fullySelectedDiffs.indexOf(e);this.fullySelectedDiffs.splice(o,1);const n=this.diffDecorations[e].selectAll||[];this.diffDecorations[e].selectAll=this.editor.deltaDecorations(n,this.generateSelectAllDiffDecoration(t.middleLine));const i=this.diffDecorations[e].usedLines||[];this.diffDecorations[e].usedLines=this.editor.deltaDecorations(i,[])}addUsedLinesDecorations(){Object.keys(this.usedLines).length?Object.keys(this.usedLines).forEach((e=>{var t,o;const n=this.diffs[e],i=this.usedLines[e];if(!n)return;if(mv(n,i)&&!n.negativeRange&&i.length)return void this.highlightUsedDiff(e);-1!==this.fullySelectedDiffs.indexOf(e)&&this.removeUsedDiffHighlight(e);const r=(null===(t=this.diffDecorations)||void 0===t||null===(o=t[e])||void 0===o?void 0:o.usedLines)||[],s=[];i.forEach((e=>{s.push(...this.generateLineActionDecoration(e.line))})),this.diffDecorations[e]||(this.diffDecorations[e]={usedLines:[],selectAll:[],hoveredLines:[],highlight:[]}),this.diffDecorations[e].usedLines=this.editor.deltaDecorations(r,s)})):this.removeAllDecorations()}removeAllDecorations(){Object.keys(this.diffDecorations).forEach((e=>{const t=this.diffDecorations[e].usedLines;this.diffDecorations[e].usedLines=this.editor.deltaDecorations(t,[])})),Object.keys(this.diffs).forEach((e=>{const t=this.diffs[e];if(t.negativeRange)return;const o=this.diffDecorations[e].selectAll;this.diffDecorations[e].selectAll=this.editor.deltaDecorations(o,[]);const n=this.generateSelectAllDiffDecoration(t.middleLine);this.diffDecorations[e].selectAll=this.editor.deltaDecorations([],n)}))}generateSelectAllDiffDecoration(e){return[{range:new this.monaco.Range(e,0,e,0),options:{isWholeLine:!0,glyphMarginClassName:"diffing-editor-glyph-unchecked"}}]}generateDiffHighlightDecoration(e,t){return[{range:new this.monaco.Range(e.startLine,0,e.endLine,0),options:{isWholeLine:!0,className:t?"diffing-editor-remote":"diffing-editor",glyphMarginClassName:t?"diffing-editor-remote-glyph":"diffing-editor-glyph"}}]}generateCheckedDecoration(e){return[{range:new this.monaco.Range(e,0,e,0),options:{isWholeLine:!0,className:"diffing-editor",glyphMarginClassName:"diffing-editor-glyph-checked"}}]}generateLineActionDecoration(e,t=!0){return[{range:new this.monaco.Range(e,1,e,1),options:{isWholeLine:!0,linesDecorationsClassName:t?"editor-add-line":"editor-remove-line"}}]}}const bv=e=>{const{0:t,1:o}=(0,pr.useState)(null),{0:n,1:i}=(0,pr.useState)(null),{0:r}=(0,pr.useState)((()=>new fv({editor:t,monaco:n,usedLines:e.usedLines,diffs:e.diffs})));(0,pr.useEffect)((()=>{t&&n&&r&&(r.setEditor(t,n),r.highlightDiffs(!!e.isRemote),r.addActionOnUsedLines(e.usedLines))}),[t,n,e.usedLines,r]),(0,pr.useEffect)((()=>{if(!t||!n||!e.conflictingDiffs||!e.diffs)return;const o=Object.keys(e.conflictingDiffs).map((t=>{const o=e.conflictingDiffs[t],n=e.diffs[t];if(!o||!n)return null;const i=n.endLine>0?n.endLine-n.startLine+1:0,r=o.endLine>0?o.endLine-o.startLine+1:0;if(r>i){return{start:Math.max(n.startLine,n.endLine),height:r-i}}return null})).filter(Boolean);r.addConflictingZones(o)}),[t,n,e.conflictingDiffs,e.diffs]),(0,pr.useEffect)((()=>{if(!t)return;const e=t.onMouseDown((e=>{a(e)})),o=t.onMouseMove((e=>{s(e)})),n=t.onMouseLeave((()=>{r.handleMouseLeave()}));return()=>{e.dispose(),o.dispose(),n.dispose()}}),[t,e.usedLines]);const s=e=>{var t;const o=null===(t=e.target.position)||void 0===t?void 0:t.lineNumber;if(!o)return;const n=l(o);n?r.handleHoverOverLine(n,o):r.handleMouseLeave()},a=t=>{var o;if(!t.event.leftButton)return;const n=t.target.element,i=null===(o=t.target.position)||void 0===o?void 0:o.lineNumber;if(!i)return;const{diffs:s}=e,a=l(i);if(!a)return;const u=null===n||void 0===n?void 0:n.classList.contains("diffing-editor-glyph-unchecked"),h=null===n||void 0===n?void 0:n.classList.contains("diffing-editor-glyph-checked");if(!u&&!h)return void c(a,i);const m=Object.keys(s).find((e=>s[e].middleLine===i));return m?h?(p(m),void r.removeUsedDiffHighlight(m)):void d(m):void 0},l=t=>{const{diffs:o}=e;return Object.keys(o).find((e=>{const n=o[e];return n.startLine<=t&&n.endLine>=t}))},c=(t,o)=>{var n;const{isRemote:i,usedLines:r,value:s}=e,a=null===r||void 0===r||null===(n=r[t])||void 0===n?void 0:n.find((e=>e.line===o&&e.source===(i?"remote":"local")));if(a)return void e.handleRemoveLines(t,[a]);const l=s.split("\n")[o-1];e.handleAddLines(t,[{content:l,line:o,source:i?"remote":"local"}])},d=t=>{const{diffs:o,isRemote:n,value:i}=e,r=o[t],s=yv(r,e.usedLines[t],i,n?"remote":"local");e.handleAddLines(t,s)},p=t=>{const{usedLines:o}=e,n=o[t];e.handleRemoveLines(t,n)};return Object.keys(e.diffs).length?(0,gr.jsx)(gr.Fragment,{children:(0,gr.jsx)(cv.ZP,{height:"calc(100% - 24px)",theme:"teleport-theme",value:e.value,language:"typescript",beforeMount:e=>i(e),onMount:e=>o(e),options:{readOnly:!0,minimap:{enabled:!1},glyphMargin:!0,fontFamily:"Source Code Pro, monospace",fontSize:14}})}):(0,gr.jsx)("div",{children:"Loading..."})};var wv=o(71712);class vv{constructor(e){(0,$.Z)(this,"editor",void 0),(0,$.Z)(this,"monaco",void 0),(0,$.Z)(this,"lineDecorations",{}),(0,$.Z)(this,"highlightLines",((e,t)=>{const o=t.map((e=>this.generateLineHighlightDecoration({startLine:e.editorLine,endLine:e.editorLine,middleLine:e.editorLine},"remote"===e.source))).flat();this.lineDecorations[e]=this.editor.deltaDecorations(this.lineDecorations[e]||[],o)}));const{editor:t,monaco:o}=e;this.editor=t,this.monaco=o}generateLineHighlightDecoration(e,t){return[{range:new this.monaco.Range(e.startLine,0,e.endLine,0),options:{isWholeLine:!0,className:t?"output-editor-remote":"output-editor",glyphMarginClassName:t?"output-editor-remote-glyph":"output-editor-glyph"}}]}}const Iv=[".diffing-editor,.output-editor{background:rgba(40,115,222,0.2);}",`.diffing-editor{z-index:${Ki.kg.ONEHUNDRED};cursor:pointer;}`,".diffing-editor-glyph,.output-editor-glyph{background:rgba(40,115,222,0.2);width:100% !important;margin-left:25px !important;border-left:4px solid rgba(40,115,222,0.8);}",`.diffing-editor-glyph,.output-editor-glyph{cursor:pointer;z-index:${Ki.kg.ONEHUNDRED};}`,".diffing-editor-glyph-middle{width:100% !important;margin-left:25px !important;}",".diffing-editor-glyph-unchecked::before,.diffing-editor-glyph-checked::before{content:'      ';position:absolute;left:-24px;display:block;height:18px;width:18px;background-repeat:no-repeat;background-size:cover;}",".diffing-editor-glyph-unchecked::before{background-image:url('/static/icons/dev-mode/unchecked.svg') !important;}",".diffing-editor-glyph-checked::before{background-image:url('/static/icons/dev-mode/checked.svg') !important;}",".diffing-editor-remote,.output-editor-remote{background:rgba(197,139,35,0.3);}",`.diffing-editor-remote{z-index:${Ki.kg.ONEHUNDRED};cursor:pointer;}`,`.diffing-editor-remote{background:rgba(197,139,35,0.3);z-index:${Ki.kg.ONEHUNDRED};cursor:pointer;}`,".diffing-editor-remote-glyph,.output-editor-remote-glyph{background:rgba(197,139,35,0.3);width:100% !important;margin-left:25px !important;border-left:4px solid rgba(197,139,35,0.8);}",`.diffing-editor-remote-glyph{cursor:pointer;z-index:${Ki.kg.ONEHUNDRED};}`,`.editor-remove-line{-webkit-mask-image:url('/static/icons/dev-mode/minus.svg') !important;mask-image:url('/static/icons/dev-mode/minus.svg') !important;background-repeat:no-repeat;background-size:cover;width:18px !important;height:18px !important;margin-left:4px;-webkit-mask-size:cover;mask-size:cover;background-color:${Ki.z8.DANGER};}`,`.editor-add-line{-webkit-mask-image:url('/static/icons/dev-mode/plus.svg') !important;mask-image:url('/static/icons/dev-mode/plus.svg') !important;background-repeat:no-repeat;background-size:cover;width:18px !important;height:18px !important;margin-left:4px;-webkit-mask-size:cover;mask-size:cover;background-color:${Ki.z8.SUCCESS};}`];Iv.__hash="3843575564";var Sv,jv,Dv,Ov,Fv,Tv,Nv,Ev,Cv,xv,Pv,kv,Mv,Zv,Uv=o(82708),Av=o(47303);function Lv(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function _v(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Lv(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Lv(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}let Rv=(Sv=(0,J.f3)("projectDoc"),jv=(0,J.f3)("absolutePositionedLayerFlow"),Dv=(0,J.f3)("projectFilesFlow"),Ov=(0,J.f3)("projectUIState"),Fv=(0,J.f3)("webRTCState"),Tv=(0,J.f3)("conflictManagementFlow"),Zv=new WeakMap,Nv=class extends pr.PureComponent{constructor(e){super(e),(0,z.Z)(this,"projectDoc",Ev,this),(0,z.Z)(this,"absolutePositionedLayerFlow",Cv,this),(0,z.Z)(this,"projectFilesFlow",xv,this),(0,z.Z)(this,"projectUIState",Pv,this),(0,z.Z)(this,"webRTCState",kv,this),(0,z.Z)(this,"conflictManagementFlow",Mv,this),(0,$.Z)(this,"editor",null),(0,$.Z)(this,"outputMonaco",void 0),(0,$.Z)(this,"rtcHandler",new Uv.L(!0)),(0,$.Z)(this,"decorationManager",void 0),(0,$.Z)(this,"monacoHelper",new Av.r),Zv.set(this,{writable:!0,value:[]}),(0,$.Z)(this,"generateHierarchy",(()=>{const e=this.projectDoc.projectFiles.conflicts[this.props.branch],t=Object.keys(e.byId).reduce(((t,o)=>(t[o]=_v(_v({},this.projectDoc.projectFiles.local[this.props.branch].byId[o]),{},{status:e.byId[o].resolved?Wm.E.RESOLVED:Wm.E.CONFLICT}),t)),{});return this.projectDoc.projectFiles.pack({filesToPack:t,assets:{}})})),(0,$.Z)(this,"checkIfConflictCanBeResolved",(()=>{const e=this.projectDoc.projectFiles.conflicts[this.props.branch];return Object.keys(e.byId).every((t=>e.byId[t].resolved))})),(0,$.Z)(this,"generateCollaboratorsSelectedFiles",(e=>{const t=this.projectUIState.devMode.selectedBranch;return e.filter((e=>e.selectedBranch===t)).map((e=>{const{selectedFile:t,name:o,email:n}=e;return{selectedFile:t,collaborator:o||n||""}}))})),(0,$.Z)(this,"handleOutputEditorMount",(async e=>{this.editor=e,await this.rtcHandler.attach(e,this.outputMonaco,(()=>null),this.monacoHelper),this.decorationManager=new vv({editor:this.editor,monaco:this.outputMonaco}),this.setState({editorLoaded:!0}),this.highlightOutputUsedLines()})),(0,$.Z)(this,"handleOutputChange",((e,t)=>{const{editorLoaded:o,actionInProgress:n,underExternalUpdate:i}=this.state;!o||n||i||this.rtcHandler.modelIsBinding||this.conflictManagementFlow.handleContentChange(t)})),(0,$.Z)(this,"handleSelectFile",(e=>{const{selectedFilePath:t}=this.state;e!==t&&this.conflictManagementFlow.setSelectedConflictFile(e)})),(0,$.Z)(this,"handleAddLines",(async(e,t)=>{this.editor&&await this.conflictManagementFlow.addLinesFromConflict(e,t)})),(0,$.Z)(this,"handleRemoveLines",(async(e,t)=>{this.editor&&await this.conflictManagementFlow.removeLinesFromConflict(e,t)})),(0,$.Z)(this,"highlightOutputUsedLines",(()=>{var e;const{localUsedLines:t,remoteUsedLines:o,selectedFilePath:n}=this.state,i=[...Object.values(t),...Object.values(o)].flat();null===(e=this.decorationManager)||void 0===e||e.highlightLines(n,i)})),(0,$.Z)(this,"handleResetCurrentFile",(async()=>{const{selectedFile:e}=this.state;this.setState({resetInProgress:!0}),await this.conflictManagementFlow.resetFile();const t=this.generateHierarchy();this.setState({resetInProgress:!1,hierarchy:t,selectedFile:_v(_v({},e),{},{resolved:!1})}),this.forceUpdate()})),(0,$.Z)(this,"handleResolveCurrentFile",(()=>{this.conflictManagementFlow.markResolved();const e=this.generateHierarchy(),{selectedFile:t}=this.state;this.setState({hierarchy:e,selectedFile:_v(_v({},t),{},{resolved:!0})})})),(0,$.Z)(this,"handleConflictResolve",(async()=>{if("merge"===this.props.type)return this.setState({solveInProgress:!0}),await this.conflictManagementFlow.solveMergeConflict(),void this.setState({solveInProgress:!1});this.conflictManagementFlow.markPullConflictAsSolved()})),(0,$.Z)(this,"handleAddLinesFromAllDiffs",(async(e=!0)=>{const{selectedFile:t,localUsedLines:o,remoteUsedLines:n}=this.state,i=e?t.diffs.baseDiffs:t.diffs.updatedDiffs,r=e?o:n;if(gv(i,r))for(const s of Object.keys(i))await this.handleRemoveLines(s,r[s]);else for(const s of Object.keys(i)){const o=e?t.baseContent:t.newContent,n=i[s],a=yv(n,r[s],o,e?"local":"remote");await this.handleAddLines(s,a)}}));const t=this.projectUIState.devMode.selectedConflictFile;this.state=_v({},this.getConflictDataForFile(t))}getConflictDataForFile(e){const t=this.projectDoc.projectFiles.conflicts[this.props.branch];e||(e=Object.keys(t.byId)[0]);const o=t.byId[e],n=this.generateHierarchy();return{selectedFilePath:e,selectedFile:o,editorLoaded:!1,resetInProgress:!1,solveInProgress:!1,underExternalUpdate:!1,canResolveConflict:this.checkIfConflictCanBeResolved(),localUsedLines:{},remoteUsedLines:{},hierarchy:n,collaboratorsSelectedFiles:this.generateCollaboratorsSelectedFiles(Object.values(this.webRTCState.devData))}}componentDidMount(){const e=this.projectUIState.devMode.selectedBranch,t=(0,V.Ys)(this.projectUIState,["devMode/selectedConflictFile"],(({devMode:e})=>{const t=e.selectedConflictFile;if(!t)return;const o=this.projectUIState.devMode.selectedBranch,n=this.projectDoc.projectFiles.conflicts[o];if(!n)return;const{localUsedLines:i={},remoteUsedLines:r={}}=n.byId[t]||{};this.setState(_v(_v({},this.getConflictDataForFile(t)),{},{localUsedLines:i,remoteUsedLines:r}))}),"SubForSelectedFile"),o=(0,V.Ys)(this.webRTCState,["devData/*","devData","devData/**"],(({devData:e})=>{const t=Object.values(e);this.setState({collaboratorsSelectedFiles:this.generateCollaboratorsSelectedFiles(t)})}),"SubForRtcDataChanges"),n=(0,V.Ys)(this.projectDoc,[`projectFiles/conflicts/${e}/**`],(t=>{const{selectedFilePath:o}=this.state,{localUsedLines:n,remoteUsedLines:i}=t.projectFiles.conflicts[e].byId[o],r=this.generateHierarchy();this.setState({localUsedLines:JSON.parse(JSON.stringify(n)),remoteUsedLines:JSON.parse(JSON.stringify(i)),canResolveConflict:this.checkIfConflictCanBeResolved(),hierarchy:r},(()=>{this.highlightOutputUsedLines(),this.forceUpdate()}))}),"SubForBranchConflict"),i=(0,V.Ys)(this.projectDoc,[`projectFiles/conflicts/${e}/actionInProgress`],(t=>{const{actionInProgress:o}=t.projectFiles.conflicts[e];this.setState({actionInProgress:!!o})}),"SubForActionInProgress"),r=(0,V.Ys)(this.projectDoc,[`projectFiles/conflicts/${e}/solveInProgress`],(t=>{const{solveInProgress:o}=t.projectFiles.conflicts[e];this.setState({solveInProgress:!!o})}),"SubForSolveInProgress"),s=(0,V.Ys)(this.projectUIState,["devMode/fileUnderExternalUpdate"],(e=>{this.setState({underExternalUpdate:e.devMode.fileUnderExternalUpdate===this.state.selectedFilePath})}),"SubForFileUnderExternalUpdate");(0,$i.Z)(this,Zv).push((()=>{n.dispose(),o.dispose(),t.dispose(),i.dispose(),r.dispose(),s.dispose()}))}componentWillUnmount(){(0,$i.Z)(this,Zv).forEach((e=>e())),(0,Gi.Z)(this,Zv,[])}render(){const{actionInProgress:e,hierarchy:t,resetInProgress:o,collaboratorsSelectedFiles:n,selectedFilePath:i,selectedFile:r,localUsedLines:s,solveInProgress:a,remoteUsedLines:l,canResolveConflict:c}=this.state;if(!i)return(0,gr.jsx)("div",{tabIndex:0});const d=gv(r.diffs.baseDiffs,s),p=gv(r.diffs.updatedDiffs,l);return(0,gr.jsxs)("div",{tabIndex:0,className:`jsx-${Iv.__hash}`,children:[(0,gr.jsx)(hv,{title:"pull"===this.props.type?`Conflicts found while pulling from ${this.props.branch}`:"Merge conflicts found",handleReset:this.handleResetCurrentFile,handleResolve:this.handleResolveCurrentFile,handleSave:this.handleConflictResolve,canSave:c,solveInProgress:a,resetInProgress:o,resolved:r.resolved,allLocalUsed:d,allRemoteUsed:p,handleAddAllLocalLines:this.handleAddLinesFromAllDiffs,handleAddAllRemoteLines:()=>this.handleAddLinesFromAllDiffs(!1),sidebar:(0,gr.jsx)(wv.a,{files:t,sidebarTitle:"Conflicts",path:Qt.y$,pathUnderRename:null,selectedFilePath:i,selectedFolder:"",handleRootContextMenu:()=>null,collaboratorsSelectedFiles:n,meta:{fileDragInProgress:!1,handleFolderExpand:!0,rootSectionName:"staged"},actions:{selectFile:this.handleSelectFile}}),localContentEditor:(0,gr.jsx)(bv,{value:r.baseContent,diffs:r.diffs.baseDiffs,conflictingDiffs:r.diffs.updatedDiffs,usedLines:s,handleAddLines:this.handleAddLines,handleRemoveLines:this.handleRemoveLines}),remoteContentEditor:(0,gr.jsx)(bv,{isRemote:!0,value:r.newContent,usedLines:l,diffs:r.diffs.updatedDiffs,conflictingDiffs:r.diffs.baseDiffs,handleAddLines:this.handleAddLines,handleRemoveLines:this.handleRemoveLines}),outputEditor:(0,gr.jsx)(cv.ZP,{height:"calc(100% - 24px)",theme:"teleport-theme",language:"typescript",beforeMount:e=>{this.outputMonaco=e,this.setState({editorLoaded:!1}),this.monacoHelper.attach(e)},onMount:this.handleOutputEditorMount,onChange:this.handleOutputChange,options:{minimap:{enabled:!1},readOnly:e||a,glyphMargin:!0,fontFamily:"Source Code Pro, monospace",fontSize:14}})}),(0,gr.jsx)(ss.default,{id:Iv.__hash,children:Iv})]},i)}},Ev=(0,G.Z)(Nv.prototype,"projectDoc",[Sv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cv=(0,G.Z)(Nv.prototype,"absolutePositionedLayerFlow",[jv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xv=(0,G.Z)(Nv.prototype,"projectFilesFlow",[Dv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pv=(0,G.Z)(Nv.prototype,"projectUIState",[Ov],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kv=(0,G.Z)(Nv.prototype,"webRTCState",[Fv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mv=(0,G.Z)(Nv.prototype,"conflictManagementFlow",[Tv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nv);const Bv=e=>{var t,o;const n=(null===(t=e.baseContent)||void 0===t?void 0:t.split("\n"))||[],i={};let r=0;const s=[],a=[];let l=0;if(Object.keys((null===(o=e.diffs)||void 0===o?void 0:o.baseDiffs)||{}).forEach((t=>{const o=e.diffs.baseDiffs[t];if(a.push(t),o.negativeRange)return;const c=s.length+1;for(let e=l;e<o.startLine-1;e++)s.push(n[e]);i[r]={startLine:c,endLine:s.length},r+=1,o.endLine>l&&(l=o.endLine)})),l<n.length){const e=s.length+1;for(let t=l;t<n.length;t++)s.push(n[t]);i[r]={startLine:e,endLine:s.length},r+=1}return{content:s.join("\n"),blocks:i,diffsOrder:a}},Hv=(e,t)=>{const{startLineNumber:o,endLineNumber:n}=t.range;return Object.keys(e).forEach((t=>{const i=[];e[t].forEach(((e,t)=>{e.editorLine&&e.editorLine>=o&&e.editorLine<=n&&i.push(t)})),i.forEach((o=>{e[t].splice(o,1)}))})),e};var zv,$v,Gv,Vv,Jv,Wv,Kv,Yv,Xv,qv,Qv,eI,tI,oI,nI,iI,rI,sI,aI,lI,cI,dI,pI,uI,hI,mI,gI;function yI(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function fI(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?yI(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):yI(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}zv=(0,J.JJ)("conflictManagementFlow"),$v=(0,J.f3)("projectDoc"),Gv=(0,J.f3)("projectUIState"),Vv=(0,J.f3)("yDocumentManagementFlow"),Jv=(0,J.f3)("modalManagementFlow"),Wv=(0,J.f3)("githubRepository"),Kv=(0,J.f3)("githubFlow"),Yv=(0,J.f3)("contentDiffingService"),Xv=(0,J.f3)("sharedbProjectSyncService"),qv=(0,J.f3)("notificationsManagementFlow"),Qv=(0,J.f3)("projectFilesFlow"),eI=(0,J.f3)("guardsService"),tI=(0,J.f3)("projectDownloadFlow"),zv((nI=class{constructor(){(0,z.Z)(this,"projectDoc",iI,this),(0,z.Z)(this,"projectUIState",rI,this),(0,z.Z)(this,"yDocumentManagementFlow",sI,this),(0,z.Z)(this,"modalManagementFlow",aI,this),(0,z.Z)(this,"githubRepository",lI,this),(0,z.Z)(this,"githubFlow",cI,this),(0,z.Z)(this,"contentDiffingService",dI,this),(0,z.Z)(this,"dbSync",pI,this),(0,z.Z)(this,"notificationsManagementFlow",uI,this),(0,z.Z)(this,"projectFilesFlow",hI,this),(0,z.Z)(this,"guardsService",mI,this),(0,z.Z)(this,"projectDownloadFlow",gI,this)}init(){const e=this.projectUIState.devMode.selectedBranch,t=this.projectDoc.projectFiles.conflicts[e];if(!t)return;if(!this.projectUIState.devMode.selectedConflictFile){const e=Object.keys(t.byId)[0];this.setSelectedConflictFile(e)}this.openConflictModal()}async handlePullConflict(e){const{files:t,branch:o,sha:n}=e,i=await this.generateDiffsForFiles(t),r=this.generateConflictOutput(o,i),s=Object.keys(r).map((e=>{const t=r[e].content;return this.yDocumentManagementFlow.setText(e,t)}));await Promise.all(s),this.guardsService.executeFunctionGuarded(to._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(async e=>{e.projectFiles.addConflict(o,{lastCommitSha:n,byId:r,type:"pull"}),Object.keys(r).forEach((t=>{const n=r[t].content;e.projectFiles.local[o].byId[t].code=n}))}))}));const a=Object.keys(r)[0];this.setSelectedConflictFile(a),this.openConflictModal()}markPullConflictAsSolved(e){if(!e)return;const t=this.projectUIState.devMode.selectedBranch,o=e.projectFiles.conflicts[t];"pull"===o.type&&((0,V.JG)(this.projectUIState,(e=>{e.devMode.selectedConflictFile=null})),e.projectFiles.local[t].lastSha=o.lastCommitSha,delete e.projectFiles.conflicts[t])}async handleMergeConflict(e,t){(0,V.JG)(this.projectUIState,(e=>{e.devMode.githubOperationInProgress="compare"}));const o=await this.compareBranches(e,t);o?(await this.syncFilesAfterConflictingMerge({commitsFiles:o.commitsFiles,branch:e,headBranch:t,latestSha:o.sha}),(0,V.JG)(this.projectUIState,(e=>{e.devMode.githubOperationInProgress=null}))):(0,V.JG)(this.projectUIState,(e=>{e.devMode.githubOperationInProgress=null}))}async solveMergeConflict(){var e;const t=this.projectUIState.devMode.selectedBranch,o=this.projectDoc.projectFiles.conflicts[t];if(!o||"merge"!==o.type)return;const{headBranch:n,byId:i}=o;if(!n)return;this.guardsService.executeFunctionGuarded(to._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{e.projectFiles.conflicts[t].solveInProgress=!0}))}));const r=Object.keys(i),s=this.githubFlow.computeFilesWithDiffs().filter((e=>r.includes(e.path)));this.githubFlow.stageFiles({files:s});const a=this.projectUIState.userPreferences.projectType,l=null===(e=this.projectDoc.stats.github)||void 0===e?void 0:e.repositoryOwner;let c=0,d=!1;for(;!d&&c<3;)try{await this.projectDownloadFlow.exportToGithub(a,{commitMessage:`Merge ${n} into ${t}`,deployStagedOnly:!0,repositoryOwner:l,extraBranchParents:[n],displayNotification:!1}),d=!0}catch(p){c+=1}this.guardsService.executeFunctionGuarded(to._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{delete e.projectFiles.conflicts[t]}))})),this.githubFlow.loadProjectCommits(),(0,V.JG)(this.projectUIState,(e=>{e.devMode.selectedConflictFile=null}))}setSelectedConflictFile(e){(0,V.JG)(this.projectUIState,(t=>{t.devMode.selectedConflictFile=e}))}openConflictModal(){if(this.projectUIState.devMode.conflictModalOpened)return;const e=this.projectUIState.devMode.selectedBranch,t=this.projectDoc.projectFiles.conflicts[e];if(!t)return;const o=Jo.d.createCustomModal({Component:Rv,data:{branch:e,type:t.type,onDismiss:()=>{(0,V.JG)(this.projectUIState,(e=>{e.devMode.conflictModalOpened=!1})),this.modalManagementFlow.hideModal()},onClose:()=>{(0,V.JG)(this.projectUIState,(e=>{e.devMode.conflictModalOpened=!1}))}}});this.modalManagementFlow.showModal(o,{padding:0},!1),(0,V.JG)(this.projectUIState,(e=>{e.devMode.conflictModalOpened=!0}))}closeConflictModal(){this.projectUIState.devMode.conflictModalOpened&&(this.modalManagementFlow.hideModal(),(0,V.JG)(this.projectUIState,(e=>{e.devMode.conflictModalOpened=!1})),this.notificationsManagementFlow.createNotification(K.k.SUCCESS,"Conflict was solved"))}async removeLinesFromConflict(e,t){if(!t.length)return;const o=this.projectUIState.devMode.selectedBranch,n=this.projectUIState.devMode.selectedConflictFile;if(!n)return;const i=this.projectDoc.projectFiles.conflicts[o].byId[n];if(!i)return;this.guardsService.executeFunctionGuarded(to._.DISABLE_HISTORY,(async()=>{this.dbSync.mutate(this.projectDoc,(e=>{e.projectFiles.conflicts[o].actionInProgress=!0}))}));const{localUsedLines:r,remoteUsedLines:s}=i;t.forEach(((o,i)=>{if(!o.editorLine)return;const a="local"===o.source?r:s,l=a[e].findIndex((e=>e.line===o.line));a[e].splice(l,1),this.yDocumentManagementFlow.removeTextFromLine(n,o.editorLine-1),Object.keys(r).forEach((e=>{r[e].forEach((e=>{!t.some((t=>t.editorLine===e.editorLine))&&e.editorLine&&o.editorLine&&e.editorLine>o.editorLine&&(e.editorLine-=1)}))})),Object.keys(s).forEach((e=>{s[e].forEach((e=>{!t.some((t=>t.editorLine===e.editorLine))&&e.editorLine&&o.editorLine&&e.editorLine>o.editorLine&&(e.editorLine-=1)}))}));for(let e=i+1;e<t.length;e++){const n=t[e];n.editorLine&&o.editorLine&&n.editorLine>o.editorLine&&(n.editorLine-=1)}}));const{diffsOrder:a,blocks:l}=i,c=a.indexOf(e);for(let d=c;d<Object.keys(l).length;d++){const e=l[d];d!==c&&(e.startLine-=t.length),e.endLine-=t.length}this.guardsService.executeFunctionGuarded(to._.DISABLE_HISTORY,(async()=>{this.dbSync.mutate(this.projectDoc,(e=>{e.projectFiles.conflicts[o].actionInProgress=!1,e.projectFiles.conflicts[o].byId[n].blocks=l,e.projectFiles.conflicts[o].byId[n].localUsedLines=r,e.projectFiles.conflicts[o].byId[n].remoteUsedLines=s}))}))}async addLinesFromConflict(e,t){if(!t.length)return;const o=this.projectUIState.devMode.selectedBranch,n=this.projectUIState.devMode.selectedConflictFile;if(!n)return;const i=this.projectDoc.projectFiles.conflicts[o].byId[n];if(!i)return;const{diffsOrder:r,blocks:s}=i,a=r.indexOf(e),l=s[a];if(!l)return;this.guardsService.executeFunctionGuarded(to._.DISABLE_HISTORY,(async()=>{this.dbSync.mutate(this.projectDoc,(e=>{e.projectFiles.conflicts[o].actionInProgress=!0}))}));let c=l.endLine+1;const d=c;t.forEach((e=>{e.editorLine=c,c+=1}));const{localUsedLines:p,remoteUsedLines:u}=i,h=t.filter((e=>"local"===e.source)),m=t.filter((e=>"remote"===e.source)),g=fI(fI({},p),{},{[e]:[...(null===p||void 0===p?void 0:p[e])||[],...h]}),y=fI(fI({},u),{},{[e]:[...(null===u||void 0===u?void 0:u[e])||[],...m]});Object.keys(g).forEach((o=>{o!==e&&g[o].forEach((e=>{e.editorLine&&e.editorLine>=d&&(e.editorLine+=t.length)}))})),Object.keys(y).forEach((o=>{y[o].forEach((n=>{o!==e&&n.editorLine&&n.editorLine>=d&&(n.editorLine+=t.length)}))}));for(let b=a;b<Object.keys(s).length;b++){const e=s[b];b!==a&&(e.startLine+=t.length),e.endLine+=t.length}const f=t.map((e=>e.content)).join("\n");this.yDocumentManagementFlow.addTextAtLine(n,d,`\n${f}`),this.guardsService.executeFunctionGuarded(to._.DISABLE_HISTORY,(async()=>{this.dbSync.mutate(this.projectDoc,(e=>{e.projectFiles.conflicts[o].actionInProgress=!1,e.projectFiles.conflicts[o].byId[n].blocks=s,e.projectFiles.conflicts[o].byId[n].localUsedLines=g,e.projectFiles.conflicts[o].byId[n].remoteUsedLines=y}))}))}async resetFile(){const e=this.projectUIState.devMode.selectedBranch,t=this.projectUIState.devMode.selectedConflictFile;if(!t)return;const o=this.projectDoc.projectFiles.conflicts[e].byId[t];if(!o)return;this.guardsService.executeFunctionGuarded(to._.DISABLE_HISTORY,(async()=>{this.dbSync.mutate(this.projectDoc,(t=>{t.projectFiles.conflicts[e].actionInProgress=!0}))}));const{blocks:n,content:i}=Bv(o);await this.yDocumentManagementFlow.setText(t,i),this.guardsService.executeFunctionGuarded(to._.DISABLE_HISTORY,(async()=>{this.dbSync.mutate(this.projectDoc,(o=>{o.projectFiles.local[e].byId[t].code=i,o.projectFiles.conflicts[e].actionInProgress=!1,o.projectFiles.conflicts[e].byId[t].resolved=!1,o.projectFiles.conflicts[e].byId[t].blocks=n,o.projectFiles.conflicts[e].byId[t].localUsedLines={},o.projectFiles.conflicts[e].byId[t].remoteUsedLines={}}))}))}markResolved(){const e=this.projectUIState.devMode.selectedBranch,t=this.projectUIState.devMode.selectedConflictFile;if(!t)return;this.projectDoc.projectFiles.conflicts[e].byId[t]&&this.guardsService.executeFunctionGuarded(to._.DISABLE_HISTORY,(async()=>{this.dbSync.mutate(this.projectDoc,(o=>{o.projectFiles.conflicts[e].byId[t].resolved=!0}))}))}handleContentChange(e){const t=this.projectUIState.devMode.selectedBranch,o=this.projectUIState.devMode.selectedConflictFile;if(!o)return;const n=this.projectDoc.projectFiles.conflicts[t].byId[o];if(!n)return;const{blocks:i}=n,r=((e,t)=>{let o=[];const{changes:n,eol:i}=t;return n.forEach((t=>{const{range:n,text:r}=t,{startLineNumber:s,endLineNumber:a}=n;if(""===r&&s===a)return;const l=Object.keys(e).findIndex((t=>{const o=e[t];return o.startLine<=s&&o.endLine>=s}));if(""===r&&s!==a){const t=Object.keys(e).findIndex((t=>{const o=e[t];return o.startLine<=a&&o.endLine>=a}));return void(o=Object.keys(e).map(((o,n)=>{const i=e[o];if(l===t&&n<l)return i;if(n===l)return i.endLine-=l===t?a-s:i.endLine-s,i;if(n>l&&n<t)return i.startLine=e[n-1].endLine,i.endLine=i.startLine,i;if(n===t){const t=a-i.startLine,o=i.endLine-i.startLine-t;return i.startLine=e[n-1].endLine+1,i.endLine=i.startLine+o-1,i.startLine>i.endLine&&(i.startLine=i.endLine),i}var r,c;if(i.endLine===i.startLine)return i.startLine=(null===(r=e[n-1])||void 0===r?void 0:r.endLine)||i.startLine,i.endLine=(null===(c=e[n-1])||void 0===c?void 0:c.endLine)||i.endLine,i;const d=i.endLine-i.startLine;return i.startLine=e[n-1].endLine+1,i.endLine=i.startLine+d,i})))}const c=r.split(i).length-1;if(c){if(-1===l)throw new Error("Output block not found after new line was added.");o=Object.keys(e).map(((t,o)=>{const n=e[t];return o===l&&(n.endLine+=c),o>l&&(n.startLine+=c,n.endLine+=c),n}))}})),o.length||(o=Object.values(e)),o.reduce(((e,t,o)=>(e[o]=t,e)),{})})(i,e),{localUsedLines:s,remoteUsedLines:a}=((e,t,o)=>{const{changes:n,eol:i}=e;return n.forEach((e=>{const{range:n,text:r}=e,{startLineNumber:s,endLineNumber:a}=n;t=Hv(t,e),o=Hv(o,e);let l=r.split(i).length-1;""===r&&s!==a&&(l-=a-s),l&&(Object.keys(t).forEach((e=>{t[e].forEach((e=>{e.editorLine&&e.editorLine>s&&(e.editorLine+=l)}))})),Object.keys(o).forEach((e=>{o[e].forEach((e=>{e.editorLine&&e.editorLine>s&&(e.editorLine+=l)}))})))})),{localUsedLines:t,remoteUsedLines:o}})(e,n.localUsedLines,n.remoteUsedLines);this.guardsService.executeFunctionGuarded(to._.DISABLE_HISTORY,(async()=>{this.dbSync.mutate(this.projectDoc,(e=>{e.projectFiles.conflicts[t].byId[o].blocks=r,e.projectFiles.conflicts[t].byId[o].localUsedLines=s,e.projectFiles.conflicts[t].byId[o].remoteUsedLines=a}))}))}async compareBranches(e,t){if(!this.projectDoc.stats.github)return;const{repositoryName:o,repositoryOwner:n}=this.projectDoc.stats.github;if(o&&n)try{const i=await this.githubRepository.compareBranches(this.projectDoc.id,{repository:o,owner:n,base:e,head:t});return{commitsFiles:i.files.reduce(((e,t)=>{const{content:o,status:n,filename:i}=t;return e[i]={content:o,status:n},e}),{}),sha:i.commits[0].sha}}catch(i){return this.notificationsManagementFlow.createNotification(K.k.ERROR,`Could not compare branches: ${e} and ${t}`),null}}async syncFilesAfterConflictingMerge(e){const{branch:t,headBranch:o,commitsFiles:n,latestSha:i}=e,r={},s={};let a={};await this.contentDiffingService.loadDiffComputer(),await new Promise((e=>{this.guardsService.executeFunctionGuarded(to._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(l=>{for(const e of Object.keys(n)){if(e.startsWith(Qt.Xh)||e.startsWith("public/playground_assets/"))continue;const o=`${Qt.y$}/${e}`,i=n[e].content,a={code:i,is_protected:!1,synced_at:Date.now()},c=l.projectFiles.local[t].byId[o];if("added"===n[e].status&&!c){l.projectFiles.local[t].byId[o]=a,l.projectFiles.staged[t].byId[o]=a,this.yDocumentManagementFlow.setTextOnBranch(o,i,t);continue}if((l.projectFiles.remote[t].byId[o]?`${l.projectFiles.remote[t].byId[o].code}`:null)||(l.projectFiles.remote[t].byId[o]=a),!c){l.projectFiles.local[t].byId[o]=a,l.projectFiles.staged[t].byId[o]=a,this.yDocumentManagementFlow.setTextOnBranch(o,i,t);continue}const d=this.contentDiffingService.computeDiff(c.code,i);(Object.keys(d.baseDiffs).length||Object.keys(d.updatedDiffs).length)&&(r[o]={baseContent:c.code,newContent:i,diffs:d},s[o]=c)}a=this.generateConflictOutput(t,r),l.projectFiles.addConflict(t,{lastCommitSha:i,byId:a,headBranch:o,type:"merge"}),Object.keys(a).forEach((e=>{const o=a[e].content;l.projectFiles.local[t].byId[e].code=o})),e()}))}))}));for(const c of Object.keys(a)){const e=a[c].content;await this.yDocumentManagementFlow.replaceText(c,e)}const l=Object.keys(a)[0];this.setSelectedConflictFile(l),this.openConflictModal()}async generateDiffsForFiles(e){const t={};await this.contentDiffingService.loadDiffComputer();for(const o of Object.keys(e)){const n=e[o],i=this.contentDiffingService.computeDiff(n.current,n.new);t[o]={baseContent:n.current,newContent:n.new,diffs:i}}return t}generateConflictOutput(e,t){return Object.keys(t).reduce(((o,n)=>(o[n]=fI(fI({},Bv(t[n])),{},{baseContent:this.projectDoc.projectFiles.local[e].byId[n].code,newContent:t[n].newContent,diffs:t[n].diffs,localUsedLines:{},remoteUsedLines:{},resolved:!1}),o)),{})}},iI=(0,G.Z)(nI.prototype,"projectDoc",[$v],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rI=(0,G.Z)(nI.prototype,"projectUIState",[Gv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sI=(0,G.Z)(nI.prototype,"yDocumentManagementFlow",[Vv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aI=(0,G.Z)(nI.prototype,"modalManagementFlow",[Jv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lI=(0,G.Z)(nI.prototype,"githubRepository",[Wv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cI=(0,G.Z)(nI.prototype,"githubFlow",[Kv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dI=(0,G.Z)(nI.prototype,"contentDiffingService",[Yv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pI=(0,G.Z)(nI.prototype,"dbSync",[Xv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uI=(0,G.Z)(nI.prototype,"notificationsManagementFlow",[qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hI=(0,G.Z)(nI.prototype,"projectFilesFlow",[Qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mI=(0,G.Z)(nI.prototype,"guardsService",[eI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gI=(0,G.Z)(nI.prototype,"projectDownloadFlow",[tI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(nI.prototype,"markPullConflictAsSolved",[io],Object.getOwnPropertyDescriptor(nI.prototype,"markPullConflictAsSolved"),nI.prototype),oI=nI));var bI,wI,vI,II,SI,jI,DI,OI,FI,TI,NI,EI,CI,xI,PI,kI,MI,ZI,UI,AI,LI,_I,RI,BI,HI,zI,$I,GI,VI,JI,WI;bI=(0,J.JJ)("remoteChangesFlow"),wI=(0,J.f3)("projectDoc"),vI=(0,J.f3)("projectUIState"),II=(0,J.f3)("githubFlow"),SI=(0,J.f3)("notificationsManagementFlow"),jI=(0,J.f3)("yDocumentManagementFlow"),DI=(0,J.f3)("modalManagementFlow"),OI=(0,J.f3)("contentDiffingService"),FI=(0,J.f3)("guardsService"),TI=(0,J.f3)("sharedbProjectSyncService"),NI=(0,J.f3)("conflictManagementFlow"),EI=(0,J.f3)("githubRepository"),CI=(0,J.f3)("projectFilesFlow"),xI=(0,J.f3)("assetsUploadFlow"),PI=(0,J.f3)("assetsEditFlow"),bI((MI=class{constructor(){(0,z.Z)(this,"projectDoc",ZI,this),(0,z.Z)(this,"projectUIState",UI,this),(0,z.Z)(this,"githubFlow",AI,this),(0,z.Z)(this,"notificationsManagementFlow",LI,this),(0,z.Z)(this,"yDocumentManagementFlow",_I,this),(0,z.Z)(this,"modalManagementFlow",RI,this),(0,z.Z)(this,"contentDiffingService",BI,this),(0,z.Z)(this,"guardsService",HI,this),(0,z.Z)(this,"dbSync",zI,this),(0,z.Z)(this,"conflictManagementFlow",$I,this),(0,z.Z)(this,"githubRepository",GI,this),(0,z.Z)(this,"projectFilesFlow",VI,this),(0,z.Z)(this,"assetsUploadFlow",JI,this),(0,z.Z)(this,"assetsEditFlow",WI,this)}async applyRemoteChanges(e,t){var o;const n=this.projectUIState.devMode.selectedBranch;if(this.projectDoc.projectFiles.conflicts[n])return;const i=null===(o=this.projectDoc.projectFiles.local[t])||void 0===o?void 0:o.lastSha,r=this.filterCommitsThatNeedParsing(e,t);if(!r.length&&i)return;(0,V.JG)(this.projectUIState,(e=>{e.devMode.githubOperationInProgress="sync"}));let s={};const a="remote"===this.projectUIState.devMode.githubBranches.byId[t].type;if(i)s=await this.compareWithLatestCommit(i,r[0].sha);else if(a||r.length>10){const e=await this.loadBranchContent(t);if(!e)return;s=Object.keys(e).reduce(((t,o)=>{const n=e[o];return t[o]={content:n,status:"remote-only-file"},t}),{})}else s=await this.loadCommitsFiles(r);const l=await this.applyChangesToLocalFiles({commitsFiles:s,latestSha:r[0].sha,branch:t});Object.keys(l).length?this.conflictManagementFlow.handlePullConflict({branch:t,sha:r[0].sha,files:l}):this.guardsService.executeFunctionGuarded(to._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{e.projectFiles.local[n].lastSha=r[0].sha}))})),(0,V.JG)(this.projectUIState,(e=>{e.devMode.githubOperationInProgress=null}))}applyChangesToLocalFiles(e){const{doc:t,branch:o,commitsFiles:n}=e,i={};if(!t)return i;t.projectFiles.local[o]||(t.projectFiles.local[o]={byId:{}}),t.projectFiles.remote[o]||(t.projectFiles.remote[o]={byId:{}}),t.projectFiles.staged[o]||(t.projectFiles.staged[o]={byId:{}});for(const r of Object.keys(n)){if(r.startsWith(Qt.Xh))continue;const e=r.match(/\.([^\.]+)$/);if(!e)continue;if(Bh.oy.includes(e[1].toLowerCase())){if(!r.startsWith(Qt._C))continue;const{content:e,status:i}=n[r],s=r.split("/").pop()||"",a=`${Qt.Wn}/playground_assets/${s}`,l=t.assets.findAssetUsingName(s);if("added"===i&&void 0===l){const n=new File([e],s,{type:"image/jpeg"});this.assetsUploadFlow.upload({files:[n],parentFolderId:ve.D.ASSETS}),t.projectFiles.remote[o].byId[a]={code:"",is_asset:!0}}"removed"===i&&l&&0===Object.keys(l.usedInNodes).length&&(Object.keys(t.projectFiles.remote).forEach((e=>{delete t.projectFiles.remote[e].byId[a]})),this.assetsEditFlow.delete([l.id]));continue}const s=`${Qt.y$}/${r}`,{content:a,status:l}=n[r],c=t.projectFiles.local[o].byId[s],d=t.projectFiles.remote[o].byId[s]?`${t.projectFiles.remote[o].byId[s].code}`:null;if("added"===l){if(!c){this.projectFilesFlow.createFile({doc:t,fileId:s,content:a,remote:!0});continue}if(c.code===a)continue;i[s]={new:a,current:c.code};continue}if("removed"===l){if(!c&&!d)continue;if((null===c||void 0===c?void 0:c.code)===d){this.projectFilesFlow.deleteFile({doc:t,fileId:s,permanent:!0});continue}i[s]={new:a,current:c.code};continue}const p={code:a,is_protected:!1,synced_at:Date.now()};"remote-only-file"!==l?(d?d!==a&&(t.projectFiles.remote[o].byId[s].code=a):t.projectFiles.remote[o].byId[s]=p,c?c.code!==d?null===d&&a===c.code||(i[s]={new:a,current:c.code}):(t.projectFiles.local[o].byId[s].code=a,this.yDocumentManagementFlow.setTextOnBranch(s,a,o)):(t.projectFiles.local[o].byId[s]=p,this.yDocumentManagementFlow.setTextOnBranch(s,a,o))):(t.projectFiles.remote[o].byId[s]=p,t.projectFiles.local[o].byId[s]=p,this.yDocumentManagementFlow.setTextOnBranch(s,a,o))}return i}filterCommitsThatNeedParsing(e,t){var o;const n=null===(o=this.projectDoc.projectFiles.local[t])||void 0===o?void 0:o.lastSha;let i=0,r=!1;const s=[];for(;!r&&i<e.length;){const t=e[i];if(t.sha!==n){if(s.push(t),i++,i===e.length&&n)throw new Error("We tried to find the commit from the last sync but failed")}else r=!0}return s}async compareWithLatestCommit(e,t){if(!this.projectDoc.stats.github)throw new Error("No GitHub data saved");const{repositoryName:o,repositoryOwner:n}=this.projectDoc.stats.github;if(!o||!n)throw new Error("Repository name or owner not found");return(await this.githubRepository.compareBranches(this.projectDoc.id,{repository:o,owner:n,base:e,head:t})).files.reduce(((e,t)=>{const{filename:o,content:n,status:i}=t;return e[o]={content:n,status:i},e}),{})}async loadBranchContent(e){if(!this.projectDoc.stats.github)return null;const{repositoryName:t,repositoryOwner:o}=this.projectDoc.stats.github;if(!t||!o)return null;try{return await this.githubRepository.getRepoContent(this.projectDoc.id,{ref:e,repository:t,owner:o})}catch(n){return this.notificationsManagementFlow.createNotification(K.k.ERROR,"Could not get GitHub project files"),null}}async loadCommitsFiles(e){const t={};for(let o=e.length-1;o>=0;o--){const n=await this.githubFlow.loadCommitFiles(e[o].sha);n&&n.files.forEach((e=>{const{filename:o,content:n,status:i}=e;t[o]={content:n,status:i}}))}return t}},ZI=(0,G.Z)(MI.prototype,"projectDoc",[wI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UI=(0,G.Z)(MI.prototype,"projectUIState",[vI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AI=(0,G.Z)(MI.prototype,"githubFlow",[II],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LI=(0,G.Z)(MI.prototype,"notificationsManagementFlow",[SI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_I=(0,G.Z)(MI.prototype,"yDocumentManagementFlow",[jI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RI=(0,G.Z)(MI.prototype,"modalManagementFlow",[DI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BI=(0,G.Z)(MI.prototype,"contentDiffingService",[OI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HI=(0,G.Z)(MI.prototype,"guardsService",[FI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zI=(0,G.Z)(MI.prototype,"dbSync",[TI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$I=(0,G.Z)(MI.prototype,"conflictManagementFlow",[NI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GI=(0,G.Z)(MI.prototype,"githubRepository",[EI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VI=(0,G.Z)(MI.prototype,"projectFilesFlow",[CI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JI=(0,G.Z)(MI.prototype,"assetsUploadFlow",[xI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WI=(0,G.Z)(MI.prototype,"assetsEditFlow",[PI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(MI.prototype,"applyChangesToLocalFiles",[io],Object.getOwnPropertyDescriptor(MI.prototype,"applyChangesToLocalFiles"),MI.prototype),kI=MI));var KI,YI,XI,qI,QI,eS,tS,oS,nS,iS,rS,sS,aS;KI=(0,J.JJ)("codeEditorFlow"),YI=(0,J.f3)("projectUIState"),XI=(0,J.f3)("globalAppState"),qI=(0,J.f3)("userAccountRepository"),QI=(0,J.f3)("sentryService"),eS=(0,q.G)(te.l.DEV_SIDEBAR_CHANGE),tS=(0,q.G)(te.l.DEV_SET_PREVIEW_TYPE),KI((nS=class{constructor(){(0,z.Z)(this,"projectUIState",iS,this),(0,z.Z)(this,"globalAppState",rS,this),(0,z.Z)(this,"userAccountRepository",sS,this),(0,z.Z)(this,"sentryService",aS,this)}updateFolderExpandedStatus(e,t=!1){(0,V.JG)(this.projectUIState,(o=>{o.devMode.expandedFolders[e]=t}))}handleDevSidebarChange(e){return(0,V.JG)(this.projectUIState,(t=>{const{devMode:o}=t;o.sidebarSettings.panel===e?o.sidebarSettings.panel=null:o.sidebarSettings.panel=e})),!0}handlePreviewerTypeChange(e){(0,V.JG)(this.projectUIState,(t=>t.userPreferences.devPreviewerType=e)),e===Y.jK.OUTSIDE&&this.projectUIState.devMode.showPreviewer&&window.open(`${window.location.origin}${(0,qo.mZ)(this.projectUIState.slug)}`)}toggleLoadingPackages(){(0,V.JG)(this.projectUIState,(e=>{e.devMode.loadingPackages=!e.devMode.loadingPackages}))}handleEditorBundleStatusChange(e){(0,V.JG)(this.projectUIState,(t=>{t.devMode.bundlerStatus=e||null}))}toggleConsole(){(0,V.JG)(this.projectUIState,(({devMode:e})=>{e.showConsole=!e.showConsole}))}setDevSidebarWidth(e){(0,V.JG)(this.projectUIState,(({devMode:t})=>{t.sidebarSettings.width=e}))}setSidebarGridTemplateColumns(e){(0,V.JG)(this.projectUIState,(({devMode:t})=>{t.sidebarSettings.gridTemplateColumns=e}))}async updateUserMetaDevMode(){(0,V.JG)(this.globalAppState,(({user:e})=>{var t,o;!e.userData||null!==(t=e.userData.meta)&&void 0!==t&&null!==(o=t.devModeEnabled)&&void 0!==o&&o.isEnabled||(e.userData.meta.devModeEnabled={isEnabled:!0})}));try{var e;await this.userAccountRepository.update({meta:null===(e=this.globalAppState.user.userData)||void 0===e?void 0:e.meta})}catch(t){this.sentryService.captureException(new Error("Could not update user meta"))}}},iS=(0,G.Z)(nS.prototype,"projectUIState",[YI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rS=(0,G.Z)(nS.prototype,"globalAppState",[XI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sS=(0,G.Z)(nS.prototype,"userAccountRepository",[qI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aS=(0,G.Z)(nS.prototype,"sentryService",[QI],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(nS.prototype,"handleDevSidebarChange",[eS],Object.getOwnPropertyDescriptor(nS.prototype,"handleDevSidebarChange"),nS.prototype),(0,G.Z)(nS.prototype,"handlePreviewerTypeChange",[tS],Object.getOwnPropertyDescriptor(nS.prototype,"handlePreviewerTypeChange"),nS.prototype),oS=nS));var lS,cS;(0,J.JJ)("componentRenderStyleFlow")((cS=class{updateComponentRenderStyle(e){var t;const{doc:o,renderStyle:n,compId:i}=e;o&&i&&(null===(t=o.components.byId[i])||void 0===t||t.changeRenderStyle({newRenderStyle:n}))}},(0,G.Z)(cS.prototype,"updateComponentRenderStyle",[Q.P],Object.getOwnPropertyDescriptor(cS.prototype,"updateComponentRenderStyle"),cS.prototype),lS=cS));var dS=o(40705),pS=o.n(dS),uS=o(31507),hS=o(41034),mS=o(99489),gS=o(28295);const yS=(0,gS.dz)((0,gS.Ry)({component:(0,gS.Z_)(),content:(0,gS.Z_)(),sourcemap:(0,gS.Z_)(),sourceMapContent:(0,gS.Z_)()}));var fS,bS,wS,vS,IS,SS,jS,DS,OS,FS,TS,NS,ES,CS,xS,PS,kS,MS,ZS,US,AS,LS,_S,RS,BS;function HS(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function zS(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?HS(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):HS(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}fS=(0,J.JJ)("cloudComponentsFlow"),bS=(0,J.f3)("projectUIState"),wS=(0,J.f3)("projectDoc"),vS=(0,J.f3)("notificationsManagementFlow"),IS=(0,J.f3)("packerService"),SS=(0,J.f3)("transpilerService"),jS=(0,J.f3)("cloudComponentsRepository"),DS=(0,J.f3)("componentManagementFlow"),OS=(0,J.f3)("designLanguageManagementFlow"),FS=(0,J.f3)("modalManagementFlow"),TS=(0,J.f3)("guardsService"),NS=(0,J.f3)("sharedbProjectSyncService"),fS((CS=class{constructor(){(0,z.Z)(this,"projectUIState",xS,this),(0,z.Z)(this,"projectDoc",PS,this),(0,z.Z)(this,"notificationsManagementFlow",kS,this),(0,z.Z)(this,"packerService",MS,this),(0,z.Z)(this,"transpilerService",ZS,this),(0,z.Z)(this,"cloudComponentsRepository",US,this),(0,z.Z)(this,"componentManagementFlow",AS,this),(0,z.Z)(this,"designLanguageManagementFlow",LS,this),(0,z.Z)(this,"modalManagementFlow",_S,this),(0,z.Z)(this,"guardsService",RS,this),(0,z.Z)(this,"dbSync",BS,this)}traverseCompDeps(e){let t={};const o=this.projectDoc.components.byId[e];if(!o)throw new Error("Component is missing from doc");return t[(0,mS.UO)(o.title)]=o.id,Object.keys((null===o||void 0===o?void 0:o.usedComponents)||{}).forEach((e=>{t=zS(zS({},t),this.traverseCompDeps(e))})),t}async generateCloudComponentLink(e,t){var o;const n=this.projectDoc.components.byId[e];if(!n)throw new Error("Component is missing from project-doc");const i=this.traverseCompDeps(e),r=new Map,s=Object.values(this.projectDoc.assets.byId||{}).reduce(((e,t)=>(Object.keys(t.usedInNodes||{}).forEach((o=>{e[o]||(e[o]=[]);const n=(0,at.parse)(t.name).ext;e[o].push({localPath:`https://jscdn.teleporthq.io/${this.projectUIState.slug}/assets/${t.path}${n}`,id:t.path});const s=this.projectDoc.getComponentIdForNode(o);if(!s||!Object.values(i).includes(s))return e;r.set(t.path,{id:t.path,ext:n})})),e)),{}),a=Jt({title:this.projectUIState.title,slug:this.projectUIState.slug,doc:this.projectDoc,projectType:t,assetSrcMapping:s,options:{disableResetCSS:!0}});a.root.styleSetDefinitions=zS(zS({},null===(o=a.root)||void 0===o?void 0:o.styleSetDefinitions),{},{[mS.P5]:{type:"reusable-project-style-map",content:(0,mS.KD)(this.projectDoc.designLanguage)}});const l=(0,mS.vT)(a.root.designLanguage||{tokens:{}},a.root.styleSetDefinitions),c=(0,mS.Tj)(a.globals.assets),d=Object.values(i||{}).map((e=>{var o,n,r,s,d,p;const u=this.projectDoc.components.byId[e],h=null===(o=a.components)||void 0===o?void 0:o[u.title];if(!h)throw new Error(`Component ${null===u||void 0===u?void 0:u.title} is missing from ProjectUIDL`);return h.node.content.referencedStyles=zS(zS({},h.node.content.referencedStyles),{},{[mS.P5]:{type:"style-map",content:{mapType:"project-referenced",referenceId:mS.P5}}}),null===(n=h.node.content)||void 0===n||null===(r=n.children)||void 0===r||r.unshift((0,mS.ex)(null===(s=c.outputOptions)||void 0===s?void 0:s.fileName)),h.outputOptions={fileName:Object.keys(i).find((t=>i[t]===e))},this.packerService.generateReactComponent(h,t,{projectStyleSet:{styleSetDefinitions:(0,hS.z)((null===(d=a.root)||void 0===d?void 0:d.styleSetDefinitions)||{},{}),fileName:null===(p=l.outputOptions)||void 0===p?void 0:p.fileName,path:"./",importFile:!0}})})),p=await Promise.all([...d,this.packerService.generateGlobalsComponent(c,t),this.packerService.generateProjectStyleSheet(l)]),u={};for(const m of p){const{files:e}=m,t=await this.transpilerService.transpile(e[0].content,e[0].fileType);u[e[0].name]={name:e[0].name,fileType:e[0].fileType,content:t,version:pS()(t),deps:await this.transpilerService.parseImports(t)}}Object.values(u).forEach((e=>{const t=zS(zS({},((null===e||void 0===e?void 0:e.deps)||[]).reduce(((e,t)=>{var o;const n=null===t||void 0===t||null===(o=t.n)||void 0===o?void 0:o.substring(2);return n&&u[n]?(e[n]=u[n].version,e):e}),{})),{},{[e.name]:u[e.name].version}),o=pS()(t);u[e.name]=zS(zS(zS({},u[e.name]),(0,mS.EV)((0,mS._5)(this.projectUIState.slug,e.name,o))),{},{id:i[e.name]||e.name,componentName:(0,mS.iY)(e.name,o).component,versionWithDeps:o})})),Object.values(u).forEach((e=>{const{versionWithDeps:t,deps:o,content:n}=e;if(!t)throw new Error("Component is missing version with deps");if(!u[e.name])throw new Error(`Component ${e.name} is missing from map`);const i=new uS.ZP(n);null===o||void 0===o||o.forEach((e=>{var t;if(null===e||void 0===e||!e.n)return;const o=u[null===(t=e.n)||void 0===t?void 0:t.substring(2)];o&&i.overwrite(e.s,e.e,o.component)})),u[e.name]=zS(zS({},u[e.name]),{},{content:(0,mS.pp)(i.toString(),e.name,t),sourceMapContent:i.generateMap().toString()})}));try{const e={usedAssets:Object.values(Object.fromEntries(r)),components:yS.runWithException(u)},o=await this.cloudComponentsRepository.generateLink({compName:n.title,data:e});if(!o)throw new Error("Failed in generating CDN link");this.saveCloudComponents({parsedComponents:u,framework:t});const i=(0,ft.Gz)(n.title);return{code:`import ${i} from '${o}' \n \n <${i} ${Object.values((null===n||void 0===n?void 0:n.propDefinitions)||{}).reduce(((e,t)=>e=e+"\n"+` ${t.name}={'${t.defaultValue}'}`),"")} />`,url:o}}catch(h){console.error(h)}return null}async deleteComponent(e){const{compId:t,url:o}=e;await this.cloudComponentsRepository.deleteCompModule({paths:[o]}),this.guardsService.executeFunctionGuarded(to._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{delete e.cloudComponents.byId[t][o]}))}))}async deleteAllComponents(e){const{compId:t}=e,o=this.projectDoc.cloudComponents.byId[t];0!==Object.keys(o||{}).length&&(await this.cloudComponentsRepository.deleteCompModule({paths:Object.keys(o)}),this.guardsService.executeFunctionGuarded(to._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{delete e.cloudComponents.byId[t]}))})))}saveCloudComponents(e){const{parsedComponents:t,framework:o}=e;this.guardsService.executeFunctionGuarded(to._.DISABLE_HISTORY,(()=>{this.dbSync.mutate(this.projectDoc,(e=>{Object.values(t).forEach((t=>{const{component:n}=(0,mS.iY)(t.name,t.versionWithDeps);t.name!==mS.i2&&t.name!==mS.YE?e.cloudComponents.saveComponent({id:t.id,path:n,component:{created:(new Date).toISOString(),framework:o}}):e.cloudComponents.saveComponent({id:t.id,path:n,component:{created:(new Date).toISOString()}})}))}))}))}},xS=(0,G.Z)(CS.prototype,"projectUIState",[bS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PS=(0,G.Z)(CS.prototype,"projectDoc",[wS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kS=(0,G.Z)(CS.prototype,"notificationsManagementFlow",[vS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MS=(0,G.Z)(CS.prototype,"packerService",[IS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZS=(0,G.Z)(CS.prototype,"transpilerService",[SS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),US=(0,G.Z)(CS.prototype,"cloudComponentsRepository",[jS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AS=(0,G.Z)(CS.prototype,"componentManagementFlow",[DS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LS=(0,G.Z)(CS.prototype,"designLanguageManagementFlow",[OS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_S=(0,G.Z)(CS.prototype,"modalManagementFlow",[FS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RS=(0,G.Z)(CS.prototype,"guardsService",[TS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BS=(0,G.Z)(CS.prototype,"dbSync",[NS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ES=CS));var $S,GS,VS,JS,WS,KS,YS,XS,qS,QS,ej,tj,oj,nj,ij,rj,sj,aj,lj,cj,dj;function pj(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function uj(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?pj(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):pj(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}$S=(0,J.JJ)("htmlToDomainFlow"),GS=(0,J.f3)("cssToDomainFlow"),VS=(0,J.f3)("projectUIState"),JS=(0,J.f3)("projectClassManagementFlow"),WS=(0,J.f3)("nodeManagementFlow"),KS=(0,J.f3)("notificationsManagementFlow"),YS=(0,J.f3)("modalManagementFlow"),XS=(0,J.f3)("workersProvider"),qS=(0,J.f3)("positioningService"),QS=(0,J.f3)("componentManagementFlow"),$S((tj=class{constructor(){(0,z.Z)(this,"cssToDomainFlow",oj,this),(0,z.Z)(this,"projectUIState",nj,this),(0,z.Z)(this,"projectClassManagementFlow",ij,this),(0,z.Z)(this,"nodeManagementFlow",rj,this),(0,z.Z)(this,"notificationsManagementFlow",sj,this),(0,z.Z)(this,"modalManagementFlow",aj,this),(0,z.Z)(this,"workersProvider",lj,this),(0,z.Z)(this,"positioningService",cj,this),(0,z.Z)(this,"componentManagementFlow",dj,this)}openEditor(e){const t=Jo.d.createCustomModal({data:{code:e,title:"HTML Import",checkIfTeleportCompatible:!0},Component:Os,onSubmit:async(e,t)=>{const o=await this.workersProvider.generateHtmlTreeFromCode(e);this.submitHtml({htmlTree:o,classesToMerge:t}),this.modalManagementFlow.hideModal()}});this.modalManagementFlow.showModal(t,{padding:"0px"})}submitHtml(e){const{htmlTree:t,doc:o,classesToMerge:n}=e;if(!o)return;const i=Object.keys(this.projectUIState.selection.nodes);if(i.length>1)return;const{classes:r,nodeHierarchy:s,nodeIdToIdAttr:a}=this.convertHtmlTreeToDomain(t),l=Object.values(s).filter((e=>!e.parentId)),c=o.getRootNodeIdForPageOrComponent(this.projectUIState.selection.componentId||""),d=i.length?i[0]:c,p=this.nodeManagementFlow.findParentThatAcceptsNodes({startNode:o.nodes.byId[d||""],nodes:l});p?(this.addNodeHierarchyBFS({doc:o,hierarchy:s,targetNodeId:p.id,roots:l}),this.addNodeIdsToComp({nodeIdToIdAttr:a,doc:o}),Object.values(r).forEach((e=>{this.mergeClassesOnCollision({cls:e,doc:o,nodeHierarchy:s,classesToMerge:n})||this.projectClassManagementFlow.addClass({classToAdd:e,doc:o})}))):this.notificationsManagementFlow.createNotification(K.k.ERROR,"Could not import HTML with that selected node.")}addNodeHierarchyBFS(e){const{hierarchy:t,roots:o,doc:n,targetNodeId:i}=e;if(!n||!o.length)return;const r=o.sort(((e,t)=>{const o=parseFloat(e.pos),n=parseFloat(t.pos);return(0,_c.F0)(o)-(0,_c.F0)(n)})),s=[];for(const a of r){const e=[a.id];for(;e.length;){const o=t[e.shift()||""];e.push(...this.positioningService.orderEntities({entitiyCollection:t,entitiesOfInterest:Object.keys(o.childrenIds||{})})),s.push(o)}}this.nodeManagementFlow.addNodesToParentOrStage({nodes:s,keepOriginalParent:!0,parentId:i,skipInitForNonComponents:!0,useContentAsNode:!0,doc:n})}mergeClassesOnCollision(e){const{doc:t,cls:o,nodeHierarchy:n,classesToMerge:i}=e;if(!t||null===i||void 0===i||!i[o.name])return!1;const r=Object.values(t.classes.byId).find((e=>e.name===o.name));if(!r)return!1;r.content=uj(uj({},o.content),r.content);const s=Object.values(r.conditions);return Object.values(o.conditions).forEach((e=>{const t=s.find((t=>t.type===e.type&&JSON.stringify(t.meta)===JSON.stringify(e.meta)));t?t.content=uj(uj({},e.content),t.content):r.conditions[e.id]=e})),Object.keys(o.usedInNodes).forEach((e=>{const t=n[e];if(!t)return;delete t.referencedStyles[o.id];const i={id:r.id,type:"style-map",content:{mapType:"project-referenced",referenceId:r.id}};t.referencedStyles[i.id]=i,r.usedInNodes[e]=!0})),!0}convertHtmlTreeToDomain(e){const{nodes:t,roots:o}=e,n={},i={};let r={},s={};const a={};return o.forEach((e=>{const o=[e];for(;o.length;){const e=o.shift(),l=t[e];if("style"===l.tag&&1===Object.values(l.children).length){const e=Object.values(l.children)[0].content||"",t=this.cssToDomainFlow.convertCSSToNodeStyle(e);r=uj(uj({},r),t);const o=this.cssToDomainFlow.convertCSSToClass(e);s=uj(uj({},s),o);continue}o.push(...Object.keys(l.children));const{node:c,classNames:d,htmlId:p}=this.convertHtmlNodeToDomainNode(l);if(i[e]=d,p&&(a[e]=p),!c.primitiveType){const e=n[c.parentId||""];if(e&&1===Object.keys(e.childrenIds).length&&dt.BB.includes(e.primitiveType||"")){e.childrenIds={},e.contentChildren=Object.keys(c.contentChildren).reduce(((e,t)=>(e[t]=c.contentChildren[t].clone(),e)),{});continue}c.primitiveType=dt.sO.TEXT,c.semanticType=dt.RY.SPAN}if(c.primitiveType===dt.sO.TEXT&&c.parentId){const e=n[c.parentId];this.convertTextNodeToSpan(c,e)}n[c.id]=c}})),Object.keys(i).forEach((e=>{var t;null===(t=i[e])||void 0===t||t.forEach((t=>{const o=n[e],i=n[o.parentId||""];if(dt.BB.includes((null===i||void 0===i?void 0:i.primitiveType)||"")&&r[t])return o.styles=uj(uj({},r[t].styles),n[e].styles),void(o.referencedStyles=r[t].referencedStyles);const a=s[t];if(a){a.usedInNodes[e]=!0;const t={id:a.id,type:"style-map",content:{mapType:"project-referenced",referenceId:a.id}};o.referencedStyles[t.id]=t}}))})),{nodeHierarchy:n,classes:s,nodeIdToIdAttr:a}}convertTextNodeToSpan(e,t){if(t&&t.primitiveType===dt.sO.TEXT&&e.semanticType!==dt.RY.SPAN){const t=e.styles;[dt.RY.BOLD,dt.RY.STRONG].includes(e.semanticType)&&!t.fontWeight&&(e.styles.fontWeight=new ar.F({content:"700"})),e.semanticType!==dt.RY.ITALIC||t.fontStyle||(e.styles.fontStyle=new ar.F({content:"italic"})),e.semanticType!==dt.RY.STRIKE||t.textDecoration||(e.styles.textDecoration=new ar.F({content:"line-through"})),e.semanticType!==dt.RY.UNDERLINE||t.textDecoration||(e.styles.textDecoration=new ar.F({content:"underline"})),e.semanticType=dt.RY.SPAN}return e}convertHtmlNodeToDomainNode(e){const t=this.buildNodeBasedOnElementType(e.tag);if(!t)throw new Error(`Could not convert tag ${e.tag} to teleport`);let o,n=[];const i=Object.keys(e.attributes).reduce(((i,r)=>{if("class"===r)return n=e.attributes[r].split(" "),i;if("style"===r){if(!t)return i;const o=this.cssToDomainFlow.convertCSSToNodeStyle(`.${t.id} { ${e.attributes[r]} }`);return t.styles=o[t.id].styles,i}"id"===r&&(o=e.attributes[r]);const s=new ar.F({content:e.attributes[r]});return i[r]=s,i}),{});if(t.id=e.id,t.attrs=i,t.parentId=e.parentId||null,t.pos=e.pos,t.childrenIds=Object.keys(e.children).reduce(((e,t)=>(e[t]=!0,e)),{}),e.content){const o=new ar.F({content:this.trimTextForRTE(e.content)});t.contentChildren[o.id]=o}return{node:t,classNames:n,htmlId:o}}buildNodeBasedOnElementType(e){if(!e)return new Zc.H;const t=(0,is.x)(e);return Object.values(dt.RY).includes(e)?new Zc.H({primitiveType:dt.sO.TEXT,semanticType:e}):Object.values(dt.iX).includes(e)?new Zc.H({primitiveType:dt.sO.CONTAINER,semanticType:e}):Object.values(dt.qo).includes(e)?new Zc.H({primitiveType:dt.sO.ICON,semanticType:e}):Object.values(dt.gt).includes(e)?new Zc.H({primitiveType:dt.sO.LIST,semanticType:e}):Object.values(dt.mw).includes(e)?new Zc.H({primitiveType:dt.sO.LISTITEM,semanticType:e}):Object.values(dt.sO).includes(t)?new Zc.H({primitiveType:t}):null}trimTextForRTE(e){let t=e;const o=t.trimEnd();o!==t&&(t=`${o} `);const n=t.trimStart();return t.trimStart()!==t&&(t=` ${n}`),t}addNodeIdsToComp(e){const{nodeIdToIdAttr:t,doc:o}=e,n=this.projectUIState.selection.componentId;n&&o&&Object.keys(t).forEach((e=>{this.componentManagementFlow.addIdToComponentSectionIds({nodeId:e,compId:n,sectionId:t[e]})}))}},oj=(0,G.Z)(tj.prototype,"cssToDomainFlow",[GS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nj=(0,G.Z)(tj.prototype,"projectUIState",[VS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ij=(0,G.Z)(tj.prototype,"projectClassManagementFlow",[JS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rj=(0,G.Z)(tj.prototype,"nodeManagementFlow",[WS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sj=(0,G.Z)(tj.prototype,"notificationsManagementFlow",[KS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aj=(0,G.Z)(tj.prototype,"modalManagementFlow",[YS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lj=(0,G.Z)(tj.prototype,"workersProvider",[XS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cj=(0,G.Z)(tj.prototype,"positioningService",[qS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dj=(0,G.Z)(tj.prototype,"componentManagementFlow",[QS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(tj.prototype,"submitHtml",[Q.P],Object.getOwnPropertyDescriptor(tj.prototype,"submitHtml"),tj.prototype),(0,G.Z)(tj.prototype,"addNodeHierarchyBFS",[Q.P],Object.getOwnPropertyDescriptor(tj.prototype,"addNodeHierarchyBFS"),tj.prototype),(0,G.Z)(tj.prototype,"mergeClassesOnCollision",[Q.P],Object.getOwnPropertyDescriptor(tj.prototype,"mergeClassesOnCollision"),tj.prototype),(0,G.Z)(tj.prototype,"addNodeIdsToComp",[Q.P],Object.getOwnPropertyDescriptor(tj.prototype,"addNodeIdsToComp"),tj.prototype),ej=tj));var hj,mj,gj,yj,fj;function bj(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function wj(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?bj(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):bj(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}hj=(0,J.JJ)("cssToDomainFlow"),mj=(0,J.f3)("projectDoc"),hj((yj=class{constructor(){(0,z.Z)(this,"projectDoc",fj,this)}convertCSSToNodeStyle(e){var t;const o=(0,ns.parse)(e,{}),n={};return null===(t=o.stylesheet)||void 0===t||t.rules.forEach((e=>{var t;if(this.isMediaRule(e)){var o,i,r;if(null===(o=e.media)||void 0===o||!o.includes("max-width"))throw new Error("Only max-width media queries supported.");const t=parseInt((null===(i=e.media.match(/\d+/))||void 0===i?void 0:i[0])||"");if(!t||!Object.values(this.projectDoc.mediaQueryBreakpoints.getNonDefaultActiveMQBreakpointsInOrder()).map((e=>e.maxWidth)).find((e=>e===t)))throw new Error(`Media Query ${t}px is not in the declared media queries. To avoid inconsistentcies, please add it or modify the snippet.`);return void(null===(r=e.rules)||void 0===r||r.forEach((e=>{var o;if(!this.isRule(e))return;this.validateRule(e,!0);const i=null===(o=e.selectors)||void 0===o?void 0:o[0].replace(".",""),r=this.parseRule(e),s={id:(0,lt.Z)(),type:"style-map",content:{conditions:[{conditionType:"screen-size",maxWidth:t}],styles:r,mapType:"inlined"}};n[i]||(n[i]={styles:{},referencedStyles:{}}),n[i]={styles:n[i].styles,referencedStyles:wj(wj({},n[i].referencedStyles),{},{[s.id]:s})}})))}if(!this.isRule(e))return;this.validateRule(e,!0);const s=null===(t=e.selectors)||void 0===t?void 0:t[0].replace(".","");n[s]||(n[s]={styles:{},referencedStyles:{}}),n[s]={styles:this.parseRule(e),referencedStyles:n[s].referencedStyles}})),n}convertCSSToClass(e){var t;const o=(0,ns.parse)(e,{}),n={},i=Object.values(this.projectDoc.classes.categoriesById||{})[0].id;return null===(t=o.stylesheet)||void 0===t||t.rules.forEach((e=>{var t;if(this.isMediaRule(e)){var o,r,s;if(null===(o=e.media)||void 0===o||!o.includes("max-width"))throw new Error("Only max-width media queries supported.");const t=parseInt((null===(r=e.media.match(/\d+/))||void 0===r?void 0:r[0])||"");if(!t||!Object.values(this.projectDoc.mediaQueryBreakpoints.getNonDefaultActiveMQBreakpointsInOrder()).map((e=>e.maxWidth)).find((e=>e===t)))throw new Error(`Media Query ${t}px is not in the declared media queries. To avoid inconsistentcies, please add it or modify the snippet.`);return void(null===(s=e.rules)||void 0===s||s.forEach((e=>{var o;if(!this.isRule(e))return;this.validateRule(e);const r=null===(o=e.selectors)||void 0===o?void 0:o[0].replace(".",""),s=this.parseRule(e),a={id:(0,lt.Z)(),type:"screen-size",content:s,meta:{maxWidth:t}};n[r]||(n[r]=n[r]=new ir.q({name:r,pos:"0",content:{},categoryId:i})),n[r].conditions=wj(wj({},n[r].conditions),{},{[a.id]:a})})))}if(!this.isRule(e))return;this.validateRule(e);const a=null===(t=e.selectors)||void 0===t?void 0:t[0].replace(".","");n[a]||(n[a]=new ir.q({name:a,pos:"0",content:{},categoryId:i})),n[a].content=this.parseRule(e)})),n}parseRule(e){var t;const o={};return null===(t=e.declarations)||void 0===t||t.forEach((e=>{if(!this.isDeclaration(e))return;const{property:t,value:n}=e;t&&n&&(o[(0,ft.hN)(t)]=new ar.F({content:n}))})),o}isRule(e){return"rule"===e.type}isMediaRule(e){return"media"===e.type}isDeclaration(e){return"declaration"===e.type}validateRule(e,t){var o;if(1!==(null===(o=e.selectors)||void 0===o?void 0:o.length)||e.selectors[0].split(" ").length>1)throw new Error("Complex selectors not yet supported.");if(!e.selectors[0].startsWith("."))throw new Error(`Only class selectors supported at the moment. "${e.selectors[0]}" is not a class.`);if(t)return;if(!/^\.-?[_a-zA-Z]+[_a-zA-Z0-9-]*$/g.test(e.selectors[0]))throw new Error(`Unsupported or invalid class deinition: "${e.selectors[0]}"`)}},fj=(0,G.Z)(yj.prototype,"projectDoc",[mj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gj=yj));o(86015),o(53590);class vj{constructor(e){(0,$.Z)(this,"currentState",void 0),(0,$.Z)(this,"states",void 0),this.states=e.states,this.currentState=e.initial}get state(){return this.currentState}send(e){const{currentState:t,states:o}=this,n=o[t][e];if(!n){const n=Object.keys(o[t]);throw new Error(`State Machien receive unsuported singnal of type ${e} for current state ${t}. This state supports only the following singnals ${n.join(", ")}`)}return this.currentState=n,this}}var Ij=o(63410);const Sj=(e,t)=>{let o=!1,n=e;const i=()=>{o=!0};if(t(n,i),!o)for(;n.parentElement;)if(n=n.parentElement,t(n,i),o)return},jj=e=>e.type===Fs.Z.SUB_HIERARCHY||e.type===Fs.Z.ABSOLUTE_SUB_HIERARCHY;var Dj,Oj,Fj,Tj,Nj,Ej,Cj,xj,Pj,kj,Mj,Zj,Uj,Aj,Lj,_j,Rj,Bj,Hj,zj,$j,Gj,Vj,Jj,Wj,Kj,Yj,Xj,qj,Qj,eD,tD,oD,nD,iD,rD,sD,aD,lD,cD,dD,pD,uD,hD,mD,gD,yD,fD,bD,wD,vD,ID,SD,jD,DD,OD,FD,TD,ND,ED,CD,xD,PD,kD,MD,ZD,UD,AD,LD,_D,RD,BD,HD,zD,$D,GD,VD,JD=o(71646),WD=o(56301);Dj=(0,J.JJ)("pointerInteractionManagementFlow"),Oj=(0,J.f3)("projectDoc"),Fj=(0,J.f3)("projectUIState"),Tj=(0,J.f3)("webRTCState"),Nj=(0,J.f3)("stageMoveFlow"),Ej=(0,J.f3)("rtcFlow"),Cj=(0,J.f3)("elementRefProvider"),xj=(0,J.f3)("layoutManagementFlow"),Pj=(0,J.f3)("dragPrimitiveFlow"),kj=(0,J.f3)("dragComponentFlow"),Mj=(0,J.f3)("dragPageFlow"),Zj=(0,J.f3)("dragUploadedAssetFlow"),Uj=(0,J.f3)("dragRemoteAssetFlow"),Aj=(0,J.f3)("dragIconAssetFlow"),Lj=(0,J.f3)("dragExistingNodeFlow"),_j=(0,J.f3)("dragTokenFlow"),Rj=(0,J.f3)("dragSectionTemplateFlow"),Bj=(0,J.f3)("dragInteractiveElementFlow"),Hj=(0,J.f3)("devFileDragFlow"),zj=(0,J.f3)("dragWidgetFlow"),$j=(0,J.f3)("dropIntoFolderFlow"),Gj=(0,J.f3)("dropIntoFlexContainerFlow"),Vj=(0,J.f3)("dropIntoUnknownContainerFlow"),Jj=(0,J.f3)("dropIntoTreeViewFlow"),Wj=(0,J.f3)("dropIntoBlockInlineContainerFlow"),Kj=(0,J.f3)("dropIntoInheritContainerFlow"),Yj=(0,J.f3)("dropIntoSlotFlow"),Xj=(0,J.f3)("dropIntoTokenCategoryFlow"),qj=(0,J.f3)("notificationsManagementFlow"),Qj=(0,J.f3)("dropIntoButtonFlow"),eD=(0,J.f3)("dropIntoNavbarFlow"),tD=(0,J.f3)("dropIntoListFlow"),oD=(0,J.f3)("sharedbProjectSyncService"),nD=(0,J.f3)("guardsService"),iD=(0,J.f3)("dropSimulatorFlow"),rD=(0,J.f3)("dropSimulatorWatcher"),sD=(0,q.G)(te.l.DRAG),Dj(($D=new WeakMap,GD=new WeakMap,VD=new WeakMap,lD=class{constructor(){(0,z.Z)(this,"projectDoc",cD,this),(0,z.Z)(this,"projectUIState",dD,this),(0,z.Z)(this,"webRTCState",pD,this),(0,z.Z)(this,"stageMoveFlow",uD,this),(0,z.Z)(this,"rtcFlow",hD,this),(0,z.Z)(this,"elementRefProvider",mD,this),(0,z.Z)(this,"layoutManagementFlow",gD,this),(0,z.Z)(this,"dragPrimitiveFlow",yD,this),(0,z.Z)(this,"dragComponentFlow",fD,this),(0,z.Z)(this,"dragPageFlow",bD,this),(0,z.Z)(this,"dragUploadedAssetFlow",wD,this),(0,z.Z)(this,"dragRemoteAssetFlow",vD,this),(0,z.Z)(this,"dragIconAssetFlow",ID,this),(0,z.Z)(this,"dragExistingNodeFlow",SD,this),(0,z.Z)(this,"dragTokenFlow",jD,this),(0,z.Z)(this,"dragSectionTemplateFlow",DD,this),(0,z.Z)(this,"dragInteractiveElementFlow",OD,this),(0,z.Z)(this,"dragFileFlow",FD,this),(0,z.Z)(this,"dragWidgetFlow",TD,this),(0,z.Z)(this,"dropIntoFolderFlow",ND,this),(0,z.Z)(this,"dropIntoFlexContainerFlow",ED,this),(0,z.Z)(this,"dropIntoUnknownContainerFlow",CD,this),(0,z.Z)(this,"dropIntoTreeViewFlow",xD,this),(0,z.Z)(this,"dropIntoBlockInlineContainerFlow",PD,this),(0,z.Z)(this,"dropIntoInheritContainerFlow",kD,this),(0,z.Z)(this,"dropIntoSlotFlow",MD,this),(0,z.Z)(this,"dropIntoTokenCategoryFlow",ZD,this),(0,z.Z)(this,"notificationsManagementFlow",UD,this),(0,z.Z)(this,"dropIntoButtonFlow",AD,this),(0,z.Z)(this,"dropIntoNavbarFlow",LD,this),(0,z.Z)(this,"dropIntoListFlow",_D,this),(0,z.Z)(this,"sharedbProjectSyncService",RD,this),(0,z.Z)(this,"guardsService",BD,this),(0,z.Z)(this,"dropSimulatorFlow",HD,this),(0,z.Z)(this,"dropSimulatorWatcher",zD,this),$D.set(this,{writable:!0,value:[]}),GD.set(this,{writable:!0,value:void 0}),VD.set(this,{writable:!0,value:null}),(0,$.Z)(this,"pointerSM",new vj({initial:"idle",states:{idle:{"pointer down":"prospecting"},prospecting:{"pointer move":"dragging",timeout:"dragging","pointer up":"clicking"},clicking:{next:"idle"},dragging:{"pointer move":"dragging","pointer up":"dropping",esc:"idle"},dropping:{next:"idle"}}})),(0,$.Z)(this,"dragFlows",[this.dragUploadedAssetFlow,this.dragRemoteAssetFlow,this.dragIconAssetFlow,this.dragPageFlow,this.dragExistingNodeFlow,this.dragPrimitiveFlow,this.dragComponentFlow,this.dragTokenFlow,this.dragSectionTemplateFlow,this.dragFileFlow,this.dragWidgetFlow,this.dragInteractiveElementFlow]),(0,$.Z)(this,"activeDragFlow",null),(0,$.Z)(this,"dropFlows",[this.dropIntoButtonFlow,this.dropIntoFlexContainerFlow,this.dropIntoTreeViewFlow,this.dropIntoBlockInlineContainerFlow,this.dropIntoListFlow,this.dropIntoUnknownContainerFlow,this.dropIntoInheritContainerFlow,this.dropIntoTokenCategoryFlow,this.dropIntoNavbarFlow,this.dropIntoFolderFlow,this.dropIntoSlotFlow]),(0,$.Z)(this,"activeDropFlows",[]),(0,$.Z)(this,"acceptingDropFlow",null),(0,$.Z)(this,"startinDragTO",0),(0,$.Z)(this,"dragStartParams",null),(0,$.Z)(this,"initialTarget",null),(0,$.Z)(this,"handlePointerDownEvent",((e,t)=>{var o;if("idle"!==this.pointerSM.state)return;if(0!==e.button)return;const{pressedKeys:n}=this.projectUIState.userInteractions;if(n.space)return;const i=this.getActualPositionOnPage(e,t);if((0,V.JG)(this.projectUIState,(e=>{e.drag.initialMousePosition=i})),this.initialTarget=null!==(o=e.target)&&void 0!==o?o:(0,Ij.e5)(i),!this.initialTarget)return;const r=this.initialTarget;if((0,rd.Qq)(r))return;const{dragFlows:s}=this;this.pointerSM.send("pointer down");let a=null,l=null;Sj(r,((o,n)=>{for(let r=0;r<s.length;r+=1)if(a=s[r].acceptDOMElement(o,e),a){if(l=s[r],!t&&e.target instanceof HTMLElement){const t=e.target.closest('[tabindex="0"]');t instanceof HTMLElement&&t.focus()}var i;if(t&&t.target instanceof HTMLIFrameElement)null===(i=t.target.contentDocument)||void 0===i||i.body.focus();if((0,rd.Qq)(o))return a=null,void n();e.preventDefault(),n();break}})),this.activeDragFlow=l,a&&l&&(this.dragStartParams={ev:e,target:r,position:i,matchedDraggedEntity:a,macthedDragFlow:l},this.startinDragTO=setTimeout((()=>{this.pointerSM.send("timeout"),(0,V.JG)(this.projectUIState,(e=>{e.drag.currentMousePosition=i})),this.startDrag()}),250))})),(0,$.Z)(this,"handlePointerMoveByMouse",((e,t,o)=>{const n=this.pointerSM.state;if((0,Gi.Z)(this,VD,{ev:e,customEv:t}),-1===["prospecting","dragging"].indexOf(n))return;const i=e.target,r={x:e.clientX,y:e.clientY},s=this.projectUIState.drag.draggedEntity;if(t&&t.target instanceof HTMLIFrameElement){const e=this.projectUIState.stage.webComp.controlValues.scale,o=t.target.getBoundingClientRect();r.x=r.x*e+o.x,r.y=r.y*e+o.y,t.detail.originalEvent.target instanceof HTMLElement&&s&&jj(s)&&this.stageMoveFlow.checkAndMoveStage(r)}if("prospecting"===n){const e=this.projectUIState.drag.initialMousePosition;if(!e)return;if(!(0,WD.NN)(e,r,20))return;clearTimeout(this.startinDragTO),this.startDrag()}if(this.pointerSM.send("pointer move"),(0,V.JG)(this.projectUIState,(({drag:e})=>{e.currentMousePosition=r})),!this.activeDragFlow||!s)return;if(this.activeDragFlow.pointerMove(e,r),!this.activeDropFlows.length)return;if(!i||!(i instanceof HTMLElement||i instanceof SVGElement))return;let a=!1;var l;(Sj(i,((n,i)=>{for(let l=0;l<this.activeDropFlows.length;l+=1){const c=this.activeDropFlows[l];if(c.acceptsDOMElement(n,e,r,t)){if((0,rd.Qq)(n))return void i();this.acceptingDropFlow&&this.acceptingDropFlow!==c&&this.acceptingDropFlow.moveOut(e,r),this.acceptingDropFlow=c,this.acceptingDropFlow.moveOver({draggedEntity:s,ev:e,position:r,customEv:t,forced:o}),a=!0,e.stopPropagation(),e.preventDefault(),i();break}}})),a)||(null===(l=this.acceptingDropFlow)||void 0===l||l.moveOut(e,r),this.acceptingDropFlow=null)})),(0,$.Z)(this,"logEventsIntoAnalytics",((e,t)=>{if(e){if(e.type===Fs.Z.SUB_HIERARCHY&&e.content.isNew){const o=(0,$i.Z)(this,GD);"drop"===t?ee.Z.mixpanelEvent(o===Y.tI.ASSETS_MANAGER?ee.Z.AnalyticsEvents.PROJECT_SIDEBARS_LEFT_ASSETS_MANAGER_UPLOADS_TAB_ASSET_DROP:ee.Z.AnalyticsEvents.PROJECT_SIDEBARS_LEFT_ELEMENTS_ELEMENTS_TAB_ELEMENT_DROP,{type:e.content.subHierarchy[0].primitiveType}):"drag"===t&&ee.Z.mixpanelEvent(o===Y.tI.ASSETS_MANAGER?ee.Z.AnalyticsEvents.PROJECT_SIDEBARS_LEFT_ASSETS_MANAGER_UPLOADS_TAB_ASSET_DRAG:ee.Z.AnalyticsEvents.PROJECT_SIDEBARS_LEFT_ELEMENTS_ELEMENTS_TAB_ELEMENT_DRAG,{type:e.content.subHierarchy[0].primitiveType})}e.type===Fs.Z.INTERACTIVE_ELEMENT&&("drop"===t?ee.Z.mixpanelEvent(ee.Z.AnalyticsEvents.PROJECT_SIDEBARS_LEFT_ELEMENTS_ELEMENTS_TAB_ELEMENT_DROP,{type:e.type}):ee.Z.mixpanelEvent(ee.Z.AnalyticsEvents.PROJECT_SIDEBARS_LEFT_ELEMENTS_ELEMENTS_TAB_ELEMENT_DRAG,{type:e.type})),e.type===Fs.Z.SECTION_TEMPLATE&&("drop"===t?ee.Z.mixpanelEvent(ee.Z.AnalyticsEvents.PROJECT_SIDEBARS_LEFT_ELEMENTS_SECTIONS_TAB_SECTION_DROP,{type:e.type}):ee.Z.mixpanelEvent(ee.Z.AnalyticsEvents.PROJECT_SIDEBARS_LEFT_ELEMENTS_SECTIONS_TAB_SECTION_DRAG,{type:e.type}))}})),(0,$.Z)(this,"handlePointerUp",((e,t)=>{const o=this.pointerSM.state;if(this.dropSimulatorFlow.rollback(),-1===["prospecting","dragging"].indexOf(o))return;this.pointerSM.send("pointer up").send("next");const n=this.getActualPositionOnPage(e,t),i=this.projectUIState.drag.draggedEntity;var r,s,a;if("prospecting"===o)return clearTimeout(this.startinDragTO),(0,V.JG)(this.projectUIState,(e=>{e.drag.draggedEntity=null})),this.dragStartParams=null,null===(r=this.activeDragFlow)||void 0===r||null===(s=r.pointerSelect)||void 0===s||s.call(r,{ev:e,position:n,initialTarget:this.initialTarget}),null===(a=this.activeDragFlow)||void 0===a||a.cleanUp(),void(this.initialTarget=null);i&&(e.stopPropagation(),e.preventDefault(),this.logEventsIntoAnalytics(i,"drop"),this.handleSyncPointerUpOps({ev:e,draggedEntity:i,position:n}))})),(0,$.Z)(this,"handleDragStart",(e=>{const t=(0,Ij.FG)(e),o=(0,Ij.e5)(t);if(!o)return;const{dragFlows:n}=this;Sj(o,((t,o)=>{for(let i=0;i<n.length;i+=1){if(n[i].acceptDOMElement(t,e)){e.preventDefault(),e.stopPropagation(),o();break}}}))})),(0,$.Z)(this,"unbind",(e=>{e.removeEventListener("mousedown",this.handlePointerDownEvent),e.removeEventListener("mousemove",this.handlePointerMoveByMouse),e.removeEventListener("mouseup",this.handlePointerUp),(0,$i.Z)(this,$D).forEach((e=>e())),this.dropSimulatorWatcher.stopListeningForUpdates()})),this.handleVirtualDrop=this.handleVirtualDrop.bind(this),this.handleDragEnd=this.handleDragEnd.bind(this)}startDrag(){const{pressedKeys:e,inPreviewMode:t}=this.projectUIState.userInteractions;if(t&&(0,V.JG)(this.projectUIState,(({userInteractions:e})=>{e.inPreviewMode=!1})),e.ctrl)return;const{dragStartParams:o}=this;if(!o)return;const{ev:n,position:i,matchedDraggedEntity:r,macthedDragFlow:s}=o;if(!r)return;if(jj(r)){const e=this.projectUIState.layout.sidebarPanel;if(e!==Y.tI.FILES&&r.content.subHierarchy.length&&((0,Gi.Z)(this,GD,e),this.layoutManagementFlow.changeActiveSidebar(Y.tI.FILES)),r.content.hierarchyType===Fs.h.EXISTING){const e=r.content.subHierarchy;if(0===e.length)return void s.pointerDown(n,i);if(this.rtcFlow.isNodeLocked(e[0].id))return;const t=e.map((e=>{if(r.type===Fs.Z.SUB_HIERARCHY){const t=this.elementRefProvider.getDomNodeElementRefById(e.id);null===t||void 0===t||t.style.setProperty("opacity","0.5")}return e.id}));this.rtcFlow.lockEditedNodes(t)}}if(r.type===Fs.Z.INTERACTIVE_ELEMENT){const e=this.projectUIState.layout.sidebarPanel;e!==Y.tI.FILES&&((0,Gi.Z)(this,GD,e),this.layoutManagementFlow.changeActiveSidebar(Y.tI.FILES))}this.logEventsIntoAnalytics(r,"drag"),s.pointerDown(n,i),(0,V.JG)(this.projectUIState,(e=>{e.drag.draggedEntity=r}));const a=[];for(let l=0;l<this.dropFlows.length;l+=1)this.dropFlows[l].handleDraggedEntity(r,i)&&a.push(this.dropFlows[l]),this.activeDropFlows=a}forcefullyRecomputeMove(){(0,$i.Z)(this,VD)&&this.handlePointerMoveByMouse((0,$i.Z)(this,VD).ev,(0,$i.Z)(this,VD).customEv,!0)}handleSyncPointerUpOps(e){var t,o;const{ev:n,doc:i,draggedEntity:r,position:s}=e;if(!i)return;null===(t=this.acceptingDropFlow)||void 0===t||t.handleDrop({draggedEntity:r,doc:i});const a=jj(r)?r.content.subHierarchy[0].id:null;null===(o=this.activeDragFlow)||void 0===o||o.pointerUp({ev:n,position:s,draggedEntityId:a,doc:i}),this.handleDragEnd()}handleVirtualDrop(e){const{doc:t}=e;if(!t)return!1;const{draggedEntity:o}=this.projectUIState.drag;return!!o&&this.guardsService.executeFunctionGuarded(to._.VIRTUAL_WORK,(()=>{var e;return null===(e=this.acceptingDropFlow)||void 0===e?void 0:e.handleDrop({draggedEntity:o,doc:t,isVirtual:!0})}))}handleDragEnd(){var e,t;const{draggedEntity:o}=this.projectUIState.drag;o&&jj(o)&&(null===o||void 0===o?void 0:o.content.hierarchyType)===Fs.h.EXISTING&&this.rtcFlow.unlockEditedNodes(),this.dropSimulatorFlow.rollback(),this.dropSimulatorFlow.disposeOfIndicator(),(0,Gi.Z)(this,VD,null),(0,V.JG)(this.projectUIState,(({drag:e})=>{e.draggedEntity=null})),"undefined"!==typeof(0,$i.Z)(this,GD)&&(this.layoutManagementFlow.changeActiveSidebar((0,$i.Z)(this,GD)),(0,Gi.Z)(this,GD,void 0)),null===(e=this.acceptingDropFlow)||void 0===e||e.resetState(),null===(t=this.activeDragFlow)||void 0===t||t.cleanUp(),this.acceptingDropFlow=null,this.activeDragFlow=null,this.activeDropFlows=[],this.dragStartParams=null,this.initialTarget=null,"dragging"===this.pointerSM.state&&this.pointerSM.send("esc")}getActualPositionOnPage(e,t){const o=(0,Ij.FG)(e);if(t&&t.target instanceof HTMLIFrameElement){const e=this.projectUIState.stage.webComp.controlValues.scale,n=t.target.getBoundingClientRect(),i=(0,mt.AO)(t.target);o.x=o.x*e*i+n.x,o.y=o.y*e*i+n.y}return o}bind(e){e.addEventListener("mousedown",this.handlePointerDownEvent),e.addEventListener("mousemove",this.handlePointerMoveByMouse),e.addEventListener("mouseup",this.handlePointerUp),(0,Gi.Z)(this,$D,[...(0,JD.un)({target:e,types:["mousedown","touchstart"],callback:(e,t)=>this.handlePointerDownEvent(e,t)}),...(0,JD.un)({target:e,types:["mouseup"],callback:(e,t)=>this.handlePointerUp(e,t)}),...(0,JD.un)({target:e,types:["mousemove"],callback:(e,t)=>this.handlePointerMoveByMouse(e,t)})]),this.dropSimulatorWatcher.listenForUpdates()}},cD=(0,G.Z)(lD.prototype,"projectDoc",[Oj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dD=(0,G.Z)(lD.prototype,"projectUIState",[Fj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pD=(0,G.Z)(lD.prototype,"webRTCState",[Tj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uD=(0,G.Z)(lD.prototype,"stageMoveFlow",[Nj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hD=(0,G.Z)(lD.prototype,"rtcFlow",[Ej],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mD=(0,G.Z)(lD.prototype,"elementRefProvider",[Cj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gD=(0,G.Z)(lD.prototype,"layoutManagementFlow",[xj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yD=(0,G.Z)(lD.prototype,"dragPrimitiveFlow",[Pj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fD=(0,G.Z)(lD.prototype,"dragComponentFlow",[kj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bD=(0,G.Z)(lD.prototype,"dragPageFlow",[Mj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wD=(0,G.Z)(lD.prototype,"dragUploadedAssetFlow",[Zj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vD=(0,G.Z)(lD.prototype,"dragRemoteAssetFlow",[Uj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ID=(0,G.Z)(lD.prototype,"dragIconAssetFlow",[Aj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SD=(0,G.Z)(lD.prototype,"dragExistingNodeFlow",[Lj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jD=(0,G.Z)(lD.prototype,"dragTokenFlow",[_j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DD=(0,G.Z)(lD.prototype,"dragSectionTemplateFlow",[Rj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OD=(0,G.Z)(lD.prototype,"dragInteractiveElementFlow",[Bj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FD=(0,G.Z)(lD.prototype,"dragFileFlow",[Hj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TD=(0,G.Z)(lD.prototype,"dragWidgetFlow",[zj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ND=(0,G.Z)(lD.prototype,"dropIntoFolderFlow",[$j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ED=(0,G.Z)(lD.prototype,"dropIntoFlexContainerFlow",[Gj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CD=(0,G.Z)(lD.prototype,"dropIntoUnknownContainerFlow",[Vj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xD=(0,G.Z)(lD.prototype,"dropIntoTreeViewFlow",[Jj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PD=(0,G.Z)(lD.prototype,"dropIntoBlockInlineContainerFlow",[Wj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kD=(0,G.Z)(lD.prototype,"dropIntoInheritContainerFlow",[Kj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MD=(0,G.Z)(lD.prototype,"dropIntoSlotFlow",[Yj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZD=(0,G.Z)(lD.prototype,"dropIntoTokenCategoryFlow",[Xj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),UD=(0,G.Z)(lD.prototype,"notificationsManagementFlow",[qj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AD=(0,G.Z)(lD.prototype,"dropIntoButtonFlow",[Qj],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LD=(0,G.Z)(lD.prototype,"dropIntoNavbarFlow",[eD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_D=(0,G.Z)(lD.prototype,"dropIntoListFlow",[tD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RD=(0,G.Z)(lD.prototype,"sharedbProjectSyncService",[oD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BD=(0,G.Z)(lD.prototype,"guardsService",[nD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HD=(0,G.Z)(lD.prototype,"dropSimulatorFlow",[iD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zD=(0,G.Z)(lD.prototype,"dropSimulatorWatcher",[rD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(lD.prototype,"startDrag",[sD],Object.getOwnPropertyDescriptor(lD.prototype,"startDrag"),lD.prototype),(0,G.Z)(lD.prototype,"handleSyncPointerUpOps",[Q.P],Object.getOwnPropertyDescriptor(lD.prototype,"handleSyncPointerUpOps"),lD.prototype),(0,G.Z)(lD.prototype,"handleVirtualDrop",[Q.P],Object.getOwnPropertyDescriptor(lD.prototype,"handleVirtualDrop"),lD.prototype),aD=lD));var KD,YD,XD,qD,QD,eO,tO,oO,nO,iO,rO,sO=o(12443);class aO{constructor(e){(0,$.Z)(this,"stencilKey",void 0),(0,$.Z)(this,"newNode",[]),(0,$.Z)(this,"isNew",!0),(0,$.Z)(this,"hierarchyType",Fs.h.PRIMITIVE),this.stencilKey=e,this.newNode=[(0,sO.a)({stencilKey:this.stencilKey})]}get subHierarchy(){return this.newNode}get representation(){return(0,WD.H)(Ol.hK[this.stencilKey],(0,mt.kC)(this.stencilKey))}}KD=(0,J.JJ)("dragPrimitiveFlow"),YD=(0,J.f3)("projectDoc"),XD=(0,J.f3)("nodeManagementFlow"),qD=(0,J.f3)("nodeSelectionFlow"),QD=(0,J.f3)("modalManagementFlow"),KD((tO=class{constructor(){(0,z.Z)(this,"projectDoc",oO,this),(0,z.Z)(this,"nodeManagementFlow",nO,this),(0,z.Z)(this,"nodeSelectionFlow",iO,this),(0,z.Z)(this,"modalManagementFlow",rO,this),(0,$.Z)(this,"draggedPrimitive",null),(0,$.Z)(this,"acceptDOMElement",(e=>e instanceof HTMLElement?this.draggedPrimitive=(e=>{if(!e)return null;const t=e.dataset.dragPrimitive;if(!t)return null;const o=new aO(t);return{type:Fs.Z.SUB_HIERARCHY,content:o,representation:o.representation}})(e):null)),(0,$.Z)(this,"pointerSelect",(()=>{if(!this.draggedPrimitive)return;const e=this.draggedPrimitive.content.subHierarchy;ee.Z.mixpanelEvent(ee.Z.AnalyticsEvents.PROJECT_SIDEBARS_LEFT_ELEMENTS_ELEMENTS_TAB_ELEMENT_CLICK,{elementType:e[0].primitiveType}),e[0].primitiveType!==dt.sO.HTML_NODE?this.nodeManagementFlow.addPrimitivesToSelNodeSelectAndScroll({primitives:this.draggedPrimitive.content.subHierarchy}):this.nodeManagementFlow.addEmbedNodeToSelNode({primitives:e})})),(0,$.Z)(this,"pointerDown",(()=>null)),(0,$.Z)(this,"pointerMove",(()=>null)),(0,$.Z)(this,"cleanUp",(()=>null))}pointerUp(e){const{draggedEntityId:t,doc:o}=e;null!==o&&void 0!==o&&o.nodes.byId[t||""]&&this.nodeSelectionFlow.setNodeSelection({nodeId:t,expandTreeView:!1})}},oO=(0,G.Z)(tO.prototype,"projectDoc",[YD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nO=(0,G.Z)(tO.prototype,"nodeManagementFlow",[XD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iO=(0,G.Z)(tO.prototype,"nodeSelectionFlow",[qD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rO=(0,G.Z)(tO.prototype,"modalManagementFlow",[QD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(tO.prototype,"pointerUp",[Q.P],Object.getOwnPropertyDescriptor(tO.prototype,"pointerUp"),tO.prototype),eO=tO));var lO,cO,dO,pO,uO,hO,mO,gO,yO,fO,bO,wO,vO,IO,SO,jO,DO,OO,FO,TO,NO,EO,CO;let xO=(lO=(0,J.f3)("projectDoc"),cO=(0,J.f3)("projectUIState"),dO=class{constructor(e){(0,z.Z)(this,"projectDoc",pO,this),(0,z.Z)(this,"projectUIState",uO,this),(0,$.Z)(this,"assets",[]),(0,$.Z)(this,"assetNodes",[]),(0,$.Z)(this,"repres",{}),(0,$.Z)(this,"assetIdToNodeIdMapping",{}),(0,$.Z)(this,"isNew",!0),(0,$.Z)(this,"hierarchyType",Fs.h.PRIMITIVE);const t=this.projectUIState.assetsList.selected;if(-1!==Object.keys(t).indexOf(e)?this.assets=Object.keys(t).reduce(((e,t)=>(e.push(this.projectDoc.assets.byId[t]),e)),[]):this.assets=[this.projectDoc.assets.byId[e]],this.assets.forEach((e=>{this.assetNodes.push((0,sO.a)({stencilKey:(0,mt.MF)(e)===dt.sO.VIDEO?Ol.sO.VIDEO:Ol.sO.IMAGE,attrs:{src:e.id}})),this.assetIdToNodeIdMapping[e.id]=this.assetNodes[this.assetNodes.length-1].id})),1!==this.assets.length)return void(this.repres=(0,WD.H)(Fl.TV.asset,"Assets"));const o=this.assets[0],n=o.type===we.K.VIDEO,i=n?(0,mt.Bh)(o):(0,mt.zo)(o,`&w=${pt.ou.oq}`);this.repres=(0,gr.jsx)("img",{alt:"",style:{objectFit:"contain",backgroundColor:Ki.Pt.DARK_02},width:100,height:100,src:i}),n&&(this.repres=(0,gr.jsx)("video",{style:{width:"160px",height:"90px"},autoPlay:!0,muted:!0,loop:!0,src:i}))}get subHierarchy(){return this.assetNodes}get meta(){return{assets:this.assets,assetIdToNodeIdMapping:this.assetIdToNodeIdMapping}}get representation(){return this.repres}},pO=(0,G.Z)(dO.prototype,"projectDoc",[lO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uO=(0,G.Z)(dO.prototype,"projectUIState",[cO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dO);hO=(0,J.JJ)("dragUploadedAssetFlow"),mO=(0,J.f3)("nodeSelectionFlow"),gO=(0,J.f3)("nodeRichTextFlow"),yO=(0,J.f3)("assetsEditFlow"),fO=(0,J.f3)("projectDoc"),bO=(0,J.f3)("projectUIState"),wO=(0,J.f3)("assetsManagementFlow"),vO=(0,J.f3)("nodeManagementFlow"),IO=(0,dr.u)(dr.j.ADD_ASSET_PRIMITIVE),hO((jO=class{constructor(){(0,$.Z)(this,"draggedAsset",null),(0,z.Z)(this,"nodeSelectionFlow",DO,this),(0,z.Z)(this,"nodeRichTextFlow",OO,this),(0,z.Z)(this,"assetsEditFlow",FO,this),(0,z.Z)(this,"projectDoc",TO,this),(0,z.Z)(this,"projectUIState",NO,this),(0,z.Z)(this,"assetsManagementFlow",EO,this),(0,z.Z)(this,"nodeManagementFlow",CO,this),(0,$.Z)(this,"actionType",null),(0,$.Z)(this,"acceptDOMElement",(e=>{if(!(e instanceof HTMLElement))return null;const t=e.dataset.assetAction;return t&&e.closest("[data-drag-new-local-asset]")&&(this.actionType=t),this.draggedAsset=(e=>{if(!e)return null;const t=e.dataset.dragNewLocalAsset,o=e.dataset.assetId;if(!t||!o)return null;const n=new xO(o);return{type:Fs.Z.SUB_HIERARCHY,content:n,representation:n.representation}})(e),this.draggedAsset?this.draggedAsset:null})),(0,$.Z)(this,"pointerSelect",(()=>{if(!this.draggedAsset||!this.actionType)return;const e=this.draggedAsset.content.meta.assets[0].id;switch(this.nodeManagementFlow.revertLocalWork(),ee.Z.mixpanelEvent(ee.Z.AnalyticsEvents.PROJECT_SIDEBARS_LEFT_ASSETS_MANAGER_UPLOADS_TAB_ASSET_CLICK),this.actionType){case hp.g.REPLACE_SOURCE:{const{activeSelection:t,selectionStyles:o}=this.projectUIState.staticNodeInterationsData,n=this.nodeSelectionFlow.getSelectedNodeType();!n||n!==dt.sO.LIST&&n!==dt.sO.LISTITEM?t||o?this.updateTextBackgroundImage(e):n===Ol.sO.IMAGE||n===Ol.sO.VIDEO||n===dt.sO.COMPONENT?this.assetsManagementFlow.setSrcForSelectedNode(e):this.assetsManagementFlow.setBgImageForSelectedNode(e):this.assetsManagementFlow.setListStyleImageForSelectedNode(e);break}case hp.g.REPLACE_POSTER:this.assetsManagementFlow.setPosterForSelectedNode(e);break;case hp.g.ADD_SIBLING:this.assetsManagementFlow.addAssetAfterSelectedNode(e);break;case hp.g.ADD_CHILD:this.assetsManagementFlow.addAssetOrContainerToSelectedNode(e)}this.actionType=null})),(0,$.Z)(this,"pointerDown",(()=>null)),(0,$.Z)(this,"pointerMove",(()=>null)),(0,$.Z)(this,"cleanUp",(()=>{this.actionType=null})),this.pointerUp=this.pointerUp.bind(this)}pointerUp(e){const{draggedEntityId:t,doc:o}=e;if(!o||!t||!this.draggedAsset)return[];if(!o.nodes.byId[t])return[];this.nodeSelectionFlow.setNodeSelection({nodeId:t,expandTreeView:!1});const n=this.draggedAsset.content.meta.assets[0].id,i=Object.keys(this.projectUIState.assetsList.selected);return-1===i.indexOf(n)?(this.assetsEditFlow.createAssetInNodeRelation({nodeId:t,assetId:n,doc:o}),[n]):(i.forEach((e=>{var t;this.assetsEditFlow.createAssetInNodeRelation({nodeId:null===(t=this.draggedAsset)||void 0===t?void 0:t.content.meta.assetIdToNodeIdMapping[e],assetId:e,doc:o})})),i)}updateTextBackgroundImage(e){const t=Object.keys(this.projectUIState.selection.nodes)[0],o=this.projectDoc.nodes.byId[t];if(!o)return;const n=this.nodeRichTextFlow.getTextComponentForNode(o.id);if(!n)return;const i=this.projectDoc.assets.byId[e];n.handleFormatChange({styles:{backgroundImage:{value:`url("${i.remoteSrc}")`}}})}},DO=(0,G.Z)(jO.prototype,"nodeSelectionFlow",[mO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OO=(0,G.Z)(jO.prototype,"nodeRichTextFlow",[gO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FO=(0,G.Z)(jO.prototype,"assetsEditFlow",[yO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TO=(0,G.Z)(jO.prototype,"projectDoc",[fO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NO=(0,G.Z)(jO.prototype,"projectUIState",[bO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EO=(0,G.Z)(jO.prototype,"assetsManagementFlow",[wO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CO=(0,G.Z)(jO.prototype,"nodeManagementFlow",[vO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(jO.prototype,"pointerUp",[Q.P,IO],Object.getOwnPropertyDescriptor(jO.prototype,"pointerUp"),jO.prototype),SO=jO));var PO,kO,MO,ZO,UO,AO,LO;class _O{constructor(e,t){(0,$.Z)(this,"newNodes",[]),(0,$.Z)(this,"repres",void 0),(0,$.Z)(this,"isNew",!0),(0,$.Z)(this,"hierarchyType",Fs.h.PRIMITIVE);const o=(0,sO.a)({stencilKey:Ol.sO.ICON,attrs:{viewBox:`0 0 ${t||1024} 1024`}});this.newNodes.push(o);const n=JSON.parse(e)||[];(null===n||void 0===n?void 0:n.length)>0&&n.forEach((e=>{const t=new Zc.H({primitiveType:dt.sO.ICON,semanticType:dt.qo.PATH,pos:"0",attrs:{d:new ar.F({content:e})},parentId:o.id});this.newNodes.push(t)}));const i=n.map(((e,t)=>(0,gr.jsx)("path",{d:e},t)));this.repres=(0,gr.jsxs)("div",{className:ss.default.dynamic([["984448913",[Ki.Pt.DARK_02,Ki.N_.UNIT,Ki.N_.HALF_UNIT]]])+" icon-container",children:[(0,gr.jsx)("svg",{height:"24",width:"24",viewBox:`0 0 ${t||1024} 1024`,fill:"#fff",stroke:"#fff",className:ss.default.dynamic([["984448913",[Ki.Pt.DARK_02,Ki.N_.UNIT,Ki.N_.HALF_UNIT]]]),children:i}),(0,gr.jsx)("span",{className:ss.default.dynamic([["984448913",[Ki.Pt.DARK_02,Ki.N_.UNIT,Ki.N_.HALF_UNIT]]])+" label",children:"Icon"}),(0,gr.jsx)(ss.default,{id:"984448913",dynamic:[Ki.Pt.DARK_02,Ki.N_.UNIT,Ki.N_.HALF_UNIT],children:[`.icon-container.__jsx-style-dynamic-selector{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;background-color:${Ki.Pt.DARK_02};-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;padding:${Ki.N_.UNIT};}`,`.label.__jsx-style-dynamic-selector{margin:${Ki.N_.HALF_UNIT};}`]})]})}get meta(){return{nodeType:dt.sO.ICON}}get subHierarchy(){return this.newNodes}get representation(){return this.repres}}PO=(0,J.JJ)("dragIconAssetFlow"),kO=(0,J.f3)("nodeManagementFlow"),MO=(0,J.f3)("nodeSelectionFlow"),PO((UO=class{constructor(){(0,z.Z)(this,"nodeManagementFlow",AO,this),(0,z.Z)(this,"nodeSelectionFlow",LO,this),(0,$.Z)(this,"draggedAsset",null),(0,$.Z)(this,"acceptDOMElement",(e=>e instanceof HTMLElement?this.draggedAsset=(e=>{if(!e)return null;const t=e.dataset.dragNewIconPaths,o=e.dataset.dragNewIconWidth;if(!t)return null;const n=new _O(t,o);return{type:Fs.Z.SUB_HIERARCHY,content:n,representation:n.representation}})(e):null)),(0,$.Z)(this,"pointerDown",(()=>null)),(0,$.Z)(this,"pointerSelect",(()=>{this.draggedAsset&&this.nodeManagementFlow.addPrimitivesToSelNodeSelectAndScroll({primitives:this.draggedAsset.content.subHierarchy,keepOriginalParent:!0})})),(0,$.Z)(this,"pointerMove",(()=>null)),(0,$.Z)(this,"cleanUp",(()=>null))}pointerUp(e){const{draggedEntityId:t,doc:o}=e;null!==o&&void 0!==o&&o.nodes.byId[t||""]&&this.nodeSelectionFlow.setNodeSelection({nodeId:t,expandTreeView:!1})}},AO=(0,G.Z)(UO.prototype,"nodeManagementFlow",[kO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LO=(0,G.Z)(UO.prototype,"nodeSelectionFlow",[MO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(UO.prototype,"pointerUp",[Q.P],Object.getOwnPropertyDescriptor(UO.prototype,"pointerUp"),UO.prototype),ZO=UO));var RO,BO,HO,zO,$O,GO,VO,JO,WO,KO,YO,XO,qO,QO,eF,tF,oF;class nF{constructor(e){(0,$.Z)(this,"src",""),(0,$.Z)(this,"remoteAssetNode",[]),(0,$.Z)(this,"isNew",!0),(0,$.Z)(this,"hierarchyType",Fs.h.PRIMITIVE),this.src=e,this.remoteAssetNode=[(0,sO.a)({stencilKey:Ol.sO.IMAGE,attrs:{src:this.src}})]}get subHierarchy(){return this.remoteAssetNode}get representation(){return(0,gr.jsx)("img",{alt:"",style:{objectFit:"contain",backgroundColor:Ki.Pt.DARK_02},width:100,height:100,src:this.src})}}RO=(0,J.JJ)("dragRemoteAssetFlow"),BO=(0,J.f3)("projectDoc"),HO=(0,J.f3)("projectUIState"),zO=(0,J.f3)("assetsManagementFlow"),$O=(0,J.f3)("nodeManagementFlow"),GO=(0,J.f3)("nodeSelectionFlow"),VO=(0,J.f3)("elementRefProvider"),JO=(0,J.f3)("nodeRichTextFlow"),RO((KO=class{constructor(){(0,$.Z)(this,"draggedAsset",null),(0,z.Z)(this,"projectDoc",YO,this),(0,z.Z)(this,"projectUIState",XO,this),(0,z.Z)(this,"assetsManagementFlow",qO,this),(0,z.Z)(this,"nodeManagementFlow",QO,this),(0,z.Z)(this,"nodeSelectionFlow",eF,this),(0,z.Z)(this,"elementRefProvider",tF,this),(0,z.Z)(this,"nodeRichTextFlow",oF,this),(0,$.Z)(this,"actionType",null),(0,$.Z)(this,"assetLink",null),(0,$.Z)(this,"downloadUrl",null),(0,$.Z)(this,"previewImgUrl",null),(0,$.Z)(this,"remoteAssetUrl",null),(0,$.Z)(this,"acceptDOMElement",(e=>{if(!(e instanceof HTMLElement))return null;const t=e.dataset.assetAction;return t&&e.closest("[data-remote-asset-url]")&&(this.actionType=t),this.draggedAsset=(e=>{if(!e)return null;const t=e.dataset.remoteAssetUrl;if(!t)return null;const o=new nF(t);return{type:Fs.Z.SUB_HIERARCHY,content:o,representation:o.representation}})(e),this.draggedAsset?(this.previewImgUrl=e.dataset.previewImgUrl||null,this.downloadUrl=e.dataset.downloadLink||null,this.assetLink=e.dataset.assetLink||null,this.remoteAssetUrl=e.dataset.remoteAssetUrl||null,this.draggedAsset):null})),(0,$.Z)(this,"pointerSelect",(()=>{if(!this.assetLink||!this.downloadUrl||!this.actionType)return;const e=this.nodeSelectionFlow.getSelectedNodeId(),t=this.nodeSelectionFlow.getSelectedNodeType(),o=this.projectUIState.userPreferences.previewAssetsOnHover?this.remoteAssetUrl:this.previewImgUrl;if(this.actionType===hp.g.REPLACE_SOURCE&&o&&e){if(t===Ol.sO.IMAGE){const t=this.elementRefProvider.getDomNodeElementRefById(e);null===t||void 0===t||t.setAttribute("src",o)}if(t===dt.sO.COMPONENT){const{targetNodeId:t}=this.assetsManagementFlow.getPropNameAndTargetNodeForImageInComp(e),n=this.elementRefProvider.getDomNodeElementRefByCompInstance(t,e);null===n||void 0===n||n.setAttribute("src",o)}}switch(this.nodeManagementFlow.revertLocalWork(),this.actionType){case hp.g.REPLACE_SOURCE:{const{activeSelection:e,selectionStyles:o}=this.projectUIState.staticNodeInterationsData;if(t===Ol.sO.IMAGE||t===dt.sO.COMPONENT){if(this.projectUIState.userInteractions.pressedKeys.alt&&t===dt.sO.COMPONENT){this.assetsManagementFlow.setBgImageForSelectedNode(this.assetLink,this.downloadUrl);break}this.assetsManagementFlow.setSrcForSelectedNode(this.assetLink,this.downloadUrl)}else e||o?this.updateTextBackgroundImage():this.assetsManagementFlow.setBgImageForSelectedNode(this.assetLink,this.downloadUrl);break}case hp.g.REPLACE_POSTER:this.assetsManagementFlow.setPosterForSelectedNode(this.assetLink,this.downloadUrl);break;case hp.g.ADD_SIBLING:this.assetsManagementFlow.addAssetAfterSelectedNode(this.assetLink,this.downloadUrl);break;case hp.g.ADD_CHILD:this.assetsManagementFlow.addAssetOrContainerToSelectedNode(this.assetLink,this.downloadUrl,!1)}this.actionType=null})),(0,$.Z)(this,"pointerDown",(()=>null)),(0,$.Z)(this,"pointerMove",(()=>null)),(0,$.Z)(this,"cleanUp",(()=>{this.actionType=null,this.downloadUrl=null,this.previewImgUrl=null,this.remoteAssetUrl=null})),this.pointerUp=this.pointerUp.bind(this)}async pointerUp(e){const{doc:t,draggedEntityId:o}=e;if(!t||!this.downloadUrl||!o)return;t.nodes.byId[o]&&(this.assetsManagementFlow.triggerUnsplashDownload(this.downloadUrl),this.nodeSelectionFlow.setNodeSelection({nodeId:o,expandTreeView:!1}))}updateTextBackgroundImage(){const e=Object.keys(this.projectUIState.selection.nodes)[0],t=this.projectDoc.nodes.byId[e];if(!t)return;const o=this.nodeRichTextFlow.getTextComponentForNode(t.id);o&&o.handleFormatChange({styles:{backgroundImage:{value:`url("${this.assetLink}&w=${pt.ou.yL}")`}}})}},YO=(0,G.Z)(KO.prototype,"projectDoc",[BO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XO=(0,G.Z)(KO.prototype,"projectUIState",[HO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qO=(0,G.Z)(KO.prototype,"assetsManagementFlow",[zO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),QO=(0,G.Z)(KO.prototype,"nodeManagementFlow",[$O],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eF=(0,G.Z)(KO.prototype,"nodeSelectionFlow",[GO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tF=(0,G.Z)(KO.prototype,"elementRefProvider",[VO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oF=(0,G.Z)(KO.prototype,"nodeRichTextFlow",[JO],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(KO.prototype,"pointerUp",[Q.P],Object.getOwnPropertyDescriptor(KO.prototype,"pointerUp"),KO.prototype),WO=KO));var iF,rF,sF,aF,lF,cF,dF,pF,uF,hF,mF,gF,yF,fF;let bF=(iF=(0,J.f3)("projectDoc"),rF=class{get meta(){return{dragComponentId:this.componentSourceId}}constructor(e){(0,z.Z)(this,"projectDoc",sF,this),(0,$.Z)(this,"componentSourceId",void 0),(0,$.Z)(this,"newComponentNode",void 0),(0,$.Z)(this,"isNew",!0),(0,$.Z)(this,"hierarchyType",Fs.h.COMPONENT),this.componentSourceId=e;if(!this.projectDoc.components.byId[e])throw new Error(`Could not construct component drag entity. Component ${e} is missing.`);const t=new Ni.F({primitiveType:dt.sO.COMPONENT});t.compIdOfCompInstance=e,this.newComponentNode=[t]}get subHierarchy(){return this.newComponentNode}get representation(){return(0,WD.H)(Fl.u7["tree-stencil/component"],"Component")}},sF=(0,G.Z)(rF.prototype,"projectDoc",[iF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rF);aF=(0,J.JJ)("dragComponentFlow"),lF=(0,J.f3)("projectDoc"),cF=(0,J.f3)("componentManagementFlow"),dF=(0,J.f3)("componentStyleManagementFlow"),pF=(0,J.f3)("nodeSelectionFlow"),aF((hF=class{constructor(){(0,z.Z)(this,"projectDoc",mF,this),(0,z.Z)(this,"componentManagementFlow",gF,this),(0,z.Z)(this,"componentStyleManagementFlow",yF,this),(0,z.Z)(this,"nodeSelectionFlow",fF,this),(0,$.Z)(this,"acceptDOMElement",(e=>e instanceof HTMLElement?(e=>{if(!e)return null;const t=e.dataset.dragComponentId;if(!t)return null;const o=new bF(t);return{type:Fs.Z.SUB_HIERARCHY,content:o,representation:o.representation}})(e):null)),(0,$.Z)(this,"pointerSelect",(()=>null)),(0,$.Z)(this,"pointerDown",(()=>null)),(0,$.Z)(this,"pointerMove",(()=>null)),(0,$.Z)(this,"cleanUp",(()=>null)),this.pointerUp=this.pointerUp.bind(this)}async pointerUp(e){const{doc:t,draggedEntityId:o}=e;if(!t||!o)return;const n=t.nodes.byId[o];if(!n||!t.nodes.nodeIsCompInstance(n))return;const i=t.components.byId[n.compIdOfCompInstance];this.componentStyleManagementFlow.addClassToCompInstance({compInstanceId:n.id,compId:i.id,className:i.getUniqueStyleSetName(t),doc:t}),this.nodeSelectionFlow.setNodeSelection({nodeId:o,expandTreeView:!1})}},mF=(0,G.Z)(hF.prototype,"projectDoc",[lF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gF=(0,G.Z)(hF.prototype,"componentManagementFlow",[cF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yF=(0,G.Z)(hF.prototype,"componentStyleManagementFlow",[dF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fF=(0,G.Z)(hF.prototype,"nodeSelectionFlow",[pF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(hF.prototype,"pointerUp",[Q.P],Object.getOwnPropertyDescriptor(hF.prototype,"pointerUp"),hF.prototype),uF=hF));var wF,vF,IF,SF;let jF=(wF=(0,J.f3)("projectDoc"),vF=class{get meta(){return{dragPageId:this.pageSourceId}}constructor(e){(0,z.Z)(this,"projectDoc",IF,this),(0,$.Z)(this,"pageSourceId",void 0),this.pageSourceId=e}get representation(){return(0,WD.H)(Fl.TV.page,"Page")}},IF=(0,G.Z)(vF.prototype,"projectDoc",[wF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vF);(0,J.JJ)("dragPageFlow")(SF=class{constructor(){(0,$.Z)(this,"draggedPage",null),(0,$.Z)(this,"acceptDOMElement",(e=>e instanceof HTMLElement?this.draggedPage=(e=>{if(!e)return null;const t=e.dataset.dragPageId;if(!t)return null;const o=new jF(t);return{type:Fs.Z.PAGE,content:o,representation:o.representation}})(e):null)),(0,$.Z)(this,"pointerSelect",(()=>null)),(0,$.Z)(this,"pointerDown",(()=>null)),(0,$.Z)(this,"pointerMove",(()=>null)),(0,$.Z)(this,"pointerUp",(()=>null)),(0,$.Z)(this,"cleanUp",(()=>null))}});var DF,OF,FF,TF,NF,EF,CF,xF,PF,kF,MF,ZF,UF,AF,LF,_F,RF,BF,HF,zF,$F,GF,VF,JF,WF,KF,YF,XF,qF=o(93096),QF=o.n(qF);function eT(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}let tT=(DF=(0,J.f3)("projectDoc"),OF=(0,J.f3)("projectUIState"),FF=(0,J.f3)("elementRefProvider"),TF=(0,J.f3)("nodeEditingFlow"),NF=class{constructor(e,t,o){var n,i,r,s;(0,z.Z)(this,"projectDoc",EF,this),(0,z.Z)(this,"projectUIState",CF,this),(0,z.Z)(this,"elementRefProvider",xF,this),(0,z.Z)(this,"nodeEditingFlow",PF,this),(0,$.Z)(this,"nodeId",void 0),(0,$.Z)(this,"compInstanceId",void 0),(0,$.Z)(this,"existingNodeInstances",[]),(0,$.Z)(this,"repres",null),(0,$.Z)(this,"nodePositionProperties",{}),(0,$.Z)(this,"inTreeview",void 0),(0,$.Z)(this,"isNew",!1),(0,$.Z)(this,"hierarchyType",Fs.h.EXISTING);let a=this.projectDoc.nodes.byId[e];if(!a)throw new Error(`ExistingNodeHierarchy could not find the subhierarchy from which the drag started; nodeId: ${e}`);this.nodeId=t||e;const{slotId:l}=this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(a.id);if(l&&t&&(this.nodeId=e,this.compInstanceId=t),!l&&t&&(a=this.projectDoc.nodes.byId[t]||a),this.inTreeview=!(null===o||void 0===o||!o.closest(".tree-view")),a.primitiveType===dt.sO.SLOT&&null!==o&&void 0!==o&&o.dataset.compInstanceId)return;const c=Object.keys(this.projectUIState.selection.nodes||{});let d,p;const u=c.every((e=>this.nodeEditingFlow.nodeIsRich({nodeId:e})));if(-1!==c.indexOf(this.nodeId)){const{primitiveType:t}=this.nodeEditingFlow.getCommonTypeForNodes(c);d=this.nodeEditingFlow.getElementIconPath(c),p=u?"Rich Text":t||"",c.forEach((t=>{const o=this.projectDoc.nodes.byId[t];if(!o)throw new Error(`ExistingNodeHierarchy could not find selected node with id: ${e}`);o.compIdOfRootNode||this.existingNodeInstances.push(o)}))}else{if(a.compIdOfRootNode)return void(this.existingNodeInstances=[]);p=u?"Rich Text":a.primitiveType||"",d=this.nodeEditingFlow.getElementIconPath([a.id]),this.existingNodeInstances=[a]}this.nodePositionProperties=(0,WD.tx)(this.existingNodeInstances,this.elementRefProvider);const h=this.projectUIState.stage.webComp.controlValues.scale,m=null===(n=this.elementRefProvider.getIframeRef())||void 0===n||null===(i=n.current)||void 0===i?void 0:i.getBoundingClientRect(),g=null===m||void 0===m?void 0:m.y,y=null===m||void 0===m?void 0:m.x,f=((null===(r=this.projectUIState.drag.initialMousePosition)||void 0===r?void 0:r.y)-g)/h,b=((null===(s=this.projectUIState.drag.initialMousePosition)||void 0===s?void 0:s.x)-y)/h;this.nodePositionProperties.verticalOffset=this.inTreeview?0:f-this.nodePositionProperties.selectionTop,this.nodePositionProperties.horizontalOffset=this.inTreeview?0:b-this.nodePositionProperties.selectionLeft,this.inTreeview?d&&p&&(this.repres=(0,WD.H)(d,(0,mt.kC)(p))):this.repres=(0,WD.AM)(this.nodePositionProperties.width*h,this.nodePositionProperties.height*h)}get meta(){const{pressedKeys:e}=this.projectUIState.userInteractions,t=this.subHierarchy.length>1?"Clone nodes":"Clone node";return function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?eT(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):eT(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({nodeId:this.nodeId,compInstanceId:this.compInstanceId,message:e.alt?t:"",inTreeview:this.inTreeview},this.nodePositionProperties)}get subHierarchy(){return this.existingNodeInstances}get representation(){return this.repres}},EF=(0,G.Z)(NF.prototype,"projectDoc",[DF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CF=(0,G.Z)(NF.prototype,"projectUIState",[OF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xF=(0,G.Z)(NF.prototype,"elementRefProvider",[FF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PF=(0,G.Z)(NF.prototype,"nodeEditingFlow",[TF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NF);kF=(0,J.JJ)("dragExistingNodeFlow"),MF=(0,J.f3)("projectUIState"),ZF=(0,J.f3)("projectDoc"),UF=(0,J.f3)("nodeSelectionFlow"),AF=(0,J.f3)("nodeManagementFlow"),LF=(0,J.f3)("nodeStyleManagmentFlow"),_F=(0,J.f3)("stageScrollFlow"),RF=(0,J.f3)("elementRefProvider"),BF=(0,J.f3)("freestyleNodeFlow"),kF((zF=class{constructor(){(0,z.Z)(this,"projectUIState",$F,this),(0,z.Z)(this,"projectDoc",GF,this),(0,z.Z)(this,"nodeSelectionFlow",VF,this),(0,z.Z)(this,"nodeManagementFlow",JF,this),(0,z.Z)(this,"nodeStyleManagmentFlow",WF,this),(0,z.Z)(this,"stageScrollFlow",KF,this),(0,z.Z)(this,"elementRefProvider",YF,this),(0,z.Z)(this,"freestyleNodeFlow",XF,this),(0,$.Z)(this,"draggedHierarchy",null),(0,$.Z)(this,"scrollTreeviewToNode",(e=>{const t=document.querySelector(`[data-node-id='${e}']`);if(t){t.scrollIntoView({block:"nearest",inline:"start"});const e=t.closest(".tree-view-wrapper");if(e)return e.scrollBy(-250,0),!0}return!1})),(0,$.Z)(this,"acceptDOMElement",(e=>{var t,o;if(!(e instanceof HTMLElement||e instanceof SVGElement)||(null===(t=e.parentElement)||void 0===t?void 0:t.tagName.toLowerCase())===ht.rC)return null;const n=(e=>{if(!e)return null;const{nodeId:t,compInstanceId:o}=(0,rd.MT)({element:e})||{};if(!t)return null;const n=new tT(t,o,e);return{type:Fs.Z.SUB_HIERARCHY,content:n,representation:n.representation}})(e);return(null===n||void 0===n||null===(o=n.content.meta)||void 0===o?void 0:o.inTreeview)?this.draggedHierarchy=n:(this.draggedHierarchy=this.freestyleNodeFlow.startFreestyleDragFromEntity(n),this.draggedHierarchy)})),(0,$.Z)(this,"pointerSelect",(e=>{var t,o,n;const{ev:i,initialTarget:r}=e;if(!this.draggedHierarchy)return;const s=r||i.target,a=null===(t=this.draggedHierarchy)||void 0===t||null===(o=t.content.meta)||void 0===o?void 0:o.inTreeview,{nodeId:l,compInstanceId:c}=(0,rd.MT)({element:s})||{},d=this.projectDoc.nodes.byId[l||""];if(!d)return;const p=d.primitiveType===dt.sO.SLOT,u=p||this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(d.id).slotId,h=u?d.id:c||l||(null===(n=this.draggedHierarchy.content.meta)||void 0===n?void 0:n.nodeId),m=!!i&&(i.ctrlKey||i.metaKey),g=!!i&&i.shiftKey;if(m?this.nodeSelectionFlow.setNodeSelection({nodeId:h,isMultiSelectMode:!p,compInstanceId:u?c:null}):g?this.nodeSelectionFlow.setNodeRangeSelection({nodeId:h,compInstanceId:u?c:null}):this.nodeSelectionFlow.setNodeSelection({nodeId:h,isMultiSelectMode:!1,compInstanceId:u?c:null}),a){const e=this.projectDoc.nodes.byId[c||""];if(p&&Object.keys((null===e||void 0===e?void 0:e.slottedNodes[d.id||""])||{}).length){const e=this.projectDoc.nodes.getFirstChild(d,c);return void this.stageScrollFlow.bringNodeIntoView(null===e||void 0===e?void 0:e.id,c)}this.stageScrollFlow.bringNodeIntoView(h,c)}else this.scrollTreeviewToNode(h)||setTimeout((()=>{this.scrollTreeviewToNode(h)}),200)})),(0,$.Z)(this,"pointerDown",(()=>null)),(0,$.Z)(this,"pointerMove",QF()((()=>{this.freestyleNodeFlow.moveDraggedFreestyleNodes()}),ts.x1.SIXTY))}cleanUp(){var e;null===(e=this.draggedHierarchy)||void 0===e||e.content.subHierarchy.forEach((e=>{const t=this.elementRefProvider.getDomNodeElementRefById(e.id);null===t||void 0===t||t.style.removeProperty("opacity")})),this.draggedHierarchy=null,this.freestyleNodeFlow.cleanUpAfterFreestyleDrag()}pointerUp(e){var t;const{draggedEntityId:o,doc:n}=e;if(null===n||void 0===n||!n.nodes.byId[o||""])return;const i=(null===(t=this.draggedHierarchy)||void 0===t?void 0:t.content.subHierarchy.map((e=>e.id)))||[],{compInstanceId:r}=n.nodes.getSlotAndCompInstanceIdForNodeById(o||"");this.nodeSelectionFlow.setMultipleNodesSelection(i,r),this.freestyleNodeFlow.endFreestyleDrag({doc:n})}},$F=(0,G.Z)(zF.prototype,"projectUIState",[MF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GF=(0,G.Z)(zF.prototype,"projectDoc",[ZF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VF=(0,G.Z)(zF.prototype,"nodeSelectionFlow",[UF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JF=(0,G.Z)(zF.prototype,"nodeManagementFlow",[AF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WF=(0,G.Z)(zF.prototype,"nodeStyleManagmentFlow",[LF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),KF=(0,G.Z)(zF.prototype,"stageScrollFlow",[_F],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),YF=(0,G.Z)(zF.prototype,"elementRefProvider",[RF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),XF=(0,G.Z)(zF.prototype,"freestyleNodeFlow",[BF],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(zF.prototype,"pointerUp",[Q.P],Object.getOwnPropertyDescriptor(zF.prototype,"pointerUp"),zF.prototype),HF=zF));var oT,nT,iT,rT,sT,aT,lT,cT,dT,pT;let uT=(oT=(0,J.f3)("projectDoc"),nT=class{constructor(e){(0,z.Z)(this,"projectDoc",iT,this),(0,$.Z)(this,"token",void 0),(0,$.Z)(this,"repres",{});const t=this.projectDoc.designLanguage.tokensById[e],o=this.projectDoc.designLanguage.textStyleSetsById[e];if(!t&&!o)throw new Error("Token non-existent");this.token=t||o,this.repres=t?"color"===t.type?(0,WD.Uz)(t):(0,WD.TU)(t):(0,WD.cq)(o)}get representation(){return this.repres}},iT=(0,G.Z)(nT.prototype,"projectDoc",[oT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nT);rT=(0,J.JJ)("dragTokenFlow"),sT=(0,J.f3)("projectDoc"),aT=(0,J.f3)("sharedbProjectSyncService"),rT((cT=class{constructor(){(0,z.Z)(this,"projectDoc",dT,this),(0,z.Z)(this,"dbSync",pT,this),(0,$.Z)(this,"draggedToken",null),(0,$.Z)(this,"acceptDOMElement",(e=>e instanceof HTMLElement?(this.draggedToken=(e=>{if(!e)return null;const t=e.dataset.tokenId;if(!t)return null;const o=new uT(t);return{type:"token",content:o,representation:o.representation}})(e),this.draggedToken):null)),(0,$.Z)(this,"pointerSelect",(()=>null)),(0,$.Z)(this,"pointerDown",(()=>null)),(0,$.Z)(this,"pointerMove",(()=>null)),(0,$.Z)(this,"pointerUp",(()=>null)),(0,$.Z)(this,"cleanUp",(()=>{document.documentElement.style.cursor="default"}))}},dT=(0,G.Z)(cT.prototype,"projectDoc",[sT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pT=(0,G.Z)(cT.prototype,"dbSync",[aT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lT=cT));var hT,mT,gT,yT,fT=o(39923);let bT=(hT=(0,J.f3)("projectDoc"),mT=class{get sectionId(){return this.sectionTemplateId}get customCodeSnippet(){return this.sectionTemplateCode}constructor(e,t){(0,z.Z)(this,"projectDoc",gT,this),(0,$.Z)(this,"sectionTemplateId",void 0),(0,$.Z)(this,"sectionTemplateCode",void 0),(0,$.Z)(this,"isNew",!0),this.sectionTemplateId=e,this.sectionTemplateCode=t}get representation(){return(0,gr.jsx)("img",{style:{maxWidth:"350px"},src:(0,fT.kn)(this.sectionTemplateId),alt:"Section Template"})}},gT=(0,G.Z)(mT.prototype,"projectDoc",[hT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mT);(0,J.JJ)("dragSectionTemplateFlow")(yT=class{constructor(){(0,$.Z)(this,"draggedTemplate",null),(0,$.Z)(this,"acceptDOMElement",(e=>e instanceof HTMLElement?this.draggedTemplate=(e=>{if(!e)return null;const t=e.dataset.dragSectionTemplateId,o=e.dataset.dragSectionTemplateCode?JSON.parse(e.dataset.dragSectionTemplateCode):void 0;if(!t)return null;const n=new bT(t,o);return{type:Fs.Z.SECTION_TEMPLATE,content:n,representation:n.representation}})(e):null)),(0,$.Z)(this,"pointerSelect",(()=>{var e;ee.Z.mixpanelEvent(ee.Z.AnalyticsEvents.PROJECT_SIDEBARS_LEFT_ELEMENTS_SECTIONS_TAB_SECTION_CLICK,{elementType:null===(e=this.draggedTemplate)||void 0===e?void 0:e.type})})),(0,$.Z)(this,"pointerDown",(()=>null)),(0,$.Z)(this,"pointerMove",(()=>null)),(0,$.Z)(this,"pointerUp",(()=>null)),(0,$.Z)(this,"cleanUp",(()=>null))}});var wT,vT,IT,ST,jT,DT,OT,FT,TT=o(90511);let NT=(wT=(0,J.f3)("projectUIState"),vT=class{get meta(){return{widgetPath:this.widgetPath}}constructor(e){(0,z.Z)(this,"projectUIState",IT,this),(0,$.Z)(this,"widgetPath",void 0),(0,$.Z)(this,"newWidgetNode",void 0),(0,$.Z)(this,"isNew",!0),(0,$.Z)(this,"hierarchyType",Fs.h.PRIMITIVE),this.widgetPath=e;const t=new Zc.H({semanticType:dt.sO.DEV_COMPONENT,primitiveType:dt.sO.DEV_COMPONENT,devComponentPath:e,name:(0,W.rk)(e),fakeSize:!1,abilities:{}});this.newWidgetNode=[t]}get subHierarchy(){return this.newWidgetNode}get representation(){var e;const t=null===(e=this.projectUIState.devMode.devComponents[this.widgetPath])||void 0===e?void 0:e.component;return t?(0,gr.jsxs)("div",{className:ss.default.dynamic([["3478446010",[Ki.N_.HALF_UNIT,Ki.N_.TWO_UNITS,Ki.bo.HIGHLIGHT]]])+" widget-container",children:[(0,gr.jsx)(TT.k,{component:t}),(0,gr.jsx)(ss.default,{id:"3478446010",dynamic:[Ki.N_.HALF_UNIT,Ki.N_.TWO_UNITS,Ki.bo.HIGHLIGHT],children:[`.widget-container.__jsx-style-dynamic-selector{margin:${Ki.N_.HALF_UNIT};padding:${Ki.N_.TWO_UNITS};background-color:${Ki.bo.HIGHLIGHT};border:1px solid black;max-width:400px;max-height:400px;color:initial;}`]})]}):"Widget"}},IT=(0,G.Z)(vT.prototype,"projectUIState",[wT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vT);ST=(0,J.JJ)("dragWidgetFlow"),jT=(0,J.f3)("nodeSelectionFlow"),ST((OT=class{constructor(){(0,z.Z)(this,"nodeSelectionFlow",FT,this),(0,$.Z)(this,"acceptDOMElement",(e=>e instanceof HTMLElement?(e=>{if(!e)return null;const t=e.dataset.dragWidgetId;if(!t)return null;const o=new NT(t);return{type:Fs.Z.SUB_HIERARCHY,content:o,representation:o.representation}})(e):null)),(0,$.Z)(this,"pointerSelect",(()=>null)),(0,$.Z)(this,"pointerDown",(()=>null)),(0,$.Z)(this,"pointerMove",(()=>null)),(0,$.Z)(this,"cleanUp",(()=>null)),this.pointerUp=this.pointerUp.bind(this)}async pointerUp(e){const{doc:t,draggedEntityId:o}=e;if(!t||!o)return;t.nodes.byId[o]&&this.nodeSelectionFlow.setNodeSelection({nodeId:o,expandTreeView:!1})}},FT=(0,G.Z)(OT.prototype,"nodeSelectionFlow",[jT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(OT.prototype,"pointerUp",[Q.P],Object.getOwnPropertyDescriptor(OT.prototype,"pointerUp"),OT.prototype),DT=OT));var ET,CT,xT,PT,kT,MT,ZT,UT;let AT=(ET=(0,J.f3)("projectDoc"),CT=class{constructor(e,t){(0,z.Z)(this,"projectDoc",xT,this),(0,$.Z)(this,"file",void 0),(0,$.Z)(this,"filePath",void 0),(0,$.Z)(this,"draggingForbidden",void 0),(0,$.Z)(this,"repres",{}),this.filePath=e,this.file=this.projectDoc.projectFiles.local[t].byId[e],this.draggingForbidden=(0,WD.AS)(e),this.repres=(0,WD.ML)(e)}get representation(){return this.repres}},xT=(0,G.Z)(CT.prototype,"projectDoc",[ET],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CT);PT=(0,J.JJ)("devFileDragFlow"),kT=(0,J.f3)("projectUIState"),PT((ZT=class{constructor(){(0,$.Z)(this,"draggedToken",null),(0,z.Z)(this,"projectUIState",UT,this),(0,$.Z)(this,"acceptDOMElement",(e=>{if(!(e instanceof HTMLElement))return null;const t=this.projectUIState.devMode.selectedBranch;return this.draggedToken=((e,t)=>{if(!t)return null;if(t.dataset.projectFiles)return null;const o=t.dataset.fileId||t.dataset.folderId;if(!o)return null;const n=new AT(o,e);return{type:Fs.Z.FILE,content:n,representation:n.representation}})(t,e),this.draggedToken})),(0,$.Z)(this,"pointerSelect",(()=>null)),(0,$.Z)(this,"pointerDown",(()=>null)),(0,$.Z)(this,"pointerMove",(()=>null)),(0,$.Z)(this,"pointerUp",(()=>null)),(0,$.Z)(this,"cleanUp",(()=>{document.documentElement.style.cursor="default"}))}},UT=(0,G.Z)(ZT.prototype,"projectUIState",[kT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MT=ZT));var LT,_T,RT,BT,HT,zT,$T,GT,VT;class JT{constructor(e,t){(0,$.Z)(this,"interactiveElementId",void 0),(0,$.Z)(this,"interactiveElementCode",void 0),(0,$.Z)(this,"isNew",!0),this.interactiveElementId=e,this.interactiveElementCode=t}get elementId(){return this.interactiveElementId}get elementCode(){return this.interactiveElementCode}get representation(){return(0,WD.H)(Ol.YN[`thq-${this.interactiveElementId}`],(0,mt.kC)(this.interactiveElementId))}}LT=(0,J.JJ)("dragInteractiveElementFlow"),_T=(0,J.f3)("projectDoc"),RT=(0,J.f3)("nodeManagementFlow"),BT=(0,J.f3)("nodeSelectionFlow"),LT((zT=class{constructor(){(0,z.Z)(this,"projectDoc",$T,this),(0,z.Z)(this,"nodeManagementFlow",GT,this),(0,z.Z)(this,"nodeSelectionFlow",VT,this),(0,$.Z)(this,"draggedInteractiveElement",null),(0,$.Z)(this,"acceptDOMElement",(e=>e instanceof HTMLElement?this.draggedInteractiveElement=(e=>{if(!e||!Object.keys(e.dataset).length)return null;const t=e.dataset.dragInteractiveElementId,o=e.dataset.dragInteractiveElementCode?JSON.parse(e.dataset.dragInteractiveElementCode):void 0;if(!t)return null;const n=new JT(t,o);return{type:Fs.Z.INTERACTIVE_ELEMENT,content:n,representation:n.representation}})(e):null)),(0,$.Z)(this,"pointerSelect",(()=>null)),(0,$.Z)(this,"pointerDown",(()=>null)),(0,$.Z)(this,"pointerMove",(()=>null)),(0,$.Z)(this,"pointerUp",(()=>null)),(0,$.Z)(this,"cleanUp",(()=>null))}},$T=(0,G.Z)(zT.prototype,"projectDoc",[_T],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GT=(0,G.Z)(zT.prototype,"nodeManagementFlow",[RT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VT=(0,G.Z)(zT.prototype,"nodeSelectionFlow",[BT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HT=zT));var WT,KT,YT,XT,qT,QT,eN,tN,oN,nN,iN,rN,sN,aN=o(99628);const lN=[Fs.Z.SUB_HIERARCHY,Fs.Z.SECTION_TEMPLATE,Fs.Z.INTERACTIVE_ELEMENT];WT=(0,J.JJ)("dropIntoTreeViewFlow"),KT=(0,J.f3)("projectDoc"),YT=(0,J.f3)("projectUIState"),XT=(0,J.f3)("nodeManagementFlow"),qT=(0,J.f3)("nodeStyleManagmentFlow"),QT=(0,J.f3)("componentManagementFlow"),WT((tN=class{constructor(){(0,z.Z)(this,"projectDoc",oN,this),(0,z.Z)(this,"projectUIState",nN,this),(0,z.Z)(this,"nodeManagementFlow",iN,this),(0,z.Z)(this,"nodeStyleManagementFlow",rN,this),(0,z.Z)(this,"componentManagementFlow",sN,this),(0,$.Z)(this,"moveOver",QF()((e=>{const{draggedEntity:t,ev:o,position:n}=e;return this.handleMouseOverTreeView(t,o,n)}),ts.x1.HUNDRED_FORTY_FOUR)),this.resetState()}resetState(){(0,V.JG)(this.projectUIState,(e=>{e.dropFlowStates.treeView.acceptedDropTarget=null,e.dropFlowStates.treeView.dropAnchor=null,e.dropFlowStates.treeView.dropAllowed=!0}))}handleDraggedEntity(e){return lN.includes(e.type)}acceptsDOMElement(e){var t;if(!(e instanceof HTMLElement))return!1;let o=e;const n=e.closest("[data-tree-view=true]"),i=this.projectUIState.selection.componentId;if(!n||!i)return!1;const r=null===(t=this.projectUIState.dropFlowStates.treeView.acceptedDropTarget)||void 0===t?void 0:t.uidlNode;let s;if(e.dataset.nodeId)s=this.projectDoc.nodes.byId[e.dataset.nodeId];else{const e=this.projectDoc.getRootNodeIdForPageOrComponent(i);e&&(s=this.projectDoc.nodes.byId[e],o=n.querySelector(`[data-node-id="${e}"]`))}if(!s||!o)return!1;let a=null;return r&&r.id!==s.id&&r.parentOrSlotId===s.parentOrSlotId&&(a=parseFloat(r.pos)>parseFloat(s.pos)?"before":"after"),(0,V.JG)(this.projectUIState,(e=>{e.dropFlowStates.treeView.acceptedDropTarget={domNode:o,uidlNode:s},a&&(e.dropFlowStates.treeView.dropAnchor=a)})),!0}handleMouseOverTreeView(e,t,o){var n;const i=this.projectUIState.dropFlowStates.treeView.acceptedDropTarget;if(!i)return;const r=this.projectUIState.selection.componentId;if(!r)return;const s=this.projectDoc.getProjectPageOrComponent(r);if((null===s||void 0===s?void 0:s.rootNodeId)===i.uidlNode.id)return void(0,V.JG)(this.projectUIState,(e=>{e.dropFlowStates.treeView.dropAnchor="inside-after",e.dropFlowStates.treeView.dropAllowed=!0}));if(e.type!==Fs.Z.SUB_HIERARCHY)return;const{domNode:a,uidlNode:l}=i,c=this.projectDoc.nodes.byId[l.parentId||""],d=a.getBoundingClientRect();let p="after";a.dataset.fakeTreeviewElem||(p=(0,WD.S3)(o,d));const u=a.dataset.compInstanceId;(null===(n=this.projectUIState.selection.expandedTreeNodes[u||""])||void 0===n?void 0:n[l.id])&&"after"===p&&!a.dataset.fakeTreeviewElem&&(p="inside-after");for(const g of e.content.subHierarchy){var h;const e=this.nodeHasButtonParent(l);var m;if(e&&g.primitiveType&&!this.projectDoc.isNodeAcceptingChild(e,g))return p=-1!==(null===(m=p)||void 0===m?void 0:m.indexOf("after"))?"after":"before",void(0,V.JG)(this.projectUIState,(e=>{e.dropFlowStates.treeView.dropAnchor=p,e.dropFlowStates.treeView.dropAllowed=!1}));const t=-1!==(null===(h=p)||void 0===h?void 0:h.indexOf("inside"))?l:c;if(g.primitiveType&&(!this.projectDoc.isNodeAcceptingChildByElementType(t,g.primitiveType)||l.primitiveType===dt.sO.SLOT&&!a.dataset.compInstanceId))return void(0,V.JG)(this.projectUIState,(e=>{var t;if(c&&g.primitiveType){if(-1!==(null===(t=p)||void 0===t?void 0:t.indexOf("inside"))){var o;const t=this.projectDoc.isNodeAcceptingChildren(l);return p=t?p:-1!==(null===(o=p)||void 0===o?void 0:o.indexOf("after"))?"after":"before",e.dropFlowStates.treeView.dropAllowed=!t&&this.projectDoc.isNodeAcceptingChildByElementType(c,g.primitiveType),void(e.dropFlowStates.treeView.dropAnchor=p)}e.dropFlowStates.treeView.dropAnchor=p,e.dropFlowStates.treeView.dropAllowed=this.projectDoc.isNodeAcceptingChildByElementType(c,g.primitiveType)}else e.dropFlowStates.treeView.dropAllowed=!1}))}(0,V.JG)(this.projectUIState,(e=>{e.dropFlowStates.treeView.dropAnchor=p,e.dropFlowStates.treeView.dropAllowed=!0}))}moveOut(){this.resetState()}handleDrop(e){const t=this.projectUIState.selection.componentId,{dropAnchor:o,acceptedDropTarget:n,dropAllowed:i}=this.projectUIState.dropFlowStates.treeView;if(!n||!o||!t||!i)return!1;const{doc:r}=e;if(!r)return!1;const s=e.draggedEntity;if(!this.projectDoc.getProjectPageOrComponent(t))throw new Error(`Attempted to insert new component instance into a component\n          that does not exist or is not active ${t}`);if(s.type===Fs.Z.SUB_HIERARCHY){var a;const e=null===(a=this.projectUIState.dropFlowStates.treeView.acceptedDropTarget)||void 0===a?void 0:a.uidlNode,t=this.nodeHasButtonParent(e);for(const o of s.content.subHierarchy)if(t&&o.primitiveType&&!r.isNodeAcceptingChild(t,o))return!1;-1===o.indexOf("inside")||(null===e||void 0===e?void 0:e.primitiveType)!==dt.sO.BUTTON||Object.keys(e.childrenIds).length||this.nodeStyleManagementFlow.setMultipleStylesByKeyForCurrentBreakpoint({nodeIds:[e.id],styleMap:{[pt.X7.DISPLAY]:{value:pt.r3.FLEX},[pt.X7.FLEX_DIRECTION]:{value:aN.aF.ROW}},doc:r})}return-1!==o.indexOf("inside")?this.handleDropInside({draggedEntity:s,doc:r}):this.handleDropAsSibling({position:o,draggedEntity:s,doc:r}),this.resetState(),!0}handleDropAsSibling(e){var t;const{draggedEntity:o,position:n,doc:i}=e,r=this.projectUIState.dropFlowStates.treeView.acceptedDropTarget,s=null===r||void 0===r||null===(t=r.uidlNode)||void 0===t?void 0:t.parentOrSlotId;if(!r||!s)return;const a=(0,rd.MT)({element:r.domNode}),l=null===a||void 0===a?void 0:a.compInstanceId;let c=r.uidlNode;if(-1!==n.indexOf("after")&&(c=this.projectDoc.nodes.getNextSibling(r.uidlNode)),o.type===Fs.Z.INTERACTIVE_ELEMENT)return void this.handleDropSectionTemplate({nextNode:c,sectionId:o.content.elementId,customCodeSnippet:o.content.elementCode,targetId:s,compInstanceId:l,doc:i});if(o.type===Fs.Z.SECTION_TEMPLATE)return void this.handleDropSectionTemplate({nextNode:c,sectionId:o.content.sectionId,customCodeSnippet:o.content.customCodeSnippet,targetId:s,compInstanceId:l,doc:i});const{content:d}=o;d.isNew?this.handleDropNewInstances({draggedContent:d,parentId:s,nextNode:c,compInstanceId:l,doc:i}):this.handleDropExistingInstances({draggedContent:d,targetId:s,nextNode:c,compInstanceId:l,doc:i})}handleDropInside(e){const t=this.projectUIState.dropFlowStates.treeView.acceptedDropTarget;if(!t)return;const{draggedEntity:o,doc:n}=e;let i;if(t.domNode){const e=(0,rd.MT)({element:t.domNode});i=null===e||void 0===e?void 0:e.compInstanceId}if(o.type===Fs.Z.INTERACTIVE_ELEMENT)return void this.handleDropSectionTemplate({sectionId:o.content.elementId,customCodeSnippet:o.content.elementCode,targetId:t.uidlNode.id,compInstanceId:i,doc:n});if(o.type===Fs.Z.SECTION_TEMPLATE)return void this.handleDropSectionTemplate({sectionId:o.content.sectionId,customCodeSnippet:o.content.customCodeSnippet,targetId:t.uidlNode.id,compInstanceId:i,doc:n});const r=o.content;r.isNew?this.handleDropNewInstances({draggedContent:r,parentId:t.uidlNode.id,compInstanceId:i,doc:n}):this.handleDropExistingInstances({draggedContent:r,targetId:t.uidlNode.id,compInstanceId:i,doc:n})}handleDropSectionTemplate(e){const{sectionId:t,customCodeSnippet:o,targetId:n,nextNode:i,compInstanceId:r,doc:s}=e;this.componentManagementFlow.importSectionComponent({sectionId:t,customCodeSnippet:o,targetId:n,nextSibling:i,compInstanceId:r,doc:s})}targetIsChildlessButton(e){const t=this.projectDoc.nodes.byId[e];return(null===t||void 0===t?void 0:t.primitiveType)===dt.sO.BUTTON&&!Object.keys(t.childrenIds||{}).length}handleDropExistingInstances(e){const{draggedContent:t,targetId:o,nextNode:n,doc:i,compInstanceId:r}=e;this.nodeManagementFlow.moveNodesToTarget({nodes:t.subHierarchy,targetId:o,nextSibling:n,useContentAsNode:this.targetIsChildlessButton(o),targetCompInstanceId:r,doc:i})}handleDropNewInstances(e){var t;const{draggedContent:o,parentId:n,nextNode:i,doc:r,compInstanceId:s}=e,a={nodes:o.subHierarchy,nextSibling:i,keepOriginalParent:(null===(t=o.meta)||void 0===t?void 0:t.nodeType)===dt.sO.ICON,compInstanceId:s,parentId:n,doc:r};o.subHierarchy[0].primitiveType!==dt.sO.HTML_NODE?this.nodeManagementFlow.addNodesToParentOrStage(a):this.nodeManagementFlow.addEmbedNodeToSelNode(a)}nodeHasButtonParent(e){if(!e)return null;if(e.primitiveType===dt.sO.BUTTON)return null;let t=e,o=null,n=!1;for(;null!==(i=t)&&void 0!==i&&i.parentId&&!o&&!n;){var i;if(t.primitiveType!==dt.sO.BUTTON)if(t.primitiveType!==dt.sO.CONTAINER){if(t=this.projectDoc.nodes.byId[t.parentId],!t)return null}else n=!0;else o=t}return o}},oN=(0,G.Z)(tN.prototype,"projectDoc",[KT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nN=(0,G.Z)(tN.prototype,"projectUIState",[YT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iN=(0,G.Z)(tN.prototype,"nodeManagementFlow",[XT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rN=(0,G.Z)(tN.prototype,"nodeStyleManagementFlow",[qT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sN=(0,G.Z)(tN.prototype,"componentManagementFlow",[QT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(tN.prototype,"handleDrop",[Q.P],Object.getOwnPropertyDescriptor(tN.prototype,"handleDrop"),tN.prototype),(0,G.Z)(tN.prototype,"handleDropAsSibling",[Q.P],Object.getOwnPropertyDescriptor(tN.prototype,"handleDropAsSibling"),tN.prototype),(0,G.Z)(tN.prototype,"handleDropInside",[Q.P],Object.getOwnPropertyDescriptor(tN.prototype,"handleDropInside"),tN.prototype),(0,G.Z)(tN.prototype,"handleDropSectionTemplate",[Q.P],Object.getOwnPropertyDescriptor(tN.prototype,"handleDropSectionTemplate"),tN.prototype),(0,G.Z)(tN.prototype,"handleDropExistingInstances",[Q.P],Object.getOwnPropertyDescriptor(tN.prototype,"handleDropExistingInstances"),tN.prototype),(0,G.Z)(tN.prototype,"handleDropNewInstances",[Q.P],Object.getOwnPropertyDescriptor(tN.prototype,"handleDropNewInstances"),tN.prototype),eN=tN));var cN,dN,pN,uN,hN,mN,gN,yN,fN,bN,wN,vN,IN,SN,jN,DN,ON,FN,TN;function NN(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function EN(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?NN(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):NN(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}const CN=["flex","block","inline","inline-block","inherit"];let xN=(cN=(0,J.f3)("projectDoc"),dN=(0,J.f3)("projectUIState"),pN=(0,J.f3)("dropElementHelper"),uN=(0,J.f3)("notificationsManagementFlow"),hN=(0,J.f3)("guardsService"),mN=(0,J.f3)("componentManagementFlow"),gN=(0,J.f3)("dropSimulatorFlow"),yN=(0,J.f3)("nodeStyleManagmentFlow"),fN=(0,J.f3)("nodeManagementFlow"),bN=class{constructor(){(0,z.Z)(this,"projectDoc",wN,this),(0,z.Z)(this,"projectUIState",vN,this),(0,z.Z)(this,"dropElementHelper",IN,this),(0,z.Z)(this,"notificationsManagementFlow",SN,this),(0,z.Z)(this,"guardsService",jN,this),(0,z.Z)(this,"componentManagementFlow",DN,this),(0,z.Z)(this,"dropSimulatorFlow",ON,this),(0,z.Z)(this,"nodeStyleManagementFlow",FN,this),(0,z.Z)(this,"nodeManagementFlow",TN,this),(0,$.Z)(this,"lastHoveredNode",null),(0,$.Z)(this,"acceptingDropTarget",null),(0,$.Z)(this,"elementChildrenOfCurrentTarget",[]),(0,$.Z)(this,"lastAltState",!1),(0,$.Z)(this,"lastCtrlState",!1),(0,$.Z)(this,"timeout",null),(0,$.Z)(this,"lastMovedAt",null),(0,$.Z)(this,"handleMouseOverContainerWithChildren",(e=>{var t;const{stateAccessor:o,target:n,position:i,draggedEntity:r}=e;if(!this.acceptingDropTarget)return;const{domNode:s,uidlNode:a}=this.acceptingDropTarget,l=s.getBoundingClientRect(),c=this.elementChildrenOfCurrentTarget.map((e=>e.getBoundingClientRect())),d=this.elementChildrenOfCurrentTarget.map((e=>(0,mt.AO)(e))),p=n.getBoundingClientRect(),u=this.projectUIState.stage.webComp.controlValues.scale;let h;if("flexContainer"===o&&(h=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(a.id,["flexDirection"]).flexDirection||"row"),"slot"===o){const e=this.projectDoc.nodes.byId[a.parentId||""];e&&this.nodeStyleManagementFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:e.id,key:pt.X7.DISPLAY,values:["flex","inline-flex"]})&&(h=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(e.id,["flexDirection"]).flexDirection||"row")}const{targetPointIdx:m,edgeData:g}=(0,WD.jV)(i,c,d,p,u,h);if(-1===m)return;if(!g.inside){const e=(0,WD.$p)(i,l,p,u);if(e&&a.primitiveType!==dt.sO.SLOT)return void this.dropElementHelper.handleMouseCloseToTargetEdge(e,o,this.acceptingDropTarget)}const y=this.projectUIState.dropFlowStates[o],f=y.childAnchoringDrop,b=this.elementChildrenOfCurrentTarget[m],{compInstanceId:w,nodeId:v,slotId:I}=b.dataset,S=I?this.projectDoc.nodes.byId[v||""]:this.projectDoc.nodes.byId[w||v||""];if(S){if("flexContainer"===o){const e=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(this.acceptingDropTarget.uidlNode.id,["flexDirection"]);if("column"!==e.flexDirection&&(g.inside||g.distance.vertical>75)){const{left:e,right:t}=g.distance;g.edge=e<t?"left":"right"}if("column"===e.flexDirection&&(g.inside||g.distance.horizontal>75)){const{top:e,bottom:t}=g.distance;g.edge=e<t?"top":"bottom"}}(null===(t=y.acceptedDropTarget)||void 0===t?void 0:t.uidlNode.id)===this.acceptingDropTarget.uidlNode.id&&(null===f||void 0===f?void 0:f.domNode)===b&&f.edgeData.edge===g.edge&&f.edgeData.inside===g.inside&&f.uidlNode.id===S.id&&null===y.dropPosition&&null===y.dropOutsideTarget||(0,V.JG)(this.projectUIState,(e=>{var t;e.dropFlowStates[o].acceptedDropTarget=this.acceptingDropTarget,e.dropFlowStates[o].newWrapperFlexDirection=this.dropElementHelper.getNewWrapperFlexDirection(o,g,null===(t=this.acceptingDropTarget)||void 0===t?void 0:t.uidlNode,S,r),e.dropFlowStates[o].childAnchoringDrop={domNode:b,uidlNode:S,edgeData:g},e.dropFlowStates[o].dropPosition=null,e.dropFlowStates[o].dropOutsideTarget=null}))}})),(0,$.Z)(this,"handleMouseOverChildlessContainer",(e=>{var t;const{stateAccessor:o,position:n,target:i}=e;if(!this.acceptingDropTarget)return;const{domNode:r,uidlNode:s}=this.acceptingDropTarget;if(!r)return;const a=i.getBoundingClientRect(),l=r.getBoundingClientRect(),c=(0,mt.AO)(r),d=this.projectUIState.stage.webComp.controlValues.scale*c,p=(0,WD.$p)(n,l,a,d);if(p&&s.primitiveType!==dt.sO.SLOT)return void this.dropElementHelper.handleMouseCloseToTargetEdge(p,o,this.acceptingDropTarget);let u=null;if("flexContainer"===o){const e=this.projectUIState.drag.draggedEntity;let t=0,o=0;var h,m;if((null===e||void 0===e?void 0:e.type)===Fs.Z.SUB_HIERARCHY&&!e.content.isNew)t=null===(h=e.content.meta)||void 0===h?void 0:h.width,o=null===(m=e.content.meta)||void 0===m?void 0:m.height;u=(0,WD.y9)(n,l,a,d,t,o)}const g=this.projectUIState.dropFlowStates[o];(null===(t=g.acceptedDropTarget)||void 0===t?void 0:t.uidlNode.id)===this.acceptingDropTarget.uidlNode.id&&g.dropPosition===u&&null===g.childAnchoringDrop&&null===g.dropOutsideTarget||(0,V.JG)(this.projectUIState,(e=>{e.dropFlowStates[o].acceptedDropTarget=this.acceptingDropTarget,e.dropFlowStates[o].dropPosition=u||"top-left",e.dropFlowStates[o].newWrapperFlexDirection=null,e.dropFlowStates[o].childAnchoringDrop=null,e.dropFlowStates[o].dropOutsideTarget=null}))}))}resetUIStateState(e){this.guardsService.getGuard(to._.VIRTUAL_WORK)||(this.timeout&&clearTimeout(this.timeout),(0,V.JG)(this.projectUIState,(t=>{t.dropFlowStates[e].acceptedDropTarget=null,t.dropFlowStates[e].childAnchoringDrop=null,t.dropFlowStates[e].newWrapperFlexDirection=null,t.dropFlowStates[e].dropPosition=null,t.dropFlowStates[e].dropOutsideTarget=null,t.dropFlowStates[e].dropIsDisabled=!1})),this.lastHoveredNode=null,this.elementChildrenOfCurrentTarget=[],this.lastAltState=!1,this.lastCtrlState=!1,this.lastMovedAt=null)}handleDraggedEntity(e){return e.type===Fs.Z.SUB_HIERARCHY||e.type===Fs.Z.SECTION_TEMPLATE||e.type===Fs.Z.INTERACTIVE_ELEMENT}checkIfElementIsAccepted(e,t,o,n,i){var r;if(!i||!((null===i||void 0===i?void 0:i.target)instanceof HTMLIFrameElement))return this.acceptingDropTarget=null,!1;if(!(e instanceof HTMLElement))return this.acceptingDropTarget=null,!1;const s=e.dataset.slotId?e.dataset.nodeId:e.dataset.compInstanceId||e.dataset.nodeId;if(!s)return this.acceptingDropTarget=null,!1;const a=!!this.projectUIState.userInteractions.pressedKeys.ctrl;if((null===(r=this.acceptingDropTarget)||void 0===r?void 0:r.uidlNode.id)===s&&this.lastCtrlState===a)return this.acceptingDropTarget={domNode:e,uidlNode:this.acceptingDropTarget.uidlNode},!0;this.lastCtrlState=a;const l=this.projectDoc.nodes.byId[s];if(!l)return this.acceptingDropTarget=null,!1;if(!a&&null!==l&&void 0!==l&&l.parentOrSlotId&&this.dropElementHelper.elementSmallerOrSibling(e,s))return this.acceptingDropTarget=null,!1;return this.nodeDataAcceptedForContainer(l,e,t,a)?(this.acceptingDropTarget={domNode:e,uidlNode:l},!0):(this.acceptingDropTarget=null,!1)}nodeIsContainerType(e){return e.primitiveType===dt.sO.CONTAINER||e.primitiveType===dt.sO.FORM||Object.values(dt.IV).includes(e.primitiveType)}nodeDataAcceptedForContainer(e,t,o,n){if(e.primitiveType===dt.sO.SLOT&&!t.dataset.compInstanceId)return!1;const i=this.projectUIState.drag.draggedEntity;let r=!0;switch((null===i||void 0===i?void 0:i.type)===Fs.Z.SUB_HIERARCHY&&(r=i.content.subHierarchy.every((t=>e.primitiveType===dt.sO.IMAGE?this.projectDoc.isNodeAcceptingChild(EN(EN({},e),{},{primitiveType:dt.sO.CONTAINER}),t):this.projectDoc.isNodeAcceptingChild(e,t)))),o){case"flexContainer":const t=this.projectDoc.nodes.byId[e.parentId||""];return r&&(e.primitiveType===dt.sO.IMAGE&&n&&(null===t||void 0===t?void 0:t.primitiveType)!==dt.sO.BUTTON||this.nodeIsContainerType(e)&&this.nodeStyleManagementFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:e.id,key:pt.X7.DISPLAY,values:["flex","inline-flex"]}));case"blockInlineContainer":return this.nodeIsContainerType(e)&&r&&this.nodeStyleManagementFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:e.id,key:pt.X7.DISPLAY,values:["block","inline-block","inline"]});case"unknownContainer":return!((null===e||void 0===e?void 0:e.primitiveType)===dt.sO.LISTITEM&&!this.projectUIState.userInteractions.pressedKeys.ctrl)&&((this.nodeIsContainerType(e)||(null===e||void 0===e?void 0:e.primitiveType)===dt.sO.LISTITEM)&&r&&!this.nodeStyleManagementFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:e.id,key:pt.X7.DISPLAY,values:CN}));case"slot":return(null===e||void 0===e?void 0:e.primitiveType)===dt.sO.SLOT&&r;default:return!1}}handleDropIntoContainer(e){const{draggedEntity:t,dropIntoChildlessContainerCallback:o,dropIntoContainerWithChildrenCallback:n,stateAccessor:i,isVirtual:r,doc:s}=e,{dropPosition:a,acceptedDropTarget:l,dropOutsideTarget:c,childAnchoringDrop:d,dropIsDisabled:p}=this.projectUIState.dropFlowStates[i],u=this.projectUIState.selection.componentId;if(!l||!u||p)return!1;if(t.type!==Fs.Z.SUB_HIERARCHY&&t.type!==Fs.Z.SECTION_TEMPLATE&&t.type!==Fs.Z.INTERACTIVE_ELEMENT)return!1;return!this.dropElementHelper.checkForCircularDependencies(t,u)&&(a&&!c?o({draggedEntity:t,isVirtual:r,doc:s}):!!d&&n({draggedEntity:t,isVirtual:r,doc:s}))}handleMoveOut(e){this.timeout&&clearTimeout(this.timeout),this.resetUIStateState(e)}handleMoveOver(e){const t=this.projectUIState.drag.currentMousePosition,o=this.projectUIState.stage.webComp.controlValues.scale;this.lastMovedAt&&t&&!(0,WD.NN)(this.lastMovedAt,t,10/o)&&!e.forced||(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.moveOverHandler(e)),ts.vL))}moveOverHandler(e){var t;this.timeout=null,this.lastMovedAt=this.projectUIState.drag.currentMousePosition;const{draggedEntity:o,stateAccessor:n,customEv:i,position:r}=e;if(!this.acceptingDropTarget||!i||!(i.target instanceof HTMLIFrameElement))return;const{domNode:s,uidlNode:a}=this.acceptingDropTarget,{pressedKeys:l}=this.projectUIState.userInteractions;if(s){if((null===(t=this.lastHoveredNode)||void 0===t?void 0:t.id)!==a.id||this.lastAltState!==l.alt){const e=o.type===Fs.Z.SUB_HIERARCHY?o.content.subHierarchy:[];this.elementChildrenOfCurrentTarget=this.dropElementHelper.processElementChildren(s.children,e),this.lastHoveredNode=a,this.lastAltState=l.alt||!1,(0,V.JG)(this.projectUIState,(e=>e.dropFlowStates[n].dropIsDisabled=!1))}if(!l.alt&&o.type===Fs.Z.SUB_HIERARCHY)for(const e of o.content.subHierarchy)if(e.id===a.id||this.projectDoc.nodes.getDescendents(e.id).find((e=>e.id===a.id)))return void(0,V.JG)(this.projectUIState,(e=>{e.dropFlowStates[n].dropIsDisabled=!0}));return this.elementChildrenOfCurrentTarget.length?this.handleMouseOverContainerWithChildren({position:r,target:i.target,stateAccessor:n,draggedEntity:o}):this.handleMouseOverChildlessContainer({position:r,target:i.target,stateAccessor:n,draggedEntity:o})}}},wN=(0,G.Z)(bN.prototype,"projectDoc",[cN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vN=(0,G.Z)(bN.prototype,"projectUIState",[dN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IN=(0,G.Z)(bN.prototype,"dropElementHelper",[pN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SN=(0,G.Z)(bN.prototype,"notificationsManagementFlow",[uN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jN=(0,G.Z)(bN.prototype,"guardsService",[hN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DN=(0,G.Z)(bN.prototype,"componentManagementFlow",[mN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ON=(0,G.Z)(bN.prototype,"dropSimulatorFlow",[gN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FN=(0,G.Z)(bN.prototype,"nodeStyleManagementFlow",[yN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TN=(0,G.Z)(bN.prototype,"nodeManagementFlow",[fN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(bN.prototype,"handleDropIntoContainer",[Q.P],Object.getOwnPropertyDescriptor(bN.prototype,"handleDropIntoContainer"),bN.prototype),bN);var PN,kN,MN,ZN,UN;function AN(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function LN(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?AN(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):AN(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}PN=(0,J.JJ)("dropIntoFlexContainerFlow"),kN=(0,J.f3)("imageTransformationFlow"),PN((ZN=class extends xN{constructor(){super(),(0,z.Z)(this,"imageTransformationFlow",UN,this),this.resetState(),this.handleDropIntoChildlessNode=this.handleDropIntoChildlessNode.bind(this),this.handleDropBetweenSiblings=this.handleDropBetweenSiblings.bind(this)}resetState(){super.resetUIStateState("flexContainer")}handleDraggedEntity(e){return super.handleDraggedEntity(e)}acceptsDOMElement(e,t,o,n){return super.checkIfElementIsAccepted(e,"flexContainer",t,o,n)}moveOver(e){super.handleMoveOver(LN(LN({},e),{},{stateAccessor:"flexContainer"}))}moveOut(){super.handleMoveOut("flexContainer")}handleDrop(e){return super.handleDropIntoContainer(LN({dropIntoChildlessContainerCallback:this.handleDropIntoChildlessNode,dropIntoContainerWithChildrenCallback:this.handleDropBetweenSiblings,stateAccessor:"flexContainer"},e))}handleDropIntoChildlessNode(e){const{acceptedDropTarget:t}=this.projectUIState.dropFlowStates.flexContainer;if(!t)return!1;const{draggedEntity:o,doc:n,isVirtual:i}=e;if(!n||!o||i)return!1;const r=this.projectUIState.selection.componentId;if(!r)return this.resetState(),!1;if(!(n.pages.byId[r]||n.components.byId[r]))throw new Error("Could not execute flex container drop when active componet is not available");const{uidlNode:s}=t;return s.primitiveType===dt.sO.IMAGE?this.handleDropIntoEmptyContainer({draggedEntity:o,doc:n,droppingInImage:!0}):this.handleDropIntoEmptyContainer({draggedEntity:o,doc:n}),this.resetState(),!0}handleDropIntoEmptyContainer(e){const{acceptedDropTarget:t,dropPosition:o}=this.projectUIState.dropFlowStates.flexContainer;if(!t)throw new Error("Could not execute flex container drop with no targets");const{draggedEntity:n,doc:i,droppingInImage:r}=e;if(!i)return;const{uidlNode:s,domNode:a}=t,{pressedKeys:l}=this.projectUIState.userInteractions,c=s.id,d=i.nodes.byId[c];if(r&&this.imageTransformationFlow.turnImageIntoContainer({nodeId:c,width:a.getBoundingClientRect().width,height:a.getBoundingClientRect().height,doc:i}),d.styles=this.getUpdatedNodeStyleBasedOnDropPosition(d.styles),n.type===Fs.Z.INTERACTIVE_ELEMENT)return this.componentManagementFlow.importSectionComponent({sectionId:n.content.elementId,customCodeSnippet:n.content.elementCode,targetId:c,doc:i}),!0;if(n.type===Fs.Z.SECTION_TEMPLATE)return this.componentManagementFlow.importSectionComponent({sectionId:n.content.sectionId,customCodeSnippet:n.content.customCodeSnippet,targetId:c,doc:i}),!0;const p=n.content;if(p.isNew){var u;const e={nodes:p.subHierarchy,parentId:c,dropPosition:o,keepOriginalParent:(null===(u=p.meta)||void 0===u?void 0:u.nodeType)===dt.sO.ICON,doc:i};if(p.subHierarchy[0].primitiveType===dt.sO.HTML_NODE)return this.nodeManagementFlow.addEmbedNodeToSelNode(e),!0;this.nodeManagementFlow.addNodesToParentOrStage(e)}else l.alt?this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:p.subHierarchy,targetId:c,doc:i}):this.nodeManagementFlow.moveNodesToTarget({nodes:p.subHierarchy,targetId:c,dropPosition:o,removeMargins:!0,doc:i});r&&this.notificationsManagementFlow.createLimitedUseNotification(K.C.IMAGE_TRANSFORMATION)}getUpdatedNodeStyleBasedOnDropPosition(e){var t,o;const{dropPosition:n}=this.projectUIState.dropFlowStates.flexContainer,i="row"===(null===(t=e[pt.X7.FLEX_DIRECTION])||void 0===t?void 0:t.content)||!(null!==(o=e[pt.X7.FLEX_DIRECTION])&&void 0!==o&&o.content);switch(n){case"top-left":return LN(LN({},e),{},{alignItems:new ar.F({content:"flex-start"}),justifyContent:new ar.F({content:"flex-start"})});case"top-right":return LN(LN({},e),{},{alignItems:i?new ar.F({content:"flex-start"}):new ar.F({content:"flex-end"}),justifyContent:i?new ar.F({content:"flex-end"}):new ar.F({content:"flex-start"})});case"bottom-right":return LN(LN({},e),{},{alignItems:new ar.F({content:"flex-end"}),justifyContent:new ar.F({content:"flex-end"})});case"bottom-left":return LN(LN({},e),{},{alignItems:i?new ar.F({content:"flex-end"}):new ar.F({content:"flex-start"}),justifyContent:i?new ar.F({content:"flex-start"}):new ar.F({content:"flex-end"})});case"center":return LN(LN({},e),{},{alignItems:new ar.F({content:"center"}),justifyContent:new ar.F({content:"center"})});case"left-middle":return LN(LN({},e),{},{alignItems:i?new ar.F({content:"center"}):new ar.F({content:"flex-start"}),justifyContent:i?new ar.F({content:"flex-start"}):new ar.F({content:"center"})});case"right-middle":return LN(LN({},e),{},{alignItems:i?new ar.F({content:"center"}):new ar.F({content:"flex-end"}),justifyContent:i?new ar.F({content:"flex-end"}):new ar.F({content:"center"})});case"top-middle":return LN(LN({},e),{},{alignItems:i?new ar.F({content:"flex-start"}):new ar.F({content:"center"}),justifyContent:i?new ar.F({content:"center"}):new ar.F({content:"flex-start"})});case"bottom-middle":return LN(LN({},e),{},{alignItems:i?new ar.F({content:"flex-end"}):new ar.F({content:"center"}),justifyContent:i?new ar.F({content:"center"}):new ar.F({content:"flex-end"})});default:return LN(LN({},e),{},{alignItems:new ar.F({content:"flex-start"}),justifyContent:new ar.F({content:"flex-start"})})}}handleDropBetweenSiblings(e){const{acceptedDropTarget:t,childAnchoringDrop:o,dropOutsideTarget:n,newWrapperFlexDirection:i}=this.projectUIState.dropFlowStates.flexContainer;if(!t||!o)return!1;const{draggedEntity:r,doc:s,isVirtual:a}=e;if(!s)return!1;const{pressedKeys:l}=this.projectUIState.userInteractions;let c=t.uidlNode;n&&(c=n.uidlNode);const{edgeData:d,uidlNode:p}=o;if(i&&"parent"!==i&&a)return!1;const u=-1!==["left","top"].indexOf(d.edge)?p:s.nodes.getNextSibling(p);if(i)return"parent"===i?(this.handleDropWithParentFlexDirectionChange({draggedEntity:r,dropOutsideTarget:n,nextSibling:u,doc:s}),!0):this.handleDropWithWrapperCreation({draggedEntity:r,dropOutsideTarget:n,doc:s});if(r.type===Fs.Z.INTERACTIVE_ELEMENT)return this.componentManagementFlow.importSectionComponent({sectionId:r.content.elementId,customCodeSnippet:r.content.elementCode,targetId:c.id,nextSibling:u,doc:s}),!0;if(r.type===Fs.Z.SECTION_TEMPLATE)return this.componentManagementFlow.importSectionComponent({sectionId:r.content.sectionId,customCodeSnippet:r.content.customCodeSnippet,targetId:c.id,nextSibling:u,doc:s}),!0;const h=r.content;if(h.isNew){var m;const e={nodes:h.subHierarchy,parentId:c.id,nextSibling:u,keepOriginalParent:(null===(m=h.meta)||void 0===m?void 0:m.nodeType)===dt.sO.ICON,doc:s};h.subHierarchy[0].primitiveType===dt.sO.HTML_NODE?this.nodeManagementFlow.addEmbedNodeToSelNode(e):this.nodeManagementFlow.addNodesToParentOrStage(e)}else l.alt?this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:h.subHierarchy,targetId:c.id,copyBefore:u,doc:s}):this.nodeManagementFlow.moveNodesToTarget({nodes:h.subHierarchy,targetId:c.id,nextSibling:u,removeMargins:!0,doc:s});return this.resetState(),!0}handleDropWithParentFlexDirectionChange(e){const{draggedEntity:t,dropOutsideTarget:o,nextSibling:n,doc:i}=e,{acceptedDropTarget:r,childAnchoringDrop:s}=this.projectUIState.dropFlowStates.flexContainer;if(!r||!s||!i)return;let{uidlNode:a}=r;o&&(a=o.uidlNode);const l=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(a.id,["flexDirection","alignItems","justifyContent"]),{uidlNode:c,edgeData:d}=s,p=-1!==["left","top"].indexOf(d.edge)?"before":"after",u=["left","right"].includes(s.edgeData.edge);if(l.flexDirection===Ol.sO.COLUMN&&u||l.flexDirection!==Ol.sO.COLUMN&&!u){const e=l.flexDirection===Ol.sO.COLUMN?Ol.sO.ROW:Ol.sO.COLUMN,t=l.alignItems,o=l.justifyContent||"flex-start",n=["flex-end","flex-start","center"],r={flexDirection:{value:e}};this.nodeStyleManagementFlow.removeMultipleStylesByKeyBasedOnCurrentBreakpoint({nodeIds:[a.id],keys:["justifyContent","alignItems"],doc:i}),"string"===typeof t&&-1!==n.indexOf(t)&&(r.justifyContent={value:t}),"string"===typeof o&&-1!==n.indexOf(o)&&(r.alignItems={value:o}),this.nodeStyleManagementFlow.setMultipleStylesByKeyForCurrentBreakpoint({nodeIds:[a.id],styleMap:r,doc:i})}const{pressedKeys:h}=this.projectUIState.userInteractions;if(t.type===Fs.Z.INTERACTIVE_ELEMENT)return void this.componentManagementFlow.importSectionComponent({sectionId:t.content.elementId,customCodeSnippet:t.content.elementCode,doc:i,targetId:a.id,nextSibling:n});if(t.type===Fs.Z.SECTION_TEMPLATE)return void this.componentManagementFlow.importSectionComponent({sectionId:t.content.sectionId,customCodeSnippet:t.content.customCodeSnippet,doc:i,targetId:a.id,nextSibling:n});const m=t.content;if(m.isNew){var g;const e={nodes:m.subHierarchy,parentId:a.id,nextSibling:"before"===p?c:null,keepOriginalParent:(null===(g=m.meta)||void 0===g?void 0:g.nodeType)===dt.sO.ICON,doc:i};if(m.subHierarchy[0].primitiveType===dt.sO.HTML_NODE)return void this.nodeManagementFlow.addEmbedNodeToSelNode(e);this.nodeManagementFlow.addNodesToParentOrStage(e)}else h.alt?this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:m.subHierarchy,targetId:a.id,copyBefore:n,doc:i}):this.nodeManagementFlow.moveNodesToTarget({nodes:m.subHierarchy,targetId:a.id,nextSibling:n,removeMargins:!0,doc:i})}handleDropWithWrapperCreation(e){var t;const{acceptedDropTarget:o,childAnchoringDrop:n}=this.projectUIState.dropFlowStates.flexContainer;if(!o||!n)return!1;const{draggedEntity:i,dropOutsideTarget:r,doc:s}=e;if(!s)return!1;let{uidlNode:a}=o;r&&(a=r.uidlNode);const{uidlNode:l,edgeData:c}=n,{pressedKeys:d}=this.projectUIState.userInteractions,p=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(a.id,["flexDirection"]).flexDirection===Ol.sO.COLUMN?Ol.sO.ROW:Ol.sO.COLUMN,u={};if(p===Ol.sO.ROW){let e=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(l.id,["height"]).height;e?(-1!==e.toString().indexOf("%")&&(e="100%"),u.height=e,u.width="auto"):(u.height="auto",u.width="auto");const t=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(a.id,["alignItems"]).alignItems;u.justifyContent=t}else{let e=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(l.id,["width"]).width;e?(-1!==e.toString().indexOf("%")&&(e="100%"),u.width=e,u.height="auto"):(u.width="auto",u.height="auto");const t=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(a.id,["justifyContent"]).justifyContent;u.alignItems=t}const h=(0,sO.a)({stencilKey:p,parentId:a.id,styles:u});h.fakeSize=!1;const m=s.nodes.getNextSibling(l),g=-1!==["left","top"].indexOf(c.edge)?"before":"after";if(this.nodeManagementFlow.addNodesToParentOrStage({nodes:[h],parentId:a.id,keepOriginalParent:(null===(t=i.content.meta)||void 0===t?void 0:t.nodeType)===dt.sO.ICON,nextSibling:m,doc:s}),i.type===Fs.Z.INTERACTIVE_ELEMENT)return this.nodeManagementFlow.moveNodesToTarget({nodes:[l],targetId:h.id,removeMargins:!0,doc:s}),this.componentManagementFlow.importSectionComponent({sectionId:i.content.elementId,customCodeSnippet:i.content.elementCode,doc:s,targetId:h.id,nextSibling:"before"===g?l:null}),!0;if(i.type===Fs.Z.SECTION_TEMPLATE)return this.nodeManagementFlow.moveNodesToTarget({nodes:[l],targetId:h.id,removeMargins:!0,doc:s}),this.componentManagementFlow.importSectionComponent({sectionId:i.content.sectionId,customCodeSnippet:i.content.customCodeSnippet,doc:s,targetId:h.id,nextSibling:"before"===g?l:null}),!0;const y=i.content;if(y.isNew){var f;this.nodeManagementFlow.moveNodesToTarget({nodes:[l],targetId:h.id,removeMargins:!0,doc:s});const e={nodes:y.subHierarchy,parentId:h.id,keepOriginalParent:(null===(f=y.meta)||void 0===f?void 0:f.nodeType)===dt.sO.ICON,nextSibling:"before"===g?l:null,doc:s};y.subHierarchy[0].primitiveType===dt.sO.HTML_NODE?this.nodeManagementFlow.addEmbedNodeToSelNode(e):this.nodeManagementFlow.addNodesToParentOrStage(e)}else this.nodeManagementFlow.moveNodesToTarget({nodes:[l],targetId:h.id,removeMargins:!0,doc:s}),d.alt?(this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:y.subHierarchy,targetId:h.id,copyBefore:"before"===g?l:null,doc:s}),y.subHierarchy.some((e=>e.id===l.id))&&this.nodeManagementFlow.moveNodesToTarget({nodes:y.subHierarchy,targetId:h.id,nextSibling:"before"===g?l:null,removeMargins:!0,doc:s})):this.nodeManagementFlow.moveNodesToTarget({nodes:y.subHierarchy,targetId:h.id,nextSibling:"before"===g?l:null,removeMargins:!0,doc:s});return this.resetState(),!0}},UN=(0,G.Z)(ZN.prototype,"imageTransformationFlow",[kN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(ZN.prototype,"handleDrop",[Q.P],Object.getOwnPropertyDescriptor(ZN.prototype,"handleDrop"),ZN.prototype),(0,G.Z)(ZN.prototype,"handleDropIntoChildlessNode",[Q.P],Object.getOwnPropertyDescriptor(ZN.prototype,"handleDropIntoChildlessNode"),ZN.prototype),(0,G.Z)(ZN.prototype,"handleDropIntoEmptyContainer",[Q.P],Object.getOwnPropertyDescriptor(ZN.prototype,"handleDropIntoEmptyContainer"),ZN.prototype),(0,G.Z)(ZN.prototype,"handleDropBetweenSiblings",[Q.P],Object.getOwnPropertyDescriptor(ZN.prototype,"handleDropBetweenSiblings"),ZN.prototype),(0,G.Z)(ZN.prototype,"handleDropWithParentFlexDirectionChange",[Q.P],Object.getOwnPropertyDescriptor(ZN.prototype,"handleDropWithParentFlexDirectionChange"),ZN.prototype),(0,G.Z)(ZN.prototype,"handleDropWithWrapperCreation",[Q.P],Object.getOwnPropertyDescriptor(ZN.prototype,"handleDropWithWrapperCreation"),ZN.prototype),MN=ZN));var _N,RN;function BN(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function HN(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?BN(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):BN(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}(0,J.JJ)("dropIntoUnknownContainerFlow")((RN=class extends xN{constructor(){super(),this.resetState(),this.handleDropBetweenSiblings=this.handleDropBetweenSiblings.bind(this),this.handleDropIntoEmptyContainer=this.handleDropIntoEmptyContainer.bind(this)}resetState(){super.resetUIStateState("unknownContainer")}handleDraggedEntity(e){return super.handleDraggedEntity(e)}acceptsDOMElement(e,t,o,n){return super.checkIfElementIsAccepted(e,"unknownContainer",t,o,n)}moveOver(e){super.handleMoveOver(HN(HN({},e),{},{stateAccessor:"unknownContainer"}))}moveOut(){super.handleMoveOut("unknownContainer")}handleDrop(e){return super.handleDropIntoContainer(HN({dropIntoChildlessContainerCallback:this.handleDropIntoEmptyContainer,dropIntoContainerWithChildrenCallback:this.handleDropBetweenSiblings,stateAccessor:"unknownContainer"},e))}handleDropIntoEmptyContainer(e){const t=this.projectUIState.dropFlowStates.unknownContainer.acceptedDropTarget;if(!t)throw new Error("Could not execute unknown container drop with no targets");const{draggedEntity:o,doc:n,isVirtual:i}=e;if(i)return!1;const{uidlNode:r}=t,{pressedKeys:s}=this.projectUIState.userInteractions,a=r.id;if(o.type===Fs.Z.INTERACTIVE_ELEMENT)return this.componentManagementFlow.importSectionComponent({sectionId:o.content.elementId,customCodeSnippet:o.content.elementCode,targetId:a,doc:n}),!0;if(o.type===Fs.Z.SECTION_TEMPLATE)return this.componentManagementFlow.importSectionComponent({sectionId:o.content.sectionId,customCodeSnippet:o.content.customCodeSnippet,targetId:a,doc:n}),!0;const l=o.content;if(l.isNew){var c;const e={nodes:l.subHierarchy,parentId:a,keepOriginalParent:(null===(c=l.meta)||void 0===c?void 0:c.nodeType)===dt.sO.ICON,doc:n};l.subHierarchy[0].primitiveType===dt.sO.HTML_NODE?this.nodeManagementFlow.addEmbedNodeToSelNode(e):this.nodeManagementFlow.addNodesToParentOrStage(e)}else s.alt?this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:l.subHierarchy,targetId:a,doc:n}):this.nodeManagementFlow.moveNodesToTarget({nodes:l.subHierarchy,targetId:a,doc:n});return this.resetState(),!0}handleDropBetweenSiblings(e){const{acceptedDropTarget:t,childAnchoringDrop:o,dropOutsideTarget:n}=this.projectUIState.dropFlowStates.unknownContainer;if(!t||!o)return!1;const{draggedEntity:i,doc:r}=e;if(!r)return!1;const{pressedKeys:s}=this.projectUIState.userInteractions;let a=t.uidlNode;n&&(a=n.uidlNode);const{uidlNode:l,edgeData:c}=o,d=a.id,p="top"===c.edge||"left"===c.edge?l:this.projectDoc.nodes.getNextSibling(l);if(i.type===Fs.Z.INTERACTIVE_ELEMENT)return this.componentManagementFlow.importSectionComponent({doc:r,sectionId:i.content.elementId,customCodeSnippet:i.content.elementCode,nextSibling:p}),!0;if(i.type===Fs.Z.SECTION_TEMPLATE)return this.componentManagementFlow.importSectionComponent({doc:r,sectionId:i.content.sectionId,customCodeSnippet:i.content.customCodeSnippet,nextSibling:p}),!0;const u=i.content;if(u.isNew){var h;const e={nodes:u.subHierarchy,keepOriginalParent:(null===(h=u.meta)||void 0===h?void 0:h.nodeType)===dt.sO.ICON,parentId:d,nextSibling:p,doc:r};u.subHierarchy[0].primitiveType===dt.sO.HTML_NODE?this.nodeManagementFlow.addEmbedNodeToSelNode(e):this.nodeManagementFlow.addNodesToParentOrStage(e)}else s.alt?this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:u.subHierarchy,targetId:d,copyBefore:p,doc:r}):this.nodeManagementFlow.moveNodesToTarget({nodes:u.subHierarchy,targetId:d,nextSibling:p,doc:r});return this.resetState(),!0}},(0,G.Z)(RN.prototype,"handleDrop",[Q.P],Object.getOwnPropertyDescriptor(RN.prototype,"handleDrop"),RN.prototype),(0,G.Z)(RN.prototype,"handleDropIntoEmptyContainer",[Q.P],Object.getOwnPropertyDescriptor(RN.prototype,"handleDropIntoEmptyContainer"),RN.prototype),(0,G.Z)(RN.prototype,"handleDropBetweenSiblings",[Q.P],Object.getOwnPropertyDescriptor(RN.prototype,"handleDropBetweenSiblings"),RN.prototype),_N=RN));var zN,$N;function GN(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function VN(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?GN(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):GN(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}(0,J.JJ)("dropIntoBlockInlineContainerFlow")(($N=class extends xN{constructor(){super(),this.resetState(),this.handleDropIntoEmptyContainer=this.handleDropIntoEmptyContainer.bind(this),this.handleDropBetweenSiblings=this.handleDropBetweenSiblings.bind(this)}resetState(){super.resetUIStateState("blockInlineContainer")}handleDraggedEntity(e){return super.handleDraggedEntity(e)}acceptsDOMElement(e,t,o,n){return super.checkIfElementIsAccepted(e,"blockInlineContainer",t,o,n)}moveOver(e){super.handleMoveOver(VN(VN({},e),{},{stateAccessor:"blockInlineContainer"}))}moveOut(){super.handleMoveOut("blockInlineContainer")}handleDrop(e){return super.handleDropIntoContainer(VN({dropIntoChildlessContainerCallback:this.handleDropIntoEmptyContainer,dropIntoContainerWithChildrenCallback:this.handleDropBetweenSiblings,stateAccessor:"blockInlineContainer"},e))}handleDropIntoEmptyContainer(e){const{draggedEntity:t,doc:o,isVirtual:n}=e;if(!o||n)return!1;const i=this.projectUIState.dropFlowStates.blockInlineContainer.acceptedDropTarget;if(!i)throw new Error("Could not execute container drop with no targets");const{uidlNode:r}=i,{pressedKeys:s}=this.projectUIState.userInteractions,a=r.id;if(t.type===Fs.Z.INTERACTIVE_ELEMENT)return this.componentManagementFlow.importSectionComponent({targetId:a,sectionId:t.content.elementId,customCodeSnippet:t.content.elementCode,doc:o}),!0;if(t.type===Fs.Z.SECTION_TEMPLATE)return this.componentManagementFlow.importSectionComponent({targetId:a,sectionId:t.content.sectionId,customCodeSnippet:t.content.customCodeSnippet,doc:o}),!0;const l=t.content;if(l.isNew){var c;const e={nodes:l.subHierarchy,parentId:a,keepOriginalParent:(null===(c=l.meta)||void 0===c?void 0:c.nodeType)===dt.sO.ICON,doc:o};l.subHierarchy[0].primitiveType===dt.sO.HTML_NODE?this.nodeManagementFlow.addEmbedNodeToSelNode(e):this.nodeManagementFlow.addNodesToParentOrStage(e)}else s.alt?this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:l.subHierarchy,targetId:a,doc:o}):this.nodeManagementFlow.moveNodesToTarget({nodes:l.subHierarchy,targetId:a,doc:o});return this.resetState(),!0}handleDropBetweenSiblings(e){const{draggedEntity:t,doc:o,isVirtual:n}=e,{acceptedDropTarget:i,childAnchoringDrop:r,dropOutsideTarget:s,newWrapperFlexDirection:a}=this.projectUIState.dropFlowStates.blockInlineContainer;if(!i||!r)return!1;const{pressedKeys:l}=this.projectUIState.userInteractions;let c=i.uidlNode;s&&(c=s.uidlNode);const{edgeData:d,uidlNode:p}=r;let u=p;if(-1!==["right","bottom"].indexOf(d.edge)&&(u=this.projectDoc.nodes.getNextSibling(p)),t.type===Fs.Z.INTERACTIVE_ELEMENT)return this.componentManagementFlow.importSectionComponent({sectionId:t.content.elementId,customCodeSnippet:t.content.elementCode,targetId:c.id,nextSibling:u,doc:o}),!0;if(t.type===Fs.Z.SECTION_TEMPLATE)return this.componentManagementFlow.importSectionComponent({sectionId:t.content.sectionId,customCodeSnippet:t.content.customCodeSnippet,targetId:c.id,nextSibling:u,doc:o}),!0;const h=t.content;if(a)return!n&&this.handleDropWithWrapperCreation({draggedEntityContent:h,wrapperFlexDirection:a,dropOutsideTarget:s,doc:o});if(h.isNew){var m;const e={nodes:h.subHierarchy,parentId:c.id,nextSibling:u,keepOriginalParent:(null===(m=h.meta)||void 0===m?void 0:m.nodeType)===dt.sO.ICON,doc:o};h.subHierarchy[0].primitiveType===dt.sO.HTML_NODE?this.nodeManagementFlow.addEmbedNodeToSelNode(e):this.nodeManagementFlow.addNodesToParentOrStage(e)}else l.alt?this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:h.subHierarchy,copyBefore:u,targetId:c.id,doc:o}):this.nodeManagementFlow.moveNodesToTarget({nodes:h.subHierarchy,nextSibling:u,targetId:c.id,doc:o});return this.resetState(),!0}handleDropWithWrapperCreation(e){var t;const{acceptedDropTarget:o,childAnchoringDrop:n}=this.projectUIState.dropFlowStates.blockInlineContainer;if(!o||!n)return!1;const{draggedEntityContent:i,wrapperFlexDirection:r,dropOutsideTarget:s,doc:a}=e;if(!a)return!1;let{uidlNode:l}=o;s&&(l=s.uidlNode);const{uidlNode:c,edgeData:d}=n,{pressedKeys:p}=this.projectUIState.userInteractions,u=(0,sO.a)({stencilKey:r,parentId:l.id}),h=this.projectDoc.nodes.getNextSibling(c),m=-1!==["left","top"].indexOf(d.edge)?"before":"after";if(this.nodeManagementFlow.addNodesToParentOrStage({nodes:[u],parentId:l.id,nextSibling:h,keepOriginalParent:(null===(t=i.meta)||void 0===t?void 0:t.nodeType)===dt.sO.ICON,doc:a}),i.isNew){var g;this.nodeManagementFlow.moveNodesToTarget({nodes:[c],targetId:u.id,doc:a});const e={nodes:i.subHierarchy,keepOriginalParent:(null===(g=i.meta)||void 0===g?void 0:g.nodeType)===dt.sO.ICON,parentId:u.id,nextSibling:"before"===m?c:null,doc:a};i.subHierarchy[0].primitiveType===dt.sO.HTML_NODE?this.nodeManagementFlow.addEmbedNodeToSelNode(e):this.nodeManagementFlow.addNodesToParentOrStage(e)}else this.nodeManagementFlow.moveNodesToTarget({nodes:[c],targetId:u.id,doc:a}),p.alt?(this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:i.subHierarchy,targetId:u.id,copyBefore:"before"===m?c:null,doc:a}),i.subHierarchy.some((e=>e.id===c.id))&&this.nodeManagementFlow.moveNodesToTarget({nodes:i.subHierarchy,targetId:u.id,nextSibling:"before"===m?c:null,doc:a})):this.nodeManagementFlow.moveNodesToTarget({nodes:[...i.subHierarchy],targetId:u.id,nextSibling:"before"===m?c:null,doc:a});return this.resetState(),!0}},(0,G.Z)($N.prototype,"handleDrop",[Q.P],Object.getOwnPropertyDescriptor($N.prototype,"handleDrop"),$N.prototype),(0,G.Z)($N.prototype,"handleDropIntoEmptyContainer",[Q.P],Object.getOwnPropertyDescriptor($N.prototype,"handleDropIntoEmptyContainer"),$N.prototype),(0,G.Z)($N.prototype,"handleDropBetweenSiblings",[Q.P],Object.getOwnPropertyDescriptor($N.prototype,"handleDropBetweenSiblings"),$N.prototype),(0,G.Z)($N.prototype,"handleDropWithWrapperCreation",[Q.P],Object.getOwnPropertyDescriptor($N.prototype,"handleDropWithWrapperCreation"),$N.prototype),zN=$N));var JN,WN,KN,YN,XN,qN,QN,eE,tE;function oE(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function nE(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?oE(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):oE(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}JN=(0,J.JJ)("dropIntoInheritContainerFlow"),WN=(0,J.f3)("dropIntoFlexContainerFlow"),KN=(0,J.f3)("dropIntoBlockInlineContainerFlow"),YN=(0,J.f3)("dropIntoUnknownContainerFlow"),JN((qN=class extends xN{constructor(){super(),(0,z.Z)(this,"dropIntoFlexContainerFlow",QN,this),(0,z.Z)(this,"dropIntoBlockInlineContainerFlow",eE,this),(0,z.Z)(this,"dropIntoUnknownContainerFlow",tE,this),(0,$.Z)(this,"stateAccessor","unknownContainer"),this.resetState()}resetState(){super.resetUIStateState(this.stateAccessor),this.stateAccessor="unknownContainer"}handleDraggedEntity(e){return super.handleDraggedEntity(e)}acceptsDOMElement(e,t,o,n){var i;if(!n)return this.acceptingDropTarget=null,!1;if(!(e instanceof HTMLElement))return this.acceptingDropTarget=null,!1;const r=e.dataset.compInstanceId||e.dataset.nodeId;if(!r)return this.acceptingDropTarget=null,!1;if((null===(i=this.acceptingDropTarget)||void 0===i?void 0:i.uidlNode.id)===r)return!0;if(!((null===n||void 0===n?void 0:n.target)instanceof HTMLIFrameElement))return this.acceptingDropTarget=null,!1;const s=!!this.projectUIState.userInteractions.pressedKeys.ctrl,a=this.projectDoc.nodes.byId[r];if(!s&&null!==a&&void 0!==a&&a.parentId&&this.dropElementHelper.elementSmallerOrSibling(e,r))return this.acceptingDropTarget=null,!1;if((null===a||void 0===a?void 0:a.primitiveType)===dt.sO.CONTAINER&&this.nodeStyleManagementFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:a.id,key:pt.X7.DISPLAY,values:["inherit"]})){if(a.parentId){const e=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(a.parentId,["display"]).display;"flex"===e&&(this.stateAccessor="flexContainer"),-1!==["block","inline","inline-block"].indexOf(e)&&(this.stateAccessor="blockInlineContainer")}return this.acceptingDropTarget={domNode:e,uidlNode:a},!0}return this.acceptingDropTarget=null,!1}moveOver(e){this.stateAccessor&&super.handleMoveOver(nE(nE({},e),{},{stateAccessor:this.stateAccessor}))}moveOut(){super.handleMoveOut(this.stateAccessor)}handleDrop(e){return"flexContainer"===this.stateAccessor?this.dropIntoFlexContainerFlow.handleDrop(e):"blockInlineContainer"===this.stateAccessor?this.dropIntoBlockInlineContainerFlow.handleDrop(e):this.dropIntoUnknownContainerFlow.handleDrop(e)}},QN=(0,G.Z)(qN.prototype,"dropIntoFlexContainerFlow",[WN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eE=(0,G.Z)(qN.prototype,"dropIntoBlockInlineContainerFlow",[KN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tE=(0,G.Z)(qN.prototype,"dropIntoUnknownContainerFlow",[YN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(qN.prototype,"handleDrop",[Q.P],Object.getOwnPropertyDescriptor(qN.prototype,"handleDrop"),qN.prototype),XN=qN));var iE,rE;function sE(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function aE(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?sE(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):sE(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}(0,J.JJ)("dropIntoSlotFlow")((rE=class extends xN{constructor(){super(),this.resetState(),this.handleDropIntoChildlessSlot=this.handleDropIntoChildlessSlot.bind(this),this.handleDropBetweenSiblings=this.handleDropBetweenSiblings.bind(this)}resetState(){super.resetUIStateState("slot")}handleDraggedEntity(e){return super.handleDraggedEntity(e)}acceptsDOMElement(e,t,o,n){return super.checkIfElementIsAccepted(e,"slot",t,o,n)}moveOver(e){super.handleMoveOver(aE(aE({},e),{},{stateAccessor:"slot"}))}moveOut(){super.handleMoveOut("slot")}handleDrop(e){return super.handleDropIntoContainer(aE({dropIntoChildlessContainerCallback:this.handleDropIntoChildlessSlot,dropIntoContainerWithChildrenCallback:this.handleDropBetweenSiblings,stateAccessor:"slot"},e))}handleDropIntoChildlessSlot(e){const{acceptedDropTarget:t,dropPosition:o}=this.projectUIState.dropFlowStates.slot;if(!t)throw new Error("Could not execute slot drop with no targets");const{draggedEntity:n,doc:i,isVirtual:r}=e;if(!i||!n||r)return!1;const s=this.projectUIState.selection.componentId;if(!s)return this.resetState(),!1;if(!(i.pages.byId[s]||i.components.byId[s]))throw new Error("Could not execute slot drop when active componet is not available");const{uidlNode:a,domNode:l}=t,{pressedKeys:c}=this.projectUIState.userInteractions,d=a.id,p=l.dataset.compInstanceId;if(!p)throw new Error("Attempted to drop into slot whose comp instance is unknown!");if(n.type===Fs.Z.INTERACTIVE_ELEMENT)return this.componentManagementFlow.importSectionComponent({sectionId:n.content.elementId,customCodeSnippet:n.content.elementCode,targetId:d,compInstanceId:p,doc:i}),!0;if(n.type===Fs.Z.SECTION_TEMPLATE)return this.componentManagementFlow.importSectionComponent({sectionId:n.content.sectionId,customCodeSnippet:n.content.customCodeSnippet,targetId:d,compInstanceId:p,doc:i}),!0;const u=n.content;var h;u.isNew?this.nodeManagementFlow.addNodesToParentOrStage({nodes:u.subHierarchy,parentId:d,dropPosition:o,keepOriginalParent:(null===(h=u.meta)||void 0===h?void 0:h.nodeType)===dt.sO.ICON,compInstanceId:p,doc:i}):c.alt?this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:u.subHierarchy,targetId:d,compInstanceId:p,doc:i}):this.nodeManagementFlow.moveNodesToTarget({nodes:u.subHierarchy,targetId:d,dropPosition:o,removeMargins:!0,targetCompInstanceId:p,doc:i});return this.resetState(),!0}handleDropBetweenSiblings(e){const{acceptedDropTarget:t,childAnchoringDrop:o,dropOutsideTarget:n,newWrapperFlexDirection:i}=this.projectUIState.dropFlowStates.slot;if(!t||!o)return!1;const{draggedEntity:r,doc:s,isVirtual:a}=e;if(!s)return!1;const{pressedKeys:l}=this.projectUIState.userInteractions;let c=t.uidlNode,d=t.domNode.dataset.compInstanceId;if(n&&(c=n.uidlNode,d=n.domNode.dataset.compInstanceId),!d)throw new Error("Attempted to drop into slot whose comp instance is unknown!");const{edgeData:p,uidlNode:u}=o;if(i&&a)return!1;const h=-1!==["left","top"].indexOf(p.edge)?u:s.nodes.getNextSibling(u);if(i)return this.handleDropWithWrapperCreation({draggedEntity:r,dropOutsideTarget:n,doc:s,compInstanceId:d});if(r.type===Fs.Z.INTERACTIVE_ELEMENT)return this.componentManagementFlow.importSectionComponent({sectionId:r.content.elementId,customCodeSnippet:r.content.elementCode,targetId:c.id,nextSibling:h,compInstanceId:d,doc:s}),!0;if(r.type===Fs.Z.SECTION_TEMPLATE)return this.componentManagementFlow.importSectionComponent({sectionId:r.content.sectionId,customCodeSnippet:r.content.customCodeSnippet,targetId:c.id,nextSibling:h,compInstanceId:d,doc:s}),!0;const m=r.content;var g;m.isNew?this.nodeManagementFlow.addNodesToParentOrStage({nodes:m.subHierarchy,parentId:c.id,nextSibling:h,compInstanceId:d,keepOriginalParent:(null===(g=m.meta)||void 0===g?void 0:g.nodeType)===dt.sO.ICON,doc:s}):l.alt?this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:m.subHierarchy,targetId:c.id,copyBefore:h,doc:s,compInstanceId:d}):this.nodeManagementFlow.moveNodesToTarget({nodes:m.subHierarchy,targetId:c.id,nextSibling:h,targetCompInstanceId:d,removeMargins:!0,doc:s});return this.resetState(),!0}handleDropWithWrapperCreation(e){var t;const{acceptedDropTarget:o,childAnchoringDrop:n}=this.projectUIState.dropFlowStates.slot;if(!o||!n)return!1;const{draggedEntity:i,dropOutsideTarget:r,compInstanceId:s,doc:a}=e;if(!a)return!1;let{uidlNode:l}=o;r&&(l=r.uidlNode);const c=a.nodes.byId[l.parentId||""];if(!c)return!1;const{uidlNode:d,edgeData:p}=n,{pressedKeys:u}=this.projectUIState.userInteractions,h=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(c.id,["flexDirection"]).flexDirection===Ol.sO.COLUMN?Ol.sO.ROW:Ol.sO.COLUMN,m={};if(h===Ol.sO.ROW){let e=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(d.id,["height"]).height;e?(-1!==e.toString().indexOf("%")&&(e="100%"),m.height=e,m.width="auto"):(m.height="auto",m.width="auto");const t=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(c.id,["alignItems"]).alignItems;m.justifyContent=t}else{let e=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(d.id,["width"]).width;e?(-1!==e.toString().indexOf("%")&&(e="100%"),m.width=e,m.height="auto"):(m.width="auto",m.height="auto");const t=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(c.id,["justifyContent"]).justifyContent;m.alignItems=t}const g=(0,sO.a)({stencilKey:h,slotId:l.id,styles:m});g.fakeSize=!1;const y=a.nodes.getNextSibling(d),f=-1!==["left","top"].indexOf(p.edge)?"before":"after";if(this.nodeManagementFlow.addNodesToParentOrStage({nodes:[g],parentId:l.id,keepOriginalParent:(null===(t=i.content.meta)||void 0===t?void 0:t.nodeType)===dt.sO.ICON,compInstanceId:s,nextSibling:y,doc:a}),i.type===Fs.Z.INTERACTIVE_ELEMENT)return this.nodeManagementFlow.moveNodesToTarget({nodes:[d],targetId:g.id,targetCompInstanceId:s,removeMargins:!0,doc:a}),this.componentManagementFlow.importSectionComponent({sectionId:i.content.elementId,customCodeSnippet:i.content.elementCode,doc:a,compInstanceId:s,targetId:g.id,nextSibling:"before"===f?d:null}),!0;if(i.type===Fs.Z.SECTION_TEMPLATE)return this.nodeManagementFlow.moveNodesToTarget({nodes:[d],targetId:g.id,targetCompInstanceId:s,removeMargins:!0,doc:a}),this.componentManagementFlow.importSectionComponent({sectionId:i.content.sectionId,customCodeSnippet:i.content.customCodeSnippet,doc:a,compInstanceId:s,targetId:g.id,nextSibling:"before"===f?d:null}),!0;const b=i.content;var w;b.isNew?(this.nodeManagementFlow.moveNodesToTarget({nodes:[d],targetId:g.id,removeMargins:!0,targetCompInstanceId:s,doc:a}),this.nodeManagementFlow.addNodesToParentOrStage({nodes:b.subHierarchy,parentId:g.id,compInstanceId:s,keepOriginalParent:(null===(w=b.meta)||void 0===w?void 0:w.nodeType)===dt.sO.ICON,nextSibling:"before"===f?d:null,doc:a})):(this.nodeManagementFlow.moveNodesToTarget({nodes:[d],targetId:g.id,removeMargins:!0,targetCompInstanceId:s,doc:a}),u.alt?(this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:b.subHierarchy,targetId:g.id,copyBefore:"before"===f?d:null,compInstanceId:s,doc:a}),b.subHierarchy.some((e=>e.id===d.id))&&this.nodeManagementFlow.moveNodesToTarget({nodes:b.subHierarchy,targetId:g.id,nextSibling:"before"===f?d:null,removeMargins:!0,targetCompInstanceId:s,doc:a})):this.nodeManagementFlow.moveNodesToTarget({nodes:b.subHierarchy,targetId:g.id,nextSibling:"before"===f?d:null,removeMargins:!0,targetCompInstanceId:s,doc:a}));return this.resetState(),!0}},(0,G.Z)(rE.prototype,"handleDrop",[Q.P],Object.getOwnPropertyDescriptor(rE.prototype,"handleDrop"),rE.prototype),(0,G.Z)(rE.prototype,"handleDropIntoChildlessSlot",[Q.P],Object.getOwnPropertyDescriptor(rE.prototype,"handleDropIntoChildlessSlot"),rE.prototype),(0,G.Z)(rE.prototype,"handleDropBetweenSiblings",[Q.P],Object.getOwnPropertyDescriptor(rE.prototype,"handleDropBetweenSiblings"),rE.prototype),(0,G.Z)(rE.prototype,"handleDropWithWrapperCreation",[Q.P],Object.getOwnPropertyDescriptor(rE.prototype,"handleDropWithWrapperCreation"),rE.prototype),iE=rE));var lE,cE,dE,pE,uE,hE,mE,gE,yE,fE,bE,wE,vE;lE=(0,J.JJ)("dropIntoButtonFlow"),cE=(0,J.f3)("projectDoc"),dE=(0,J.f3)("nodeManagementFlow"),pE=(0,J.f3)("projectUIState"),uE=(0,J.f3)("dropElementHelper"),hE=(0,J.f3)("nodeStyleManagmentFlow"),lE((gE=class{constructor(){(0,z.Z)(this,"projectDoc",yE,this),(0,z.Z)(this,"nodeManagementFlow",fE,this),(0,z.Z)(this,"projectUIState",bE,this),(0,z.Z)(this,"dropElementHelper",wE,this),(0,z.Z)(this,"nodeStyleManagementFlow",vE,this),(0,$.Z)(this,"lastHoveredNode",null),(0,$.Z)(this,"elementChildrenOfCurrentTarget",[]),(0,$.Z)(this,"lastAltState",!1),(0,$.Z)(this,"acceptingDropTarget",null),(0,$.Z)(this,"timeout",null),(0,$.Z)(this,"lastMovedAt",null)}resetState(){this.timeout&&clearTimeout(this.timeout),this.acceptingDropTarget=null,this.elementChildrenOfCurrentTarget=[],this.lastAltState=!1,this.lastHoveredNode=null,this.lastMovedAt=null,(0,V.JG)(this.projectUIState,(e=>{e.dropFlowStates.button.acceptedDropTarget=null,e.dropFlowStates.button.childAnchoringDrop=null,e.dropFlowStates.button.dropPosition=null,e.dropFlowStates.button.dropOutsideTarget=null,e.dropFlowStates.button.dropIsDisabled=!1}))}handleDraggedEntity(e){return e.type===Fs.Z.SUB_HIERARCHY}moveOut(){this.resetState()}acceptsDOMElement(e,t,o,n){if(!n)return this.acceptingDropTarget=null,!1;if(!(e instanceof HTMLElement))return this.acceptingDropTarget=null,!1;if(!((null===n||void 0===n?void 0:n.target)instanceof HTMLIFrameElement))return this.acceptingDropTarget=null,!1;let i=!0;for(;i&&e.parentElement;){const t=e.parentElement,o=t.dataset.nodeId,n=this.projectDoc.nodes.byId[o||""];(null===n||void 0===n?void 0:n.primitiveType)===dt.sO.TEXT?e=t:i=!1}if(!(e instanceof HTMLElement))return this.acceptingDropTarget=null,!1;const r=e.dataset.compInstanceId||e.dataset.nodeId;if(!r)return this.acceptingDropTarget=null,!1;const s=this.projectDoc.nodes.byId[r];if(!this.projectUIState.userInteractions.pressedKeys.ctrl&&null!==s&&void 0!==s&&s.parentId&&this.dropElementHelper.elementSmallerOrSibling(e,r))return this.acceptingDropTarget=null,!1;const a=(null===s||void 0===s?void 0:s.primitiveType)===dt.sO.BUTTON;if(!s||!a)return this.acceptingDropTarget=null,!1;this.acceptingDropTarget={domNode:e,uidlNode:s};return!!this.checkIfDraggedEntityIsAccepted(this.projectUIState.drag.draggedEntity)||(this.acceptingDropTarget=null,!1)}handleDrop(e){const{dropPosition:t,acceptedDropTarget:o,dropOutsideTarget:n,childAnchoringDrop:i,dropIsDisabled:r}=this.projectUIState.dropFlowStates.button,s=this.projectUIState.selection.componentId;if(!o||!s||r)return!1;const{draggedEntity:a,isVirtual:l,doc:c}=e;return a.type===Fs.Z.SUB_HIERARCHY&&(t&&!n?this.dropIntoChildlessButton({draggedEntityContent:a.content,doc:c,isVirtual:l}):!!i&&this.dropIntoButtonWithChildren({draggedEntityContent:a.content,doc:c,isVirtual:l}))}moveOver(e){const t=this.projectUIState.drag.currentMousePosition,o=this.projectUIState.stage.webComp.controlValues.scale;this.lastMovedAt&&t&&!(0,WD.NN)(this.lastMovedAt,t,10/o)&&!e.forced||(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.handleMoveOver(e)),ts.vL))}handleMoveOver(e){var t;this.timeout=null,this.lastMovedAt=this.projectUIState.drag.currentMousePosition;const{draggedEntity:o,customEv:n,position:i}=e;if(!o)return;if(!this.acceptingDropTarget||!n||!(n.target instanceof HTMLIFrameElement))return;const{domNode:r,uidlNode:s}=this.acceptingDropTarget,{pressedKeys:a}=this.projectUIState.userInteractions;return r?((null===(t=this.lastHoveredNode)||void 0===t?void 0:t.id)===s.id&&this.lastAltState===a.alt||(this.elementChildrenOfCurrentTarget=s.primitiveType===dt.sO.BUTTON?this.dropElementHelper.processElementChildren(r.children,o.content.subHierarchy):this.elementChildrenOfCurrentTarget,this.lastHoveredNode=s,this.lastAltState=a.alt||!1,(0,V.JG)(this.projectUIState,(e=>e.dropFlowStates.button.dropIsDisabled=!1))),this.elementChildrenOfCurrentTarget.length?this.handleMoveOverButtonWithChildren({draggedEntity:o,position:i,target:n.target}):this.handleMoveOverChildlessButton({draggedEntity:o,position:i,target:n.target})):void 0}handleMoveOverChildlessButton(e){const{position:t,target:o,draggedEntity:n}=e;if(!this.acceptingDropTarget||!t||n.type!==Fs.Z.SUB_HIERARCHY)return;const{domNode:i,uidlNode:r}=this.acceptingDropTarget;if(!i)return;const s=o.getBoundingClientRect(),a=i.getBoundingClientRect(),l=(0,mt.AO)(i),c=this.projectUIState.stage.webComp.controlValues.scale*l,d=(0,WD.$p)(t,a,s,c),p=i.getBoundingClientRect(),u=o.getBoundingClientRect(),h=(0,mt.AO)(o),m=this.projectDoc.nodes.byId[r.parentId||""];let g=!1,y=!1;if(m&&m.primitiveType===dt.sO.BUTTON){const e=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(null===m||void 0===m?void 0:m.id,["flexDirection","display"]),t=e.display;g=e.flexDirection===Ol.sO.COLUMN,y=t===pt.r3.FLEX}const f=(g&&y?t.y<=p.y*c*h+u.y+p.height/2*c*h:t.x<=p.x*c*h+u.x+p.width/2*c*h)?"left-middle":"right-middle";if(d)return this.dropElementHelper.handleMouseCloseToTargetEdge(d,"button",this.acceptingDropTarget),!0;(0,V.JG)(this.projectUIState,(e=>{e.dropFlowStates.button.acceptedDropTarget=this.acceptingDropTarget,e.dropFlowStates.button.dropPosition=f,e.dropFlowStates.button.childAnchoringDrop=null,e.dropFlowStates.button.dropOutsideTarget=null}))}checkIfDraggedEntityIsAccepted(e){if(!this.acceptingDropTarget||!e||e.type!==Fs.Z.SUB_HIERARCHY)return!1;const{uidlNode:t}=this.acceptingDropTarget;for(const o of e.content.subHierarchy){if(!o.primitiveType)continue;const e=this.projectDoc.isNodeAcceptingChild(t,o),n=this.projectDoc.nodes.byId[t.parentId||""];if(!(t.primitiveType===dt.sO.BUTTON||this.projectDoc.isNodeAcceptingChild(n,o)))return!1;if(!e)return!1}return!0}handleMoveOverButtonWithChildren(e){const{position:t,target:o}=e;if(!this.acceptingDropTarget||!t)return;const{domNode:n}=this.acceptingDropTarget;if(!n)return;const i=this.elementChildrenOfCurrentTarget.map((e=>e.getBoundingClientRect())),r=this.elementChildrenOfCurrentTarget.map((e=>(0,mt.AO)(e))),s=o.getBoundingClientRect(),a=this.projectUIState.stage.webComp.controlValues.scale,l=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(this.acceptingDropTarget.uidlNode.id,["flexDirection"]),{targetPointIdx:c,edgeData:d}=(0,WD.jV)(t,i,r,s,a,l.flexDirection);if(-1===c)return;const p=this.elementChildrenOfCurrentTarget[c],u=this.projectDoc.nodes.byId[p.dataset.compInstanceId||p.dataset.nodeId||""];if(!u)throw new Error("Button Drop error. Child node responsible for drop not found.");if("column"!==l.flexDirection){const{left:e,right:t}=d.distance;d.edge=e<t?"left":"right"}if("column"===l.flexDirection){const{top:e,bottom:t}=d.distance;d.edge=e<t?"top":"bottom"}(0,V.JG)(this.projectUIState,(e=>{e.dropFlowStates.button.acceptedDropTarget=this.acceptingDropTarget,e.dropFlowStates.button.childAnchoringDrop={domNode:p,uidlNode:u,edgeData:d},e.dropFlowStates.button.dropPosition=null,e.dropFlowStates.button.dropOutsideTarget=null}))}dropIntoChildlessButton(e){const{draggedEntityContent:t,isVirtual:o,doc:n}=e;if(!n||o)return!1;const{dropPosition:i,acceptedDropTarget:r}=this.projectUIState.dropFlowStates.button;if(!r)return!1;if(!this.projectUIState.selection.componentId)return this.resetState(),!1;const{uidlNode:s}=r,{pressedKeys:a}=this.projectUIState.userInteractions,l=n.nodes.byId[s.id];var c;return(null===l||void 0===l?void 0:l.primitiveType)===dt.sO.BUTTON&&(l.styles[pt.X7.DISPLAY]=new ar.F({content:pt.r3.FLEX}),l.styles[pt.X7.FLEX_DIRECTION]=new ar.F({content:aN.aF.ROW})),t.isNew?(this.nodeManagementFlow.addNodesToParentOrStage({dropPosition:"left-middle"===i?"before":"after",nodes:t.subHierarchy,keepOriginalParent:(null===(c=t.meta)||void 0===c?void 0:c.nodeType)===dt.sO.ICON,parentId:s.id,useContentAsNode:!0,doc:n}),!0):a.alt?(this.nodeManagementFlow.copyNodeHierarchyToTarget({dropPosition:"left-middle"===i?"before":"after",nodes:t.subHierarchy,targetId:s.id,useContentAsNode:!0,doc:n}),!0):(this.nodeManagementFlow.moveNodesToTarget({dropPosition:"left-middle"===i?"before":"after",nodes:t.subHierarchy,targetId:s.id,useContentAsNode:!0,doc:n}),!0)}dropIntoButtonWithChildren(e){const{doc:t,draggedEntityContent:o}=e;if(!t)return!1;const{childAnchoringDrop:n,acceptedDropTarget:i,dropOutsideTarget:r}=this.projectUIState.dropFlowStates.button;if(!i)return!1;if(!this.projectUIState.selection.componentId)return this.resetState(),!1;const{edgeData:s,uidlNode:a}=n||{},{pressedKeys:l}=this.projectUIState.userInteractions;let c=i.uidlNode;if(c.primitiveType!==dt.sO.BUTTON){c=this.projectDoc.nodes.byId[c.parentId]||c}r&&(c=r.uidlNode);const d=s&&-1!==["left","top"].indexOf((null===s||void 0===s?void 0:s.edge)||"")?a:a?this.projectDoc.nodes.getNextSibling(a):null,p=c.id;var u;return o.isNew?(this.nodeManagementFlow.addNodesToParentOrStage({nodes:o.subHierarchy,parentId:p,keepOriginalParent:(null===(u=o.meta)||void 0===u?void 0:u.nodeType)===dt.sO.ICON,nextSibling:d,doc:t}),!0):l.alt?(this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:o.subHierarchy,targetId:p,copyBefore:d,doc:t}),!0):(this.nodeManagementFlow.moveNodesToTarget({nodes:o.subHierarchy,targetId:p,nextSibling:d,doc:t}),!0)}},yE=(0,G.Z)(gE.prototype,"projectDoc",[cE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fE=(0,G.Z)(gE.prototype,"nodeManagementFlow",[dE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bE=(0,G.Z)(gE.prototype,"projectUIState",[pE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wE=(0,G.Z)(gE.prototype,"dropElementHelper",[uE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vE=(0,G.Z)(gE.prototype,"nodeStyleManagementFlow",[hE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(gE.prototype,"handleDrop",[Q.P],Object.getOwnPropertyDescriptor(gE.prototype,"handleDrop"),gE.prototype),(0,G.Z)(gE.prototype,"dropIntoChildlessButton",[Q.P],Object.getOwnPropertyDescriptor(gE.prototype,"dropIntoChildlessButton"),gE.prototype),(0,G.Z)(gE.prototype,"dropIntoButtonWithChildren",[Q.P],Object.getOwnPropertyDescriptor(gE.prototype,"dropIntoButtonWithChildren"),gE.prototype),mE=gE));var IE,SE,jE,DE,OE,FE,TE,NE,EE;IE=(0,J.JJ)("dropIntoListFlow"),SE=(0,J.f3)("projectUIState"),jE=(0,J.f3)("projectDoc"),DE=(0,J.f3)("nodeManagementFlow"),IE((FE=class{constructor(){(0,z.Z)(this,"projectUIState",TE,this),(0,z.Z)(this,"projectDoc",NE,this),(0,z.Z)(this,"nodeManagementFlow",EE,this),(0,$.Z)(this,"acceptingDropTarget",null),(0,$.Z)(this,"timeout",null),(0,$.Z)(this,"lastMovedAt",null),this.resetState()}resetState(){this.timeout&&clearTimeout(this.timeout),this.acceptingDropTarget=null,this.lastMovedAt=null,(0,V.JG)(this.projectUIState,(e=>{e.dropFlowStates.list.acceptedDropTarget=null,e.dropFlowStates.list.childAnchoringDrop=null,e.dropFlowStates.list.dropPosition=null,e.dropFlowStates.list.dropOutsideTarget=null,e.dropFlowStates.list.dropIsDisabled=!1}))}moveOut(){this.resetState()}moveOver(e){const t=this.projectUIState.drag.currentMousePosition,o=this.projectUIState.stage.webComp.controlValues.scale;this.lastMovedAt&&t&&!(0,WD.NN)(this.lastMovedAt,t,10/o)&&!e.forced||(this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.handleMoveOver(e)),ts.vL))}handleMoveOver(e){this.timeout=null,this.lastMovedAt=this.projectUIState.drag.currentMousePosition;const{draggedEntity:t,customEv:o,position:n}=e;if(!t)return;if(!this.acceptingDropTarget||!o||!(o.target instanceof HTMLIFrameElement))return;const{domNode:i,uidlNode:r}=this.acceptingDropTarget;return i?Object.keys(r.childrenIds||{}).length?this.handleMoveOverListWithChildren({draggedEntity:t,position:n,target:o.target}):this.handleMoveOverEmptyList():void 0}handleMoveOverEmptyList(){(0,V.JG)(this.projectUIState,(e=>{e.dropFlowStates.list.acceptedDropTarget=this.acceptingDropTarget,e.dropFlowStates.list.dropPosition="top-left",e.dropFlowStates.list.childAnchoringDrop=null,e.dropFlowStates.list.dropOutsideTarget=null}))}handleMoveOverListWithChildren(e){const{position:t,target:o,draggedEntity:n}=e;if(!this.acceptingDropTarget||!t)return;const{domNode:i}=this.acceptingDropTarget;if(!i)return;const r=Array.from(i.children).filter((e=>!n.content.subHierarchy.find((t=>e.dataset.nodeId===t.id)))),s=r.map((e=>e.getBoundingClientRect())),a=r.map((e=>(0,mt.AO)(e))),l=o.getBoundingClientRect(),c=this.projectUIState.stage.webComp.controlValues.scale,{targetPointIdx:d,edgeData:p}=(0,WD.jV)(t,s,a,l,c);if(-1===d)return;const u=r[d],h=this.projectDoc.nodes.byId[u.dataset.compInstanceId||u.dataset.nodeId||""];if(!h)return;const{top:m,bottom:g}=p.distance;p.edge=m<g?"top":"bottom",(0,V.JG)(this.projectUIState,(e=>{e.dropFlowStates.list.acceptedDropTarget=this.acceptingDropTarget,e.dropFlowStates.list.childAnchoringDrop={domNode:u,uidlNode:h,edgeData:p},e.dropFlowStates.list.dropPosition=null,e.dropFlowStates.list.dropOutsideTarget=null}))}handleDraggedEntity(e){if(e.type!==Fs.Z.SUB_HIERARCHY)return!1;return(0,$r.a)(e.content.subHierarchy)===dt.sO.LISTITEM}acceptsDOMElement(e){if(!(e instanceof HTMLElement))return this.acceptingDropTarget=null,!1;const t=this.projectDoc.nodes.byId[e.dataset.nodeId||""];return t&&t.primitiveType===dt.sO.LIST?(this.acceptingDropTarget={domNode:e,uidlNode:t},!0):(this.acceptingDropTarget=null,!1)}handleDrop(e){const{dropPosition:t,acceptedDropTarget:o,dropOutsideTarget:n,childAnchoringDrop:i,dropIsDisabled:r}=this.projectUIState.dropFlowStates.list,s=this.projectUIState.selection.componentId;if(!o||!s||r)return!1;const{draggedEntity:a,isVirtual:l,doc:c}=e;return a.type===Fs.Z.SUB_HIERARCHY&&(t&&!n?this.dropIntoChildlessList({draggedEntityContent:a.content,doc:c,isVirtual:l}):!!i&&this.dropIntoListWithChildren({draggedEntityContent:a.content,doc:c,isVirtual:l}))}dropIntoChildlessList(e){const{draggedEntityContent:t,isVirtual:o,doc:n}=e;if(!n||o)return!1;const{acceptedDropTarget:i}=this.projectUIState.dropFlowStates.list;if(!i)return!1;const{uidlNode:r}=i,{pressedKeys:s}=this.projectUIState.userInteractions;return t.isNew?(this.nodeManagementFlow.addNodesToParentOrStage({nodes:t.subHierarchy,parentId:r.id,doc:n}),!0):s.alt?(this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:t.subHierarchy,targetId:r.id,doc:n}),!0):(this.nodeManagementFlow.moveNodesToTarget({nodes:t.subHierarchy,targetId:r.id,doc:n}),!0)}dropIntoListWithChildren(e){const{draggedEntityContent:t,doc:o}=e;if(!o)return!1;const{childAnchoringDrop:n,acceptedDropTarget:i}=this.projectUIState.dropFlowStates.list;if(!i)return!1;const{edgeData:r,uidlNode:s}=n||{},{pressedKeys:a}=this.projectUIState.userInteractions,l=r&&-1!==["left","top"].indexOf((null===r||void 0===r?void 0:r.edge)||"")?s:s?this.projectDoc.nodes.getNextSibling(s):null,c=i.uidlNode;return t.isNew?(this.nodeManagementFlow.addNodesToParentOrStage({nodes:t.subHierarchy,parentId:c.id,nextSibling:l,doc:o}),!0):a.alt?(this.nodeManagementFlow.copyNodeHierarchyToTarget({nodes:t.subHierarchy,targetId:c.id,copyBefore:l,doc:o}),!0):(this.nodeManagementFlow.moveNodesToTarget({nodes:t.subHierarchy,targetId:c.id,nextSibling:l,doc:o}),!0)}},TE=(0,G.Z)(FE.prototype,"projectUIState",[SE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NE=(0,G.Z)(FE.prototype,"projectDoc",[jE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EE=(0,G.Z)(FE.prototype,"nodeManagementFlow",[DE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(FE.prototype,"handleDrop",[Q.P],Object.getOwnPropertyDescriptor(FE.prototype,"handleDrop"),FE.prototype),(0,G.Z)(FE.prototype,"dropIntoChildlessList",[Q.P],Object.getOwnPropertyDescriptor(FE.prototype,"dropIntoChildlessList"),FE.prototype),(0,G.Z)(FE.prototype,"dropIntoListWithChildren",[Q.P],Object.getOwnPropertyDescriptor(FE.prototype,"dropIntoListWithChildren"),FE.prototype),OE=FE));var CE,xE,PE,kE,ME,ZE,UE,AE,LE;CE=(0,J.JJ)("dropIntoTokenCategoryFlow"),xE=(0,J.f3)("projectDoc"),PE=(0,J.f3)("projectUIState"),kE=(0,J.f3)("designLanguageManagementFlow"),CE((ZE=class{constructor(){(0,z.Z)(this,"projectDoc",UE,this),(0,z.Z)(this,"projectUIState",AE,this),(0,z.Z)(this,"designLanguageManagementFlow",LE,this),(0,$.Z)(this,"moveOver",QF()((e=>{const{draggedEntity:t,ev:o,position:n}=e;return this.handleMouseOverTokenCategory(t,o,n)}),ts.x1.SIXTY)),this.resetState()}resetState(){(0,V.JG)(this.projectUIState,(e=>{e.dropFlowStates.tokenCategory.acceptedDropTarget=null,e.dropFlowStates.tokenCategory.dropAnchor=null}))}handleDraggedEntity(e){return e.type===Fs.Z.TOKEN}acceptsDOMElement(e){var t;if(!(e instanceof HTMLElement))return!1;const o=e,n=e.closest("[data-category-id]"),i=null===n||void 0===n?void 0:n.getAttribute("data-category-id"),r=null===(t=this.projectUIState.drag.draggedEntity)||void 0===t?void 0:t.content;if(r&&r.token.categoryId!==i)return document.documentElement.style.cursor="no-drop",!1;if(!n)return!1;const s=Array.from(n.querySelectorAll("[data-token-id]")).reduce(((e,t)=>(e[t.dataset.tokenId]=t,e)),{});return!!o&&((0,V.JG)(this.projectUIState,(e=>{e.dropFlowStates.tokenCategory.acceptedDropTarget={domTokenCategory:o.closest("[data-category-id]"),domTokensFromCategory:s}})),document.documentElement.style.cursor="default",!0)}handleMouseOverTokenCategory(e,t,o){const n=this.projectUIState.dropFlowStates.tokenCategory.acceptedDropTarget;if(!n)return;if(e.type!==Fs.Z.TOKEN)return;const{domTokensFromCategory:i}=n,r=e.content.token;let s=Object.values(i)[0],a="before";Object.keys(i).forEach((e=>{const{x:t,y:n}=i[e].getBoundingClientRect();switch(r.type){case"color":if(o.x>t&&o.y>n){s=i[e];const t=this.projectDoc.designLanguage.tokensById[e];a=r.position<t.position?"after":"before"}break;case"size":case"space":case"radius":case"text-style":if(o.y>n){const{tokensById:t,textStyleSetsById:o}=this.projectDoc.designLanguage;s=i[e];const n=t[e]||o[e];a=r.position<n.position?"after":"before"}}})),s.dataset.tokenId!==e.content.token.id&&(0,V.JG)(this.projectUIState,(e=>{e.dropFlowStates.tokenCategory.dropAnchor=a,e.dropFlowStates.tokenCategory.closestTokenElement=s}))}moveOut(){this.resetState()}handleDrop(e){const{dropAnchor:t,acceptedDropTarget:o,closestTokenElement:n}=this.projectUIState.dropFlowStates.tokenCategory;if(!t||!o||!n)return!1;const{draggedEntity:i,doc:r}=e;if(i.type!==Fs.Z.TOKEN)return!1;const s=i.content.token,a=n.dataset.tokenId;return!!a&&(this.projectDoc.designLanguage.tokensById[a]?(this.designLanguageManagementFlow.changeTokenPosition({draggedTokenId:s.id,closestToDropTokenId:this.projectDoc.designLanguage.tokensById[a].id,direction:t,doc:r}),!0):!!this.projectDoc.designLanguage.textStyleSetsById[a]&&(this.designLanguageManagementFlow.changeTextStylePosition({draggedTokenId:s.id,closestToDropTokenId:this.projectDoc.designLanguage.textStyleSetsById[a].id,direction:t,doc:r}),!0))}},UE=(0,G.Z)(ZE.prototype,"projectDoc",[xE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AE=(0,G.Z)(ZE.prototype,"projectUIState",[PE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LE=(0,G.Z)(ZE.prototype,"designLanguageManagementFlow",[kE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(ZE.prototype,"handleDrop",[Q.P],Object.getOwnPropertyDescriptor(ZE.prototype,"handleDrop"),ZE.prototype),ME=ZE));var _E,RE,BE,HE,zE,$E,GE,VE,JE;_E=(0,J.JJ)("dropIntoNavbarFlow"),RE=(0,J.f3)("projectUIState"),BE=(0,J.f3)("navbarFlow"),HE=(0,J.f3)("positioningService"),_E(($E=class{constructor(){(0,z.Z)(this,"projectUIState",GE,this),(0,z.Z)(this,"navbarFlow",VE,this),(0,z.Z)(this,"positioningService",JE,this),(0,$.Z)(this,"moveOver",QF()((e=>{var t;const{position:o}=e,n=null===(t=this.projectUIState.dropFlowStates.navbar.acceptingTab)||void 0===t?void 0:t.getBoundingClientRect();if(!n)return;const i=Math.abs(o.x-n.left)<Math.abs(o.x-n.right)?"before":"after";(0,V.JG)(this.projectUIState,(e=>{e.dropFlowStates.navbar.dropPosition=i}))}),ts.x1.SIXTY)),this.resetState()}resetState(){(0,V.JG)(this.projectUIState,(e=>{e.dropFlowStates.navbar.acceptingTab=null,e.dropFlowStates.navbar.dropPosition=null}))}handleDraggedEntity(e){return e.type===Fs.Z.SUB_HIERARCHY&&e.content.hierarchyType===Fs.h.COMPONENT||e.type===Fs.Z.PAGE}acceptsDOMElement(e){if(!(e instanceof HTMLElement))return!1;if(e.dataset.tabId){const t=document.querySelector(`[data-tab-id="${e.dataset.tabId}"]`);return!!t&&((0,V.JG)(this.projectUIState,(({dropFlowStates:e})=>{e.navbar.acceptingTab=t})),!0)}if("thq-navbar"===e.id){const e=this.navbarFlow.getTabIdsInOrder(),t=document.querySelector(`[data-tab-id="${e[e.length-1]}"]`);return!!t&&((0,V.JG)(this.projectUIState,(({dropFlowStates:e})=>{e.navbar.acceptingTab=t})),!0)}return!1}moveOut(){this.resetState()}handleDrop(e){var t,o;const{dropPosition:n,acceptingTab:i}=this.projectUIState.dropFlowStates.navbar,{draggedEntity:r}=e;if(r.type===Fs.Z.TOKEN||!n||!i)return!1;const s=(null===(t=r.content.meta)||void 0===t?void 0:t.dragComponentId)||(null===(o=r.content.meta)||void 0===o?void 0:o.dragPageId);if(!s)return!1;const a=this.navbarFlow.getCurrentTabs()[i.dataset.tabId],l=this.navbarFlow.getTabByEntityId(s);if(!a||(null===l||void 0===l?void 0:l.id)===a.id)return!1;if("before"===n){var c;const e=(null===(c=this.navbarFlow.getPreviousTab(a.id))||void 0===c?void 0:c.pos)||"0",t=(0,_c.Dd)(a.pos,e);l?this.navbarFlow.moveTab(l.id,t):this.navbarFlow.createNewTab({entityId:s,pos:t,forceSave:!0})}else{var d;const e=(null===(d=this.navbarFlow.getNextTab(a.id))||void 0===d?void 0:d.pos)||`${parseInt(a.pos)+Number.MAX_SAFE_INTEGER}`,t=(0,_c.Dd)(a.pos,e);l?this.navbarFlow.moveTab(l.id,t):this.navbarFlow.createNewTab({entityId:s,pos:t,forceSave:!0})}return!0}},GE=(0,G.Z)($E.prototype,"projectUIState",[RE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VE=(0,G.Z)($E.prototype,"navbarFlow",[BE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JE=(0,G.Z)($E.prototype,"positioningService",[HE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)($E.prototype,"handleDrop",[Q.P],Object.getOwnPropertyDescriptor($E.prototype,"handleDrop"),$E.prototype),zE=$E));var WE,KE,YE,XE,qE,QE,eC,tC,oC;WE=(0,J.JJ)("dropIntoFolderFlow"),KE=(0,J.f3)("projectDoc"),YE=(0,J.f3)("projectUIState"),XE=(0,J.f3)("projectFilesFlow"),WE((QE=class{constructor(){(0,z.Z)(this,"projectDoc",eC,this),(0,z.Z)(this,"projectUIState",tC,this),(0,z.Z)(this,"projectFilesFlow",oC,this),(0,$.Z)(this,"handleDraggedEntity",(e=>e.type===Fs.Z.FILE)),(0,$.Z)(this,"moveOver",(()=>{})),this.resetState()}resetState(){(0,V.JG)(this.projectUIState,(e=>{e.dropFlowStates.folder.acceptedDropTarget=null}))}acceptsDOMElement(e){if(!(e instanceof HTMLElement))return!1;const t=e.closest("[data-folder-id]");if(!t)return!1;const o=this.projectUIState.drag.draggedEntity;if((null===o||void 0===o?void 0:o.type)!==Fs.Z.FILE)return!1;const{draggingForbidden:n,filePath:i}=o.content;if(n)return!1;const r=t.dataset.folderId;return i!==r&&-1===(null===r||void 0===r?void 0:r.indexOf(`${i}/`))&&((0,V.JG)(this.projectUIState,(e=>{e.dropFlowStates.folder.acceptedDropTarget=t,r&&!(0,WD.AS)(r)&&(e.devMode.expandedFolders[r]=!0)})),!0)}moveOut(){this.resetState()}handleDrop(e){const{doc:t,draggedEntity:o}=e;if(o.type!==Fs.Z.FILE||o.content.draggingForbidden)return!1;const{acceptedDropTarget:n}=this.projectUIState.dropFlowStates.folder;if(!n)return!1;const i=n.dataset.folderId,r=o.content.filePath;return!(!i||!r||-1!==i.indexOf(`${r}/`)||(0,WD.AS)(i))&&(this.projectFilesFlow.moveFile({doc:t,toMovePath:r,destinationFolderPath:i}),!0)}},eC=(0,G.Z)(QE.prototype,"projectDoc",[KE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tC=(0,G.Z)(QE.prototype,"projectUIState",[YE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oC=(0,G.Z)(QE.prototype,"projectFilesFlow",[XE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qE=QE));var nC,iC,rC,sC,aC,lC,cC,dC,pC,uC,hC,mC,gC,yC,fC;nC=(0,J.JJ)("dropElementHelper"),iC=(0,J.f3)("projectDoc"),rC=(0,J.f3)("projectUIState"),sC=(0,J.f3)("nodeManagementFlow"),aC=(0,J.f3)("elementRefProvider"),lC=(0,J.f3)("notificationsManagementFlow"),cC=(0,J.f3)("nodeStyleManagmentFlow"),nC((pC=class{constructor(){(0,z.Z)(this,"projectDoc",uC,this),(0,z.Z)(this,"projectUIState",hC,this),(0,z.Z)(this,"nodeManagementFlow",mC,this),(0,z.Z)(this,"elementRefProvider",gC,this),(0,z.Z)(this,"notificationsManagementFlow",yC,this),(0,z.Z)(this,"nodeStyleManagementFlow",fC,this)}elementSmallerOrSibling(e,t){var o,n;const i=this.projectUIState.drag.draggedEntity;if((null===i||void 0===i?void 0:i.type)!==Fs.Z.SUB_HIERARCHY||i.content.isNew)return!1;const r=i.content.subHierarchy.map((e=>e.id));if(this.projectDoc.nodes.areNodesSiblings(r)){const e=this.projectDoc.nodes.getAncestors(t,!0,!0);for(const o of[t,...e])if(this.projectDoc.nodes.areNodesSiblings([r[0],o]))return!0}const s=this.projectDoc.nodes.byId[t],a=(null===(o=i.content.meta)||void 0===o?void 0:o.width)||0,l=(null===(n=i.content.meta)||void 0===n?void 0:n.height)||0;let c=e.clientWidth,d=e.clientHeight;if((null===s||void 0===s?void 0:s.primitiveType)===dt.sO.SLOT&&"contents"===getComputedStyle(e).display){const o=this.nodeManagementFlow.getNodeChildren(t,e.dataset.compInstanceId).map((e=>this.projectDoc.nodes.byId[e])),n=(0,WD.tx)(o,this.elementRefProvider);c=n.width,d=n.height}return a>c+2||l>d+2}processElementChildren(e,t){const{pressedKeys:o}=this.projectUIState.userInteractions;return Array.from(e).reduce(((e,n)=>{const{nodeId:i,compInstanceId:r,slotId:s}=(0,rd.MT)({element:n,dragging:!0})||{},a=s?this.projectDoc.nodes.byId[i||""]:this.projectDoc.nodes.byId[r||i||""];if(!a)return e;if(!o.alt)for(const o of t)if(o.id===a.id)return e;return this.nodeStyleManagementFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:a.id,key:"position",values:["absolute","fixed"]})||((null===a||void 0===a?void 0:a.primitiveType)===dt.sO.COMPONENT?e.push(n.firstElementChild):n.dataset.nodeId?e.push(n):s?e.push(this.elementRefProvider.getDomTargetNode(i||"",r)):e.push(this.elementRefProvider.getDomTargetNode(r||i||""))),e}),[])}handleMouseCloseToTargetEdge(e,t,o){if(!o)return;const{childAnchoringDrop:n,dropOutsideTarget:i}=this.projectUIState.dropFlowStates[t],{domNode:r}=o;let s=r,a=this.projectDoc.nodes.byId[s.dataset.nodeId],l=s.parentElement;if(e.shouldDropIntoComputedParent){const{edge:t}=e;for(;(null===(c=l)||void 0===c?void 0:c.getBoundingClientRect()[t])===s.getBoundingClientRect()[t]&&null!==(d=l.parentElement)&&void 0!==d&&d.dataset.nodeId;){var c,d;s=l,l=s.parentElement,a=this.projectDoc.nodes.byId[s.dataset.nodeId]}}if(!a||!l)return;const p=this.projectDoc.nodes.byId[l.dataset.nodeId];if(!p||p.primitiveType===dt.sO.SLOT)return;if((null===n||void 0===n?void 0:n.uidlNode.id)===a.id&&(null===i||void 0===i?void 0:i.uidlNode.id)===p.id)return;const u=this.projectUIState.drag.draggedEntity;(0,V.JG)(this.projectUIState,(n=>{n.dropFlowStates[t].acceptedDropTarget=o,n.dropFlowStates[t].newWrapperFlexDirection=this.getNewWrapperFlexDirection(t,e,p,a,u),n.dropFlowStates[t].dropOutsideTarget={domNode:l,uidlNode:p},n.dropFlowStates[t].childAnchoringDrop={domNode:s,uidlNode:a,edgeData:e},n.dropFlowStates[t].dropPosition=null}))}getNewWrapperFlexDirection(e,t,o,n,i){if(!i)return null;const{nodeHasStyleAtCurrentBreakpoint:r}=this.nodeStyleManagementFlow,s=-1!==["left","right"].indexOf(t.edge);let a=o,l=e;if("slot"===e){const e=this.projectDoc.nodes.byId[o.parentId||""];e&&this.nodeStyleManagementFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:e.id,key:pt.X7.DISPLAY,values:["flex","inline-flex"]})&&(a=e,l="flexContainer"),e&&this.nodeStyleManagementFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:e.id,key:pt.X7.DISPLAY,values:["block","inline-block","inline"]})&&(a=e,l="blockInlineContainer")}switch(l){case"flexContainer":let t=Object.keys(a.childrenIds||{});if(i.type!==Fs.Z.SUB_HIERARCHY||i.content.isNew||(t=t.filter((e=>!i.content.subHierarchy.some((t=>t.id===e))))),1===t.length&&"slot"!==e)return"parent";const o=r({nodeId:a.id,key:"flexDirection",values:["column"]});return o&&s?Ol.sO.ROW:o||s?null:Ol.sO.COLUMN;case"blockInlineContainer":const l=["block","flex"],c=i.content,d=null===c||void 0===c?void 0:c.subHierarchy[0].id,p=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(d,[pt.X7.DISPLAY])[pt.X7.DISPLAY],u=this.nodeStyleManagementFlow.getCurrentStyleValueByKeyForNode(n.id,[pt.X7.DISPLAY])[pt.X7.DISPLAY];return-1!==l.indexOf(u.toString())&&s?Ol.sO.ROW:-1===u.toString().indexOf("inline")||s||-1===(null===p||void 0===p?void 0:p.toString().indexOf("inline"))?-1!==u.toString().indexOf("inline")&&s&&p&&-1!==l.indexOf(p.toString())?Ol.sO.ROW:null:Ol.sO.COLUMN;default:return null}}checkForCircularDependencies(e,t){var o;return e.type!==Fs.Z.SECTION_TEMPLATE&&e.type!==Fs.Z.INTERACTIVE_ELEMENT&&(e.content.hierarchyType===Fs.h.COMPONENT&&(!!this.projectDoc.components.checkIfComponentsHaveCircularDependency(null===(o=e.content.meta)||void 0===o?void 0:o.dragComponentId,t)&&(this.notificationsManagementFlow.createNotification(K.k.ERROR,"Could not add component because it would create a circular dependency."),!0)))}},uC=(0,G.Z)(pC.prototype,"projectDoc",[iC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hC=(0,G.Z)(pC.prototype,"projectUIState",[rC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mC=(0,G.Z)(pC.prototype,"nodeManagementFlow",[sC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gC=(0,G.Z)(pC.prototype,"elementRefProvider",[aC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yC=(0,G.Z)(pC.prototype,"notificationsManagementFlow",[lC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fC=(0,G.Z)(pC.prototype,"nodeStyleManagementFlow",[cC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dC=pC));var bC,wC,vC,IC,SC,jC,DC,OC,FC,TC,NC,EC,CC,xC,PC,kC,MC,ZC,UC;function AC(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function LC(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?AC(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):AC(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}bC=(0,J.JJ)("dropSimulatorFlow"),wC=(0,J.f3)("projectDoc"),vC=(0,J.f3)("projectUIState"),IC=(0,J.f3)("pointerInteractionManagementFlow"),SC=(0,J.f3)("nodeStyleManagmentFlow"),jC=(0,J.f3)("elementRefProvider"),DC=(0,J.f3)("sharedbProjectSyncService"),OC=(0,J.f3)("nodeManagementFlow"),bC((ZC=new WeakMap,UC=new WeakMap,TC=class{constructor(){(0,z.Z)(this,"projectDoc",NC,this),(0,z.Z)(this,"projectUIState",EC,this),(0,z.Z)(this,"pointerInteractionManagementFlow",CC,this),(0,z.Z)(this,"nodeStyleManagementFlow",xC,this),(0,z.Z)(this,"elementRefProvider",PC,this),(0,z.Z)(this,"dbSync",kC,this),(0,z.Z)(this,"nodeManagementFlow",MC,this),ZC.set(this,{writable:!0,value:null}),UC.set(this,{writable:!0,value:null}),(0,$.Z)(this,"simulatedPatches",[])}rollbackAll(e){if(!this.simulatedPatches.length)return;const t=[];for(;this.simulatedPatches.length;){const e=this.simulatedPatches.pop();e&&t.push(...e.map(V.Y7).reverse())}(0,V.z9)(e,t)}rollback(e){this.rollbackAll(e||this.projectDoc)}forceDropStateRecompute(){this.pointerInteractionManagementFlow.forcefullyRecomputeMove()}createFutureContainerIndicator(e,t,o,n,i){var r;const s=document.createElement("div"),a=e.getBoundingClientRect(),l=null===t||void 0===t?void 0:t.getBoundingClientRect(),c="horizontal"===o?3*Ki.Dd:Ki.Dd,d="vertical"===o?3*Ki.Dd:Ki.Dd,p=this.projectUIState.stage.webComp.controlValues.scale,u=(0,mt.AO)(e),h={padding:`${Ki.N_.UNIT}`,display:"flex",flexDirection:"horizontal"===o?"row":"column",alignItems:"center",justifyContent:"before"===n?"flex-start":"flex-end",position:"absolute",top:(a.top-d-((null===l||void 0===l?void 0:l.top)||0))*u+"px",left:(a.left-c-((null===l||void 0===l?void 0:l.left)||0))*u+"px",width:(a.width+2*c)*u+"px",height:(a.height+2*d)*u+"px",border:i?(p<1?4:3)+"px solid rgba(0,0,0,0.2)":"",pointerEvents:"none"};return Object.assign(s.style,h),(0,Gi.Z)(this,UC,s),null===(r=e.parentElement)||void 0===r||r.appendChild(s),s}createEdgeIndicator(e){var t;const o=this.projectUIState.stage.webComp.controlValues.scale,n=o<1?"4px":o<3?"3px":"2px",i=null===(t=this.projectUIState.drag.draggedEntity)||void 0===t?void 0:t.content.meta,r="horizontal"===e?(null===i||void 0===i?void 0:i.height)||50:(null===i||void 0===i?void 0:i.width)||50,s=document.createElement("div"),a={width:"vertical"===e?`${r}px`:n,minWidth:n,margin:`${"vertical"===e?Ki.iY.HALF_UNIT/2+"px":0} ${"horizontal"===e?Ki.iY.HALF_UNIT/2+"px":0}`,height:"horizontal"===e?`${r}px`:n,minHeight:n,maxHeight:"100%",maxWidth:"100%",backgroundColor:"#0074f0",borderRadius:"4px",pointerEvents:"none"};return Object.assign(s.style,a),(0,Gi.Z)(this,ZC,s),s}createContainerDropIndicator(e){this.disposeOfIndicator();const{childAnchoringDrop:t,acceptedDropTarget:o,dropIsDisabled:n,dropOutsideTarget:i,newWrapperFlexDirection:r,containerType:s}=e;if(n||!t)return;let a=(null===i||void 0===i?void 0:i.uidlNode)||(null===o||void 0===o?void 0:o.uidlNode);var l;"slot"===s&&(a=this.projectDoc.nodes.byId[(null===(l=a)||void 0===l?void 0:l.parentId)||""]);if(!a)return;const{styles:c,inheritedStyles:d,classesStyles:p}=this.nodeStyleManagementFlow.getComputedStyleByKeyForCurrentBreakpoint(a.id,["flexDirection"]),u=c.flexDirection||d.flexDirection||p.flexDirection,{edge:h}=t.edgeData,m=this.elementRefProvider.getDomTargetNode(t.uidlNode.id),g=null===m||void 0===m?void 0:m.parentElement;if(!m||!g)return;const y=this.nodeManagementFlow.getFirstPositionedParentOfNode(t.uidlNode.id),f=("flexContainer"===s||"slot"===s)&&"parent"!==r;if("left"===h||"right"===h){const e=this.createEdgeIndicator("horizontal"),o="left"===h?m:m.nextSibling;if("column"!==u)return o?void g.insertBefore(e,o):void g.appendChild(e);return void this.createFutureContainerIndicator(t.uidlNode.primitiveType===dt.sO.COMPONENT?t.domNode:m,y.parentElement,"horizontal","left"===h?"before":"after",f).appendChild(e)}const b=this.createEdgeIndicator("vertical"),w="top"===h?m:m.nextSibling;if("column"===u||"list"===s)return w?void g.insertBefore(b,w):void g.appendChild(b);this.createFutureContainerIndicator(t.uidlNode.primitiveType===dt.sO.COMPONENT?t.domNode:m,y.parentElement,"vertical","top"===h?"before":"after",f).appendChild(b)}shouldSimulateDrop(e,t){if(!t)return!0;if((null===e||void 0===e?void 0:e.type)!==Fs.Z.SUB_HIERARCHY||e.content.isNew)return!1;if(this.projectUIState.userInteractions.pressedKeys.alt)return!1;const{childAnchoringDrop:o}=t;if(!o)return!1;if(t.newWrapperFlexDirection&&"parent"!==t.newWrapperFlexDirection)return!1;const n=e.content.subHierarchy.map((e=>e.id));return!!this.projectDoc.nodes.areNodesSiblings([...n,o.uidlNode.id])}disposeOfIndicator(){var e,t;null===(e=(0,$i.Z)(this,ZC))||void 0===e||e.remove(),null===(t=(0,$i.Z)(this,UC))||void 0===t||t.remove()}simulateDrop(e){const{containerDropFlowState:t,containerType:o}=e;let n=this.shouldSimulateDrop(this.projectUIState.drag.draggedEntity,t);if(!n)return this.createContainerDropIndicator(LC(LC({},t),{},{containerType:o})),n;this.rollback();const i=(0,V.JG)(this.projectDoc,(e=>{n=this.pointerInteractionManagementFlow.handleVirtualDrop({doc:e})}));return i&&i.length&&this.simulatedPatches.push(i),!t||null!==i&&void 0!==i&&i.length||n?this.disposeOfIndicator():this.createContainerDropIndicator(LC(LC({},t),{},{containerType:o})),n}},NC=(0,G.Z)(TC.prototype,"projectDoc",[wC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EC=(0,G.Z)(TC.prototype,"projectUIState",[vC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CC=(0,G.Z)(TC.prototype,"pointerInteractionManagementFlow",[IC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xC=(0,G.Z)(TC.prototype,"nodeStyleManagementFlow",[SC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PC=(0,G.Z)(TC.prototype,"elementRefProvider",[jC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kC=(0,G.Z)(TC.prototype,"dbSync",[DC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),MC=(0,G.Z)(TC.prototype,"nodeManagementFlow",[OC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FC=TC));var _C,RC,BC,HC,zC,$C,GC,VC,JC,WC,KC,YC;_C=(0,J.JJ)("dropSimulatorWatcher"),RC=(0,J.f3)("projectUIState"),BC=(0,J.f3)("projectDoc"),HC=(0,J.f3)("dropSimulatorFlow"),_C((WC=new WeakMap,KC=new WeakMap,YC=new WeakMap,$C=class{constructor(){(0,z.Z)(this,"projectUIState",GC,this),(0,z.Z)(this,"projectDoc",VC,this),(0,z.Z)(this,"dropSimulatorFlow",JC,this),WC.set(this,{writable:!0,value:[]}),KC.set(this,{writable:!0,value:[]}),YC.set(this,{writable:!0,value:null})}handleDropFlowStateUpdate(e,t){(0,$i.Z)(this,YC)&&clearTimeout((0,$i.Z)(this,YC)),(0,Gi.Z)(this,YC,setTimeout((()=>{this.dropSimulatorFlow.simulateDrop({containerDropFlowState:e,containerType:t})}),ts.zc.STAGE))}subscribeForIndicatorChanges(){const e=(0,V.Ys)(this.projectUIState,["dropFlowStates/tokenCategory/**"],(()=>{(0,$i.Z)(this,YC)&&clearTimeout((0,$i.Z)(this,YC)),(0,Gi.Z)(this,YC,setTimeout((()=>{this.dropSimulatorFlow.simulateDrop({})}),ts.zc.OTHER))}),"DropSimulator2");(0,$i.Z)(this,KC).push((()=>e.dispose()));const t=(0,V.Ys)(this.projectUIState,["dropFlowStates/flexContainer/**"],(({dropFlowStates:e})=>{this.handleDropFlowStateUpdate(e.flexContainer,"flexContainer")}),"DropSimulator3");(0,$i.Z)(this,KC).push((()=>t.dispose()));const o=(0,V.Ys)(this.projectUIState,["dropFlowStates/blockInlineContainer/**"],(({dropFlowStates:e})=>{this.handleDropFlowStateUpdate(e.blockInlineContainer,"blockInlineContainer")}),"DropSimulator4");(0,$i.Z)(this,KC).push((()=>o.dispose()));const n=(0,V.Ys)(this.projectUIState,["dropFlowStates/unknownContainer/**"],(({dropFlowStates:e})=>{this.handleDropFlowStateUpdate(e.unknownContainer,"unknownContainer")}),"DropSimulator5");(0,$i.Z)(this,KC).push((()=>n.dispose()));const i=(0,V.Ys)(this.projectUIState,["dropFlowStates/slot/**"],(({dropFlowStates:e})=>{this.handleDropFlowStateUpdate(e.slot,"slot")}),"DropSimulatorSlot");(0,$i.Z)(this,KC).push((()=>i.dispose()));const r=(0,V.Ys)(this.projectUIState,["userInteractions/pressedKeys/ctrl"],(()=>this.dropSimulatorFlow.forceDropStateRecompute()),"DropSimulatorCtrl");(0,$i.Z)(this,KC).push((()=>r.dispose()));const s=(0,V.Ys)(this.projectUIState,["dropFlowStates/button/**"],(({dropFlowStates:e})=>{this.handleDropFlowStateUpdate(e.button,"button")}),"DropSimulator6");(0,$i.Z)(this,KC).push((()=>s.dispose()));const a=(0,V.Ys)(this.projectUIState,["dropFlowStates/list/**"],(({dropFlowStates:e})=>{this.handleDropFlowStateUpdate(e.list,"list")}),"DropSimulator7");(0,$i.Z)(this,KC).push((()=>a.dispose()))}unsubscribeFromIndicatorChanges(){(0,$i.Z)(this,YC)&&clearTimeout((0,$i.Z)(this,YC)),(0,$i.Z)(this,KC).forEach((e=>e())),(0,Gi.Z)(this,KC,[])}listenForUpdates(){const e=(0,V.Ys)(this.projectUIState,["drag/draggedEntity"],(e=>{e.drag.draggedEntity?this.subscribeForIndicatorChanges():this.unsubscribeFromIndicatorChanges()}),"DropSimulatorSubManager");(0,$i.Z)(this,WC).push((()=>e.dispose()))}stopListeningForUpdates(){this.unsubscribeFromIndicatorChanges(),(0,$i.Z)(this,WC).forEach((e=>e())),(0,Gi.Z)(this,WC,[])}},GC=(0,G.Z)($C.prototype,"projectUIState",[RC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VC=(0,G.Z)($C.prototype,"projectDoc",[BC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),JC=(0,G.Z)($C.prototype,"dropSimulatorFlow",[HC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zC=$C));var XC,qC,QC,ex,tx,ox,nx,ix,rx,sx,ax,lx,cx,dx,px,ux,hx,mx,gx,yx,fx,bx,wx,vx,Ix,Sx,jx,Dx,Ox,Fx,Tx,Nx,Ex,Cx;XC=(0,J.JJ)("asyncWatcherService"),qC=(0,J.f3)("projectDoc"),QC=(0,J.f3)("projectUIState"),ex=(0,J.f3)("nodeSelectionFlow"),tx=(0,J.f3)("componentManagementFlow"),ox=(0,J.f3)("pageManagementFlow"),nx=(0,J.f3)("notificationsManagementFlow"),ix=(0,J.f3)("globalAppState"),rx=(0,J.f3)("projectChangesFlow"),sx=(0,J.f3)("rtcFlow"),ax=(0,J.f3)("webRTCState"),lx=(0,J.f3)("collaboratorManagementFlow"),cx=(0,J.f3)("bundlerService"),dx=(0,J.f3)("conflictManagementFlow"),px=(0,J.f3)("projectFilesFlow"),ux=(0,J.f3)("navbarFlow"),XC((Cx=new WeakMap,mx=class{constructor(){(0,z.Z)(this,"projectDoc",gx,this),(0,z.Z)(this,"projectUIState",yx,this),(0,z.Z)(this,"nodeSelectionFlow",fx,this),(0,z.Z)(this,"componentManagementFlow",bx,this),(0,z.Z)(this,"pageManagementFlow",wx,this),(0,z.Z)(this,"notificationsManagementFlow",vx,this),(0,z.Z)(this,"globalAppState",Ix,this),(0,z.Z)(this,"projectChangesFlow",Sx,this),(0,z.Z)(this,"rtcFlow",jx,this),(0,z.Z)(this,"webRTCState",Dx,this),(0,z.Z)(this,"collaboratorManagementFlow",Ox,this),(0,z.Z)(this,"bundlerService",Fx,this),(0,z.Z)(this,"conflictManagementFlow",Tx,this),(0,z.Z)(this,"projectFilesFlow",Nx,this),(0,z.Z)(this,"navbarFlow",Ex,this),Cx.set(this,{writable:!0,value:[]})}listenForUpdates(){const e=(0,V.Ys)(this.projectDoc,["nodes/byId/*"],((e,t)=>{t.forEach((t=>{const{pathArray:o,op:n,value:i,old:r}=t;if(3===o.length&&"remove"===n&&!i){const t=Object.keys(this.projectUIState.selection.nodes||{});1===t.length&&o[2]===t[0]&&(this.nodeSelectionFlow.resetNodeSelection(),e.nodes.byId[r.parentId||""]&&this.nodeSelectionFlow.setNodeSelection({nodeId:r.parentId}))}}))}),"AsyncWatcherService1"),t=(0,V.Ys)(this.projectDoc,["components/byId/*"],((e,t)=>{t.forEach((e=>{const{op:t,pathArray:o}=e;"remove"===t&&3===o.length&&"components"===o[0]&&"byId"===o[1]&&this.componentManagementFlow.updateUIAfterCompDeletion(o[2])}))}),"AsyncWatcherService2"),o=(0,V.Ys)(this.projectDoc,["pages/byId/*"],((e,t)=>{t.forEach((e=>{const{op:t,pathArray:o}=e;"remove"===t&&3===o.length&&"pages"===o[0]&&"byId"===o[1]&&this.pageManagementFlow.updateUIAfterPageDeletion(o[2])}))}),"AsyncWatcherService3"),n=(0,V.Ys)(this.projectUIState,["selection/componentId"],(({selection:e})=>{this.rtcFlow.notifySelectedComp(e.componentId)}),"AsyncComponentSelectionWatcher"),i=(0,V.Ys)(this.projectUIState,["selection/nodes/*","selection/nodes"],(({selection:e})=>{this.rtcFlow.notifySelectedNodes(Object.keys(e.nodes)),this.webRTCState.followedUserId&&Object.keys(e.nodes).length>0&&this.collaboratorManagementFlow.resetFollowedUserId()}),"AsyncNodeSelectionWatcher"),r=(0,V.Ys)(this.projectDoc,["projectFiles/lastSync","projectFiles/lastSync/*"],(()=>{this.bundlerService.hardRefresh()}),"AsyncProjectFilesSyncWatcher"),s=(0,V.Ys)(this.projectDoc,["projectFiles/conflicts/*"],(e=>{if(this.projectUIState.devMode.githubOperationInProgress)return;const t=this.projectUIState.devMode.selectedBranch,{conflictModalOpened:o}=this.projectUIState.devMode;e.projectFiles.conflicts[t]?this.conflictManagementFlow.openConflictModal():o&&this.conflictManagementFlow.closeConflictModal()}),"AsyncConflictsWatcher"),a=(0,V.Ys)(this.projectDoc,["projectFiles/local/*/byId/*"],(e=>{var t;const o=this.projectUIState.devMode.selectedBranch,n=this.projectUIState.devMode.selectedFile,i=this.projectUIState.devMode.githubBranches.underRename;if(!(!n||i||null!==(t=e.projectFiles.local[o])&&void 0!==t&&t.byId)&&!e.projectFiles.local[o].byId[n]){var r;const e=(null===(r=this.navbarFlow.getTabByEntityId(n))||void 0===r?void 0:r.id)||"";this.navbarFlow.deleteTab(e),this.projectFilesFlow.selectNextAvailableFile({fileToStartFrom:n})}}),"AsyncProjectFilesWatcher");(0,$i.Z)(this,Cx).push((()=>e.dispose()),(()=>t.dispose()),(()=>o.dispose()),(()=>n.dispose()),(()=>i.dispose()),(()=>r.dispose()),(()=>s.dispose()),(()=>a.dispose()))}stopListeningForUpdates(){(0,$i.Z)(this,Cx).forEach((e=>e()))}},gx=(0,G.Z)(mx.prototype,"projectDoc",[qC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yx=(0,G.Z)(mx.prototype,"projectUIState",[QC],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fx=(0,G.Z)(mx.prototype,"nodeSelectionFlow",[ex],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bx=(0,G.Z)(mx.prototype,"componentManagementFlow",[tx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wx=(0,G.Z)(mx.prototype,"pageManagementFlow",[ox],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vx=(0,G.Z)(mx.prototype,"notificationsManagementFlow",[nx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ix=(0,G.Z)(mx.prototype,"globalAppState",[ix],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sx=(0,G.Z)(mx.prototype,"projectChangesFlow",[rx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jx=(0,G.Z)(mx.prototype,"rtcFlow",[sx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dx=(0,G.Z)(mx.prototype,"webRTCState",[ax],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ox=(0,G.Z)(mx.prototype,"collaboratorManagementFlow",[lx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fx=(0,G.Z)(mx.prototype,"bundlerService",[cx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tx=(0,G.Z)(mx.prototype,"conflictManagementFlow",[dx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nx=(0,G.Z)(mx.prototype,"projectFilesFlow",[px],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ex=(0,G.Z)(mx.prototype,"navbarFlow",[ux],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hx=mx));o(73239),o(95253),o(42051),o(96062),o(56933),o(17535);var xx=o(52395);const Px=(e,t)=>{const o={},{files:n,subFolders:i}=e;try{n.forEach((e=>{let n="";try{n="base64"===e.contentEncoding?decodeURIComponent(window.atob(e.content)):e.content}catch(r){n="base64"===e.contentEncoding?window.atob(e.content):e.content}const i=`${t?`${t}/`:""}${e.name}.${e.fileType}`;o[i]=n})),i.forEach((e=>{Object.assign(o,Px(e,t?`${t}/${e.name}`:e.name))}))}catch(r){console.error(`Could not flat github files structure: ${r}`)}return o};var kx,Mx,Zx,Ux,Ax;function Lx(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function _x(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?Lx(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):Lx(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}kx=(0,J.JJ)("githubRepository"),Mx=(0,J.f3)("requestMaker"),kx((Ux=class{constructor(){(0,z.Z)(this,"requestMaker",Ax,this),(0,$.Z)(this,"basePath","/github")}async checkIfUserHasAccessToRepo(e,t,o){try{return(await this.requestMaker.makeRequest({method:xx.x.GET,path:`${this.basePath}/repo/exists/${e}/${o}${t?"/"+t:""}`})).hasAccess}catch(n){if(-1!==(null===n||void 0===n?void 0:n.message.toLowerCase().indexOf("bad credentials")))throw new ro("GitHub credentials are expired or you do not have enough permissions");throw new Error(`Could not check if user has access to repository: ${n}`)}}async getRepoContent(e,t){const{ref:o,repository:n,owner:i}=t;try{const t=await this.requestMaker.makeRequest({method:xx.x.GET,path:`${this.basePath}/content/${e}/${i}/${n}/${o}`});return Px(t)}catch(r){throw new Error(`Could not get repository content: ${r}`)}}async getCommits(e,t){return(await this.requestMaker.makeRequest({method:xx.x.POST,path:`${this.basePath}/commits/${e}`,payload:JSON.stringify(t)})).map((e=>{var t,o,n,i;return{author:{name:null===(t=e.commit)||void 0===t||null===(o=t.author)||void 0===o?void 0:o.name,image:null===(n=e.author)||void 0===n?void 0:n.avatar_url},message:null===(i=e.commit)||void 0===i?void 0:i.message,sha:e.sha}}))}async getCommitDetails(e,t){try{return await this.requestMaker.makeRequest({method:xx.x.POST,path:`${this.basePath}/commits/details/${e}`,payload:JSON.stringify(t)})}catch(o){throw new Error(`Could not get commit details: ${o}`)}}async createBranch(e,t){try{return await this.requestMaker.makeRequest({method:xx.x.POST,path:`${this.basePath}/branch/${e}`,payload:JSON.stringify(t)})}catch(o){throw new Error(`Could not create new github branch: ${o}`)}}async mergeBranches(e,t){try{return await this.requestMaker.makeRequest({method:xx.x.PUT,path:`${this.basePath}/merge/${e}`,payload:JSON.stringify(t)})}catch(o){throw o}}async compareBranches(e,t){try{return await this.requestMaker.makeRequest({method:xx.x.POST,path:`${this.basePath}/branch/compare/${e}`,payload:JSON.stringify(t)})}catch(o){throw o}}async deleteBranch(e,t){try{return await this.requestMaker.makeRequest({method:xx.x.DELETE,path:`${this.basePath}/branch/${e}`,payload:JSON.stringify(t)})}catch(o){throw new Error(`Could not delete github branch: ${o}`)}}async getBranches(e,t,o){return await this.requestMaker.makeRequest({method:xx.x.GET,path:`${this.basePath}/branches/${e}/${t}/${o}`})}async deploy(e,t,o){const{repository:n,commitBranch:i,extraBranchParents:r=[],commitMessage:s,isPrivate:a,repositoryOwner:l}=o,c=_x(_x({},l?{repositoryOwner:l}:{}),{},{projectFolder:t,repository:n,extraBranchParents:r,isPrivate:a||!1,mainBranch:Qt.cY,commitBranch:i||Qt.cY,commitMessage:s||"Commit from TeleportHQ"});try{return await this.requestMaker.makeRequest({method:xx.x.POST,path:`${this.basePath}/${e}`,payload:JSON.stringify(c)})}catch(d){throw new Error("Could not publish project to GitHub. Please try again.")}}},Ax=(0,G.Z)(Ux.prototype,"requestMaker",[Mx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zx=Ux));o(64804);var Rx,Bx,Hx=o(44813);function zx(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function $x(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?zx(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):zx(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}(0,J.JJ)("transpilerService")((Bx=new WeakMap,Rx=class{constructor(){Bx.set(this,{writable:!0,value:void 0})}async load(){if(!(0,$i.Z)(this,Bx))try{const e=await o.e(54996).then(o.bind(o,54996)).then((e=>e));return await e.default(),(0,Gi.Z)(this,Bx,e.transformSync),(0,$i.Z)(this,Bx)}catch(e){throw new Error("Failed to load js-compiler")}return(0,$i.Z)(this,Bx)}async parseImports(e){await Hx.S;const[t]=(0,Hx.Q)(e);return t}async transpile(e,t){try{const o=await this.load();return e?o(e,{jsc:{target:"es2016",parser:t===et.Tv.TS||t===et.Tv.TSX?$x($x({syntax:"typescript"},t===et.Tv.TSX&&{tsx:!0}),{},{dynamicImport:!1,decorators:!1}):{syntax:"ecmascript",jsx:!0,dynamicImport:!1,numericSeparator:!1,privateMethod:!0,functionBind:!1,exportDefaultFrom:!1,exportNamespaceFrom:!1,decorators:!1,decoratorsBeforeExport:!1,topLevelAwait:!1,importMeta:!1}}}).code:""}catch(o){throw console.error(o),o}}}));var Gx;o(71115),o(70257);(0,J.JJ)("fileDownloadService")(Gx=class{constructor(){(0,$.Z)(this,"fileSaver",null)}async init(){this.fileSaver=(await o.e(93162).then(o.t.bind(o,93162,23))).default}async promptDownload(e,t){this.fileSaver||await this.init(),this.fileSaver.saveAs(e,t)}});var Vx,Jx,Wx,Kx,Yx,Xx,qx;Vx=(0,J.JJ)("assetsService"),Jx=(0,J.f3)("projectDoc"),Wx=(0,J.f3)("sentryService"),Vx((Yx=class{constructor(){(0,z.Z)(this,"projectDoc",Xx,this),(0,z.Z)(this,"sentryService",qx,this)}async downloadAssets(e,t={}){const o=e.map((e=>this.getAssetData(e,t)));return(await Promise.all(o)).filter((e=>e))}async fetchImageFromUrlAsBlob(e){return await fetch(e,{headers:{accept:"image/avif,image/webp,image/apng,image/*,*/*;q=0.8"}}).then((e=>e.blob()))}async createOptimisedAssets(e){const t=[];e.forEach((e=>{if(e.type!==we.K.IMAGE)return void t.push(e);const o=e.name.split(".");if(o.length<2)throw new Error(`There is an asset without an extension: ${e.name}`);if(e.skipOptimisations||-1!==pt.ou.a.indexOf(o[o.length-1])){const o={name:e.name,type:e.type,bucket:e.bucket,mimetype:e.mimetype,usedInNodes:e.usedInNodes,usedInClasses:e.usedInClasses,path:e.path,id:e.id,size:"w="+3*Bh.Cg,parentFolderId:e.parentFolderId};return void t.push(new Yp.G(o))}const{sizePerComponent:n}=e;n&&Object.keys(n).forEach((i=>{const r=n[i].split("="),s=[...o];s[s.length-2]=`${s[s.length-2]}-${r[1]}${r[0]}`;const a=s.join(".");for(let o=0;o<t.length;o++)if(t[o].size===n[i]&&t[o].name===a)return void Object.keys(e.usedInNodes).forEach((e=>{this.projectDoc.getComponentIdForNode(e)===i&&(t[o].usedInNodes[e]=!0)}));const l={};Object.keys(e.usedInNodes).forEach((e=>{this.projectDoc.getComponentIdForNode(e)===i&&(l[e]=!0)}));const c={name:a,type:e.type,bucket:e.bucket,mimetype:e.mimetype,usedInNodes:l,usedInClasses:e.usedInClasses,path:e.path,id:e.id,size:n[i],parentFolderId:e.parentFolderId};t.push(new Yp.G(c))}))}));const o=[];return t.forEach((e=>{e.name=(0,W._x)(o,e.name),o.push(e.name)})),t}computeImageUrl(e){const t=e.size||this.computeAssetSize(e);return(0,mt.zo)(e,`&${t}`)}computeAssetSize(e){let t=100,o=100;if(!Object.keys(e.usedInNodes).length)return`w=${t}`;Object.keys(e.usedInNodes).forEach((e=>{const n=this.projectDoc.estimateNodeDimensionInPxByStyle("width",e),i=this.projectDoc.estimateNodeDimensionInPxByStyle("height",e);t=n>t?n:t,o=i>o?i:o}));const n=pt.ou.I1;return o=Math.ceil(o/n)*n,t=Math.ceil(t/n)*n,t>o?`w=${t}`:`h=${o}`}async getAssetData(e,t){const o=this.computeImageUrl(e);if(t.skipDownload)return{content:o,name:e.name,location:"remote"};try{const t=await fetch(o,{headers:{accept:"image/avif,image/webp,image/apng,image/*,*/*;q=0.8"}}),n=await t.blob(),i=await this.blobToBase64(n);return{name:e.name,content:i,contentEncoding:"base64"}}catch(n){n.message=`Asset ${e.name} failed to download: ${n.message}`,this.sentryService.captureException(n)}}async blobToBase64(e){return new Promise(((t,o)=>{const n=new FileReader;n.readAsDataURL(e),n.onerror=o,n.onloadend=()=>{const e=n.result;if(!e)return t("");if("string"===typeof e||e instanceof String)return t(e.split(",")[1]);const o=new TextDecoder("base64").decode(e);t(o)}}))}},Xx=(0,G.Z)(Yx.prototype,"projectDoc",[Jx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qx=(0,G.Z)(Yx.prototype,"sentryService",[Wx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kx=Yx));o(75351),o(72536);var Qx,eP,tP=o(54375);(0,J.JJ)("packerService")((eP=new WeakMap,Qx=class{constructor(){eP.set(this,{writable:!0,value:null})}loadWorker(){return(0,$i.Z)(this,eP)||(0,Gi.Z)(this,eP,(0,tP.Ud)(new Worker(new URL(o.p+o.u(35786),o.b),{type:void 0}))),(0,$i.Z)(this,eP)}async generateComponentCode(e,t){return this.loadWorker().generateComponentCode(e,t)}async generateReactComponent(e,t,o){return this.loadWorker().generateReactComponent(e,t,o)}async generateGlobalsComponent(e,t){return this.loadWorker().generateGlobalsComponent(e,t)}async generateProjectStyleSheet(e){return this.loadWorker().generateProjectStyleSheet(e)}async packAndPublish(e){return this.loadWorker().packAndPublish(JSON.parse(JSON.stringify(e)))}async generateCustomCodeProject(e){return this.loadWorker().generateCustomCodeProject(JSON.parse(JSON.stringify(e)))}}));var oP,nP,iP,rP,sP,aP,lP,cP,dP;o(5871),o(65170);oP=(0,J.JJ)("userPermissionGuardService"),nP=(0,J.f3)("projectUIState"),iP=(0,J.f3)("projectDoc"),rP=(0,J.f3)("studioAPIService"),oP((aP=class{constructor(){(0,z.Z)(this,"projectUIState",lP,this),(0,z.Z)(this,"projectDoc",cP,this),(0,z.Z)(this,"studioAPI",dP,this),(0,$.Z)(this,"operationsDisabled",!1),(0,$.Z)(this,"guardReadOnlyProject",(()=>{this.projectUIState.readonly&&((0,V.JG)(this.projectUIState,(({layout:e})=>{e.sidebarPanel=Y.tI.FILES,e.visibleInspector=Y.dG.DEV})),this.disableWriteOperations(),this.disableButtons())})),(0,$.Z)(this,"guardReadOnlyDevProject",(()=>{if(!this.projectUIState.readonly)return;const{elements:e}=this.studioAPI;e&&(e.dev.search&&(e.dev.search.disabled=!0),e.dev.sourceControl&&(e.dev.sourceControl.disabled=!0),e.dev.syncProject&&(e.dev.syncProject.disabled=!0),e.dev.upload&&(e.dev.upload.disabled=!0,e.dev.upload.onclick=e=>{e.preventDefault(),e.stopPropagation()}),e.dev.prettify&&(e.dev.prettify.disabled=!0),e.dev.options&&(e.dev.options.disabled=!0),e.dev.externalDependency&&(e.dev.externalDependency.disabled=!0,e.dev.externalDependency.onclick=e=>{e.preventDefault(),e.stopPropagation()}))}))}disableWriteOperations(){if(this.operationsDisabled)return;Object.values(te.l).forEach((e=>this.studioAPI.attachHook(e,{onStart:()=>!1}))),this.operationsDisabled=!0}disableButtons(){const{elements:e}=this.studioAPI;if(!e)return;e.sidebar.elements.disabled=!0,e.sidebar.assetsManager.disabled=!0,e.sidebar.cssClasses.disabled=!0,e.header.publish.disabled=!0,e.header.exportProject.disabled=!0,e.header.projectSettings.disabled=!0,e.header.projectSettings.href="/",e.header.projectSettings.style.color=Ki.bo.INACTIVE,e.header.projectSettings.onclick=e=>{e.preventDefault(),e.stopPropagation()};e.header.exportProject.children[0].onclick=e=>{e.preventDefault(),e.stopPropagation()}}},lP=(0,G.Z)(aP.prototype,"projectUIState",[nP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cP=(0,G.Z)(aP.prototype,"projectDoc",[iP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dP=(0,G.Z)(aP.prototype,"studioAPI",[rP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sP=aP));var pP,uP,hP,mP,gP,yP,fP,bP,wP,vP,IP,SP,jP,DP,OP,FP,TP,NP,EP,CP=o(97197);function xP(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function PP(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?xP(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):xP(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}let kP;!function(e){e.LOADED="loaded",e.BUILDING="building",e.FAILED="failed",e.RUNNING="running",e.SUCCESS="success",e.TRANSFORM_FAILED="transform-failed"}(kP||(kP={}));pP=(0,J.JJ)("bundlerService"),uP=(0,J.f3)("projectUIState"),hP=(0,J.f3)("projectDoc"),mP=(0,J.f3)("projectDownloadFlow"),gP=(0,J.f3)("assetsManagementFlow"),yP=(0,J.f3)("projectFilesFlow"),fP=(0,J.f3)("codeEditorFlow"),bP=(0,J.f3)("transpilerService"),wP=(0,J.f3)("sharedbProjectSyncService"),pP((IP=class{constructor(){(0,z.Z)(this,"projectUIState",SP,this),(0,z.Z)(this,"projectDoc",jP,this),(0,z.Z)(this,"projectDownloadFlow",DP,this),(0,z.Z)(this,"assetsManagementFlow",OP,this),(0,z.Z)(this,"projectFilesFlow",FP,this),(0,z.Z)(this,"codeEditorFlow",TP,this),(0,z.Z)(this,"transpiler",NP,this),(0,z.Z)(this,"dbSync",EP,this),(0,$.Z)(this,"frames",new Map),(0,$.Z)(this,"sendAssetMapping",(e=>{this.send({type:"asset-mapping",message:e})})),(0,$.Z)(this,"sendFiles",(async e=>{const t=await this.processFiles(e);this.send({type:"add-files",message:{files:t,entry:Qt.qG}})})),(0,$.Z)(this,"updateFile",(async(e,t)=>{this.send({type:"file-update",message:{fileName:e,content:(await this.processFile(e,t)).content}})})),(0,$.Z)(this,"deleteFile",(e=>{this.send({type:"file-delete",message:{fileName:e}})})),(0,$.Z)(this,"createFile",(e=>{this.send({type:"file-create",message:{fileName:e}})})),(0,$.Z)(this,"renameFile",(async(e,t,o)=>{this.send({type:"file-rename",message:{oldFileName:e,file:{name:t,content:(await this.processFile(t,o)).content}}})})),(0,$.Z)(this,"refresh",(async e=>{const t=this.projectUIState.devMode.selectedBranch,o=this.projectDoc.projectFiles.flatFiles({assets:this.projectDoc.assets.getAssetsForCustomCode(),branch:t}),n={type:"add-files",message:{files:await this.processFiles(o),entry:Qt.qG}},i={event:"shutdown"};e?(this.sendToFrame(i,e),this.sendToFrame(n,e)):(this.send(i),this.send(n))})),(0,$.Z)(this,"sendToFrame",((e,t)=>{var o,n,i;null===(o=this.frames.get(t))||void 0===o||null===(n=o.frame)||void 0===n||null===(i=n.contentWindow)||void 0===i||i.postMessage(PP(PP({},e),{},{identifier:t}),"*")})),(0,$.Z)(this,"addExternalDependency",(e=>{this.dbSync.mutate(this.projectDoc,(({projectFiles:e})=>{e.isAddingExternalDependency=Wm.B.ADDING})),this.send({type:"add-dependency",message:e})})),(0,$.Z)(this,"unMountFrame",(e=>{this.frames.delete(e)})),(0,$.Z)(this,"unMountAllFrames",(()=>this.frames=new Map)),(0,$.Z)(this,"send",(e=>{for(const[t]of this.frames)this.sendToFrame(e,t)})),(0,$.Z)(this,"processFiles",(async e=>(await Promise.all(Object.keys(e).map((t=>this.processFile(t,e[t]))))).reduce(((e,t)=>(e[t.fileName]=t.content,e)),{}))),(0,$.Z)(this,"processFile",(async(e,t)=>{await this.transpiler.load();try{const o=(0,at.extname)(e).substring(1);return(0,gf.YP)(o)?{fileName:e,content:await this.transpiler.transpile(t,o)}:{fileName:e,content:t}}catch(o){throw this.send({type:"file-error",message:`${e} \n e`}),o}})),(0,$.Z)(this,"loadExports",(e=>{this.send({type:"load-exports",message:{depName:e}})})),(0,$.Z)(this,"listener",(async e=>{const{data:t}=e,{type:n,message:i,identifier:r}=t;if(null!==t&&void 0!==t&&t.bundler)switch(n){case"bundler-status":{const{status:e}=i;await this.transpiler.load(),this.codeEditorFlow.handleEditorBundleStatusChange(e),"loaded"===e&&this.refresh(r),"success"===e&&((0,V.JG)(this.projectUIState,(e=>{e.devMode.navigation={}})),await this.projectFilesFlow.generateDevComponents());break}case"url-change":{const{url:e,backward:t,forward:o}=i;(0,V.JG)(this.projectUIState,(n=>{const i={url:new URL(e).pathname,forward:o,backward:t};n.devMode.navigation[r]=i}));break}case"missing-files":this.projectUIState.devMode.bundlerStatus&&this.refresh(r);break;case"console":{const{message:e}=t;if(e){const{Decode:t}=await o.e(95575).then(o.t.bind(o,95575,23));CP.yS.next([...(null===CP.yS||void 0===CP.yS?void 0:CP.yS.value)||[],PP(PP({},t(e[0])),{},{created:Date.now()})])}break}case"package-failed":this.dbSync.mutate(this.projectDoc,(({projectFiles:e})=>{e.isAddingExternalDependency=Wm.B.FAILED})),(0,V.JG)(this.projectUIState,(e=>{e.devMode.packageExports=null}));break;case"importmap-update":{const{message:e}=t;this.projectDoc.projectFiles.isAddingExternalDependency===Wm.B.ADDING&&this.dbSync.mutate(this.projectDoc,(({projectFiles:e})=>e.isAddingExternalDependency=Wm.B.SUCCESS)),this.projectFilesFlow.updateImportMap(e);break}case"package-json":{const{message:e}=t,o=(null===e||void 0===e?void 0:e.packageJSON)||{exports:{}},n=Object.keys(o.exports).map((e=>"."===e?`${o.name}@${o.version}`:`${o.name}@${(0,at.join)(o.version,e)}`));(0,V.JG)(this.projectUIState,(e=>e.devMode.packageExports=n));break}default:0}}))}async registerIFrame(e,t){this.frames.set(t,{frame:e,nav:{}}),this.sendToFrame({type:"handshake",message:{skipTranspile:!0,devTools:!0}},t)}hardRefresh(e){if(e)return this.sendToFrame({type:"hard-refresh"},e),void this.frames.delete(e);this.send({type:"hard-refresh"}),this.frames.clear()}},SP=(0,G.Z)(IP.prototype,"projectUIState",[uP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jP=(0,G.Z)(IP.prototype,"projectDoc",[hP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),DP=(0,G.Z)(IP.prototype,"projectDownloadFlow",[mP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OP=(0,G.Z)(IP.prototype,"assetsManagementFlow",[gP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FP=(0,G.Z)(IP.prototype,"projectFilesFlow",[yP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TP=(0,G.Z)(IP.prototype,"codeEditorFlow",[fP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NP=(0,G.Z)(IP.prototype,"transpiler",[bP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EP=(0,G.Z)(IP.prototype,"dbSync",[wP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vP=IP));var MP;(0,J.JJ)("contentDiffingService")(MP=class{constructor(){(0,$.Z)(this,"diffComputer",void 0)}computeDiff(e="",t=""){if(!this.diffComputer)throw new Error("Diff computer was not loaded");return new(0,this.diffComputer)(e.split("\n"),t.split("\n"),{shouldComputeCharChanges:!0,shouldPostProcessCharChanges:!0,shouldIgnoreTrimWhitespace:!1,shouldMakePrettyDiff:!0,maxComputationTime:5e3}).computeDiff().changes.reduce(((e,t)=>{const{originalStartLineNumber:o,originalEndLineNumber:n,modifiedStartLineNumber:i,modifiedEndLineNumber:r}=t,s=(0,lt.Z)(),a=Math.floor((n+o)/2),l=Math.floor((r+i)/2);return e.baseDiffs[s]={startLine:o,endLine:n,middleLine:a,negativeRange:n<o},e.updatedDiffs[s]={startLine:i,endLine:r,middleLine:l,negativeRange:r<i},e}),{baseDiffs:{},updatedDiffs:{}})}async loadDiffComputer(){if(this.diffComputer)return this.diffComputer;const{DiffComputer:e}=await o.e(86692).then(o.bind(o,86692));return this.diffComputer=e,this.diffComputer}});var ZP,UP=o(94716);const AP="@thq-prop-";(0,J.JJ)("propsDetectionService")(ZP=class{constructor(){(0,$.Z)(this,"parser",void 0)}async detectPropsInContent(e,t){this.parser||await this.loadParser();const o=[...this.parser.defaultHandlers,(e,t,o)=>this.customTypesHandler(e,t,o)],{props:n}=this.parser.parse(e,void 0,o,{filename:t});return Object.keys(n).reduce(((e,t)=>{var o,i,r,s;const a=n[t],l=null===(o=a.defaultValue)||void 0===o?void 0:o.value,c=a.customPropType||(null===(i=a.type)||void 0===i?void 0:i.name)||(null===(r=a.tsType)||void 0===r?void 0:r.type)||(null===(s=a.flowType)||void 0===s?void 0:s.type)||"string";e[t]={type:c,defaultValue:l?JSON.parse(l):""};const{elements:d,name:p}=a.tsType||{};return c===Y.t_.LIST&&"union"===p&&d?(e[t].options=d.map((e=>{let t=e.value;const o=t.startsWith("'")||t.startsWith('"'),n=t.endsWith("'")||t.endsWith('"');return o&&(t=t.substring(1)),n&&(t=t.substring(0,t.length-1)),t})),e):e}),{})}async loadParser(){this.parser=await Promise.all([o.e(20797),o.e(87865),o.e(49989),o.e(31e3),o.e(27439),o.e(37536)]).then(o.bind(o,27439))}customTypesHandler(e,t,o){var n;const{getFlowTypeFromReactComponent:i}=this.parser.utils,r=i(t,o);if(!r)return;const s=r.value.typeName.name,a=this.findPropsInterfaceInAST(t,s),l=null===a||void 0===a||null===(n=a.body)||void 0===n?void 0:n.body;if(null!==l&&void 0!==l&&l.length)for(let d=0;d<l.length;d++){var c;const t=l[d];if(!UP.namedTypes.TSPropertySignature.check(t))continue;const o=t.key.name;if(!o)continue;const n=null===(c=t.leadingComments)||void 0===c?void 0:c.find((e=>{var t,o;return UP.namedTypes.CommentLine.check(e)&&-1!==(null===(t=e.value)||void 0===t||null===(o=t.trim())||void 0===o?void 0:o.indexOf(AP))})),i=this.getCustomTypeFromValue(null===n||void 0===n?void 0:n.value);if(!i)continue;const r=e._props.get(o);r?(r.customPropType=i,e._props.set(o,r)):e._props.set(o,{customPropType:i})}}findPropsInterfaceInAST(e,t){var o;const n="program";if(e.name!==n&&!e.parent)return null;for(;e.name!==n&&e.parent;)e=e.parent;return e.name===n&&null!==(o=e.value)&&void 0!==o&&o.body?e.value.body.find((e=>UP.namedTypes.TSInterfaceDeclaration.check(e)&&e.id.name===t)):null}getCustomTypeFromValue(e){if(!e)return null;const t=e.trim();if(0!==t.indexOf(AP))return null;switch(t.replace(AP,"").toLowerCase()){case"text":return Y.t_.STRING;case"color":return Y.t_.COLOR;case"multiline":return Y.t_.MULTILINE;case"number":return Y.t_.NUMBER;case"bool":return Y.t_.BOOLEAN;case"list":return Y.t_.LIST;default:return null}}});var LP,_P,RP,BP,HP,zP,$P,GP,VP,JP,WP=JSON.parse('{"accent":{"themeValuesKey":["colors"]},"align":{"values":["baseline","top","bottom","middle","text-top","text-bottom","sub","supper"]},"animate":{"themeValuesKey":["animation"]},"aspect":{"themeValuesKey":["aspectRatio"]},"auto-cols":{"values":["auto","min","max","fr"]},"auto-rows":{"values":["auto","min","max","fr"]},"basis":{"themeValuesKey":["flexBasis"]},"backdrop-blur":{"themeValuesKey":["backdropBlur"]},"backdrop-brightness":{"themeValuesKey":["backdropBrightness"]},"backdrop-contrast":{"themeValuesKey":["backdropContrast"]},"backdrop-grayscale":{"themeValuesKey":["backdropGrayscale"]},"backdrop-hue-rotate":{"themeValuesKey":["backdropHueRotate"]},"backdrop-invert":{"themeValuesKey":["backdropInvert"]},"backdrop-opacity":{"themeValuesKey":["backdropOpacity"]},"backdrop-saturate":{"themeValuesKey":["backdropSaturate"]},"backdrop-sepia":{"themeValuesKey":["backdropSepia"]},"blur":{"values":["none","sm","DEFAULT","md","lg","xl","2xl","3xl"]},"bg":{"cssKey":"backgroundColor","themeValuesKey":["backgroundColor","backgroundPosition","backgroundSize","backgroundImage"],"values":["fixed","local","scroll","repeat","no-repeat","repeat-x","repeat-y","round","space","none"]},"bg-clip":{"values":["padding","border","content","text"]},"bg-origin":{"values":["padding","border","content"]},"block":{},"border":{"values":["solid","dashed","dotted","double","hidden","none","collapse","separate"],"themeValuesKey":["borderColor","borderWidth"]},"border-spacing":{"themeValuesKey":["spacing"]},"border-x":{"values":["DEFAULT","0","2","4","8"],"themeValuesKey":["borderColor"]},"border-y":{"values":["DEFAULT","0","2","4","8"],"themeValuesKey":["borderColor"]},"bottom":{"themeValuesKey":["spacing"]},"box-decoration":{"values":["clone, slice"]},"box":{"values":["border","content"]},"brightness":{"themeValuesKey":["brightness"]},"break":{"values":["normal","words","all"]},"break-after":{"values":["auto","avoid","all","avoid-page"]},"break-before":{"values":["auto","avoid","all","avoid-page"]},"break-inside":{"values":["auto","avoid","avoid-page","avoid-column"]},"caret":{"themeValuesKey":["caretColor"]},"clear":{"values":["left","right","both","none"]},"col-span":{"themeValuesKey":["columns"]},"col":{"themeValuesKey":["gridColumn"]},"col-start":{"themeValuesKey":["gridColumnStart"]},"col-end":{"themeValuesKey":["gridColumnEnd"]},"container":{},"content-none":{},"columns":{"themeValuesKey":["columns"]},"content":{"values":["start","end","center","between","around","evenly"]},"contents":{},"contrast":{"themeValuesKey":["contrast"]},"cursor":{"themeValuesKey":["cursor"]},"decoration":{"themeValuesKey":["textDecorationColor"]},"delay":{"themeValuesKey":["transitionDelay"]},"drop-shadow":{"themeValuesKey":["dropShadow"]},"duration":{"themeValuesKey":["transitionDuration"]},"ease":{"themeValuesKey":["transitionTimingFunction"]},"fill":{"themeValuesKey":["fill"]},"float":{"values":["right","left","none"]},"flex":{"values":["DEFAULT","1","auto","initial","none","row","row-reverse","col","col-reverse"]},"flex-wrap":{"values":["DEFAULT","reverse","nowrap"]},"font":{"themeValuesKey":["fontWeight"],"values":["sans","mono","serif"]},"flow-root":{},"gap":{"themeValuesKey":["gap"]},"gap-x":{"themeValuesKey":["gap"]},"gap-y":{"themeValuesKey":["gap"]},"grayscale":{"values":["DEFAULT","0"]},"grid":{},"grid-cols":{"themeValuesKey":["gridTemplateColumns"]},"grid-rows":{"themeValuesKey":["gridTemplateRows"]},"grid-flow":{"values":["row","col","dense","row-dense","col-dense"]},"grow":{"values":["DEFAULT","0"]},"height":{"themeValuesKey":["height"]},"hue-rotate":{"themeValuesKey":["hueRotate"]},"hidden":{},"inline-flex":{},"inline-table":{},"inline-grid":{},"inline":{},"inline-block":{},"inset":{"themeValuesKey":["spacing"]},"inset-x":{"themeValuesKey":["spacing"]},"inset-y":{"themeValuesKey":["spacing"]},"indent":{"themeValuesKey":["textIndent"]},"invert":{"themeValuesKey":["invert"]},"invisible":{},"isolate":{},"isolation-auto":{},"items":{"values":["start","end","center","baseline","stretch"]},"justify":{"values":["start","end","center","between","around","evenly"]},"justify-items":{"values":["start","end","center","stretch"]},"justify-self":{"values":["auto","start","end","center","stretch"]},"leading":{"themeValuesKey":["lineHeight"]},"list":{"values":["none","disc","decimal","outside","inside"]},"list-item":{},"left":{"themeValuesKey":["spacing"]},"m":{"themeValuesKey":["spacing"]},"mt":{"themeValuesKey":["spacing"]},"mb":{"themeValuesKey":["spacing"]},"mr":{"themeValuesKey":["spacing"]},"ml":{"themeValuesKey":["spacing"]},"mx":{"themeValuesKey":["spacing"]},"my":{"themeValuesKey":["spacing"]},"min-w":{"values":["0","full","min","max","fix"]},"max-w":{"values":["0","none","xs","sm","md","lg","xl","2xl","3xl","4xl","full","min","max","fit"]},"min-h":{"values":["0","full","min","max","fit","screen"]},"max-h":{"themeValuesKey":["spacing"]},"object":{"themeValuesKey":["objectPosition"]},"opacity":{"themeValuesKey":["opacity"]},"order":{"themeValuesKey":["order"]},"origin":{"themeValuesKey":["transformOrigin"]},"outline":{"themeValuesKey":["outlineColor"],"values":["DEFAULT","dashed","dotted","double","hidden","none"]},"outline-offset":{"themeValuesKey":["outlineOffset"]},"overflow":{"values":["auto","hidden","clip","visible","scroll","x-auto","y-auto","x-hidden","y-hidden","x-clip","y-clip","x-visible","y-visible","x-scroll","y-scroll"]},"overscroll":{"values":["auto","contain","none","y-auto","y-contain","y-none","x-auto","x-contain","x-none"]},"p":{"themeValuesKey":["spacing"]},"pt":{"themeValuesKey":["spacing"]},"pb":{"themeValuesKey":["spacing"]},"pr":{"themeValuesKey":["spacing"]},"pl":{"themeValuesKey":["spacing"]},"px":{"themeValuesKey":["spacing"]},"py":{"themeValuesKey":["spacing"]},"place-content":{"values":["center","start","end","between","around","evenly","stretch"]},"place-items":{"values":["center","start","end","stretch"]},"place-self":{"values":["auto","center","start","end","stretch"]},"position":{"values":["static","fixed","absolute","relative","sticky"]},"ring":{"themeValuesKey":["ringWidth"]},"rounded":{"themeValuesKey":["borderRadius"]},"rotate":{"themeValuesKey":["rotate"]},"row":{"themeValuesKey":["gridRow"]},"row-start":{"themeValuesKey":["gridRowStart"]},"row-end":{"themeValuesKey":["gridRowEnd"]},"saturate":{"themeValuesKey":["saturate"]},"scale":{"themeValuesKey":["scale"]},"scroll":{"values":["auto","smooth"]},"scroll-m":{"themeValuesKey":["scrollMargin"]},"scroll-mx":{"themeValuesKey":["scrollMargin"]},"scroll-my":{"themeValuesKey":["scrollMargin"]},"scroll-p":{"themeValuesKey":["scrollPadding"]},"scroll-px":{"themeValuesKey":["scrollPadding"]},"scroll-py":{"themeValuesKey":["scrollPadding"]},"select":{"values":["none","all","text","auto"]},"sepia":{"themeValuesKey":["sepia"]},"skew-x":{"themeValuesKey":["skew"]},"skew-y":{"themeValuesKey":["skew"]},"shadow":{"themeValuesKey":["boxShadowColor"],"values":["DEFAULT","sm","md","lg","xl","2xl","inner","none"]},"space-x":{"themeValuesKey":["spacing"]},"space-y":{"themeValuesKey":["spacing"]},"self":{"values":["auto","start","end","center","stretch","baseline"]},"shrink":{"values":["DEFAULT","0"]},"stroke":{"themeValuesKey":["stroke"]},"table":{},"table-caption":{},"table-cell":{},"table-column":{},"table-column-group":{},"table-footer-group":{},"table-row-group":{},"table-row":{},"text":{"themeValuesKey":["fontSize","textColor"],"values":["left","center","right","justify","start","end","ellipsis","clip"]},"top":{"themeValuesKey":["spacing"]},"translate-x":{"themeValuesKey":["translate"]},"translate-y":{"themeValuesKey":["translate"]},"translate":{"themeValuesKey":["translate"]},"tracking":{"themeValuesKey":["letterSpacing"]},"transition":{"themeValuesKey":["transitionProperty"]},"truncate":{},"underline-offset":{"values":["auto","0","1","2","4","8"]},"uppercase":{},"lowercase":{},"capitalize":{},"normal-case":{},"visible":{},"w":{"themeValuesKey":["width"]},"whitespace":{"values":["normal","nowrap","pre","pre-line","pre-wrap"]},"will-change":{"themeValuesKey":["willChange"]},"z":{"themeValuesKey":["zIndex"]}}'),KP=o(72378),YP=o.n(KP),XP=o(8146),qP=o.n(XP),QP=o(86926),ek=o.n(QP);function tk(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function ok(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?tk(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):tk(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}LP=(0,J.JJ)("tailwindService"),_P=(0,J.f3)("projectDoc"),RP=(0,J.f3)("projectUIState"),BP=(0,J.f3)("sentryService"),LP((JP=new WeakMap,zP=class{constructor(){(0,z.Z)(this,"projectDoc",$P,this),(0,z.Z)(this,"projectUIState",GP,this),(0,z.Z)(this,"sentryService",VP,this),JP.set(this,{writable:!0,value:void 0}),(0,$.Z)(this,"getClassesFromTheme",((e,t,o)=>{Object.keys(e).forEach((n=>{const i=e[n];if(qP()(i))this.getClassesFromTheme(i,t,`${o}-${n}`);else if("DEFAULT"===n)t[`${o}`]="";else{if(Array.isArray(i))return void(t[`${o}-${n}`]="");t[`${o}-${n}`]=i}}))}))}loadWorker(){return(0,$i.Z)(this,JP)||(0,Gi.Z)(this,JP,(0,tP.Ud)(new Worker(new URL(o.p+o.u(96537),o.b),{type:void 0}))),(0,$i.Z)(this,JP)}convertStudioTokensToTailwind(e){return this.projectDoc.designLanguage.getCategoriesBySection(e).reduce(((e,t)=>{const o={};return this.projectDoc.designLanguage.getTokensByCategoryId(t.id).forEach((e=>o[e.name]=e.value)),e[t.name]=o,e}),{})}getTailwindConfig(){var e,t;const o=null===(e=this.projectDoc.designLanguage.getTokenWithRole("foreground-color"))||void 0===e?void 0:e.value,n=null===(t=this.projectDoc.designLanguage.getTokenWithRole("background-color"))||void 0===t?void 0:t.value,i=this.convertStudioTokensToTailwind("colors"),r=this.convertStudioTokensToTailwind("layout");return YP()(vf,{theme:{extend:{colors:ok(ok(ok({},i),o&&{foreground:o}),n&&{background:n}),spacing:(null===r||void 0===r?void 0:r.Space)||{},borderRadius:(null===r||void 0===r?void 0:r.Radius)||{},scale:(null===r||void 0===r?void 0:r.Size)||{}}}})}getTailwindClassOptions(e){const t=ek()(ok({},e)).theme,o=WP,n={};return Object.keys(o).forEach((e=>{var i;o[e].values&&(null===(i=o[e].values)||void 0===i||i.forEach((t=>{"DEFAULT"===t?n[`${e}`]="":n[`${e}-${t}`]=""})));const r=o[e].themeValuesKey;null===r||void 0===r||r.forEach((o=>{const i=t[o];this.getClassesFromTheme(i,n,e)})),o[e].values||r||(n[`${e}`]="")})),n}generateTailwindClassOptions(){const e=this.getTailwindConfig(),t=this.getTailwindClassOptions(e);(0,V.JG)(this.projectUIState,(({tailwind:e})=>{e.classOptions=t}))}async handleAutocompleteOptions(e,t,o,n){return await this.loadWorker().handleAutocompleteOptions(e,t,o,n)}async getStyleSheet(e){try{(0,V.JG)(this.projectUIState,(e=>e.tailwind.building=!0));const t=this.getTailwindConfig(),o=await this.loadWorker().getStyleSheet(e,t);return(0,V.JG)(this.projectUIState,(({tailwind:e})=>{e.building=!1})),o}catch(t){return this.sentryService.captureException(t),null}}},$P=(0,G.Z)(zP.prototype,"projectDoc",[_P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),GP=(0,G.Z)(zP.prototype,"projectUIState",[RP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VP=(0,G.Z)(zP.prototype,"sentryService",[BP],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),HP=zP));var nk,ik,rk,sk,ak,lk,ck,dk,pk;nk=(0,J.JJ)("cloudComponentsRepository"),ik=(0,J.f3)("requestMaker"),rk=(0,J.f3)("projectDoc"),sk=(0,J.f3)("sentryService"),nk((lk=class{constructor(){(0,z.Z)(this,"requestMaker",ck,this),(0,z.Z)(this,"projectDoc",dk,this),(0,z.Z)(this,"sentryService",pk,this),(0,$.Z)(this,"basePath","/registry/")}async generateLink(e){const{compName:t,data:o}=e;try{return(await this.requestMaker.makeRequest({method:xx.x.POST,path:this.basePath+this.projectDoc.id+"/module",payload:JSON.stringify(o)}))[(0,mS.UO)(t)].component}catch(n){return this.sentryService.captureException(n),null}}async deleteCompModule(e){try{await this.requestMaker.makeRequest({method:xx.x.DELETE,path:this.basePath+this.projectDoc.id+"/module",payload:JSON.stringify(e)})}catch(t){this.sentryService.captureException(t)}}},ck=(0,G.Z)(lk.prototype,"requestMaker",[ik],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dk=(0,G.Z)(lk.prototype,"projectDoc",[rk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pk=(0,G.Z)(lk.prototype,"sentryService",[sk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ak=lk));var uk,hk,mk,gk,yk,fk,bk,wk,vk,Ik;uk=(0,J.JJ)("elementRefProvider"),hk=(0,J.f3)("projectDoc"),uk((fk=new WeakMap,bk=new WeakMap,wk=new WeakMap,vk=new WeakMap,Ik=new WeakMap,gk=class{constructor(){(0,z.Z)(this,"projectDoc",yk,this),fk.set(this,{writable:!0,value:null}),bk.set(this,{writable:!0,value:null}),wk.set(this,{writable:!0,value:null}),vk.set(this,{writable:!0,value:{}}),Ik.set(this,{writable:!0,value:{}}),(0,$.Z)(this,"getDomTargetNode",((e,t)=>{const o=this.projectDoc.nodes.byId[e];if(!o)return null;let n=this.getDomNodeElementRefByCompInstance(e,t||void 0);if(o.primitiveType!==dt.sO.HTML_NODE&&o.primitiveType!==dt.sO.LOTTIE||(n=(0,Uc.G)(e)),!n)return null;return"component"===n.dataset.type&&n.childNodes[0]&&(n=n.childNodes[0]),n})),this.getDomNodeElementRefByCompInstance=this.getDomNodeElementRefByCompInstance.bind(this)}get nodeInstanceDomData(){return(0,$i.Z)(this,vk)}get nodeIdToInstanceIds(){return(0,$i.Z)(this,Ik)}getIframeRef(){return(0,$i.Z)(this,fk)}setIframeRef(e){(0,Gi.Z)(this,fk,e)}getIframeRoot(){return(0,$i.Z)(this,bk)}setIframeRoot(e){(0,Gi.Z)(this,bk,e)}getIframeStyleRoot(){return(0,$i.Z)(this,wk)}setIframeStyleRoot(e){(0,Gi.Z)(this,wk,e)}getDomNodeElementRefByCompInstance(e,t){var o,n;const i=(0,$i.Z)(this,Ik)[e],r=null===i||void 0===i?void 0:i[t||"root"];return(null===(o=this.nodeInstanceDomData)||void 0===o||null===(n=o[r])||void 0===n?void 0:n.domRef)||null}getDomNodeElementRefById(e){const t=this.projectDoc.nodes.byId[e];if(!t)return null;if(this.projectDoc.nodes.nodeIsCompInstance(t)){var o;const e=null===(o=this.projectDoc.components.byId[t.compIdOfCompInstance])||void 0===o?void 0:o.rootNodeId;return this.getDomNodeElementRefByCompInstance(e||"",t.id)}const{compInstanceId:n}=this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(t.id);return this.getDomNodeElementRefByCompInstance(t.id,n)}resetInstanceData(){(0,Gi.Z)(this,vk,{}),(0,Gi.Z)(this,Ik,{})}},yk=(0,G.Z)(gk.prototype,"projectDoc",[hk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mk=gk));var Sk,jk,Dk,Ok,Fk,Tk,Nk,Ek;Sk=(0,J.JJ)("assetSrcProvider"),jk=(0,J.f3)("projectDoc"),Dk=(0,J.f3)("projectUIState"),Sk((Ek=new WeakMap,Fk=class{constructor(){Ek.set(this,{writable:!0,value:{}}),(0,z.Z)(this,"projectDoc",Tk,this),(0,z.Z)(this,"projectUIState",Nk,this),this.safelyGetSrcForAssetId=this.safelyGetSrcForAssetId.bind(this)}safelyGetSrcForAssetId(e){var t;const o=this.projectDoc.assets.byId[e];if(!o)return e;const n=this.projectUIState.selection.componentId,i=o.originalHeight||0,r=o.originalWidth||0,s=null===(t=o.sizePerComponent)||void 0===t?void 0:t[n||""],a=o.skipOptimisations||o.type===we.K.VIDEO,l=s||(i>=r?`w=${pt.ou.Cg}`:`h=${pt.ou.Cg}`);return(0,$i.Z)(this,Ek)[e]||((0,$i.Z)(this,Ek)[e]=o.remoteSrc),`${(0,$i.Z)(this,Ek)[e]}${a?"":"&"+l}`}},Tk=(0,G.Z)(Fk.prototype,"projectDoc",[jk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nk=(0,G.Z)(Fk.prototype,"projectUIState",[Dk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ok=Fk));var Ck,xk;(0,J.JJ)("workersProvider")((xk=new WeakMap,Ck=class{constructor(){(0,$.Z)(this,"linter",void 0),(0,$.Z)(this,"prettier",void 0),(0,$.Z)(this,"htmlParser",void 0),(0,$.Z)(this,"typings",void 0),xk.set(this,{writable:!0,value:[]})}async loadLinter(){const e=new Worker(new URL(o.p+o.u(97366),o.b),{type:void 0}),t=new((0,tP.Ud)(e));try{this.linter=await t,(0,$i.Z)(this,xk).push(e)}catch(n){throw new Error("Failed to load Linter")}}async loadPrettier(){const e=new Worker(new URL(o.p+o.u(42753),o.b),{type:void 0}),t=new((0,tP.Ud)(e));try{this.prettier=await t,(0,$i.Z)(this,xk).push(e)}catch(n){throw new Error("Failed to load Prettier")}}async loadTypingsWorker(e){const t=new Worker(new URL(o.p+o.u(71347),o.b),{type:void 0}),n=new((0,tP.Ud)(t));try{this.typings=await n,this.typings.init((0,tP.sj)(e)),(0,$i.Z)(this,xk).push(t)}catch(i){throw new Error("Failed in loading ATA")}}async loadHtmlParser(){const e=new Worker(new URL(o.p+o.u(9324),o.b),{type:void 0}),t=new((0,tP.Ud)(e));try{this.htmlParser=await t,(0,$i.Z)(this,xk).push(e)}catch(n){throw new Error("Failed to load HTML Parser")}}async generateHtmlTreeFromCode(e){return this.htmlParser||await this.loadHtmlParser(),this.htmlParser.generateHtmlTreeFromText(e)}async lintFile(e,t,o,n){this.linter||await this.loadLinter(),this.linter.verify(e,t,(0,tP.sj)(o),(0,tP.sj)(n))}async prettify(e,t,o,n){this.prettier||await this.loadPrettier(),this.prettier.prettify(e,t,(0,tP.sj)(o),(0,tP.sj)(n))}async loadTypes(e,t){this.typings||await this.loadTypingsWorker(t),this.typings.load(e)}terminateWorkers(){(0,$i.Z)(this,xk).forEach((e=>e.terminate()))}}));var Pk,kk,Mk,Zk,Uk,Ak,Lk,_k,Rk,Bk,Hk,zk,$k,Gk,Vk,Jk=o(87146),Wk=o(22447),Kk=o(51676),Yk=o(7446),Xk=o(60178);function qk(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function Qk(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?qk(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):qk(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}Pk=(0,J.JJ)("uidlToProjectMapper"),kk=(0,J.f3)("sharedbProjectSyncService"),Mk=(0,J.f3)("projectDoc"),Zk=(0,J.f3)("uidlToComponentMapper"),Uk=(0,J.f3)("fontsInProjectFlow"),Ak=(0,J.f3)("projectClassManagementFlow"),Lk=(0,J.f3)("guardsService"),Pk((Rk=class{constructor(){(0,z.Z)(this,"dbSync",Bk,this),(0,z.Z)(this,"projectDoc",Hk,this),(0,z.Z)(this,"uidlToComponentMapper",zk,this),(0,z.Z)(this,"fontsInProjectFlow",$k,this),(0,z.Z)(this,"projectClassManagementFlow",Gk,this),(0,z.Z)(this,"guardsService",Vk,this),(0,$.Z)(this,"addClassToProject",(e=>{const{doc:t,name:o,cls:n}=e;this.addDynamicNodesToClass(t,n);const i=(new ir.q).fromJSON({id:(0,lt.Z)(),name:o,conditions:n.conditions,content:n.content});this.projectClassManagementFlow.addClass({classToAdd:i,doc:t})})),(0,$.Z)(this,"addSingleTextStyleToProject",(e=>{var t;const{doc:o,styleSetDefinition:n,styleName:i,index:r}=e;let s=Object.values(o.designLanguage.categoriesById).find((e=>"typography"===e.section));s||(s={id:(0,lt.Z)(),name:"Text Styles",position:0,section:"typography"},o.designLanguage.categoriesById[s.id]=s);const a=n,l=(0,W.Zu)(Object.values(o.designLanguage.textStyleSetsById).map((e=>e.name)),i),c=(new Wk.o).fromJSON(Qk(Qk({},a),{},{role:(null===a||void 0===a?void 0:a.role)||void 0,categoryId:null===(t=s)||void 0===t?void 0:t.id,identifier:(0,mt.Ky)(i),name:l,position:r*Number.MAX_SAFE_INTEGER,type:Yk.i.TEXT_STYLE,id:(0,lt.Z)()}));o.designLanguage.textStyleSetsById[c.id]=c})),(0,$.Z)(this,"addTextStylesToProject",(e=>{const{doc:t,styleSetDefinitions:o}=e;Object.keys(o||{}).forEach(((e,n)=>{this.addSingleTextStyleToProject({doc:t,styleName:e,styleSetDefinition:o[e],index:n})})),this.ensureDefaultTextStyleExists(t)})),(0,$.Z)(this,"addFontsUsedInTokens",(e=>{Object.keys(e.designLanguage.textStyleSetsById).forEach((t=>{const o=e.designLanguage.textStyleSetsById[t];Object.keys(o.content).forEach((n=>{if("fontFamily"!==n)return;const i=o.content[n];if("static"===(null===i||void 0===i?void 0:i.type)){const o=this.fontsInProjectFlow.importGoogleFont({doc:e,fontName:i.content}),n=Object.values(e.fonts.byId).find((e=>e.name===o));n&&(n.usedInTokens[t]=!0)}}))}))})),(0,$.Z)(this,"addSingleDesignTokenToProject",((e,t,o,n,i)=>{const{backgroundToken:r,foregroundToken:s}=eM(n),{type:a=Yk.i.COLOR,categoryName:l=(0,lt.Z)(),name:c}=(0,Fi.kg)(t);let d=Object.keys(e.designLanguage.categoriesById).find((t=>e.designLanguage.categoriesById[t].name.toLowerCase().replace(/ /g,"")===l));if(!d){const t=Math.max(...Object.values(e.designLanguage.categoriesById).map((e=>e.position))),o=a===Yk.i.COLOR,n=-1!==[Yk.i.SIZE,Yk.i.SPACE,Yk.i.RADIUS].indexOf(a),i=-1!==[Yk.i.TYPEFACE,Yk.i.TEXT_SCALE,Yk.i.TEXT_STYLE].indexOf(a);let r=o?"colors":n?"layout":null;r=r||(i?"typography":"colors");const s={id:(0,lt.Z)(),name:l,position:t+Number.MAX_SAFE_INTEGER,section:r};e.designLanguage.categoriesById[s.id]=s,d=s.id}const p=o,u="static"===(null===p||void 0===p?void 0:p.type)?null===p||void 0===p?void 0:p.content:"",h=r&&r.categoryName===l&&r.name===c,m=s&&s.categoryName===l&&s.name===c;if(h){const t=Object.keys(e.designLanguage.tokensById).find((t=>"background-color"===e.designLanguage.tokensById[t].role));t&&(e.designLanguage.tokensById[t].role=void 0)}if(m){const t=Object.keys(e.designLanguage.tokensById).find((t=>"foreground-color"===e.designLanguage.tokensById[t].role));t&&(e.designLanguage.tokensById[t].role=void 0)}const g=(0,W.Zu)(Object.values(e.designLanguage.getTokensByCategoryId(d)).map((e=>e.name)),c),y=new Kk.Q({id:(0,lt.Z)(),type:a,categoryId:d,name:g,value:u,role:h?"background-color":m?"foreground-color":void 0,usedInNodes:{},position:i*Number.MAX_SAFE_INTEGER});e.designLanguage.tokensById[y.id]=y})),(0,$.Z)(this,"addDesignTokensToProject",((e,t,o)=>{Object.keys(t).length&&Object.keys(t||{}).forEach(((n,i)=>{this.addSingleDesignTokenToProject(e,n,t[n],o,i)}))})),(0,$.Z)(this,"solveDesignLanguageConflicts",((e,t,o,n,i,r)=>{const s=null===r||void 0===r?void 0:r.classes,a=null===r||void 0===r?void 0:r.tokens,l=null===r||void 0===r?void 0:r.textStyles,c={classes:{},tokens:{},textStyles:{}};if(e)return Object.entries(o).forEach((([t,o],n)=>{const{type:r,categoryName:s,name:l}=(0,Fi.kg)(t);if(a&&a.hasOwnProperty(t)){if(1!==a[t])if(0===a[t]){const a=Object.keys(e.designLanguage.categoriesById).find((t=>e.designLanguage.categoriesById[t].name.toLowerCase().replace(/ /g,"")===s));let d=l;a&&(d=(0,W.Zu)(Object.values(e.designLanguage.getTokensByCategoryId(a)).map((e=>e.name)),l)),c.tokens[t]=`--dl-${r}-${s}-${d}`,this.addSingleDesignTokenToProject(e,t,o,i,n)}else{const t=Object.values(e.designLanguage.tokensById).find((e=>e.name.toLowerCase().replace(/ /g,"")===l));if(t){const n=e.designLanguage.tokensById[t.id];return n.value=o.content,void(e.designLanguage.tokensById[n.id]=n)}}}else Object.values(e.designLanguage.getTokensAsCustomProperties()).find((e=>e.name===t))||this.addSingleDesignTokenToProject(e,t,o,i,n)})),t&&Object.entries(t).forEach((([t,o])=>{if(s&&s.hasOwnProperty(t)){if(1!==s[t])if(0===s[t]){const n=(0,W.Zu)(Object.values(e.classes.byId).map((e=>e.name)),t);c.classes[t]=n,this.addClassToProject({doc:e,name:t,cls:o})}else{const n=Object.values(e.classes.byId).find((e=>e.name===t));if(!n)return;this.addDynamicNodesToClass(e,o);const i=(new ir.q).fromJSON({name:t,conditions:o.conditions,content:o.content});switch(s[t]){case 2:n.content=i.content;break;case 3:n.content=Qk(Qk({},i.content),n.content);break;case 4:n.content=Qk(Qk({},n.content),i.content)}const r=Object.values(n.conditions);Object.values(i.conditions).forEach((e=>{const o=r.find((t=>t.type===e.type&&JSON.stringify(t.meta)===JSON.stringify(e.meta)));if(o)switch(s[t]){case 2:o.content=e.content;break;case 3:o.content=Qk(Qk({},e.content),o.content);break;case 4:o.content=Qk(Qk({},o.content),e.content)}else n.conditions[e.id]=e}))}}else Object.values(e.classes.byId).find((e=>e.name===t))||this.addClassToProject({doc:e,name:t,cls:o})})),Object.entries(n).forEach((([t,o],n)=>{if(l&&l.hasOwnProperty(t)){if(1!==l[t])if(0===l[t]){const i=(0,W.Zu)(Object.values(e.designLanguage.textStyleSetsById).map((e=>e.name)),t);c.classes[t]=i,this.addSingleTextStyleToProject({doc:e,styleName:t,styleSetDefinition:o,index:n})}else{const n=Object.values(e.designLanguage.textStyleSetsById).find((e=>e.name===t));if(!n)return;const i=o,r=(new Wk.o).fromJSON(Qk({},i));switch(Object.values(r.content).forEach((t=>{if("dynamic"!==t.type)return;const{name:o}=(0,Fi.kg)(t.content.id),n=Object.values(e.designLanguage.tokensById).find((e=>e.name.toLowerCase().replace(/ /g,"")===o));n&&(t.content.id=n.id)})),l[t]){case 2:n.content=r.content;break;case 3:case 4:n.content=Qk(Qk({},r.content),n.content)}}}else Object.values(e.designLanguage.textStyleSetsById).find((e=>(0,ft.hN)(e.name)===t))||this.addSingleTextStyleToProject({doc:e,styleName:t,styleSetDefinition:o,index:n})})),c}))}async mapUIDLToProject(e){await this.guardsService.executeAsyncFunctionGuarded(to._.DISABLE_HISTORY,(async()=>{await(0,Fi.Yh)(e),await this.addGlobalDataToDocument({projectUIDL:e}),await this.extractProjectFromUIDLAndSave(e)}))}async addGlobalDataToDocument(e){var t,o;const{doc:n,projectUIDL:i}=e;if(!n)return;const{root:r,globals:s}=i;n.settings.general={title:s.settings.title,language:s.settings.language||"en"},n.settings.code={headTag:null===(t=s.customCode)||void 0===t?void 0:t.head,bodyTag:null===(o=s.customCode)||void 0===o?void 0:o.body};tM(s).forEach((e=>n.fonts.addFont(e)));const{designLanguage:a={}}=r;this.addDesignTokensToProject(n,a.tokens||{},s),r.styleSetDefinitions&&this.addTextStylesToProject({doc:n,styleSetDefinitions:r.styleSetDefinitions}),this.addFontsUsedInTokens(n)}async extractProjectFromUIDLAndSave(e){var t,o;const{components:n={},root:i}=e,r=null===(t=i.stateDefinitions)||void 0===t||null===(o=t.route)||void 0===o?void 0:o.defaultValue,s=(i.node.content.children||[]).map((e=>{const t=e.content;return{uidl:Qk(Qk({},e.content),{},{name:t.value}),validateUIDL:!1,isPage:!0}})),a=Object.keys(n).map((e=>({uidl:n[e],validateUIDL:!1}))),l=await this.uidlToComponentMapper.mapUIDLsToComponents({uidls:s,doc:this.projectDoc});if(!l)return;const c=await this.uidlToComponentMapper.mapUIDLsToComponents({uidls:a,doc:this.projectDoc}),{assets:d,nodes:p,tokensInNodes:u,textStylesInNodes:h,fontsInNodes:m,fontsToImport:g}=l,y=l.components,f=null===c||void 0===c?void 0:c.components;d.push(...(null===c||void 0===c?void 0:c.assets)||[]),p.push(...(null===c||void 0===c?void 0:c.nodes)||[]),Object.keys((null===c||void 0===c?void 0:c.tokensInNodes)||{}).forEach((e=>{u[e]?u[e].push(...(null===c||void 0===c?void 0:c.tokensInNodes[e])||[]):u[e]=(null===c||void 0===c?void 0:c.tokensInNodes[e])||[]})),Object.keys((null===c||void 0===c?void 0:c.textStylesInNodes)||{}).forEach((e=>{h[e]?h[e].push(...(null===c||void 0===c?void 0:c.textStylesInNodes[e])||[]):h[e]=(null===c||void 0===c?void 0:c.textStylesInNodes[e])||[]})),Object.keys((null===c||void 0===c?void 0:c.fontsInNodes)||{}).forEach((e=>{m[e]?m[e].push(...(null===c||void 0===c?void 0:c.fontsInNodes[e])||[]):m[e]=(null===c||void 0===c?void 0:c.fontsInNodes[e])||[]})),this.dbSync.mutate(this.projectDoc,(e=>{y.forEach((t=>{t.isHomePage=t.title===r||1===y.length,e.addPage({page:t,folderId:"pages"})})),Object.keys(g).forEach((t=>{const o=this.fontsInProjectFlow.importGoogleFont({doc:e,fontName:g[t]}),n=Object.keys(this.projectDoc.fonts.byId).find((e=>this.projectDoc.fonts.byId[e].name===o));n&&(m[n]?m[n].push(t):m[n]=[t])})),f.forEach((t=>{const o=e.addComponent({component:t,folderId:"components"});Object.values((null===c||void 0===c?void 0:c.propDefinitions[t.id])||{}).forEach((e=>{null===o||void 0===o||o.createPropDefinition(Qk({},e))})),Object.values((null===c||void 0===c?void 0:c.stateDefinitions[t.id])||{}).forEach((e=>{null===o||void 0===o||o.createStateDefinition(Qk({},e))}))})),p.forEach((t=>e.nodes.add(t))),d.forEach((t=>e.assets.add(t)));const t=[...l.nodesWithNavlinks||[],...(null===c||void 0===c?void 0:c.nodesWithNavlinks)||[]];(0,Fi.Gw)(e,t),(0,Fi.cT)({doc:e,sectionIds:l.sectionIds}),(0,Fi.cT)({doc:e,sectionIds:null===c||void 0===c?void 0:c.sectionIds});const o=l.usedComponents;(0,Fi.ng)({doc:e,usedComponents:o}),(0,Fi.ng)({doc:e,usedComponents:null===c||void 0===c?void 0:c.usedComponents}),Object.keys(u).forEach((t=>{u[t].forEach((o=>{const n=e.designLanguage.tokensById[t].usedInNodes[o];e.designLanguage.tokensById[t].usedInNodes[o]=n?n+1:1}))})),Object.keys(h).forEach((t=>{h[t].forEach((o=>{e.designLanguage.textStyleSetsById[t].usedInNodes[o]=!0}))})),Object.keys(m).forEach((t=>{m[t].forEach((o=>{const n=e.fonts.byId[t].usedInNodes[o];e.fonts.byId[t].usedInNodes[o]=n?n+1:1}))}))}))}ensureDefaultTextStyleExists(e){if(Object.keys(e.designLanguage.textStyleSetsById).some((t=>"default"===e.designLanguage.textStyleSetsById[t].role)))return;const t=Jk.$e.find((e=>"default"===e.role));if(!t)throw new Error("No default text style is defined");const o=Object.keys(e.designLanguage.textStyleSetsById).find((o=>{const n=e.designLanguage.textStyleSetsById[o];return Object.keys(n.content).every((e=>{var o,i;const r=e;return("string"===typeof n.content[r]?n.content[r]:null===(o=n.content[r])||void 0===o?void 0:o.content)===("string"===typeof t.content[r]?t.content[r]:null===(i=t.content[r])||void 0===i?void 0:i.content)}))}));o?e.designLanguage.textStyleSetsById[o].role="default":e.designLanguage.textStyleSetsById[t.id]=new Wk.o(t)}addDynamicNodesToClass(e,t){Object.values(t.content).forEach((t=>{if("dynamic"!==t.type)return;const{name:o,categoryName:n}=(0,Fi.kg)(t.content.id),i=Object.keys(e.designLanguage.categoriesById).find((t=>e.designLanguage.categoriesById[t].name.toLowerCase().replace(/ /g,"")===n));if(i){const n=Object.values(e.designLanguage.getTokensByCategoryId(i)).find((e=>e.name.toLowerCase().replace(/ /g,"")===o));n&&(t.content.id=n.id)}})),t.conditions&&Object.values(t.conditions).forEach((t=>{Object.values(t.content).forEach((t=>{if("dynamic"!==t.type)return;const{name:o,categoryName:n}=(0,Fi.kg)(t.content.id),i=Object.keys(e.designLanguage.categoriesById).find((t=>e.designLanguage.categoriesById[t].name.toLowerCase().replace(/ /g,"")===n));if(i){const n=Object.values(e.designLanguage.getTokensByCategoryId(i)).find((e=>e.name.toLowerCase().replace(/ /g,"")===o));n&&(t.content.id=n.id)}}))}))}},Bk=(0,G.Z)(Rk.prototype,"dbSync",[kk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hk=(0,G.Z)(Rk.prototype,"projectDoc",[Mk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zk=(0,G.Z)(Rk.prototype,"uidlToComponentMapper",[Zk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$k=(0,G.Z)(Rk.prototype,"fontsInProjectFlow",[Uk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gk=(0,G.Z)(Rk.prototype,"projectClassManagementFlow",[Ak],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vk=(0,G.Z)(Rk.prototype,"guardsService",[Lk],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(Rk.prototype,"addGlobalDataToDocument",[Q.P],Object.getOwnPropertyDescriptor(Rk.prototype,"addGlobalDataToDocument"),Rk.prototype),_k=Rk));const eM=e=>{const t=e.assets.filter((e=>"style"===e.type));let o=null,n=null;return t.forEach((e=>{var t,i;const r=document.implementation.createHTMLDocument(""),s=document.createElement("style");s.textContent=e.content||"",r.body.appendChild(s);const a=null===(t=s.sheet)||void 0===t||null===(i=t.cssRules)||void 0===i?void 0:i[0];if(!a)return;const l=a.style["background-color"];if(l&&-1!==l.indexOf("--dl")){const e=l.replace("var(","").slice(0,-1);o=(0,Fi.kg)(e)}const c=a.style.color;if(c&&-1!==l.indexOf("--dl")){const e=c.replace("var(","").slice(0,-1);n=(0,Fi.kg)(e)}})),{backgroundToken:o,foregroundToken:n}},tM=e=>e.assets.filter((e=>"font"===e.type)).map((e=>{var t;const o=-1!==(null===(t=e.path)||void 0===t?void 0:t.indexOf("googleapis")),n=o?(0,Fi.eA)(e.path):"";return new Xk.F({id:(0,lt.Z)(),name:e.name||n,path:e.path,usedInNodes:{},usedInTokens:{},type:o?"google":e.path?"custom":"system"})})).filter((e=>e));var oM,nM,iM,rM,sM,aM,lM,cM=o(26903),dM=o(97283);function pM(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function uM(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?pM(Object(o),!0).forEach((function(t){(0,$.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):pM(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}oM=(0,J.JJ)("uidlToComponentMapper"),nM=(0,J.f3)("assetsRepository"),iM=(0,J.f3)("folderManagementFlow"),oM((sM=class{constructor(){(0,z.Z)(this,"assetsRepository",aM,this),(0,z.Z)(this,"folderManagementFlow",lM,this)}async mapUIDLsToComponents(e){const{doc:t,uidls:o}=e;if(!t)return null;const n=o.map((e=>this.mapSingleUIDLToComponent({doc:t,uidl:e.uidl,meta:e.meta})));return(await Promise.all(n)).reduce(((e,o)=>{if(!o)return e;const n=o.component;return n.title=t.getUniqueCompOrPageName(n.title),e.components.push(n),e.nodes.push(...o.nodes),e.assets.push(...o.assets||[]),e.propDefinitions[n.id]=o.propDefinitions,e.tailwindClasses=uM({},o.tailwindClasses),e.usedComponents[n.id]?e.usedComponents[n.id].push(...o.usedComponents):e.usedComponents[n.id]=o.usedComponents,e.sectionIds[n.id]?e.sectionIds[n.id].push(...o.sectionIds):e.sectionIds[n.id]=o.sectionIds,e.nodesWithNavlinks.push(...o.nodesWithNavlinks),Object.keys(o.tokensInNodes).forEach((t=>{e.tokensInNodes[t]?e.tokensInNodes[t].push(...o.tokensInNodes[t]):e.tokensInNodes[t]=o.tokensInNodes[t]})),Object.keys(o.textStylesInNodes).forEach((t=>{e.textStylesInNodes[t]?e.textStylesInNodes[t].push(...o.textStylesInNodes[t]):e.textStylesInNodes[t]=o.textStylesInNodes[t]})),Object.keys(o.classesInNodes).forEach((t=>{e.classesInNodes[t]?e.classesInNodes[t].push(...o.classesInNodes[t]):e.classesInNodes[t]=o.classesInNodes[t]})),Object.keys(o.fontsInNodes).forEach((t=>{e.fontsInNodes[t]?e.fontsInNodes[t].push(...o.fontsInNodes[t]):e.fontsInNodes[t]=o.fontsInNodes[t]})),Object.keys(o.fontsToImport).forEach((t=>{e.fontsToImport[t]=o.fontsToImport[t]})),e}),{components:[],nodes:[],assets:[],propDefinitions:{},stateDefinitions:{},tokensInNodes:{},textStylesInNodes:{},classesInNodes:{},fontsInNodes:{},fontsToImport:{},usedComponents:{},sectionIds:{},nodesWithNavlinks:[],tailwindClasses:{}})}async mapSingleUIDLToComponent(e){const{doc:t,uidl:o,meta:n={}}=e;if(!t)return null;const{validateUIDL:i=!0,isPage:r=!1}=n;let s=o;i&&(s=await gM(o));const a=(0,lt.Z)(),{name:l}=s,c=this.getComponentPropDefinitions(s),d=this.getComponentStateDefinitions(s),p=await this.parseNodeHierarchy({doc:t,propDefinitions:c,stateDefinitions:d,node:s.node,compId:a,isPage:r});if(!p)return null;const u={},h=Object.values(t.designLanguage.tokensById),m=Object.values(t.designLanguage.categoriesById);if(s.styleSetDefinitions){const e=s.styleSetDefinitions;Object.keys(e).forEach((t=>{const o={};Object.keys(e[t].content).forEach((n=>{const i=e[t].content[n];if("static"===i.type){const e=i.content;return void(o[n]=new ar.F({content:e}))}const r=fM(h,m,i.content.id),s=p.nodes.find((e=>{var o;return e instanceof Zc.H&&(null===(o=e.attrs[gt.Q])||void 0===o?void 0:o.content)===t}));if(r&&s){const e=new os.P({content:{referenceType:"token",id:r.id}});o[n]=e,p.tokensInNodes[r.id]?p.tokensInNodes[r.id].push(s.id):p.tokensInNodes[r.id]=[s.id]}else{const{type:e,name:t,categoryName:r}=(0,Fi.kg)(i.content.id);if(r){const i=Jk.ST.find((e=>e.name.toLowerCase()===r)),s=(null===i||void 0===i?void 0:i.id)||null;if(s){const i=Jk.ZC.find((o=>o.name.toLowerCase()===t&&o.categoryId===s&&o.type===e));if(i){const e=new ar.F({content:i.value});o[n]=e}}}}})),u[t]={styles:o,referencedStyles:{},usedByInstances:{}}}))}const g=r?(new oe.m).fromJSON({id:a,title:l}):new Zt.n({id:a,title:l,rootNodeId:s.node.content.key,styleSetDefinitions:u,slots:p.usedSlots,stateDefinitions:Object.values(d).reduce(((e,t)=>(e[t.id]=t,e)),{})}),{nodes:y}=p,f=y.find((e=>e instanceof Zc.H&&e.compIdOfRootNode===g.id));return g.rootNodeId=null===f||void 0===f?void 0:f.id,uM({component:g},p)}async parseNodeHierarchy(e){const{doc:t,node:o,propDefinitions:n,stateDefinitions:i,compId:r,isPage:s}=e;if(!t)return null;const a=Object.values(t.designLanguage.tokensById),l=Object.values(t.designLanguage.textStyleSetsById),c=Object.values(t.classes.byId),d=Object.values(t.designLanguage.categoriesById),p=Object.values(t.fonts.byId),u=[{node:o}],h=[],m=[],g={},y={},f={},b={},w=[],v=[],I={},S={},j={};for(;u.length;){var D,O;const e=u.shift();if(!e)continue;const{node:t,parentNode:o,childIndex:k}=e;t.id=(0,lt.Z)(),o||(t.compIdOfRootNode=r);const M=u.some((e=>{var t;return(null===(t=e.parentNode)||void 0===t?void 0:t.id)===(null===o||void 0===o?void 0:o.id)})),Z=(null===o||void 0===o?void 0:o.primitiveType)===dt.sO.TEXT&&Object.keys(o.childrenIds).length;if(o&&!M&&!Z&&("string"===typeof t.content||"number"===typeof t.content||"boolean"===typeof t.content)){const e=new ar.F({content:t.content});o.contentChildren={[e.id]:e},o.primitiveType||(o.primitiveType=dt.sO.TEXT);continue}if("dynamic"===t.type&&"prop"===t.content.referenceType&&o){const e=n.find((e=>e.name===t.content.id));if(e){const n=new os.P({content:uM(uM({},t.content),{},{id:e.id})});o.contentChildren?o.contentChildren[n.id]=n:o.contentChildren={[n.id]:n},e.locations[o.id]=(0,cM.B)({base:jl.hD.CONTENT});continue}}o&&(t.parentNodeId=o.id,o.childrenIds[t.id]=!0);const U=t.content.elementType===dt.sO.COMPONENT?new Ni.F:new Zc.H,A="conditional"===t.type?t.content.node.content:t.content;var F;if(U.fromJSON(uM(uM({},"dynamic"===t.type?{}:t.content),{},{id:t.id,name:t.type===dt.sO.SLOT?"slot1":t.content.name,parentId:t.parentNodeId||null,compIdOfRootNode:t.compIdOfRootNode||null,compIdOfSlot:t.type===dt.sO.SLOT?r:null,html:null===(D=A.attrs)||void 0===D||null===(O=D.html)||void 0===O?void 0:O.content,primitiveType:t.type===dt.sO.SLOT?t.type:A.elementType,pos:""+((k||0)+1)*Number.MAX_SAFE_INTEGER,referencedStyles:{}})),U.primitiveType===dt.sO.HTML_NODE)null===U||void 0===U||(null===(F=U.attrs)||void 0===F||delete F.html);if(U.primitiveType===dt.sO.SLOT&&(I[U.id]={height:Za.l.HEIGHT,width:Za.l.HEIGHT}),"conditional"===t.type){var T;const e=null===(T=i.find((e=>e.name===t.content.reference.content.id)))||void 0===T?void 0:T.id,o=new zr({reference:new os.P({content:{referenceType:"state",id:t.content.reference.content.id},id:e}),value:t.content.value});U.renderingConditions=o,U.primitiveType||(U.primitiveType=dt.sO.TEXT)}if("string"===typeof A||"number"===typeof A||"boolean"===typeof A){const e=new ar.F({content:A});U.contentChildren={[e.id]:e},U.primitiveType||(U.primitiveType=dt.sO.TEXT)}if("element"===t.type&&A.referencedStyles&&Object.keys(A.referencedStyles).forEach((e=>{if(!A.referencedStyles)return;if(!A.referencedStyles[e])return;const t=A.referencedStyles[e];if("style-map"===(null===t||void 0===t?void 0:t.type)){const i=l.find((e=>"project-referenced"===t.content.mapType&&(e.name===t.content.referenceId||e.identifier===t.content.referenceId)));if(i){const e={type:"style-map",id:(0,lt.Z)(),content:{mapType:"design-language-referenced",referenceId:i.id}};U.referencedStyles[i.id]=e,y[i.id]?y[i.id].push(U.id):y[i.id]=[U.id]}else if("project-referenced"===t.content.mapType){const e=t.content.referenceId,o=c.find((t=>t.name===e));o&&(U.referencedStyles[o.id]={type:"style-map",id:o.id,content:{mapType:"project-referenced",referenceId:o.id}},j[o.id]?j[o.id].push(U.id):j[o.id]=[U.id])}else if("component-referenced"===t.content.mapType){var o;if(s)return;"static"===t.content.content.type&&(S[U.id]?S[U.id].push(t.content.content.content):S[U.id]=[t.content.content.content]);const i=null===(o=n.find((e=>"rootClassName"===e.name)))||void 0===o?void 0:o.id;i&&(U.referencedStyles[e]={type:"style-map",id:e,content:{mapType:"component-referenced",content:{type:"dynamic",content:{referenceType:"prop",id:i}}}})}if("inlined"===t.content.mapType){const e=this.extractStyles({uidlStyle:t.content.styles,dataNodeId:U.id,propDefinitions:n,tokenCategories:d,tokensInNodes:g,projectTokens:a,projectFonts:p,fontsInNodes:f,fontsToImport:b}),o=(0,lt.Z)();U.referencedStyles[o]={content:{mapType:"inlined",styles:e,conditions:t.content.conditions},type:"style-map",id:o}}}})),"element"!==t.type&&"conditional"!==t.type||!A.style||(U.styles=this.extractStyles({uidlStyle:A.style,dataNodeId:U.id,propDefinitions:n,tokenCategories:d,tokensInNodes:g,projectTokens:a,projectFonts:p,fontsInNodes:f,fontsToImport:b})),m.push(U),"element"===t.type||"conditional"===t.type){var N,E,C;if(null===(N=A.children)||void 0===N||N.forEach(((e,t)=>{u.push({node:e,parentNode:U,childIndex:t})})),A.elementType===dt.sO.COMPONENT){const e=A.semanticType;e&&w.push({componentName:e,nodeId:U.id})}if(this.syncDynamicNodeAbilities(U,n),U.styles.backgroundImage&&-1!==U.styles.backgroundImage.content.indexOf("data:image/png;base64")){const e=(0,lt.Z)();h.push({nodeId:U.id,type:"backgroundImage",file:yM(U.styles.backgroundImage.content.split("'")[1],e)})}const e=(null===(E=A.attrs)||void 0===E||null===(C=E.alt)||void 0===C?void 0:C.content)||(0,lt.Z)(),t={gif:"data:image/gif;base64",jpeg:"data:image/jpeg;base64",jpg:"data:image/jpg;base64",png:"data:image/png;base64",svg:"data:image/svg+xml;base64",bmp:"data:image/bmp;base64"},o=Object.keys(A.attrs||{});for(const i of o){var x;const o=null===(x=A.attrs)||void 0===x?void 0:x[i];if("html"===i&&U.primitiveType===dt.sO.HTML_NODE)continue;if("id"===i&&"static"===(null===o||void 0===o?void 0:o.type)&&v.push({nodeId:U.id,sectionId:o.content}),"dynamic"===(null===o||void 0===o?void 0:o.type)&&"prop"===o.content.referenceType){var P;const e=n.find((e=>e.name===o.content.id));if(e&&null!==(P=A.attrs)&&void 0!==P&&P[i]){const t=new os.P({content:{referenceType:"prop",id:e.id}});U.attrs[i]=t,e.locations[U.id]=(0,cM.B)({base:jl.hD.ATTR,sufix:i}),"src"===i&&(e.inputType=jl.SO.IMAGE)}}let r;if("src"===i&&"string"===typeof(null===o||void 0===o?void 0:o.content)&&(r=Object.keys(t).find((e=>-1!==o.content.indexOf(t[e]))),r&&h.push({nodeId:U.id,type:"image",file:yM(o.content,e,r)})),"static"===(null===o||void 0===o?void 0:o.type)&&"string"===typeof o.content&&(-1!==o.content.indexOf(Bh.Bq)||(0,dM.Z)(o.content))){const e=new ar.F({content:Ol.b.image.src});U.attrs[i]=e}if(("string"===typeof o||"number"===typeof o)&&"static"===U.attrs[i].type&&!U.attrs[i].content){const e=new ar.F({content:o});U.attrs[i]=e}}}}const k=await this.uploadAssets({assetFiles:h,nodesToReturn:m,doc:t});return{fontsInNodes:f,fontsToImport:b,propDefinitions:n,textStylesInNodes:y,tokensInNodes:g,classesInNodes:j,usedComponents:w,usedSlots:I,tailwindClasses:S,sectionIds:v,nodesWithNavlinks:[],assets:k,nodes:m}}extractStyles(e){const{uidlStyle:t,dataNodeId:o,propDefinitions:n,tokenCategories:i,tokensInNodes:r,projectTokens:s,projectFonts:a,fontsInNodes:l,fontsToImport:c}=e,d={};return Object.keys(t).forEach((e=>{const p=null===t||void 0===t?void 0:t[e];if(("string"===typeof p||"number"===typeof p)&&t){const t=new ar.F({content:p});d[e]=t}if("static"===(null===p||void 0===p?void 0:p.type)){const t=new ar.F({content:p.content});d[e]=t}if("static"===(null===p||void 0===p?void 0:p.type)&&"string"===typeof p.content&&(p.content.includes(Bh.Bq)||(0,dM.Z)(p.content))){const t=new ar.F({content:Rl.H.includes(e)?`url("${Ol.b.image.src}")`:Ol.b.image.src});d[e]=t}if("static"===(null===p||void 0===p?void 0:p.type)&&"string"===typeof p.content&&Rl.H.includes(e)&&0===p.content.indexOf("url(")){const t=null===p||void 0===p?void 0:p.content.split('"');if((0,dM.Z)(t[1])){const t=hM(p.content),o=new ar.F({content:t});d[e]=o}}if("fontFamily"===e){const e=a.find((e=>e.name===(null===p||void 0===p?void 0:p.content)));e?l[e.id]?l[e.id].push(o):l[e.id]=[o]:c[o]="string"===typeof p?p:null===p||void 0===p?void 0:p.content}if("dynamic"===(null===p||void 0===p?void 0:p.type)&&"prop"===p.content.referenceType){const t=n.find((e=>e.name===p.content.id));if(t){const n=new os.P({content:{referenceType:"prop",id:t.id}});d[e]=n,t.locations[o]=(0,cM.B)({base:jl.hD.STYLE,sufix:e})}}if("dynamic"===(null===p||void 0===p?void 0:p.type)&&"token"===p.content.referenceType){const t=fM(s,i,p.content.id);if(t){const n=new os.P({content:{referenceType:"token",id:t.id}});d[e]=n,r[t.id]?r[t.id].push(o):r[t.id]=[o]}else{const{type:t,name:o,categoryName:n}=(0,Fi.kg)(p.content.id);if(n){const i=Jk.ST.find((e=>e.name.toLowerCase()===n)),r=(null===i||void 0===i?void 0:i.id)||null;if(r){const n=Jk.ZC.find((e=>e.name.toLowerCase()===o&&e.categoryId===r&&e.type===t));if(n){const t=new ar.F({content:n.value});d[e]=t}}}}}})),d}syncDynamicNodeAbilities(e,t){let o=!1;return Object.keys(e.abilities).forEach((n=>{const i=e.abilities[n];switch(i.type){case pt.RZ.URL:{const e=i.content;if("string"!==typeof e.url&&"dynamic"===e.url.type){const o=e.url.content.id,n=t.find((e=>e.name===o));if(n&&"prop"===e.url.content.referenceType){const e=new os.P({content:{referenceType:"prop",id:n.id}});i.content.url=e,n.inputType=jl.SO.LINK}break}"string"!==typeof e.url&&"static"===e.url.type&&(e.url=e.url.content);break}case pt.RZ.NAVLINK:o=!0,delete e.abilities[n];break;case pt.RZ.PHONE:{const e=i.content;if("string"!==typeof e.phone&&"dynamic"===e.phone.type){const o=e.phone.content.id,n=t.find((e=>e.name===o));if(n&&"prop"===e.phone.content.referenceType){const t=new os.P({content:{referenceType:"prop",id:n.id}});e.phone=t}}break}case pt.RZ.MAIL:{var r,s;const e=i.content;if("string"!==typeof e.mail&&"dynamic"===e.mail.type){const o=e.mail.content.id,n=t.find((e=>e.name===o));if(n&&"prop"===e.mail.content.referenceType){const t=new os.P({content:{referenceType:"prop",id:n.id}});e.mail=t}}if("string"!==typeof e.subject&&"dynamic"===(null===(r=e.subject)||void 0===r?void 0:r.type)){const o=e.subject.content.id,n=t.find((e=>e.name===o));if(n&&"prop"===e.subject.content.referenceType){const t=new os.P({content:{referenceType:"prop",id:n.id}});e.subject=t}}if("string"!==typeof e.body&&"dynamic"===(null===(s=e.body)||void 0===s?void 0:s.type)){const o=e.body.content.id,n=t.find((e=>e.name===o));if(n&&"prop"===e.body.content.referenceType){const t=new os.P({content:{referenceType:"prop",id:n.id}});e.body=t}}break}}})),o}async uploadAssets(e){const{assetFiles:t,nodesToReturn:o,doc:n}=e;if(!n)return;const i=t.map((e=>e.file)),r=await Promise.all(i);let s=Object.keys(n.folders.byId).filter((e=>"external"===n.folders.byId[e].name)).map((e=>n.folders.byId[e]))[0];s||(s=this.folderManagementFlow.create({folderName:"external",parentFolderId:"assets"}));const a=mM(r).map((e=>this.assetsRepository.upload({files:e,projectId:n.id,parentFolderId:s?s.id:ve.D.ASSETS}))),l=(await Promise.all(a)).flat().filter((e=>e));return t.map(((e,t)=>{const n=r[t].name,i=null===l||void 0===l?void 0:l.find((e=>e.name===n));if(!i)throw new Error(`File could not be uploaded: ${n}`);i.usedInNodes[e.nodeId]=!0;const s=o.find((t=>t instanceof Zc.H&&t.id===e.nodeId));if(!s)throw new Error(`Could not find node to update src attribute: ${e.nodeId}`);if("image"===e.type){const e=new ar.F({content:(0,mt.zo)(i,i.size.toString())});s.attrs.src=e}if("backgroundImage"===e.type){const e=new ar.F({content:`url("${(0,mt.zo)(i,i.size.toString())}")`});s.styles.backgroundImage=e}return i}))}getComponentPropDefinitions(e){const{propDefinitions:t}=e;return t&&Object.keys(t).length?Object.keys(t).map((e=>{let{defaultValue:o}=t[e];const{type:n}=t[e];return"string"!==typeof o||0!==o.indexOf(`${Bh.Bq}/`)&&!(0,dM.Z)(o)||(o=Ol.b.image.src),{id:(0,lt.Z)(),type:n,defaultValue:o,name:e,locations:{},hidden:e===gt.Q,inputType:jl.SO.TEXT}})):[]}getComponentStateDefinitions(e){const{stateDefinitions:t}=e;return t&&Object.keys(t).length?Object.keys(t).map((e=>{const{defaultValue:o,type:n}=t[e];return{id:(0,lt.Z)(),name:e,type:n,defaultValue:o}})):[]}},aM=(0,G.Z)(sM.prototype,"assetsRepository",[nM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lM=(0,G.Z)(sM.prototype,"folderManagementFlow",[iM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,G.Z)(sM.prototype,"mapUIDLsToComponents",[Q.P],Object.getOwnPropertyDescriptor(sM.prototype,"mapUIDLsToComponents"),sM.prototype),rM=sM));const hM=e=>{const t=e.split('"');return 3===t.length?`${t[0]}${Ol.b.image.src}${t[2]}`:e},mM=(e,t=20)=>{const o=[];for(let n=0;n<e.length;n+=t)o.push(e.slice(n,n+t));return o},gM=async e=>{const{Validator:t,Parser:n}=await o.e(78286).then(o.bind(o,78286));let i=e;const r=new t,s=JSON.parse(JSON.stringify(n.parseComponentJSON(e)),((e,t)=>{if(null!==t)return t}));try{const e=r.validateComponentSchema(s),{componentUIDL:t,valid:o}=e;if(!o||!t)throw new Error(e.errorMsg);return i=t,i}catch(a){throw new Error("Invalid component UIDL")}},yM=async(e,t,o)=>{try{const n=await fetch(e),i=await n.blob(),r=Math.random().toString(36).substring(9),s=Math.random().toString(36).substring(9);return new File([i],`${t||r}-${s}.${o}`,{type:`image/${o}`})}catch(n){throw new Error("Could not fetch base64 asset")}},fM=(e,t,o)=>{const{type:n,name:i,categoryName:r}=(0,Fi.kg)(o);let s=null;if(r){const e=t.find((e=>e.name.toLowerCase()===r));s=(null===e||void 0===e?void 0:e.id)||null}return e.find((e=>{const t=e.type.toLowerCase()===n.toLowerCase()&&e.name.toLowerCase()===i.toLowerCase();return s?t&&e.categoryId===s:t}))}},27726:function(e,t,o){"use strict";o.d(t,{D:function(){return n}});const n=()=>'\nhtml {\n  line-height: 1.15;\n}\nbody {\n  margin: 0;\n}\n\n* {\n  box-sizing: border-box;\n  border-width: 0;\n  border-style: solid;\n}\n\np,\nli,\nul,\npre,\ndiv,\nh1,\nh2,\nh3,\nh4,\nh5,\nh6,\nfigure,\nblockquote,\nfigcaption {\n  margin: 0;\n  padding: 0;\n}\n\nbutton {\n  background-color: transparent;\n}\n\nbutton,\ninput,\noptgroup,\nselect,\ntextarea {\n  font-family: inherit;\n  font-size: 100%;\n  line-height: 1.15;\n  margin: 0;\n}\n\nbutton,\nselect {\n  text-transform: none;\n}\n\nbutton,\n[type="button"],\n[type="reset"],\n[type="submit"] {\n  -webkit-appearance: button;\n}\n\nbutton::-moz-focus-inner,\n[type="button"]::-moz-focus-inner,\n[type="reset"]::-moz-focus-inner,\n[type="submit"]::-moz-focus-inner {\n  border-style: none;\n  padding: 0;\n}\n\nbutton:-moz-focus,\n[type="button"]:-moz-focus,\n[type="reset"]:-moz-focus,\n[type="submit"]:-moz-focus {\n  outline: 1px dotted ButtonText;\n}\n\na {\n  color: inherit;\n  text-decoration: inherit;\n}\n\ninput {\n  padding: 2px 4px;\n}\n\nimg {\n  display: block;\n}\n'},98200:function(e,t,o){"use strict";o.d(t,{lP:function(){return c},MT:function(){return d},_k:function(){return p},Qq:function(){return u}});var n=o(75222),i=o(7933),r=o(62057),s=o(95409),a=o(68768),l=o(74736);const c=(e,t)=>{const o=e.target;return d({element:o,entityAttr:t.entityAttribute,declarationAttr:t.declarationAttribute})},d=e=>{let{element:t,entityAttr:o="nodeId",declarationAttr:i="compInstanceId"}=e;const{dragging:r,slotAttr:s="slotId"}=e;if(!t)return null;"drag-handle"===t.id&&null!==t.getAttribute("data-drag-id")&&(i="dragId",o="dragId");const a=h(t),l=g(t),c=y(t),d=r?m(t):null,p=f(t);t=d||a||l||c||p||t,t.dataset[s]||(t=v(t,i,s)),t.dataset.type===n.sO.OPTION&&(t=b(t));let u=t.dataset[i],I=t.dataset[s],S=t.dataset[o];return u||S||I||(t=w(t),u=t.dataset[i],I=t.dataset[s],S=t.dataset[o]),{nodeId:S,compInstanceId:u,slotId:I}},p=e=>{var t,o,n;if(!e.target||!(e.target instanceof HTMLElement))return!1;const i=e.target.closest(a.rC);return!!i&&"true"===(null===(t=i.children[0])||void 0===t||null===(o=t.children[0])||void 0===o||null===(n=o.children[0])||void 0===n?void 0:n.getAttribute("contenteditable"))},u=e=>{var t,o,n;if(null===e||void 0===e||!e.closest)return null;const i=null===e||void 0===e?void 0:e.closest(a.rC);return i?"true"===(null===(t=i.children[0])||void 0===t||null===(o=t.children[0])||void 0===o||null===(n=o.children[0])||void 0===n?void 0:n.getAttribute("contenteditable")):null},h=e=>{var t,o;if(null===e||void 0===e||!e.closest)return null;const n=null===e||void 0===e?void 0:e.closest(a.rC);return n?"scrolling-container"===(null===(t=n.children[0])||void 0===t?void 0:t.id)?null===(i=n.children[0])||void 0===i?void 0:i.children[0]:null===(o=n.children)||void 0===o?void 0:o[0]:null;var i},m=e=>{var t;if(null===e||void 0===e||!e.closest)return null;const o=null===e||void 0===e?void 0:e.closest(r._u);return o?null===(t=o.children)||void 0===t?void 0:t[0]:null},g=e=>{var t;if(null===e||void 0===e||!e.closest)return null;const o=null===e||void 0===e?void 0:e.closest(i.J);return o?null===(t=o.children)||void 0===t?void 0:t[0]:null},y=e=>{var t;if(null===e||void 0===e||!e.closest)return null;const o=null===e||void 0===e?void 0:e.closest(s.G);return o?null===(t=o.children)||void 0===t?void 0:t[0]:null},f=e=>{var t;return null!==e&&void 0!==e&&e.closest&&(null===(t=e.closest(`.${l.D}`))||void 0===t?void 0:t.firstElementChild)||null},b=e=>e.closest(n.sO.SELECT),w=e=>{let t=e.parentElement,o=e,n=!1;for(;t&&t.parentElement&&!n;){"dev-component"===t.dataset.type?(o=t,n=!0):(o=t,t=t.parentElement)}return n?o:e},v=(e,t,o)=>{if(!e.dataset[t])return e;let n=e.parentElement,i=e,r=!1;for(;n&&n.parentElement&&!r;){var s,l;const e="component"===n.dataset.type;if(e&&(null===(s=n.parentElement)||void 0===s||!s.dataset[t]||null!==(l=n.parentElement)&&void 0!==l&&l.dataset[o])){var c;r=!0,null!==(c=n.parentElement)&&void 0!==c&&c.dataset[o]&&(i=n);continue}const d=n.tagName.toLowerCase()===a.rC;n.dataset[t]||e||d?(i=n,n=n.parentElement):r=!0}return i}},7933:function(e,t,o){"use strict";o.d(t,{J:function(){return n}});const n="html-node"},95409:function(e,t,o){"use strict";o.d(t,{G:function(){return n}});const n="lottie-node"},61063:function(e,t,o){"use strict";o.d(t,{jk:function(){return r},vq:function(){return s},J$:function(){return a},vw:function(){return l},f8:function(){return c},Cu:function(){return d},vi:function(){return p}});var n=o(75222),i=o(63316);const r=e=>{if(!e)return null;return e.getRootNode().host.children[0]||null},s=(e,t)=>{var o;if(!t)return;const n=null===(o=e.parentElement)||void 0===o?void 0:o.ownerDocument;if(!n)return;const i=n.defaultView;if(!i)return;let r=0;const s=n.createRange();s.setStart(e,0),s.collapse(!0);const a=[e];let l=null,c=!1,d=!1;for(;!c&&(l=a.pop());){if(3!==l.nodeType){let e=l.childNodes.length;for(;e--;)a.push(l.childNodes[e]);continue}const e=r+(l.nodeValue||"").length;!d&&t.start>=r&&t.start<e&&(s.setStart(l,t.start-r),d=!0),d&&t.end>=r&&t.end<=e&&(s.setEnd(l,t.end-r),c=!0),r=e}const p=null===i||void 0===i?void 0:i.getSelection();null===p||void 0===p||p.removeAllRanges(),null===p||void 0===p||p.addRange(s)},a=(e,t)=>{if(t.nodeType===Node.TEXT_NODE){var o;const n=document.createRange();return null===n||void 0===n||n.setStart(t,null===(o=t.nodeValue)||void 0===o?void 0:o.length),n.collapse(!0),void(null===e||void 0===e||e.addRange(n))}if(1===t.childNodes.length&&t.childNodes[0].nodeType===Node.TEXT_NODE){var n;const o=document.createRange();return null===o||void 0===o||o.setStart(t.childNodes[0],null===(n=t.childNodes[0].nodeValue)||void 0===n?void 0:n.length),o.collapse(!0),void(null===e||void 0===e||e.addRange(o))}if(e){const o=document.createRange();return o.selectNodeContents(t),o.collapse(!1),void e.addRange(o)}if(t.createTextRange){const e=t.createTextRange();e.moveToElementText(t),e.collapse(!1),e.select()}},l=(e,t={})=>{if(t.styles){const o=t.styles;Object.keys(o).forEach((t=>{const n=o[t];if(n.tokenId){const i=e.designLanguage.tokensById[n.tokenId];if(!i)throw new Error(`Could not find design token: ${n.tokenId}`);o[t].tokenValue=o[t].value,o[t].value=i.value}}))}return t},c=e=>{const t=[n.RY.HEADING1,n.RY.HEADING2,n.RY.HEADING3,n.RY.HEADING4,n.RY.HEADING5,n.RY.HEADING6];return e.semanticType&&-1!==t.indexOf(e.semanticType)},d=(e,t)=>{if("string"!==typeof e||-1===e.indexOf("--dl"))return null;const o=e.replace("var(","").slice(0,-1),n=(0,i.kg)(o);if(!n.categoryName)return null;const r=Object.values(t).find((e=>e.name.toLowerCase()===n.categoryName));return r?(n.categoryName=r.name,"color"===n.type?`${n.name} (${n.categoryName})`:n.name):null},p=(e,t,o)=>{const n=e.replace("var(","").slice(0,-1),r=(0,i.kg)(n);if(!r.categoryName)return null;const s=Object.values(t).find((e=>e.name.toLowerCase()===r.categoryName.toLowerCase()));return s?Object.values(o).find((e=>e.categoryId===s.id&&e.name===r.name&&e.type===r.type)):null}},97197:function(e,t,o){"use strict";o.d(t,{yS:function(){return i}});var n=o(83359);const i=new n.Subject([])},47303:function(e,t,o){"use strict";o.d(t,{r:function(){return a}});var n=o(92809),i=o(33800),r=o(79113),s=new WeakMap;class a{constructor(){(0,n.Z)(this,"monaco",void 0),s.set(this,{writable:!0,value:{}})}attach(e){this.monaco=e}createModel(e,t,o){if(!this.monaco)throw new Error("Editor instance is missig");const n=this.getMonacoUri(e);this.updateTypings(e,t);const i=this.monaco.editor.getModel(n);return i||this.monaco.editor.createModel(t,o||(0,r.kC)(n.path),n)}deleteModel(e){const t=this.monaco.editor.getModel(this.getMonacoUri(e));if(t)t.dispose();else{const t=this.monaco.editor.getModels().find((t=>"inmemory"===t.uri.scheme&&t.uri.path===e));null===t||void 0===t||t.dispose()}}updateTypings(e,t){var o;if(null===(o="string"===typeof e?e:e.path)||void 0===o||!o.endsWith(".d.ts"))return;const n=this.getMonacoUri(e),r=(0,i.Z)(this,s)[n.path];null===r||void 0===r||r.dispose(),(0,i.Z)(this,s)[n.path]=this.monaco.languages.typescript.typescriptDefaults.addExtraLib(t,n.path.substring(1))}getMonacoUri(e){if(!this.monaco)throw new Error("Editor instance is missig");let t;if("string"===typeof e){const o=e.includes("file://")?e:"file://"+e;t=this.monaco.Uri.file(o)}else t=e;return t}}},82708:function(e,t,o){"use strict";o.d(t,{L:function(){return V}});var n=o(73202),i=o(92809),r=o(9626),s=o(33800),a=o(30773),l=o(76883),c=o(49899),d=o(45461);class p{constructor(e){(0,i.Z)(this,"line",void 0),(0,i.Z)(this,"column",void 0),(0,i.Z)(this,"id",void 0),(0,i.Z)(this,"label",void 0),(0,i.Z)(this,"color",void 0),(0,i.Z)(this,"preference",void 0);const{id:t,label:o,line:n,color:r,column:s,preference:a}=e;this.id=t,this.label=o,this.line=n,this.column=s,this.color=r,a&&(this.preference=a)}getId(){return this.id}getDomNode(){const e=document.createElement("div");return e.innerHTML=this.label,e.classList.add("editor-collaborator-widget"),e.style.background=this.color,e}getPosition(){return{position:{lineNumber:this.line,column:this.column},preference:this.preference}}}var u,h,m,g=o(74031),y=o(88439);let f=(u=(0,l.f3)("projectUIState"),h=class{constructor(e,t){(0,n.Z)(this,"projectUIState",m,this),(0,i.Z)(this,"activeWidgets",{}),(0,i.Z)(this,"editor",void 0),(0,i.Z)(this,"monaco",void 0),(0,i.Z)(this,"remove",(e=>{if(!e)return;const t=this.activeWidgets[e];t&&(this.editor.removeContentWidget(t),delete this.activeWidgets[e])})),this.setEditor(e,t)}setEditor(e,t){this.editor=e,this.monaco=t}render(e){var t,o;this.cleanupWidgets(Object.keys(e));const n=null===(t=this.projectUIState)||void 0===t||null===(o=t.devMode)||void 0===o?void 0:o.selectedFile,i=this.projectUIState.devMode.selectedBranch;Object.keys(e).forEach(((t,o)=>{const r=e[t];if(!r.selection||r.selectedFile!==n||r.selectedBranch!==i)return void this.remove(t);const s=o++%g.q.length,a=(0,y.$W)(g.q[s],.7),{endColumn:l,endLineNumber:c}=r.selection,{name:d,email:p}=r;this.addWidget({color:a,id:t,label:d||p||"unknown",line:c,column:l})}))}cleanup(){Object.keys(this.activeWidgets).forEach((e=>{this.remove(e)}))}addWidget(e){const{id:t}=e;if(this.activeWidgets[t])return void this.repositionWidget(e);e.preference=[this.monaco.editor.ContentWidgetPositionPreference.ABOVE,this.monaco.editor.ContentWidgetPositionPreference.BELOW];const o=new p(e);this.activeWidgets[t]=o,this.editor.addContentWidget(o)}cleanupWidgets(e){Object.keys(this.activeWidgets).reduce(((t,o)=>(-1===e.indexOf(o)&&t.push(o),t)),[]).forEach(this.remove)}repositionWidget(e){const{id:t,line:o,column:n}=e,i=this.activeWidgets[t];i.line=o,i.column=n,this.editor.layoutContentWidget(i)}},m=(0,a.Z)(h.prototype,"projectUIState",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h);var b=o(29527),w=o(93562),v=o(75642);class I{constructor(e,t,o){(0,i.Z)(this,"start",void 0),(0,i.Z)(this,"end",void 0),(0,i.Z)(this,"direction",void 0),this.start=e,this.end=t,this.direction=o}}var S,j,D,O,F,T=o(10440),N=o(36565);let E=(S=(0,l.f3)("projectFilesFlow"),j=(0,l.f3)("projectUIState"),D=class{constructor(e){var t;(0,n.Z)(this,"projectFilesFlow",O,this),(0,n.Z)(this,"projectUIState",F,this),(0,i.Z)(this,"doc",null),(0,i.Z)(this,"ytext",void 0),(0,i.Z)(this,"monaco",void 0),(0,i.Z)(this,"monacoHelper",void 0),(0,i.Z)(this,"monacoModel",void 0),(0,i.Z)(this,"editors",void 0),(0,i.Z)(this,"awareness",void 0),(0,i.Z)(this,"savedSelections",void 0),(0,i.Z)(this,"decorations",void 0),(0,i.Z)(this,"changeHandler",void 0),(0,i.Z)(this,"fileId",void 0),(0,i.Z)(this,"mux",void 0),(0,i.Z)(this,"handleContentChange",(e=>{this.projectUIState.devMode.githubBranches.underCreationSource||this.mux((()=>{var t;null===(t=this.doc)||void 0===t||t.transact((()=>{e.changes.sort(((e,t)=>t.rangeOffset-e.rangeOffset)).forEach((e=>{this.ytext.delete(e.rangeOffset,e.rangeLength),this.ytext.insert(e.rangeOffset,e.text)}))}),this)}))})),(0,i.Z)(this,"listenForEditorCursorChange",(e=>{e.onDidChangeCursorSelection((()=>{var t;if(e.getModel()!==this.monacoModel)return;if(this.projectUIState.devMode.githubBranches.underCreationSource)return;const o=e.getSelection();if(null===o)return;let n=this.monacoModel.getOffsetAt(o.getStartPosition()),i=this.monacoModel.getOffsetAt(o.getEndPosition());if(o.getDirection()===this.monaco.SelectionDirection.RTL){const e=n;n=i,i=e}null===(t=this.awareness)||void 0===t||t.setLocalStateField("selection",{anchor:b.w$(this.ytext,n),head:b.w$(this.ytext,i)})}))})),(0,i.Z)(this,"beforeTransaction",(()=>{this.mux((()=>{this.savedSelections=new Map,this.editors.forEach((e=>{if(e.getModel()!==this.monacoModel)return;const t=((e,t,o)=>{const n=e.getSelection();if(!n)return null;const i=n.getStartPosition(),r=n.getEndPosition(),s=b.w$(o,t.getOffsetAt(i)),a=b.w$(o,t.getOffsetAt(r));return new I(s,a,n.getDirection())})(e,this.monacoModel,this.ytext);null!==t&&this.savedSelections.set(e,t)}))}))})),(0,i.Z)(this,"rerenderDecorations",(()=>{this.editors.forEach((e=>{if(!this.doc||!this.awareness||e.getModel()!==this.monacoModel)return void this.decorations.delete(e);const t=this.decorations.get(e)||[],o=[];this.awareness.getStates().forEach(((e,t)=>{var n,i;if(t===(null===(n=this.doc)||void 0===n?void 0:n.clientID)||null===(i=e.selection)||void 0===i||!i.anchor||!e.selection.head)return;const r=b.or(e.selection.anchor,this.doc),s=b.or(e.selection.head,this.doc);if((null===r||void 0===r?void 0:r.type)!==this.ytext||(null===s||void 0===s?void 0:s.type)!==this.ytext)return;let a,l,c=null,d=null;r.index<s.index?(a=this.monacoModel.getPositionAt(r.index),l=this.monacoModel.getPositionAt(s.index),c="yRemoteSelectionHead",d=null):(a=this.monacoModel.getPositionAt(s.index),l=this.monacoModel.getPositionAt(r.index),c=null,d="yRemoteSelectionHead"),o.push({range:new this.monaco.Range(a.lineNumber,a.column,l.lineNumber,l.column),options:{className:"yRemoteSelection",afterContentClassName:c,beforeContentClassName:d}})})),this.decorations.set(e,e.deltaDecorations(t,o))}))})),(0,i.Z)(this,"ytextObserver",(e=>{this.projectFilesFlow.setFileUnderExternalUpdate(this.fileId),this.mux((()=>{let t=0;e.delta.forEach((e=>{if(void 0!==e.retain)t+=e.retain;else if(void 0!==e.insert){const o=this.monacoModel.getPositionAt(t),n=new this.monaco.Selection(o.lineNumber,o.column,o.lineNumber,o.column),i=e.insert;this.monacoModel.applyEdits([{range:n,text:i}]),t+=i.length}else{if(void 0===e.delete)throw w.zR();{const o=this.monacoModel.getPositionAt(t),n=this.monacoModel.getPositionAt(t+e.delete),i=new this.monaco.Selection(o.lineNumber,o.column,n.lineNumber,n.column);this.monacoModel.applyEdits([{range:i,text:""}])}}})),this.savedSelections.forEach(((e,t)=>{const o=((e,t,o,n,i)=>{if(!i)return;const r=b.or(n.start,i),s=b.or(n.end,i);if((null===r||void 0===r?void 0:r.type)!==o||(null===s||void 0===s?void 0:s.type)!==o)return null;const a=e.getModel();if(!a)return;const l=a.getPositionAt(r.index),c=a.getPositionAt(s.index);return t.Selection.createWithDirection(l.lineNumber,l.column,c.lineNumber,c.column,n.direction)})(t,this.monaco,this.ytext,e,this.doc);o&&t.setSelection(o)}))})),this.projectFilesFlow.setFileUnderExternalUpdate(null),this.debounceHandleTypesChange(this.monacoModel.getValue()),this.rerenderDecorations(),e.transaction.local&&this.debounceHandleEditorChange(this.monacoModel.getValue())})),(0,i.Z)(this,"destroy",(()=>{var e;this.changeHandler.dispose(),this.ytext.unobserve(this.ytextObserver),null===(e=this.doc)||void 0===e||e.off("beforeAllTransactions",this.beforeTransaction),null!==this.awareness&&this.awareness.off("change",this.rerenderDecorations)})),(0,i.Z)(this,"handleEditorChange",(e=>{this.projectFilesFlow.updateFile({fileId:this.fileId,content:e}),N.Z.customEvents.customCode.file.update({fileContent:e,fileName:this.fileId||""})})),(0,i.Z)(this,"debounceHandleEditorChange",(0,T.Ds)((e=>this.handleEditorChange(e)),500,!1)),(0,i.Z)(this,"debounceHandleTypesChange",(0,T.Ds)((e=>this.monacoHelper.updateTypings(this.fileId,e)),500,!1));const{ytext:o,monacoModel:r,fileId:s,monaco:a,awareness:l=null,monacoHelper:c}=e,{editors:d=new Set}=e;this.doc=o.doc,this.ytext=o,this.fileId=s,this.monacoModel=r,this.editors=d,this.awareness=l,this.monaco=a,this.mux=(0,v.M)(),this.monacoHelper=c,this.savedSelections=new Map,this.decorations=new Map,null===(t=this.doc)||void 0===t||t.on("beforeAllTransactions",this.beforeTransaction),o.observe(this.ytextObserver),r.setValue(o.toString()),this.changeHandler=r.onDidChangeContent(this.handleContentChange),r.onWillDispose(this.destroy),l&&d.forEach((e=>{this.listenForEditorCursorChange(e),l.on("change",this.rerenderDecorations)}))}},O=(0,a.Z)(D.prototype,"projectFilesFlow",[S],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),F=(0,a.Z)(D.prototype,"projectUIState",[j],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D);var C,x,P,k,M,Z,U,A,L,_,R,B,H,z,$,G;let V=(C=(0,l.f3)("globalAppState"),x=(0,l.f3)("webRTCState"),P=(0,l.f3)("rtcFlow"),k=(0,l.f3)("projectDoc"),M=(0,l.f3)("projectUIState"),Z=(0,l.f3)("projectChangesFlow"),U=(0,l.f3)("yDocumentManagementFlow"),G=new WeakMap,A=class{constructor(e=!1,t){(0,n.Z)(this,"globalAppState",L,this),(0,n.Z)(this,"webRTCState",_,this),(0,n.Z)(this,"rtcFlow",R,this),(0,n.Z)(this,"projectDoc",B,this),(0,n.Z)(this,"projectUIState",H,this),(0,n.Z)(this,"projectChangesFlow",z,this),(0,n.Z)(this,"yDocumentManagementFlow",$,this),(0,i.Z)(this,"widgetManager",void 0),(0,i.Z)(this,"editor",void 0),(0,i.Z)(this,"monaco",void 0),(0,i.Z)(this,"monacoHelper",void 0),(0,i.Z)(this,"typingsLoader",void 0),(0,i.Z)(this,"modelIsBinding",!1),(0,i.Z)(this,"selectedFile",null),(0,i.Z)(this,"lastEditorSelection",null),(0,i.Z)(this,"currentBinding",null),(0,i.Z)(this,"initialized",!1),(0,i.Z)(this,"usedForConflicts",!1),(0,i.Z)(this,"onModelBind",null),G.set(this,{writable:!0,value:[]}),(0,i.Z)(this,"attach",(async(e,t,o,n)=>{var i,r;if(this.editor=e,this.monaco=t,this.typingsLoader=o,this.monacoHelper=n,this.selectedFile=this.usedForConflicts?this.projectUIState.devMode.selectedConflictFile:(null===(i=this.projectUIState)||void 0===i||null===(r=i.devMode)||void 0===r?void 0:r.selectedFile)||d.e3,!this.selectedFile&&this.usedForConflicts){const e=this.projectUIState.devMode.selectedBranch,t=this.projectDoc.projectFiles.conflicts[e];this.selectedFile=Object.keys(t.byId)[0]}await this.loadFileData(),this.widgetManager?(this.widgetManager.cleanup(),this.widgetManager.setEditor(this.editor,this.monaco)):this.widgetManager=new f(this.editor,this.monaco),this.initialized||(this.listenForDataChanges(),this.listenForEditorChanges(),this.initialized=!0)})),(0,i.Z)(this,"collaboratorsExistOnFile",(e=>Object.values(this.webRTCState.devData).some((t=>t.selectedFile===e)))),(0,i.Z)(this,"detach",(()=>{var e;(0,s.Z)(this,G).forEach((e=>e())),(0,r.Z)(this,G,[]),null===(e=this.widgetManager)||void 0===e||e.cleanup(),this.initialized=!1})),(0,i.Z)(this,"loadFileData",(async(e=0)=>{var t,o;if(!this.selectedFile)return;this.currentBinding&&(this.currentBinding.destroy(),this.currentBinding=null);const n=this.yDocumentManagementFlow.getText(this.selectedFile);if(n)return void this.bindEditor(n);const i=this.selectedFile,r=this.projectUIState.devMode.selectedBranch,s=null===(t=this.projectDoc.projectFiles.local[r])||void 0===t||null===(o=t.byId[i])||void 0===o?void 0:o.code;return this.typingsLoader(s),await this.yDocumentManagementFlow.setText(i,s),e>=5?this.projectChangesFlow.handleSocketConnectionLost():e?new Promise((t=>{setTimeout((async()=>(await this.loadFileData(++e),t())),1e3)})):void(await this.loadFileData(++e))})),(0,i.Z)(this,"bindEditor",(e=>{if(!this.editor||!this.monaco||!this.selectedFile)return;const t=this.editor.getModel();if(!t)return;this.modelIsBinding=!0,this.onModelBind&&this.onModelBind(!0);const o=this.selectedFile,n=this.monaco.Uri.file(`file://${this.usedForConflicts?"conflict-":""}${o}`);if(t.uri.path!==n.path){var i,r;const e=this.switchModelToNewUri(t,n);this.editor.setModel(e);const o=null===(i=this.projectUIState.userPreferences.devFileViewState)||void 0===i||null===(r=i.local)||void 0===r?void 0:r[this.selectedFile];o&&this.editor.restoreViewState(o)}this.currentBinding=new E({ytext:e,fileId:this.selectedFile,monacoModel:this.editor.getModel(),monacoHelper:this.monacoHelper,editors:new Set([this.editor]),monaco:this.monaco,awareness:this.yDocumentManagementFlow.getAwareness()}),this.modelIsBinding=!1,this.onModelBind&&this.onModelBind(!1)})),(0,i.Z)(this,"switchModelToNewUri",((e,t)=>{const o=this.monaco.editor.getModel(t);if(o)return o;const n=this.monacoHelper.createModel(t,e.getValue(),e.getLanguageId().language);return this.monacoHelper.deleteModel(e.uri.path),n})),(0,i.Z)(this,"listenForEditorChanges",(()=>{const e=this.editor.onDidChangeCursorPosition(this.handleCursorPositionChange);(0,s.Z)(this,G).push((()=>{e.dispose()}))})),(0,i.Z)(this,"listenForDataChanges",(()=>{const e=(0,c.Ys)(this.webRTCState,["devData/*","devData","devData/**"],(({devData:e})=>{this.widgetManager.render(e)}),"SubForRtcDataChanges");if(this.usedForConflicts){const e=(0,c.Ys)(this.projectUIState,["devMode/selectedConflictFile"],(async({devMode:e})=>{const{selectedConflictFile:t}=e;t!==this.selectedFile&&(this.selectedFile=t,await this.loadFileData(),this.widgetManager.render(this.webRTCState.devData))}),"SubForSelectedConflictFile");(0,s.Z)(this,G).push((()=>{e.dispose()}))}else{const e=(0,c.Ys)(this.projectUIState,["devMode/selectedFile","devMode/selectedFile/*"],(async({devMode:e})=>{const{selectedFile:t}=e;t!==this.selectedFile&&(this.selectedFile=t,await this.loadFileData(),this.widgetManager.render(this.webRTCState.devData))}),"SubForSelectedFile");(0,s.Z)(this,G).push((()=>{e.dispose()}))}(0,s.Z)(this,G).push((()=>{e.dispose()}))})),(0,i.Z)(this,"handleCursorPositionChange",(e=>{const t=this.monaco.editor.CursorChangeReason.RecoverFromMarkers,o=this.monaco.editor.CursorChangeReason.NotSet,n=1===e.position.column&&1===e.position.lineNumber;if((e.reason===t||e.reason===o&&n)&&this.lastEditorSelection)return void this.editor.setSelection(this.lastEditorSelection);const i=this.editor.getSelection();if(!i)return;this.lastEditorSelection=i;const{startColumn:r,endColumn:s,startLineNumber:a,endLineNumber:l}=i;this.rtcFlow.notifyDevModeDataChange({selectedBranch:this.projectUIState.devMode.selectedBranch||void 0,selectedFile:this.selectedFile||void 0,selection:{startColumn:r,endColumn:s,startLineNumber:a,endLineNumber:l}})})),this.usedForConflicts=e,t&&(this.onModelBind=t)}},L=(0,a.Z)(A.prototype,"globalAppState",[C],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_=(0,a.Z)(A.prototype,"webRTCState",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),R=(0,a.Z)(A.prototype,"rtcFlow",[P],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),B=(0,a.Z)(A.prototype,"projectDoc",[k],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),H=(0,a.Z)(A.prototype,"projectUIState",[M],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z=(0,a.Z)(A.prototype,"projectChangesFlow",[Z],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$=(0,a.Z)(A.prototype,"yDocumentManagementFlow",[U],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A)},79113:function(e,t,o){"use strict";o.d(t,{YP:function(){return a},WK:function(){return s},Oh:function(){return r},kC:function(){return i}});var n=o(26470);const i=e=>{if(!e)return"javascript";const t=e.split("."),o=t[t.length-1];switch(o){case"js":case"jsx":return"javascript";case"ts":case"tsx":case".d.ts":return"typescript";default:return o||"javascript"}},r=e=>{if(!e)return null;const t=new Date(e),o=t.getHours()%12;return t.getDate()+"-"+(t.getMonth()+1)+"-"+t.getFullYear()+" | "+o+":"+t.getMinutes()+(t.getHours()>12?" pm":" am")},s=e=>{const t=(0,n.parse)(e).ext;return a(t)},a=e=>!!["js","ts","jsx","tsx",".js",".ts",".jsx",".tsx"].includes(e)},49249:function(e,t,o){"use strict";o.d(t,{G:function(){return n}});const n=e=>{const t=document.getElementById("stage-frame");return t&&t.contentDocument?t.contentDocument.querySelector(`[data-node-id="${e}"]`):null}},71646:function(e,t,o){"use strict";o.d(t,{kb:function(){return n},Cr:function(){return i},K:function(){return r},un:function(){return s}});const n=e=>{const{source:t,target:o,type:n,modifier:i,eventParams:r}=e,s=e=>{(e=>{const{ev:t,target:o,modifier:n}=e;t.stopImmediatePropagation();const i=new CustomEvent(`proxy:${t.type}`,{detail:{originalEvent:t,modifier:n?n(t):{}},bubbles:!0,composed:!0,cancelable:!0});o.dispatchEvent(i)})({ev:e,modifier:i,target:o})};return r?t.addEventListener(n,s,r):t.addEventListener(n,s),()=>{t.removeEventListener(n,s)}},i=e=>{const{types:t,source:o,target:i,modifier:r}=e;return t.map((e=>n({type:e,source:o,target:i,modifier:r})))},r=e=>{const{callback:t,type:o,target:n}=e,i=e=>{const o=e.detail.originalEvent;t(o,e)};return n.addEventListener(`proxy:${o}`,i),()=>{n.removeEventListener(`proxy:${o}`,i)}},s=e=>{const{types:t,target:o,callback:n}=e;return t.map((e=>r({target:o,callback:n,type:e})))}},30264:function(e){let t=0;const o={existsSync:function(){return!1},statSync:e=>"sourcePath"===e?{mtimeMs:self.BUILD_ID}:{mtimeMs:++t},readFileSync:e=>self[e]||"",readFile:e=>self[e]||"",writeFile:(e,t)=>{}};e.exports=o},9425:function(e,t,o){var n={"./banner1.json":[45356,45356],"./banner2.json":[61944,61944],"./banner3.json":[34988,34988],"./banner4.json":[54766,54766],"./banner5.json":[13319,13319],"./blog1.json":[48371,48371],"./blog2.json":[62810,83578],"./blog3.json":[4806,4806],"./blog4.json":[9711,9711],"./blogpostcard1.json":[94110,94110],"./blogpostcard2.json":[55181,55181],"./blogpostcard3.json":[81329,81329],"./blogpostcard4.json":[53089,53089],"./dropdown.json":[7100,7100],"./featurecard1.json":[87114,87114],"./featurecard2.json":[8781,8781],"./featurecard3.json":[90784,90784],"./featurecard4.json":[50490,50490],"./features1.json":[79094,79094],"./features2.json":[21271,21271],"./features3.json":[95924,95924],"./features4.json":[21993,21993],"./footer1.json":[73014,73014],"./footer2.json":[27281,27281],"./footer3.json":[22945,22945],"./footer4.json":[31298,31298],"./gallery1.json":[26062,26062],"./gallery2.json":[98899,98899],"./gallery3.json":[12874,12874],"./gallery4.json":[4206,16883],"./gallerycard1.json":[50456,50456],"./gallerycard2.json":[52641,52641],"./gallerycard3.json":[2256,2256],"./header1.json":[57722,57722],"./header2.json":[31848,31848],"./header3.json":[90547,90547],"./header4.json":[3693,3693],"./header5.json":[85724,85724],"./header6.json":[3479,3479],"./hero1.json":[64907,64907],"./hero2.json":[72127,72127],"./hero3.json":[25263,25263],"./hero4.json":[69036,69036],"./hero5.json":[90489,90489],"./hero6.json":[53882,53882],"./navbar.json":[8701,8701],"./navigationlinks.json":[95591,95591],"./pricing1.json":[29476,29476],"./pricing2.json":[44411,44411],"./pricing3.json":[49954,49954],"./sidebar1.json":[24934,24934],"./sidebar2.json":[90335,90335],"./sidebar3.json":[82083,82083],"./socialbar.json":[7614,7614],"./stats1.json":[37266,37266],"./stats2.json":[50250,50250],"./steps1.json":[65969,65969],"./steps2.json":[87347,87347],"./testimonial1.json":[68187,68187],"./testimonial2.json":[87651,87651],"./testimonial3.json":[98240,98240],"./testimonial4.json":[72306,72306],"./testimonialcard1.json":[73110,73110],"./testimonialcard2.json":[63509,63509],"./testimonialcard3.json":[28492,28492],"./testimonialcard4.json":[88856,88856]};function i(e){if(!o.o(n,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],i=t[0];return o.e(t[1]).then((function(){return o.t(i,19)}))}i.keys=function(){return Object.keys(n)},i.id=9425,e.exports=i},73274:function(e,t,o){var n={"./thq-dropdown/thq-dropdown-arrow.json":[29882,29882],"./thq-dropdown/thq-dropdown-list.json":[63697,63697],"./thq-navbar/thq-navbar.json":[26953,26953]};function i(e){if(!o.o(n,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=n[e],i=t[0];return o.e(t[1]).then((function(){return o.t(i,19)}))}i.keys=function(){return Object.keys(n)},i.id=73274,e.exports=i}}]);
