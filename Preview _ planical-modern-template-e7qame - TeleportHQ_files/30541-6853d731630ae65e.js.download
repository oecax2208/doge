"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[30541],{80427:function(e,t,n){n.d(t,{S:function(){return p}});var o=n(65988),i=n(67294),s=n(11847),r=n(26545),d=n(92763),a=n(55193),l=n(89361),c=n(65989),h=n(36565),u=n(85893);const p=({iconType:e,id:t,title:n,buttonTitle:p,iconPosition:m,buttonStyle:v="solid",buttonSize:f="small",size:y="default",children:I,preHeaderVisible:g})=>{const{0:b,1:w}=(0,i.useState)(!1),S=(0,i.useRef)(null),D=()=>{w(!b);let e="";p?e=p:n&&(e=n),"Export Project"===e?(h.Z.mixpanelEvent(h.Z.AnalyticsEvents.PROJECT_SIDEBARS_TOP_EXPORT_CODE),h.Z.customEvents.project.sidebars.top.exportCode()):"Publish"===e&&(h.Z.mixpanelEvent(h.Z.AnalyticsEvents.PROJECT_SIDEBARS_TOP_PUBLISH),h.Z.customEvents.project.sidebars.top.publishProject.publish())};return(0,r.O)(S,(e=>{var t;null!==(t=e.target)&&void 0!==t&&t.closest(".modal-wrapper")||w(!1)})),(0,u.jsxs)("div",{ref:S,className:`jsx-${s.W.__hash} `+o.default.dynamic([["3062088968",[s.x,g?92:58,b?"visible":"hidden",p?22:10,c.N_.TWO_UNITS]]]),children:[e&&!m&&(0,u.jsx)("div",{className:`jsx-${s.W.__hash} `+o.default.dynamic([["3062088968",[s.x,g?92:58,b?"visible":"hidden",p?22:10,c.N_.TWO_UNITS]]])+" dropdown",children:(0,u.jsx)(a.C,{isPressed:b,style:"transparent",shape:"square",cornerStyle:"sharp",size:"medium-large",onChange:D,id:t,title:n,dataAttrs:{"data-tooltip-direction":"vertical"},children:(0,u.jsx)(d.J,{type:e})})}),e&&m&&p&&(0,u.jsxs)(l.z,{id:t,size:f,style:v,colorScheme:"neutral",onClick:D,children:["left"===m&&(0,u.jsx)(d.J,{type:e}),p,"right"===m&&(0,u.jsx)(d.J,{type:e})]}),p&&!e&&(0,u.jsx)("div",{className:`jsx-${s.W.__hash} `+o.default.dynamic([["3062088968",[s.x,g?92:58,b?"visible":"hidden",p?22:10,c.N_.TWO_UNITS]]])+" dropdown text-button",children:(0,u.jsx)(l.z,{id:t,size:f,style:v,colorScheme:"accent",onClick:D,children:p})}),(0,u.jsx)("div",{style:{display:b?"block":"none"},className:`jsx-${s.W.__hash} `+o.default.dynamic([["3062088968",[s.x,g?92:58,b?"visible":"hidden",p?22:10,c.N_.TWO_UNITS]]])+" "+`${s.x} ${y}`,children:I}),(0,u.jsx)(o.default,{id:"3062088968",dynamic:[s.x,g?92:58,b?"visible":"hidden",p?22:10,c.N_.TWO_UNITS],children:[`.${s.x}.__jsx-style-dynamic-selector{top:${g?92:58}px;}`,`.dropdown.__jsx-style-dynamic-selector::after{visibility:${b?"visible":"hidden"};bottom:-${p?22:10}px;}`,`.text-button.__jsx-style-dynamic-selector{margin:0 ${c.N_.TWO_UNITS};}`]}),(0,u.jsx)(o.default,{id:s.W.__hash,children:s.W})]})}},11847:function(e,t,n){n.d(t,{x:function(){return i},W:function(){return s}});var o=n(65989);const i="thq-panel-dropdown",s=[`.${i}.jsx-3994884047{position:fixed;background:${o.Pt.DEFAULT};display:block;right:0;top:58px;width:320px;z-index:${o.kg.THIRTY};box-shadow:${o.E6.DARK_DROP_DOWN};padding:${o.N_.TWO_UNITS};}`,`.${i}.wide.jsx-3994884047{width:480px;}`,".dropdown.jsx-3994884047{position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;}",`.dropdown.jsx-3994884047::after{content:'';position:absolute;left:17px;width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-bottom:8px solid ${o.Pt.DEFAULT};z-index:${o.kg.FORTY};}`,`.${i}.jsx-3994884047 hr{background:${o.GC.LIGHT};height:1px;margin-left:-12px;margin-right:-12px;}`];s.__hash="3994884047"},54335:function(e,t,n){n.d(t,{h:function(){return i},o:function(){return s}});var o=n(65989);const i="menu-container",s=[`.${i}.jsx-232488806{position:absolute;top:26px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;height:auto;border-radius:${o.n_.DEFAULT};background-color:${o.Pt.DARK_01};outline:none;z-index:${o.kg.ONEHUNDRED};}`,`.${i}.jsx-232488806 .section-header{height:36px;border-bottom:1px solid var(--color-neutral-500);padding:0 ${o.N_.TWO_UNITS};cursor:-webkit-grab;cursor:-moz-grab;cursor:grab;}`,`.${i}.jsx-232488806 .section-content{padding:${o.N_.UNIT} ${o.N_.ONE_AND_HALF};}`];s.__hash="232488806"},2100:function(e,t,n){n.d(t,{V:function(){return z}});var o,i,s,r,d,a,l,c,h,u,p,m,v,f,y,I,g,b,w,S,D,M,N,C,E,O=n(73202),T=n(92809),R=n(30773),j=(n(67294),n(76883)),F=n(77729),Z=n(56516),x=n(63410),P=n(75222),k=n(49899),A=n(12293),U=n(60408),L=n(85893);let z=(o=(0,j.f3)("projectDoc"),i=(0,j.f3)("projectUIState"),s=(0,j.f3)("nodeManagementFlow"),r=(0,j.f3)("nodeEditingFlow"),d=(0,j.f3)("nodeRichTextFlow"),a=(0,j.f3)("clipboardFlow"),l=(0,j.f3)("absolutePositionedLayerFlow"),c=(0,j.f3)("componentManagementFlow"),h=(0,j.f3)("elementRefProvider"),u=(0,j.f3)("imageTransformationFlow"),p=(0,j.f3)("nodeStyleManagmentFlow"),m=(0,j.f3)("nodeSelectionFlow"),v=class{constructor(){(0,O.Z)(this,"projectDoc",f,this),(0,O.Z)(this,"projectUIState",y,this),(0,O.Z)(this,"nodeManagementFlow",I,this),(0,O.Z)(this,"nodeEditingFlow",g,this),(0,O.Z)(this,"nodeRichTextFlow",b,this),(0,O.Z)(this,"clipboardFlow",w,this),(0,O.Z)(this,"absolutePositionedLayerFlow",S,this),(0,O.Z)(this,"componentManagementFlow",D,this),(0,O.Z)(this,"elementRefProvider",M,this),(0,O.Z)(this,"imageTransformationFlow",N,this),(0,O.Z)(this,"nodeStyleManagmentFlow",C,this),(0,O.Z)(this,"nodeSelectionFlow",E,this),(0,T.Z)(this,"sensorSource",document),(0,T.Z)(this,"nodeId",""),(0,T.Z)(this,"compInstanceId",void 0),(0,T.Z)(this,"multiselectMode",!1),(0,T.Z)(this,"handleStartRename",(()=>{this.nodeManagementFlow.setRenamedNode(this.nodeId)})),(0,T.Z)(this,"getNodesToBeChanged",(()=>{const{nodeId:e,multiselectMode:t}=this,n=this.projectUIState.selection.nodes;return t||n[e]?Object.keys(n):[e]})),(0,T.Z)(this,"handleConvertToComponent",(()=>{if(this.multiselectMode)return this.handleConvertMultipleNodesToComponent();const e=this.projectUIState.selection.componentId;this.nodeManagementFlow.convertNodesToComponent({nodeIds:[this.nodeId],compId:e})})),(0,T.Z)(this,"handleDetachComponentInstance",(()=>{this.componentManagementFlow.detachComponentInstance({componentInstanceId:this.nodeId})})),(0,T.Z)(this,"handleChangeVisibility",(e=>{const t=this.getNodesToBeChanged();this.nodeStyleManagmentFlow.updateNodesVisibility({hide:e,nodeIds:t})})),(0,T.Z)(this,"handleUngroupNodes",(e=>{!e||Object.keys((null===e||void 0===e?void 0:e.childrenIds)||{}).length||this.multiselectMode?this.nodeManagementFlow.ungroupNodeChildren({nodeId:this.nodeId}):this.handleDeleteNode()})),(0,T.Z)(this,"handleCreateLink",(()=>{this.nodeRichTextFlow.toggleAddLink()})),(0,T.Z)(this,"handleCopyText",(async()=>{const e=this.projectDoc.nodes.byId[this.nodeId];if(!e)return;this.resetOSClipboard();const t=this.nodeRichTextFlow.getTextComponentForNode(e.id);if(!t)return;const n=t.getSelectionTextContent();n&&(await navigator.clipboard.writeText(n),(0,k.JG)(this.projectUIState,(e=>{e.currentTextInClipboard=n})))})),(0,T.Z)(this,"handlePasteText",(async()=>{const e=await navigator.clipboard.readText();if(!e||""===e)return;const t=this.projectDoc.nodes.byId[this.nodeId];if(!t)return;const n=this.nodeRichTextFlow.getTextComponentForNode(t.id);n&&n.replaceRangeContent(e)})),(0,T.Z)(this,"handleCutText",(async()=>{var e;const t=this.projectDoc.nodes.byId[this.nodeId];if(!t)return;this.resetOSClipboard();const n=this.nodeRichTextFlow.getTextComponentForNode(t.id);if(!n)return;const o=n.getSelectionTextContent();o&&(await navigator.clipboard.writeText(o),null===(e=n.shadowRoot)||void 0===e||e.ownerDocument.execCommand("cut"))})),(0,T.Z)(this,"handleDeleteNode",(()=>{const e=this.getNodesToBeChanged();this.nodeManagementFlow.deleteNodesById({nodeIds:e})})),(0,T.Z)(this,"handleCopyNode",(()=>{this.resetOSClipboard();const e=this.getNodesToBeChanged();this.clipboardFlow.copyNodesById(e)})),(0,T.Z)(this,"handleCopyMainComponentToClipboard",(()=>{const e=this.projectDoc.nodes.byId[this.nodeId];if(!e||!this.projectDoc.nodes.nodeIsCompInstance(e))return;const t=e.compIdOfCompInstance;t&&this.clipboardFlow.copyComponentToClipboard(t)})),(0,T.Z)(this,"handleCutNode",(()=>{this.resetOSClipboard();const e=this.getNodesToBeChanged();this.clipboardFlow.copyNodesById(e,!0)})),(0,T.Z)(this,"handleDuplicateNode",(()=>{const e=this.getNodesToBeChanged();this.nodeManagementFlow.duplicateNodesById({nodeIds:e})})),(0,T.Z)(this,"handlePasteStyle",(()=>{const e=this.getNodesToBeChanged();this.clipboardFlow.pasteCopiedStyleToTargets(e)})),(0,T.Z)(this,"handlePasteClassesStyle",(()=>{const e=this.getNodesToBeChanged();this.clipboardFlow.pasteCopiedClassesStyleToTargets(e)})),(0,T.Z)(this,"handleGroupNodes",(()=>{const e=this.getNodesToBeChanged();this.nodeManagementFlow.groupNodes({nodeIds:e})})),(0,T.Z)(this,"handleConvertMultipleNodesToComponent",(()=>{const e=this.projectUIState.selection.componentId,t=this.getNodesToBeChanged();this.nodeManagementFlow.convertNodesToComponent({nodeIds:t,compId:e})})),(0,T.Z)(this,"isMultiselect",(()=>{const e=Object.keys(this.projectUIState.selection.nodes);return e.length>1&&e.indexOf(this.nodeId)>-1})),(0,T.Z)(this,"handleContextualMenu",(e=>{const t=e,{nodeId:n,insideGroup:o,insideEditable:i,origin:s,originalEvent:r,compInstanceId:d}=t.detail;if(r.preventDefault(),this.projectUIState.userInteractions.inPreviewMode)return;const a=this.projectDoc.nodes.byId[n||""];a&&(this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(a.id).slotId||a.primitiveType===P.sO.SLOT)?(this.nodeId=n||"",this.compInstanceId=d):this.nodeId=d||n||"",this.multiselectMode=o||this.isMultiselect();const l=this.generateContextMenuItems(i),c=(0,x.FG)(r);if("stage"===s){var h;const e=null===(h=this.elementRefProvider.getIframeRef())||void 0===h?void 0:h.current;if(!e)return;const t=e.getBoundingClientRect(),n=this.projectUIState.stage.webComp.controlValues.scale;c.x=c.x*n+t.x,c.y=c.y*n+t.y}this.absolutePositionedLayerFlow.showContextMenu((0,L.jsx)(Z.x,{menuItems:l,eventPosition:c}),c)})),(0,T.Z)(this,"handleTurnIntoContainer",(e=>{if(!e)return;const t=this.elementRefProvider.getDomNodeElementRefById(e.id);t&&this.imageTransformationFlow.turnImageIntoContainer({nodeId:e.id,width:null===t||void 0===t?void 0:t.getBoundingClientRect().width,height:null===t||void 0===t?void 0:t.getBoundingClientRect().height})})),(0,T.Z)(this,"handleImageTransformation",(e=>{e&&this.imageTransformationFlow.extractImageFromContainer({nodeId:null===e||void 0===e?void 0:e.id})}))}areTopLevelNodesSiblings(){const e=this.getNodesToBeChanged(),t=this.projectDoc.nodes.getOrderedTopLevelNodes(e);return this.projectDoc.nodes.areNodesSiblings(t)}areButtonChildren(){const e=this.getNodesToBeChanged(),t=this.projectDoc.nodes.byId[e[0]];if(!t||!t.parentId)return!1;const n=this.projectDoc.nodes.byId[t.parentId];return(null===n||void 0===n?void 0:n.primitiveType)===P.sO.BUTTON}resetOSClipboard(){navigator.clipboard.writeText("")}attach(e){var t,n;e&&(this.sensorSource=e),null===(t=this.sensorSource)||void 0===t||t.addEventListener("uidl-node:contextmenu",this.handleContextualMenu),null===(n=this.sensorSource)||void 0===n||n.addEventListener("node-addon-container:contextmenu",this.handleContextualMenu)}detach(){var e,t;null===(e=this.sensorSource)||void 0===e||e.removeEventListener("uidl-node:contextmenu",this.handleContextualMenu),null===(t=this.sensorSource)||void 0===t||t.removeEventListener("node-addon-container:contextmenu",this.handleContextualMenu)}getItems(e){const{node:t,isRootNode:n,isComponentInstance:o,isDevComponent:i,isContent:s,isImage:r,isSlot:d,isEmbed:a,isSlotInstance:l,isInButton:c,canTurnIntoImage:h,isRichElement:u,isHidden:p,isInteractiveCopy:m,isInteractiveShow:v}=e,f=(0,L.jsx)("span",{style:{position:"absolute",marginTop:-2,marginLeft:2},children:(0,L.jsx)(U.s,{tooltipTriggerArea:"sm",tooltipName:"Interactive Node Show Context Menu",tooltipContent:"Editing or removing some properties of interactive nodes is not allowed."})}),y=(0,L.jsx)("span",{style:{position:"absolute",marginTop:-2,marginLeft:2},children:(0,L.jsx)(U.s,{tooltipTriggerArea:"sm",tooltipName:"Interactive Node Copy Context Menu",tooltipContent:"Copying and pasting interactive node elements is permitted only inside interactive root nodes."})});return[{label:F.dU.EDIT,action:()=>this.nodeEditingFlow.beginEditingNode(this.nodeId),showOption:s||a},{label:(0,L.jsxs)("p",{children:[F.dU.COPY,m&&y]}),action:this.handleCopyNode,showOption:!d},{label:F.dU.COPY_COMPONENT_TO_CLIPBOARD,action:this.handleCopyMainComponentToClipboard,showOption:!this.multiselectMode&&o},{label:F.dU.CUT,action:this.handleCutNode,showOption:!n&&!d},{label:F.dU.PASTE,disabled:!this.projectUIState.userInteractions.clipboard.copiedNodes||i,action:()=>this.clipboardFlow.pasteCopiedNodes(this.nodeId),showOption:!this.multiselectMode&&!(d&&!l)},{label:F.dU.PASTE_SPECIAL,showOption:!d,disabled:!1,subMenu:[{label:F.dU.PASTE_FROM_CLIPBOARD,action:async()=>await this.clipboardFlow.pasteFromExternalCopyEvent(),disabled:navigator.userAgent.includes("Firefox"),disabledTooltip:" Clipboard pasting is not supported in Firefox",showOption:!0},{label:F.dU.PASTE_STYLE,disabled:!this.projectUIState.userInteractions.clipboard.copiedNodes||i,action:this.handlePasteStyle,showOption:!o},{label:F.dU.PASTE_CLASSES,disabled:!this.projectUIState.userInteractions.clipboard.copiedNodes||i,action:this.handlePasteClassesStyle,showOption:!o&&!n}]},{label:F.dU.DUPLICATE,action:this.handleDuplicateNode,showOption:!n&&!l,disabled:d},{label:F.dU.RENAME,action:this.handleStartRename,showOption:!this.multiselectMode&&!l,disabled:this.projectUIState.userPreferences.showElementTag||i},{label:F.dU.UNRICH,action:()=>this.nodeRichTextFlow.removeRichStylesFromNode({nodeId:null===t||void 0===t?void 0:t.id}),showOption:u},{label:F.dU.DELETE,action:this.handleDeleteNode,showOption:!n&&!l},{label:(0,L.jsxs)("p",{children:[F.dU.SHOW,v&&f]}),action:()=>this.handleChangeVisibility(),showOption:p&&!n&&!d,disabled:v},{label:(0,L.jsxs)("p",{children:[F.dU.HIDE,v&&f]}),action:()=>this.handleChangeVisibility(!0),showOption:!p&&!n&&!d,disabled:v},{label:F.dU.GROUP,action:this.handleGroupNodes,disabled:!this.areTopLevelNodesSiblings()||this.areButtonChildren()||l,separatorBefore:!0,showOption:!n&&!l},{label:F.dU.UNGROUP,action:()=>this.handleUngroupNodes(t),disabled:!!this.multiselectMode||((null===t||void 0===t?void 0:t.primitiveType)!==P.sO.CONTAINER||!(null===t||void 0===t||!t.compIdOfRootNode)||o),showOption:!n&&!d},{label:F.dU.SELECT_PARENT,action:()=>this.nodeSelectionFlow.selectNodeParent(null===t||void 0===t?void 0:t.id,this.compInstanceId),showOption:!n&&!this.multiselectMode},{label:F.dU.TURN_INTO_CONTAINER,action:()=>this.handleTurnIntoContainer(t),showOption:!o&&!this.multiselectMode&&r,disabled:c},{label:F.dU.TURN_INTO_IMAGE,action:()=>this.handleImageTransformation(t),showOption:!o&&!this.multiselectMode&&!n&&h},{label:F.dU.DETACH_INSTANCE,action:this.handleDetachComponentInstance,separatorBefore:!0,showOption:!this.multiselectMode&&o},{label:F.dU.MAKE_COMPONENT,action:this.handleConvertToComponent,separatorBefore:!0,disabled:!!this.multiselectMode&&!this.areTopLevelNodesSiblings()||!(!t||!(0,A.U2)(this.projectDoc,null===t||void 0===t?void 0:t.id,P.IV.DROPDOWN))||!(!t||!(0,A.U2)(this.projectDoc,null===t||void 0===t?void 0:t.id,P.IV.NAVBAR)),showOption:!n&&!d&&!o&&!this.areButtonChildren()}]}generateContextMenuItems(e=!1){var t,n;const o=this.projectDoc.nodes.byId[this.nodeId];if(e)return this.getContextMenuItemsForEditable();const i=o&&!o.parentOrSlotId,s=(null===o||void 0===o?void 0:o.primitiveType)===P.sO.COMPONENT,r=(null===o||void 0===o?void 0:o.primitiveType)===P.sO.DEV_COMPONENT,d=(null===o||void 0===o?void 0:o.primitiveType)===P.sO.IMAGE,a=(null===o||void 0===o?void 0:o.primitiveType)===P.sO.SLOT,l=(null===o||void 0===o?void 0:o.primitiveType)===P.sO.HTML_NODE,c=(null===(t=this.projectDoc.nodes.byId[(null===o||void 0===o?void 0:o.parentId)||""])||void 0===t?void 0:t.primitiveType)===P.sO.BUTTON,h=o&&o.primitiveType===P.sO.CONTAINER&&!Object.keys((null===o||void 0===o?void 0:o.childrenIds)||{}).length&&(null===(n=o.styles.backgroundImage)||void 0===n?void 0:n.id),u=this.nodeEditingFlow.nodeIsRich({nodeId:(null===o||void 0===o?void 0:o.id)||""}),p=this.nodeStyleManagmentFlow.nodeHasStyleAtCurrentBreakpoint({nodeId:this.nodeId,key:"display",values:["none"]}),m=o&&(o.primitiveType===P.IV.MOBILE_MENU||o.primitiveType===P.IV.DROPDOWN_LIST||o.primitiveType===P.IV.BURGER_MENU)||!1,v=o&&Object.values(P.IV).includes(o.primitiveType)&&o.primitiveType!==P.IV.NAVBAR&&o.primitiveType!==P.IV.DROPDOWN||!1;return this.getItems({node:o,isRootNode:i,isComponentInstance:s,isDevComponent:r,isContent:!!(o&&o.contentChildren&&Object.keys(o.contentChildren).length),isImage:d,isSlot:a,isEmbed:l,isHidden:p,isSlotInstance:a&&!!this.compInstanceId,isInButton:c,canTurnIntoImage:!!h,isRichElement:u,isInteractiveCopy:v,isInteractiveShow:m}).filter((e=>e.subMenu?e.showOption?(e.subMenu=e.subMenu.filter((e=>e.showOption)),e):void 0:e.showOption))}getContextMenuItemsForEditable(){return[{label:F.dU.COPY,action:this.handleCopyText},{label:F.dU.CUT,action:this.handleCutText},{label:F.dU.CREATE_LINK,action:this.handleCreateLink},{label:F.dU.PASTE,action:this.handlePasteText,disabled:!this.projectUIState.currentTextInClipboard}]}},f=(0,R.Z)(v.prototype,"projectDoc",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y=(0,R.Z)(v.prototype,"projectUIState",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=(0,R.Z)(v.prototype,"nodeManagementFlow",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g=(0,R.Z)(v.prototype,"nodeEditingFlow",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b=(0,R.Z)(v.prototype,"nodeRichTextFlow",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w=(0,R.Z)(v.prototype,"clipboardFlow",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S=(0,R.Z)(v.prototype,"absolutePositionedLayerFlow",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=(0,R.Z)(v.prototype,"componentManagementFlow",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M=(0,R.Z)(v.prototype,"elementRefProvider",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N=(0,R.Z)(v.prototype,"imageTransformationFlow",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C=(0,R.Z)(v.prototype,"nodeStyleManagmentFlow",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E=(0,R.Z)(v.prototype,"nodeSelectionFlow",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v)},48122:function(e,t,n){n.d(t,{s:function(){return w}});var o,i,s,r,d,a,l,c,h,u,p,m,v,f=n(73202),y=n(92809),I=n(30773),g=n(76883),b=n(75222);let w=(o=(0,g.f3)("nodeSelectionFlow"),i=(0,g.f3)("projectUIState"),s=(0,g.f3)("projectDoc"),r=(0,g.f3)("stageScrollFlow"),d=(0,g.f3)("nodeEditingFlow"),a=(0,g.f3)("layoutManagementFlow"),l=class{constructor(){(0,f.Z)(this,"nodeSelectionFlow",c,this),(0,f.Z)(this,"projectUIState",h,this),(0,f.Z)(this,"projectDoc",u,this),(0,f.Z)(this,"stageScrollFlow",p,this),(0,f.Z)(this,"nodeEditingFlow",m,this),(0,f.Z)(this,"layoutManagementFlow",v,this),(0,y.Z)(this,"sensorSource",document),(0,y.Z)(this,"trackHoverNode",(e=>{const t=e,{nodeId:n,compInstanceId:o}=t.detail;if(!n)return;const i=this.projectDoc.nodes.byId[n];!i||!this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(i.id).slotId&&i.primitiveType!==b.sO.SLOT?o?this.nodeSelectionFlow.setHoveredNodeIds({nodeIds:[o||null]}):this.nodeSelectionFlow.setHoveredNodeIds({nodeIds:[n||null]}):this.nodeSelectionFlow.setHoveredNodeIds({nodeIds:[n||null],compInstanceId:o})})),(0,y.Z)(this,"trackOutNode",(()=>{this.nodeSelectionFlow.setHoveredNodeIds({nodeIds:[]})})),(0,y.Z)(this,"scrollToNode",(e=>{const t=document.querySelector(`[data-node-id='${e}']`);if(t){t.scrollIntoView({block:"nearest",inline:"start"});const e=t.closest(".tree-view");if(e)return e.scrollBy(-50,0),!0}return!1}))}attach(e){var t,n;e&&(this.sensorSource=e),null===(t=this.sensorSource)||void 0===t||t.addEventListener("uidl-node:over",this.trackHoverNode),null===(n=this.sensorSource)||void 0===n||n.addEventListener("uidl-node:out",this.trackOutNode)}detach(){var e,t;null===(e=this.sensorSource)||void 0===e||e.removeEventListener("uidl-node:over",this.trackHoverNode),null===(t=this.sensorSource)||void 0===t||t.removeEventListener("uidl-node:out",this.trackOutNode)}},c=(0,I.Z)(l.prototype,"nodeSelectionFlow",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=(0,I.Z)(l.prototype,"projectUIState",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u=(0,I.Z)(l.prototype,"projectDoc",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p=(0,I.Z)(l.prototype,"stageScrollFlow",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m=(0,I.Z)(l.prototype,"nodeEditingFlow",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v=(0,I.Z)(l.prototype,"layoutManagementFlow",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l)},39818:function(e,t,n){n.d(t,{i:function(){return m}});var o,i,s,r,d,a=n(73202),l=n(92809),c=n(30773),h=n(76883),u=n(93510);const p={[u.xT.ALT]:[18],[u.xT.CTRL]:[17,91,93,224],[u.xT.SHIFT]:[16],[u.xT.SPACE]:[32]};let m=(o=(0,h.f3)("keyboardInteractionFlow"),i=(0,h.f3)("projectUIState"),s=class{constructor(){(0,a.Z)(this,"keyboardInteractionFlow",r,this),(0,a.Z)(this,"projectUIState",d,this),(0,l.Z)(this,"unsubs",[]),(0,l.Z)(this,"handleKeyDown",(e=>{const{keyCode:t}=e;18===t&&e.preventDefault(),Object.keys(p).forEach((e=>{const n=e,o=p[n];o.length&&-1!==o.indexOf(t)&&this.keyboardInteractionFlow.executeKeyDown(n)}))})),(0,l.Z)(this,"handleKeyUp",(e=>{const{keyCode:t}=e;18===t&&e.preventDefault(),Object.keys(p).forEach((e=>{const n=e,o=p[n];o.length&&-1!==o.indexOf(t)&&this.keyboardInteractionFlow.executeKeyUp(n)}))}))}attach(e=null){let t=document;e&&(this.handleWrapperClick(e),e.contentDocument&&(t=e.contentDocument)),t.addEventListener("keydown",this.handleKeyDown),t.addEventListener("keyup",this.handleKeyUp),this.unsubs.push((()=>{t.removeEventListener("keydown",this.handleKeyDown),t.removeEventListener("keyup",this.handleKeyUp)}))}detach(){this.unsubs.forEach((e=>e()))}handleWrapperClick(e){var t;e instanceof HTMLIFrameElement&&null!==(t=e.contentDocument)&&void 0!==t&&t.body&&(e.contentDocument.body.addEventListener("click",(()=>{var t;null===(t=e.contentWindow)||void 0===t||t.focus()})),this.unsubs.push((()=>{var t;null!==(t=e.contentDocument)&&void 0!==t&&t.body&&e.contentDocument.body.removeEventListener("click",(()=>{var t;null===(t=e.contentWindow)||void 0===t||t.focus()}))})))}},r=(0,c.Z)(s.prototype,"keyboardInteractionFlow",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),d=(0,c.Z)(s.prototype,"projectUIState",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),s)},78498:function(e,t,n){n.d(t,{Q:function(){return L}});var o,i,s,r,d,a,l,c,h,u,p,m,v,f,y,I,g,b,w,S,D,M,N,C,E,O=n(73202),T=n(92809),R=n(30773),j=n(76883),F=n(18637),Z=n(41146),x=n(28079),P=n(93510),k=n(2318);function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){(0,T.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let L=(o=(0,j.f3)("layoutManagementFlow"),i=(0,j.f3)("localHistoryStackFlow"),s=(0,j.f3)("zoomControlFlow"),r=(0,j.f3)("projectUIState"),d=(0,j.f3)("projectDoc"),a=(0,j.f3)("pointerInteractionManagementFlow"),l=(0,j.f3)("pageManagementFlow"),c=(0,j.f3)("componentManagementFlow"),h=(0,j.f3)("notificationsManagementFlow"),u=(0,j.f3)("commandPaletteFlow"),p=(0,j.f3)("projectFilesFlow"),m=(0,j.f3)("bundlerService"),v=class{constructor(){(0,O.Z)(this,"layoutManagementFlow",f,this),(0,O.Z)(this,"localHistoryStackFlow",y,this),(0,O.Z)(this,"zoomControlFlow",I,this),(0,O.Z)(this,"projectUIState",g,this),(0,O.Z)(this,"projectDoc",b,this),(0,O.Z)(this,"pointerInteractionManagementFlow",w,this),(0,O.Z)(this,"pageManagementFlow",S,this),(0,O.Z)(this,"componentManagementFlow",D,this),(0,O.Z)(this,"notificationsManagementFlow",M,this),(0,O.Z)(this,"commandPaletteFlow",N,this),(0,O.Z)(this,"projectFilesFlow",C,this),(0,O.Z)(this,"bundlerService",E,this),(0,T.Z)(this,"unsubs",[]),(0,T.Z)(this,"isEditableElement",(()=>document.activeElement&&("INPUT"===document.activeElement.nodeName||"TEXTAREA"===document.activeElement.nodeName||"true"===document.activeElement.getAttribute("contenteditable"))))}attach(e=null){const t=/firefox|fxios/i.test(navigator.userAgent),n=Z.BROWSER_BLOCKED_COMMANDS.reduce(((e,t)=>(e[t]=()=>{},e)),{}),o=Object.keys(x.r).reduce(((e,t)=>(e[t]=()=>{this.layoutManagementFlow.changeActiveSidebar(x.r[t])},e)),{}),i=U(U({[Z.KEY_GLOBAL_COMMANDS.ZOOM_IN]:()=>this.zoomControlFlow.zoomIn(),[Z.KEY_GLOBAL_COMMANDS.ZOOM_IN_NUMPAD]:()=>this.zoomControlFlow.zoomIn(),[Z.KEY_GLOBAL_COMMANDS.ZOOM_OUT]:()=>this.zoomControlFlow.zoomOut(),[Z.KEY_GLOBAL_COMMANDS.ZOOM_RESET]:()=>this.zoomControlFlow.resetScaleValue(),[Z.KEY_GLOBAL_COMMANDS.SAVE]:async e=>{e.preventDefault()},[Z.KEY_GLOBAL_COMMANDS.OPEN_COMMAND_PALETTE]:()=>this.commandPaletteFlow.open(),[t?Z.KEY_GLOBAL_COMMANDS.FIREFOX_COMMAND_PALETTE_WITH_ACTION:Z.KEY_GLOBAL_COMMANDS.OPEN_COMMAND_PALETTE_WITH_ACTION]:()=>this.commandPaletteFlow.open(!0),[Z.KEY_TOGGLES.HIGHLIGHT]:()=>{this.layoutManagementFlow.toggleUserPreferenceValue("highlightMarginAndPadding")},[Z.KEY_TOGGLES.LAYOUT]:()=>{this.projectUIState.layout.mainPanel===P.iW.STAGE&&this.layoutManagementFlow.toggleUserPreferenceValue("layoutStructureVisible")},[Z.KEY_TOGGLES.CODEVIEW]:()=>{this.layoutManagementFlow.toggleCodeview()},[Z.KEY_TOGGLES.SHORTCUTS]:()=>{this.layoutManagementFlow.setShortcutsVisibleValue(!this.projectUIState.layout.shortcutsVisible)},[Z.KEY_TOGGLES.INSPECTOR]:()=>{const e=this.projectUIState.layout.visibleInspector;this.layoutManagementFlow.changeInspectorType(e===P.dG.MAIN?P.dG.DEV:P.dG.MAIN)},[Z.KEY_PAGE_NAVIGATION_COMMANDS.NEXT_PAGE]:()=>{const e=this.projectUIState.selection.componentId;this.projectDoc.components.byId[e]?this.componentManagementFlow.selectNextComponent():this.pageManagementFlow.selectNextPage()},[Z.KEY_PAGE_NAVIGATION_COMMANDS.PREVIOUS_PAGE]:()=>{const e=this.projectUIState.selection.componentId;this.projectDoc.components.byId[e]?this.componentManagementFlow.selectPreviousComponent():this.pageManagementFlow.selectPreviousPage()},[Z.KEY_COMPONENTS_COMMANDS.CREATE]:()=>{this.projectUIState.layout.sidebarPanel!==P.tI.FILES&&this.layoutManagementFlow.changeActiveSidebar(P.tI.FILES),this.projectUIState.sidebarSettings.expanded.components||this.layoutManagementFlow.toggleFolders(k.S.COMPONENTS),this.componentManagementFlow.createEmptyComponent()}},o),n);e&&this.handleWrapperClick(e);const s=e instanceof HTMLIFrameElement?e.contentDocument:e;this.unsubs=[(0,F.N)(s,i,{preventDefault:!0}),(0,F.N)(s,{[Z.KEY_GLOBAL_COMMANDS.UNDO]:e=>{this.isEditableElement()||(this.localHistoryStackFlow.undo(),e.preventDefault())},[Z.KEY_GLOBAL_COMMANDS.REDO]:e=>{this.isEditableElement()||(this.localHistoryStackFlow.redo(),e.preventDefault())}},{throttle:!0}),(0,F.N)(s,{[Z.KEY_GLOBAL_COMMANDS.BACKSPACE]:e=>{this.isEditableElement()||e.preventDefault()},[Z.KEY_NAVIGATION.CLOSE]:()=>{this.projectUIState.drag.draggedEntity&&this.pointerInteractionManagementFlow.handleDragEnd()}})]}detach(){this.unsubs.forEach((e=>e()))}handleWrapperClick(e){var t;e instanceof HTMLIFrameElement&&null!==(t=e.contentDocument)&&void 0!==t&&t.body&&(e.contentDocument.body.addEventListener("click",(()=>{var t;null===(t=e.contentWindow)||void 0===t||t.focus()})),this.unsubs.push((()=>{var t;null!==(t=e.contentDocument)&&void 0!==t&&t.body&&e.contentDocument.body.removeEventListener("click",(()=>{var t;null===(t=e.contentWindow)||void 0===t||t.focus()}))})))}},f=(0,R.Z)(v.prototype,"layoutManagementFlow",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y=(0,R.Z)(v.prototype,"localHistoryStackFlow",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=(0,R.Z)(v.prototype,"zoomControlFlow",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g=(0,R.Z)(v.prototype,"projectUIState",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b=(0,R.Z)(v.prototype,"projectDoc",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w=(0,R.Z)(v.prototype,"pointerInteractionManagementFlow",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S=(0,R.Z)(v.prototype,"pageManagementFlow",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=(0,R.Z)(v.prototype,"componentManagementFlow",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M=(0,R.Z)(v.prototype,"notificationsManagementFlow",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N=(0,R.Z)(v.prototype,"commandPaletteFlow",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C=(0,R.Z)(v.prototype,"projectFilesFlow",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E=(0,R.Z)(v.prototype,"bundlerService",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v)},62081:function(e,t,n){n.d(t,{T:function(){return m}});var o,i,s,r=n(73202),d=n(92809),a=n(30773),l=n(76883),c=n(10440),h=n(93096),u=n.n(h),p=n(98200);let m=(o=(0,l.f3)("elementRefProvider"),i=class{constructor(e={}){(0,r.Z)(this,"elementRefProvider",s,this),(0,d.Z)(this,"entitySelector","[data-node-id]"),(0,d.Z)(this,"entityAttribute","nodeId"),(0,d.Z)(this,"declarationSelector","[data-comp-instance-id]"),(0,d.Z)(this,"declarationAttribute","compInstanceId"),(0,d.Z)(this,"sensorSource",document),(0,d.Z)(this,"detachCallback",null),(0,d.Z)(this,"handlePointerDblClick",(e=>{const t=(0,p.lP)(e,this),n=e.target;if(t){const{nodeId:o,compInstanceId:i}=t,s=new CustomEvent("uidl-node:dblclick",{detail:{nodeId:o,compInstanceId:i,originalEvent:e},bubbles:!0,composed:!0});n.dispatchEvent(s)}})),(0,d.Z)(this,"handlePointerOver",(e=>{const t=(0,p.lP)(e,this),n=e.target;this.dispatchOver(e,n,t)})),(0,d.Z)(this,"handlePointerOut",(e=>{const t=e,n=(0,p.lP)(e,this),o=t.target;n&&t.relatedTarget&&t.relatedTarget.closest(this.entitySelector)||this.dispatchOut(e,o)})),(0,d.Z)(this,"handlePointerContextMenu",(e=>{const t=e,n=t.target,o=n.closest(".tree-view")?"tree":"stage";if((0,c.z2)()&&2!==t.buttons)return void t.preventDefault();if("stage"===o){var i;const s=document.getElementById("group-overlay"),r=null===s||void 0===s?void 0:s.getBoundingClientRect(),d=null===(i=this.elementRefProvider.getIframeRef())||void 0===i?void 0:i.current,a=null===d||void 0===d?void 0:d.getBoundingClientRect();if(a&&r&&t.x+a.x>r.x&&t.x+a.x<r.x+r.width&&t.y+a.y>r.y&&t.y+a.y<r.y+r.height){const t=new CustomEvent("uidl-node:contextmenu",{detail:{insideGroup:!0,origin:o,originalEvent:e},bubbles:!0,composed:!0});return void n.dispatchEvent(t)}}const s=(0,p.lP)(e,this);if((0,p._k)(e)){const t=new CustomEvent("uidl-node:contextmenu",{detail:{origin:o,nodeId:null===s||void 0===s?void 0:s.nodeId,compInstanceId:null===s||void 0===s?void 0:s.compInstanceId,insideEditable:!0,originalEvent:e},bubbles:!0,composed:!0});n.dispatchEvent(t)}else if(s&&s.nodeId){const t=new CustomEvent("uidl-node:contextmenu",{detail:{nodeId:s.nodeId,compInstanceId:s.compInstanceId,origin:o,originalEvent:e},bubbles:!0,composed:!0});n.dispatchEvent(t)}})),(0,d.Z)(this,"detach",(()=>{const{detachCallback:e}=this;e&&e()})),this.entitySelector=e.entitySelector||this.entitySelector,this.entityAttribute=e.entityAttribute||this.entityAttribute,this.sensorSource=e.sensorSource||this.sensorSource,this.declarationSelector=e.declarationSelector||this.declarationSelector,this.declarationAttribute=e.declarationAttribute||this.declarationAttribute,this.dispatchOver=u()(this.dispatchOver,100),this.dispatchOut=u()(this.dispatchOut,100)}attach(e){return e&&(this.sensorSource=e),this.sensorSource.addEventListener("dblclick",this.handlePointerDblClick),this.sensorSource.addEventListener("mouseover",this.handlePointerOver),this.sensorSource.addEventListener("mouseout",this.handlePointerOut),this.sensorSource.addEventListener("contextmenu",this.handlePointerContextMenu),this.detachCallback=()=>{this.sensorSource.removeEventListener("dblclick",this.handlePointerDblClick),this.sensorSource.removeEventListener("mouseover",this.handlePointerOver),this.sensorSource.removeEventListener("mouseout",this.handlePointerOut),this.sensorSource.removeEventListener("contextmenu",this.handlePointerContextMenu)},this.detach}dispatchOver(e,t,n){if(n){const{nodeId:o,compInstanceId:i}=n,s=new CustomEvent("uidl-node:over",{detail:{nodeId:o,compInstanceId:i,originalEvent:e},bubbles:!0,composed:!0});t.dispatchEvent(s)}}dispatchOut(e,t){const n=new CustomEvent("uidl-node:out",{detail:{originalEvent:e},bubbles:!0,composed:!0});t.dispatchEvent(n)}},s=(0,a.Z)(i.prototype,"elementRefProvider",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i)},45626:function(e,t,n){n.d(t,{O:function(){return In}});var o,i,s,r,d,a,l,c,h,u,p,m,v,f,y,I,g,b,w,S,D,M,N,C,E,O,T=n(73202),R=n(92809),j=n(9626),F=n(33800),Z=n(30773),x=n(65988),P=n(93096),k=n.n(P),A=n(76883),U=n(49899),L=n(67294),z=n(71646),B=n(72045),_=n(68768),W=n(89099),H=n(67076),V=n(33381),G=n(10440),K=n(75222),Y=n(53482),$=n(63639),J=n(77736),X=n(93510),q=n(62057),Q=n(7933),ee=n(49249),te=n(80123),ne=n(95409);let oe=(o=(0,A.f3)("projectDoc"),i=(0,A.f3)("projectUIState"),s=(0,A.f3)("nodeManagementFlow"),r=(0,A.f3)("slotNodeManagementFlow"),d=(0,A.f3)("nodeStyleManagmentFlow"),a=(0,A.f3)("nodeSelectionFlow"),l=(0,A.f3)("propDefinitionManagementFlow"),c=(0,A.f3)("elementRefProvider"),h=(0,A.f3)("assetSrcProvider"),u=(0,A.f3)("componentRenderStyleFlow"),p=(0,A.f3)("tailwindService"),m=(0,A.f3)("stateDefinitionManagementFlow"),O=new WeakMap,v=class{constructor(){(0,T.Z)(this,"projectDoc",f,this),(0,T.Z)(this,"projectUIState",y,this),(0,T.Z)(this,"nodeManagementFlow",I,this),(0,T.Z)(this,"slotNodeManagementFlow",g,this),(0,T.Z)(this,"nodeStyleManagmentFlow",b,this),(0,T.Z)(this,"nodeSelectionFlow",w,this),(0,T.Z)(this,"propDefinitionManagementFlow",S,this),(0,T.Z)(this,"elementRefProvider",D,this),(0,T.Z)(this,"assetSrcProvider",M,this),(0,T.Z)(this,"componentRenderStyleFlow",N,this),(0,T.Z)(this,"tailwindService",C,this),(0,T.Z)(this,"stateDefinitionManagementFlow",E,this),(0,R.Z)(this,"renderInto",null),(0,R.Z)(this,"unsubs",[]),(0,R.Z)(this,"renderingMode","stage"),(0,R.Z)(this,"styleSheetManager",new H.o),O.set(this,{writable:!0,value:void 0}),(0,R.Z)(this,"nodeIsTextRoot",(e=>{const t=e.parentOrSlotId,n=t?this.projectDoc.nodes.byId[t]:null;return(e.primitiveType!==K.sO.BUTTON||!Object.keys(e.childrenIds).length)&&(n&&n.primitiveType!==K.sO.TEXT&&n.primitiveType!==K.sO.LINK&&(e.primitiveType===K.sO.BUTTON||e.primitiveType===K.sO.TEXT||e.primitiveType===K.sO.LINK))})),(0,R.Z)(this,"appendNode",((e,t)=>{const n=this.createDomNode(e,t),{nodeInstanceDomData:o,nodeIdToInstanceIds:i}=this.elementRefProvider;if(n&&e.parentId){var s,r,d;const c=null===(s=i[e.parentId])||void 0===s?void 0:s[t],h=this.projectDoc.nodes.byId[e.parentId||""];var a,l;if("preview"===this.renderingMode&&"link"!==(null===h||void 0===h?void 0:h.primitiveType)&&null!==h&&void 0!==h&&null!==(r=h.abilities)&&void 0!==r&&r.link)return void(null===(a=o[c||""])||void 0===a||null===(l=a.domRef.firstChild)||void 0===l||l.appendChild(n));null===(d=o[c||""])||void 0===d||d.domRef.appendChild(n)}if(e.primitiveType!==K.sO.SLOT)return;const c=this.projectDoc.nodes.byId[t];c&&Object.keys(c.slottedNodes[e.id]||{}).length&&(null===n||void 0===n||n.style.setProperty("display","contents"),this.renderSlotsNodes(c,e.id))})),(0,R.Z)(this,"createNode",((e,t)=>{const n=this.createDomNode(e,t),{nodeInstanceDomData:o,nodeIdToInstanceIds:i}=this.elementRefProvider,s=e.parentOrSlotId;if(n&&s){var r;const f=this.projectDoc.nodes.byId[s],y=null===(r=i[s])||void 0===r?void 0:r[t],I=o[y||""],g=this.projectDoc.nodes.orderChildrenIds(this.nodeManagementFlow.getNodeChildren(f.id,t));let b=g.indexOf(e.id)+1;for(;b<g.length;){var d,a,l,c,h,u,p,m;const e=g[b],s=o[(null===(d=i[e])||void 0===d?void 0:d[t])||""];if(!s){b+=1;continue}let r=(null===s||void 0===s||null===(a=s.domRef.parentElement)||void 0===a||null===(l=a.tagName)||void 0===l?void 0:l.toLowerCase())===_.rC||(null===s||void 0===s||null===(c=s.domRef.parentElement)||void 0===c||null===(h=c.tagName)||void 0===h?void 0:h.toLowerCase())===q._u?null===s||void 0===s?void 0:s.domRef.parentElement:null===s||void 0===s?void 0:s.domRef;var v;if((null===(u=this.projectDoc.nodes.byId[e])||void 0===u?void 0:u.primitiveType)===K.sO.HTML_NODE||(null===(p=this.projectDoc.nodes.byId[e])||void 0===p?void 0:p.primitiveType)===K.sO.LOTTIE)r=null===(v=(0,ee.G)(e))||void 0===v?void 0:v.parentElement;const f=null===(m=o[y||""])||void 0===m?void 0:m.domRef;if(f&&(0,G.l8)(I.domRef,r))return void f.insertBefore(n,r);b+=1}e.slotId&&(I.domRef.style.display="contents"),null===I||void 0===I||I.domRef.appendChild(n)}}))}async init(e){var t;this.elementRefProvider.resetInstanceData(),this.renderInto=e.rootNode,this.renderingMode=e.renderingMode,this.styleSheetManager.init({rootNode:e.rootNode,styleRootNode:e.styleRootNode,rootHead:e.rootHead,renderingMode:e.renderingMode});const{componentId:n}=this.projectUIState.selection;if(n&&this.renderInto){(0,j.Z)(this,O,n);const e=this.renderComponentInstance({componentId:n,instanceId:"root"});this.setFakeRootStyle(),this.renderInto.onclick=e=>{e.target===this.renderInto&&this.nodeSelectionFlow.resetNodeSelection()},e&&this.renderInto.appendChild(e)}null!==(t=this.projectDoc.settings.experimentalFeatures)&&void 0!==t&&t.tailwindCSS&&(await this.styleSheetManager.generateTailwindStyles(),this.tailwindService.generateTailwindClassOptions())}attach(){const e=(0,U.Ys)(this.projectDoc,["nodes/byId/*/primitiveType"],((e,t)=>{t.forEach((e=>{const{pathArray:t}=e;if(4!==t.length||"nodes"!==t[0]||"primitiveType"!==t[3])return;const n=t[2];this.removeNodeAndDescendants(n),this.addNode(n)}))}),"UIDLRenderer1"),t=(0,U.Ys)(this.projectDoc,["components/byId/*/propDefinitions/*"],((e,t)=>{t.forEach((t=>{const n=t.value;if(!n)return;const{op:o}=t;Object.keys(n.locations||{}).forEach((t=>{const i=e.nodes.byId[t],s=this.elementRefProvider.nodeIdToInstanceIds[t]||{};Object.keys(s).map((e=>s[e])).forEach((e=>{var s;const r=null===(s=this.elementRefProvider.nodeInstanceDomData[e])||void 0===s?void 0:s.domRef;if((0,G.xK)(i)){if("true"===(null===r||void 0===r?void 0:r.getAttribute("contenteditable")))return;"replace"===o&&(this.removeNodeContentChildren(t),this.addNodeContentChildren(t))}else if("replace"===o){if(Object.values(n.locations[t]).find((e=>"src"===e.sufix))&&r)return void r.setAttribute("src",this.assetSrcProvider.safelyGetSrcForAssetId(n.defaultValue));if(null===i||void 0===i||!i.parentId)return;this.removeNodeAndDescendants(t),this.addNodeAndDescendants(t)}}))}))}))}),"UIDLRenderer2"),n=(0,U.Ys)(this.projectDoc,["nodes/byId/*/contentChildren/**","nodes/byId/*/contentChildren"],((e,t)=>{t.forEach((t=>{var n;const{pathArray:o}=t;if("nodes"!==o[0]||"contentChildren"!==o[3])return;const i=o[2];if(null!==(n=this.projectUIState.localWork.nodesUnderLocalWork)&&void 0!==n&&n[i])return;const s=this.elementRefProvider.getDomNodeElementRefById(i);if(!s)return;const r=e.nodes.byId[i];if(!r)return;const d=e.nodes.byId[r.parentOrSlotId||""],a=(null===d||void 0===d?void 0:d.primitiveType)===K.sO.BUTTON;return(null===r||void 0===r?void 0:r.primitiveType)===K.sO.BUTTON||a?(this.removeNodeAndDescendants(i),void this.addNode(i)):"remove"===t.op&&5===o.length||"replace"===t.op&&4===o.length?(this.removeNodeContentChildren(i),void this.addNodeContentChildren(i)):void(s instanceof HTMLElement&&s.innerText!==t.value&&(this.removeNodeContentChildren(i),this.addNodeContentChildren(i)))}))}),"UIDLRenderer3"),o=(0,U.Ys)(this.projectDoc,["nodes/byId/*/attrs","nodes/byId/*/attrs/*"],((e,t)=>{t.forEach((t=>{let{value:n}=t;const{op:o,pathArray:i}=t;if("attrs"!==i[3])return;const s=i[2],{compInstanceId:r}=e.nodes.getSlotAndCompInstanceIdForNodeById(s);if(!this.elementRefProvider.getDomNodeElementRefByCompInstance(s,r))return;const d=this.projectDoc.nodes.byId[s];if(!d)return;if(d.primitiveType===K.sO.LOTTIE)return this.removeNodeAndDescendants(d.id),void this.addNodeAndDescendants(d.id);if(d.primitiveType===K.sO.DEV_COMPONENT)return this.removeNodeAndDescendants(d.id),void this.addNode(d.id);if(e.nodes.nodeIsCompInstance(d)){if(5===i.length){var a;const e=i[4],t=d.compIdOfCompInstance;if(!t||i[4]===$.Q)return;const r=(null===(a=this.projectDoc.components.byId[t])||void 0===a?void 0:a.propDefinitions)||{},l=Object.values(r).find((t=>t.name===e));if(!l)return;return void Object.keys(l.locations).forEach((e=>{const t=this.elementRefProvider.nodeIdToInstanceIds[e]||{},i=Object.keys(t).map((e=>t[e])),r=Object.values(l.locations[e]).find((e=>e.base===Y.hD.ATTR));if(!Object.values(l.locations[e]).find((e=>e.base===Y.hD.ABILITY))&&(!r||!r.sufix))return this.removeNodeAndDescendants(e),void this.addNodeAndDescendants(e);i.forEach((e=>{var t;const i=null===(t=this.elementRefProvider.nodeInstanceDomData[e])||void 0===t?void 0:t.domRef;i&&r&&r.sufix&&i.closest(`[data-node-id="${s}"]`)&&("remove"===o?l.defaultValue?i.setAttribute(r.sufix,this.assetSrcProvider.safelyGetSrcForAssetId(l.defaultValue)):i.removeAttribute(r.sufix):i.setAttribute(r.sufix,this.assetSrcProvider.safelyGetSrcForAssetId(String(n.content))))}))}))}return this.removeNodeAndDescendants(s),void this.addNodeAndDescendants(s)}const l=this.elementRefProvider.nodeIdToInstanceIds[s]||{},c=Object.keys(l).map((e=>l[e]));for(let e=0;e<c.length;e+=1){var h;const t=null===(h=this.elementRefProvider.nodeInstanceDomData[c[e]])||void 0===h?void 0:h.domRef;if(!t)return;if(4===i.length){if("replace"===o){const e=n;Object.keys(e).forEach((o=>{"static"===e[o].type&&t.setAttribute(o,this.assetSrcProvider.safelyGetSrcForAssetId(String(e[o].content))),"dynamic"===e[o].type&&(n=this.propDefinitionManagementFlow.resolveDynamicValue(e[o],s))}))}}else if("add"===o||"replace"===o){if("dynamic"===n.type&&(n=this.propDefinitionManagementFlow.resolveDynamicValue(n,s)),!n)return;t.setAttribute(i[4],this.assetSrcProvider.safelyGetSrcForAssetId(String(n.content)))}else"remove"===o&&t.removeAttribute(i[4])}}))}),"UIDLRenderer4"),i=(0,U.Ys)(this.projectDoc,["nodes/byId/*"],((e,t)=>{t.forEach((t=>{const{op:n,pathArray:o,old:i}=t;if("nodes"!==o[0]||"byId"!==o[1]||3!==o.length)return;const s=o[2];if("replace"===n)return this.removeNodeAndDescendants(s),void this.addNodeAndDescendants(s);if("remove"!==n){if("add"===n){const t=e.nodes.byId[s];if(!t)return;const{slotId:n,compInstanceId:o}=e.nodes.getSlotAndCompInstanceIdForNodeById(t.id);if(n&&o&&this.elementRefProvider.getDomNodeElementRefByCompInstance(t.id,o))return;return this.removeNodeAndDescendants(s),void this.addNode(s)}}else{this.removeNodeAndDescendants(s);const e=i;null!==e&&void 0!==e&&e.slotId&&e.compInstanceId&&this.checkSlotForNodesAndUpdate(e.slotId,e.compInstanceId)}}))}),"UIDLRenderer5"),s=(0,U.Ys)(this.projectDoc,["nodes/byId/*/parentId","nodes/byId/*/pos","nodes/byId/*/slotId","nodes/byId/*/compInstanceId"],((e,t)=>{const n=[],o=["compInstanceId","parentId","slotId"];t.forEach((t=>{const{op:i,pathArray:s}=t;if("nodes"===s[0]&&"byId"===s[1]&&4===s.length&&("pos"===s[3]||o.includes(s[3]))){if("replace"===i||"add"===i){const e=s[2];if(-1!==n.indexOf(e))return;n.push(e)}if("remove"===i&&o.includes(s[3])){var r;if(null!==(r=e.nodes.byId[s[2]])&&void 0!==r&&r.compIdOfRootNode)return;this.removeNodeAndDescendants(s[2])}}})),n.sort(((t,n)=>{const o=e.nodes.byId[t],i=e.nodes.byId[n],s=parseFloat(null===o||void 0===o?void 0:o.pos),r=parseFloat(null===i||void 0===i?void 0:i.pos);return(0,V.F0)(r)-(0,V.F0)(s)})).forEach((e=>{this.removeNodeAndDescendants(e),this.addNodeAndDescendants(e)}))}),"UIDLRenderer6"),r=(0,U.Ys)(this.projectDoc,["nodes/byId/*/semanticType","nodes/byId/*/abilities/*"],((e,t)=>{t.forEach((t=>{const{pathArray:n}=t;if(4===n.length&&"semanticType"===n[3]){const t=n[2],o=e.nodes.byId[t];if(null!==o&&void 0!==o&&o.compIdOfRootNode)return void this.refreshComponent(o.compIdOfRootNode);this.removeNodeAndDescendants(t),this.addNodeAndDescendants(t)}if(5===n.length&&"abilities"===n[3]){const t=n[2],o=e.nodes.byId[t];if(null!==o&&void 0!==o&&o.compIdOfRootNode)return void this.refreshComponent(o.compIdOfRootNode);this.removeNodeAndDescendants(t),this.addNodeAndDescendants(t)}}))}),"UIDLRenderer7"),d=(0,U.Ys)(this.projectDoc,["nodes/byId/*/compIdOfRootNode"],((e,t)=>{t.forEach((t=>{const{pathArray:n,op:o,value:i}=t;if(4===n.length&&"compIdOfRootNode"===n[3]&&"add"===o){const t=e.components.byId[i];if(!t)return;const o=Object.keys(t.instantiatedByNodes);this.removeNodeAndDescendantsOutsideInstances(n[2],o)}}))}),"UIDLRenderer8"),a=(0,U.Ys)(this.projectDoc,["components/byId/*/styleSetDefinitions/**"],((e,t)=>{t.forEach((t=>{const{pathArray:n}=t;if("components"!==n[0])return;const o=e.components.byId[n[2]],i=null===o||void 0===o?void 0:o.rootNodeId;if(!o||!i)return;const s=o.styleSetDefinitions[n[4]];Object.keys((null===s||void 0===s?void 0:s.usedByInstances)||{}).forEach((e=>{this.styleSheetManager.removeStyleForNode(i,e),this.styleSheetManager.appendStyleForNodeId(i,e)}))}))}),"UIDLRenderer9"),l=(0,U.Ys)(this.projectDoc,["components/byId/*/checkerRenderStyle"],(()=>{this.setFakeRootStyle()}),"UIDLRenderer10"),c=(0,U.Ys)(this.projectUIState,["devMode/bundlerStatus","devMode/devComponents"],(e=>{if(e.layout.mainPanel===X.iW.DEV||!Object.keys(e.devMode.devComponents).length)return;if(!("loaded"===e.devMode.bundlerStatus||"success"===e.devMode.bundlerStatus))return;Object.values(this.projectDoc.nodes.byId||{}).filter((e=>(null===e||void 0===e?void 0:e.primitiveType)===K.sO.DEV_COMPONENT)).forEach((e=>{e&&(this.removeNodeAndDescendants(e.id),this.addNode(e.id))}))}),"BundlerStatusSub"),h=(0,U.Ys)(this.projectDoc,["assets/byId/*/sizePerComponent/*","assets/byId/*/sizePerComponent"],((e,t)=>{t.forEach((t=>{const{pathArray:n}=t;if(n.length<4||"assets"!==n[0]||"sizePerComponent"!==n[3])return;const o=e.assets.byId[n[2]];o&&Object.keys(o.usedInNodes).forEach((t=>{const n=e.nodes.byId[t];if((null===n||void 0===n?void 0:n.primitiveType)!==K.sO.IMAGE){if((null===n||void 0===n?void 0:n.primitiveType)!==K.sO.COMPONENT&&(null===n||void 0===n?void 0:n.primitiveType)!==K.sO.VIDEO)return this.styleSheetManager.removeStyleForNode(t),void this.styleSheetManager.appendStyleForNodeId(t);this.removeNodeAndDescendants(t),this.addNodeAndDescendants(t)}else{const e=this.elementRefProvider.getDomNodeElementRefById(t);null===e||void 0===e||e.setAttribute("src",this.assetSrcProvider.safelyGetSrcForAssetId(o.id))}}))}))}),"UIDLRenderer11"),u=(0,U.Ys)(this.projectDoc,["nodes/byId/*/slotsWithHiddenPreview/**","nodes/byId/*/previewSize/**"],((e,t)=>{t.forEach((e=>{const{pathArray:t}=e;if("nodes"!==t[0]||"previewSize"!==t[3]&&"slotsWithHiddenPreview"!==t[3]||5!==t.length)return;const n=t[2],o=t[4];this.checkSlotForNodesAndUpdate(o,n)}))}),"UIDLRenderer12"),p=(0,U.Ys)(this.projectDoc,["components/byId/*/slots/*"],((e,t)=>{t.forEach((e=>{const{pathArray:t}=e;if("components"!==t[0]||"slots"!==t[3]||5!==t.length)return;const n=t[4];this.checkSlotForNodesAndUpdate(n,"root")}))}),"UIDLRenderer13"),m=(0,U.Ys)(this.projectDoc,["nodes/byId/*/slottedNodes/**"],((e,t)=>{t.forEach((e=>{const{pathArray:t,op:n}=e;if("nodes"!==t[0]||"slottedNodes"!==t[3]||"remove"!==n)return;const o=t[2],i=t[4];this.checkSlotForNodesAndUpdate(i,o)}))}),"UIDLRenderer14"),v=(0,U.Ys)(this.projectUIState,["userInteractions/cursorProperty"],(e=>{this.setCustomCursorStyle(e.userInteractions.cursorProperty)}),"UIDLRenderer15"),f=(0,U.Ys)(this.projectUIState,["componentList/stateValues/*/*/value"],((e,t)=>{const{pathArray:n}=t[0],o=n[3];this.stateDefinitionManagementFlow.getNodesBoundToStateDefinition(o).forEach((e=>{this.removeNodeAndDescendants(e),this.addNodeAndDescendants(e)}))}),"UIDLRenderer16"),y=(0,U.Ys)(this.projectUIState,["componentList/stateValues/*/*/componentInstanceValues/**"],((e,t)=>{const{pathArray:n}=t[0],o=n[5];this.removeNodeAndDescendants(o),this.addNodeAndDescendants(o)}),"UIDLRenderer17"),I=(0,U.Ys)(this.projectDoc,["nodes/byId/*/renderingConditions","nodes/byId/*/renderingConditions/**"],((e,t)=>{t.forEach((t=>{const{pathArray:n}=t;if("nodes"!==n[0]||"renderingConditions"!==n[3])return;const o=e.nodes.byId[n[2]];if(!o)throw new Error(`Couldn't find referrenced node with id: ${n[2]}`);this.removeNodeAndDescendants(o.id),this.addNodeAndDescendants(o.id)}))}),"UIDLRenderer18"),g=(0,U.Ys)(this.projectDoc,["nodes/byId/*/html"],((e,t)=>{t.forEach((e=>{const{pathArray:t}=e;if(t.length<3||"nodes"!==t[0]||"html"!==t[3])return;const n=t[2];this.removeNodeAndDescendants(n),this.addNodeAndDescendants(n)}))}),"UIDLRenderer19");this.unsubs.push((()=>i.dispose()),(()=>o.dispose()),(()=>s.dispose()),(()=>e.dispose()),(()=>n.dispose()),(()=>r.dispose()),(()=>t.dispose()),(()=>d.dispose()),(()=>a.dispose()),(()=>l.dispose()),(()=>c.dispose()),(()=>v.dispose()),(()=>h.dispose()),(()=>u.dispose()),(()=>p.dispose()),(()=>m.dispose()),(()=>f.dispose()),(()=>y.dispose()),(()=>I.dispose()),(()=>g.dispose()))}checkSlotForNodesAndUpdate(e,t){var n;const{nodeIdToInstanceIds:o,nodeInstanceDomData:i}=this.elementRefProvider,s=this.projectDoc.nodes.byId[e];if(!s||s.primitiveType!==K.sO.SLOT)return;const{width:r,height:d}=this.slotNodeManagementFlow.getSlotPreviewSize({slotId:e,instanceId:t}),a=null===(n=i[o[e][t]])||void 0===n?void 0:n.domRef;if(!a)return;const l=this.projectDoc.nodes.byId[t];if(!l||!this.projectDoc.nodes.nodeIsCompInstance(l))return a.style.width=r,void(a.style.height=d);if(Object.keys(l.slottedNodes[e]||{}).length)return;a.style.removeProperty("display");const c=l.slotsWithHiddenPreview[e];a.style.width=c?"0px":r,a.style.height=c?"0px":d}setFakeRootStyle(){var e,t;const{componentId:n}=this.projectUIState.selection;if(!n)return;var o;if(this.projectDoc.pages.byId[n]||"preview"===this.renderingMode)return void(null===(o=this.renderInto)||void 0===o||o.removeAttribute("style"));let i=null===(e=this.projectDoc.components.byId[n])||void 0===e?void 0:e.checkerRenderStyle;i||(this.componentRenderStyleFlow.updateComponentRenderStyle({renderStyle:J.wY.WHITE_CHESS,compId:n}),i=J.wY.WHITE_CHESS);const s={display:"flex",alignItems:"center",justifyContent:"center",minHeight:"1000px",backgroundImage:J.ay[i],backgroundSize:"20px 20px",backgroundBlendMode:"normal, difference, normal"};Object.assign(null===(t=this.renderInto)||void 0===t?void 0:t.style,s)}setCustomCursorStyle(e){var t;const n={cursor:e};Object.assign(null===(t=this.renderInto)||void 0===t?void 0:t.style,n)}refreshComponent(e){Object.values(this.elementRefProvider.nodeInstanceDomData||{}).forEach((e=>{null===e||void 0===e||e.domRef.remove()})),this.elementRefProvider.resetInstanceData(),this.setFakeRootStyle(),this.nodeSelectionFlow.resetNodeSelection(),this.styleSheetManager.computeRootStyles();const t=this.renderComponentInstance({componentId:e,instanceId:"root"});var n;t&&(null===(n=this.renderInto)||void 0===n||n.appendChild(t))}removeNodeContentChildren(e){const t=this.elementRefProvider.nodeIdToInstanceIds[e]||{};Object.values(t).forEach((e=>{const t=this.elementRefProvider.nodeInstanceDomData[e],{domRef:n}=t||{};if(!n)return;const o=[],i=n.tagName.toLowerCase()===_.rC?n.children[0]:n;for(let s=0;s<i.childNodes.length;s++){const e=i.childNodes[s];e.nodeType===Node.TEXT_NODE&&o.push(e)}o.forEach((e=>{i.removeChild(e)}))}))}addNodeContentChildren(e){const t=this.projectDoc.nodes.byId[e];if(!t)return;const n=this.elementRefProvider.nodeIdToInstanceIds[e]||{};Object.values(n).forEach((e=>{const n=this.elementRefProvider.nodeInstanceDomData[e],{domRef:o}=n||{};if(!o)return;const i=this.propDefinitionManagementFlow.getResolvedNodeData(t,null===n||void 0===n?void 0:n.componentInstanceId);(0,W.BD)(o.tagName.toLowerCase()===_.rC?o.children[0]:o,i.contentChildren)}))}removeNodeAndDescendants(e){const{nodeIdToInstanceIds:t,nodeInstanceDomData:n}=this.elementRefProvider;if(!t)return;const o=t[e]||{},i=Object.keys(o).map((e=>o[e]));for(let h=0;h<i.length;h+=1){var s,r,d;const t=null===(s=this.elementRefProvider.nodeInstanceDomData[i[h]])||void 0===s?void 0:s.domRef;if((null===t||void 0===t?void 0:t.dataset.type)===K.sO.HTML_NODE){var a;const t=(0,ee.G)(e);(null===t||void 0===t||null===(a=t.parentElement)||void 0===a?void 0:a.tagName.toLowerCase())===Q.J&&t.parentElement.remove()}if((null===t||void 0===t?void 0:t.dataset.type)===K.sO.LOTTIE){var l;const t=(0,ee.G)(e);(null===t||void 0===t||null===(l=t.parentElement)||void 0===l?void 0:l.tagName.toLowerCase())===ne.G&&t.parentElement.remove()}var c;if((null===t||void 0===t||null===(r=t.parentElement)||void 0===r?void 0:r.tagName.toLowerCase())===_.rC||(null===t||void 0===t||null===(d=t.parentElement)||void 0===d?void 0:d.tagName.toLowerCase())===q._u)t.parentElement.remove();else null===(c=this.elementRefProvider.nodeInstanceDomData[i[h]])||void 0===c||c.domRef.remove();delete this.elementRefProvider.nodeInstanceDomData[i[h]]}Object.keys(t||{}).forEach((o=>{var i;const s=t[o];if(s){var r;const t=s[e];null===(r=n[t])||void 0===r||r.domRef.remove(),delete n[t]}null===(i=t[o])||void 0===i||delete i[e]})),this.styleSheetManager.removeStyleForNode(e),delete t[e]}removeNodeAndDescendantsOutsideInstances(e,t){const n=this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(e).compInstanceId,o=this.nodeManagementFlow.getNodeChildren(e,n);Object.keys(o||{}).forEach((e=>{this.removeNodeAndDescendantsOutsideInstances(e,t)}));const i=this.elementRefProvider.nodeIdToInstanceIds[e]||{};Object.keys(i).forEach((e=>{var n,o;if(t.includes(e))return;const s=null===(n=this.elementRefProvider.nodeInstanceDomData[i[e]])||void 0===n?void 0:n.domRef;var r;(null===s||void 0===s||null===(o=s.parentElement)||void 0===o?void 0:o.tagName.toLowerCase())===_.rC?s.parentElement.remove():null===(r=this.elementRefProvider.nodeInstanceDomData[i[e]])||void 0===r||r.domRef.remove();delete this.elementRefProvider.nodeInstanceDomData[i[e]]}))}addNode(e){const t=this.projectDoc.nodes.byId[e];if(!t)return;const{compInstanceId:n}=this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(t.id),{parentId:o,slotId:i}=t;if(!o&&!i)return;const s=this.elementRefProvider.nodeIdToInstanceIds[o||i]||{};Object.keys(s).forEach((e=>{n&&n!==e||this.createNode(t,e)}))}addNodeAndDescendants(e){this.projectDoc.nodes.bfs(e,(e=>{this.addNode(e.id)}))}detach(){(0,F.Z)(this,O)&&this.unsubs.length>0&&(this.elementRefProvider.resetInstanceData(),this.unsubs.forEach((e=>{e&&e()})),this.styleSheetManager.detach(),this.unsubs=[])}renderComponentInstance(e){var t,n,o;const{componentInstanceNode:i,componentId:s,instanceId:r="root",isDragged:d=!1}=e,a=null!==(t=this.projectDoc.pages.byId[s])&&void 0!==t?t:this.projectDoc.components.byId[s];if(!a||!a.rootNodeId)throw new Error(`Cannot render element node ${null===a||void 0===a?void 0:a.rootNodeId}.`);const{projectDoc:l,projectUIState:c}=this,{nodeIdToInstanceIds:h}=this.elementRefProvider,{rootNodeId:u}=a;l.nodes.bfs(u,(e=>{this.appendNode(e,r)}));const p=null===(n=h[u])||void 0===n?void 0:n[r];if((null===i||void 0===i?void 0:i.primitiveType)===K.sO.COMPONENT){var m;const e=this.propDefinitionManagementFlow.getResolvedNodeData(i,i.id),t=l.nodes.getSlotAndCompInstanceIdForNodeById(i.id).compInstanceId,n=(0,W.m7)({nodeData:e,instanceId:t||"root",slug:c.slug,renderingMode:this.renderingMode,textStyleTokens:this.projectDoc.designLanguage.textStyleSetsById||{},getAssetSrcFromId:this.assetSrcProvider.safelyGetSrcForAssetId,cssClassesList:this.projectDoc.classes.byId||{},devComponents:this.projectUIState.devMode.devComponents||{}}),o=null===(m=this.elementRefProvider.nodeInstanceDomData[p||""])||void 0===m?void 0:m.domRef;return d&&o.style.setProperty("opacity","0.5"),null===n||void 0===n||n.append(o),n}return null===(o=this.elementRefProvider.nodeInstanceDomData[p||""])||void 0===o?void 0:o.domRef}renderSlotsNodes(e,t){const n=Object.keys(e.slottedNodes[t]||{});n.length&&this.projectDoc.nodes.orderChildrenIds(n).forEach((e=>{this.addNodeAndDescendants(e)}))}createDomNode(e,t){const{nodeInstanceDomData:n,nodeIdToInstanceIds:o}=this.elementRefProvider,i=this.projectUIState.drag.draggedEntity;let s;if(s=e.primitiveType===K.sO.SLOT?this.projectDoc.getComponentIdForNode(t):this.projectDoc.getComponentIdForNode(e.id),e.renderingConditions&&!this.nodeStyleManagmentFlow.nodeSatisfiesStateRenderingCondition(e.id,s,t))return;const r=s!==this.projectUIState.selection.componentId?void 0:e.primitiveType===K.sO.SLOT?e.id:this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(e.id).slotId,d=(null===i||void 0===i?void 0:i.type)===te.Z.SUB_HIERARCHY&&!!i.content.subHierarchy.find((t=>t.id===e.id));let a,l;if(e.primitiveType===K.sO.SLOT){const n=this.projectDoc.nodes.byId[t];l=null===n||void 0===n?void 0:n.slotsWithHiddenPreview[e.id],a=this.slotNodeManagementFlow.getSlotPreviewSize({slotId:e.id,instanceId:t})}let c=this.projectDoc.nodes.nodeIsCompInstance(e)?this.renderComponentInstance({componentInstanceNode:e,componentId:e.compIdOfCompInstance,instanceId:e.id,isDragged:d}):(0,W.m7)({nodeData:this.propDefinitionManagementFlow.getResolvedNodeData(e,t),nodeParentData:this.projectDoc.nodes.byId[e.parentOrSlotId||""],instanceId:t,slug:this.projectUIState.slug,renderingMode:this.renderingMode,textStyleTokens:this.projectDoc.designLanguage.textStyleSetsById||{},getAssetSrcFromId:this.assetSrcProvider.safelyGetSrcForAssetId,cssClassesList:this.projectDoc.classes.byId||{},devComponents:this.projectUIState.devMode.devComponents||{},slotId:r,isDragged:d,previewHidden:l,previewSize:a,tailwindClasses:this.projectDoc.tailwindCSS.getTailwindClassesForNode(e.id)});if(!c)return;const h=(0,B.Z)();if(n[h]={domRef:c,nodeId:e.id,componentInstanceId:this.projectDoc.nodes.nodeIsCompInstance(e)?"root":t},this.styleSheetManager.appendStyleForNodeId(e.id,t),this.nodeIsTextRoot(e)&&"preview"!==this.renderingMode){const t=document.createElement(_.rC);this.unsubs.push(t.disconnectedCallback),t.setAttribute(_.Or,e.id),t.appendChild(c),c=t}if(e.primitiveType===K.sO.HTML_NODE){const t=document.createElement(Q.J);this.unsubs.push(t.disconnectedCallback),t.setAttribute(_.Or,e.id),t.setAttribute(_.XK,this.renderingMode),t.appendChild(c),c=t}if(e.primitiveType===K.sO.LOTTIE){const t=document.createElement(ne.G);t.setAttribute(_.Or,e.id),t.appendChild(c),c=t}if(e.primitiveType===K.IV.NAVBAR&&"preview"!==this.renderingMode){const t=document.createElement(q._u);this.unsubs.push(t.disconnectedCallback),t.setAttribute(_.Or,e.id),t.appendChild(c),c=t}if(e.primitiveType===K.IV.DROPDOWN&&"preview"!==this.renderingMode){if(1===this.projectDoc.nodes.getAncestors(e.id,!1,!0).map((e=>this.projectDoc.nodes.byId[e])).filter((e=>(null===e||void 0===e?void 0:e.primitiveType)===K.IV.DROPDOWN)).length){const t=document.createElement(q._u);this.unsubs.push(t.disconnectedCallback),t.setAttribute(_.Or,e.id),t.appendChild(c),c=t}}return o[e.id]=o[e.id]||{},o[e.id][t]=h,c}},f=(0,Z.Z)(v.prototype,"projectDoc",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),y=(0,Z.Z)(v.prototype,"projectUIState",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I=(0,Z.Z)(v.prototype,"nodeManagementFlow",[s],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g=(0,Z.Z)(v.prototype,"slotNodeManagementFlow",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b=(0,Z.Z)(v.prototype,"nodeStyleManagmentFlow",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),w=(0,Z.Z)(v.prototype,"nodeSelectionFlow",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S=(0,Z.Z)(v.prototype,"propDefinitionManagementFlow",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D=(0,Z.Z)(v.prototype,"elementRefProvider",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),M=(0,Z.Z)(v.prototype,"assetSrcProvider",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N=(0,Z.Z)(v.prototype,"componentRenderStyleFlow",[u],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),C=(0,Z.Z)(v.prototype,"tailwindService",[p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),E=(0,Z.Z)(v.prototype,"stateDefinitionManagementFlow",[m],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),v);var ie,se,re,de,ae,le,ce,he,ue,pe,me,ve=n(62081),fe=n(48122),ye=n(89450);let Ie=(ie=(0,A.f3)("projectDoc"),se=(0,A.f3)("projectUIState"),re=(0,A.f3)("layoutManagementFlow"),de=(0,A.f3)("nodeEditingFlow"),ae=(0,A.f3)("componentManagementFlow"),le=class{constructor(){(0,T.Z)(this,"projectDoc",ce,this),(0,T.Z)(this,"projectUIState",he,this),(0,T.Z)(this,"layoutManagementFlow",ue,this),(0,T.Z)(this,"nodeEditingFlow",pe,this),(0,T.Z)(this,"componentManagementFlow",me,this),(0,R.Z)(this,"sensorSource",document),(0,R.Z)(this,"elementIsAsset",{check:(e,t)=>{const{nodeInstance:n}=e;if(!(0,G.Sj)(n.primitiveType||""))return t();const{sidebarPanel:o}=this.projectUIState.layout;o!==X.tI.ASSETS_MANAGER&&this.layoutManagementFlow.changeActiveSidebar(X.tI.ASSETS_MANAGER)}}),(0,R.Z)(this,"elementIsComponent",{check:(e,t)=>{const{nodeInstance:n}=e;if(n&&this.projectDoc.nodes.nodeIsCompInstance(n)){const e=n.compIdOfCompInstance;if(e)return void this.componentManagementFlow.select(e)}return t()}}),(0,R.Z)(this,"elementIsHtmlNode",{check:(e,t)=>{const{nodeInstance:n}=e;if(!n||n.primitiveType!==K.sO.HTML_NODE)return t();this.nodeEditingFlow.beginEditingNode(n.id)}}),(0,R.Z)(this,"elementShouldHaveContentEditable",{check:(e,t)=>{const{nodeId:n,nodeInstance:o}=e;if(!o.contentChildren)return t();const i=Object.keys(o.contentChildren).length,s=Object.keys(o.childrenIds).length;if(!i&&!s)return t();this.nodeEditingFlow.beginEditingNode(n)}}),(0,R.Z)(this,"handleNodeDoubleClick",(e=>{const t=e,{nodeId:n,compInstanceId:o}=t.detail;if(!n)return;let i=this.projectDoc.nodes.byId[n];if(!i)return;o&&!this.projectDoc.nodes.getSlotAndCompInstanceIdForNodeById(i.id).slotId&&(i=this.projectDoc.nodes.byId[o]||i);const s=[this.elementIsAsset,this.elementIsComponent,this.elementIsHtmlNode,this.elementShouldHaveContentEditable];let r=0,d=!1;for(;r<s.length&&!d;)d=!0,s[r].check({nodeId:n,nodeInstance:i,ev:t},(()=>{r+=1,d=!1}))}))}attach(e){var t;e&&(this.sensorSource=e),null===(t=this.sensorSource)||void 0===t||t.addEventListener("uidl-node:dblclick",this.handleNodeDoubleClick)}detach(){var e;null===(e=this.sensorSource)||void 0===e||e.removeEventListener("uidl-node:dblclick",this.handleNodeDoubleClick)}},ce=(0,Z.Z)(le.prototype,"projectDoc",[ie],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),he=(0,Z.Z)(le.prototype,"projectUIState",[se],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ue=(0,Z.Z)(le.prototype,"layoutManagementFlow",[re],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pe=(0,Z.Z)(le.prototype,"nodeEditingFlow",[de],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),me=(0,Z.Z)(le.prototype,"componentManagementFlow",[ae],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),le);var ge=n(11163),be=n(89361),we=n(84073),Se=n(92763),De=n(85893);const Me=e=>{const{onDismiss:t,onSubmit:n,href:o}=e;return(0,De.jsxs)("div",{className:"externalLink-modal",children:[(0,De.jsx)(Se.J,{type:"error",size:32}),(0,De.jsx)("p",{className:"warning-message",children:"By accesing this link you are about to leave teleportHQ's domain. Beware of external sites asking for your personal information (e.g. phone numbers, credit cards). You may become a victim of a phishing attack!"}),(0,De.jsxs)("p",{className:"question",children:["Are you sure you want to access"," ",(0,De.jsxs)("span",{className:"url",children:[null===o||void 0===o?void 0:o.replace("https://","")," "]}),"?"]}),(0,De.jsxs)("div",{className:"modal-buttons",children:[(0,De.jsx)(be.z,{style:"solid",colorScheme:"neutral",onClick:t,children:"Cancel"}),(0,De.jsx)(be.z,{style:"solid",colorScheme:"accent",onClick:n,children:"Access Link"})]}),(0,De.jsx)("style",{children:we.DF})]})};var Ne,Ce,Ee,Oe,Te,Re,je,Fe,Ze,xe=n(61030),Pe=n(20510);let ke=(Ne=(0,A.f3)("projectDoc"),Ce=(0,A.f3)("projectUIState"),Ee=(0,A.f3)("modalManagementFlow"),Oe=(0,A.f3)("elementRefProvider"),Te=class{constructor(){(0,R.Z)(this,"sensorSource",null),(0,T.Z)(this,"projectDoc",Re,this),(0,T.Z)(this,"projectUIState",je,this),(0,T.Z)(this,"modalManagementFlow",Fe,this),(0,T.Z)(this,"iframeRef",Ze,this),(0,R.Z)(this,"openExternalLink",(e=>{window.open(e,"_blank"),this.modalManagementFlow.hideModal()})),(0,R.Z)(this,"handleLinkClick",(e=>{let t;if(e.preventDefault(),e.target&&("link"===e.target.dataset.type?t=e.target:e.target.closest('[data-type="link"]')&&(t=e.target.closest('[data-type="link"]')),t&&t)){const e=t.getAttribute("href");if(!e)return;const n=this.projectUIState.slug;if(e.includes(n))return void ge.default.push((0,Pe.zg)("[slug]","[compId]"),e);if(e.startsWith("#")){const t=this.iframeRef.getIframeRoot(),n=null===t||void 0===t?void 0:t.querySelector(`[id=${e.substring(1)}]`);return void(n&&n.scrollIntoView({block:"start",behavior:"smooth"}))}const o=xe.d.createCustomModal({Component:Me,onSubmit:()=>this.openExternalLink(e),data:{href:e}});this.modalManagementFlow.showModal(o)}})),(0,R.Z)(this,"attach",(e=>{var t;return e&&(this.sensorSource=e),null===(t=this.sensorSource)||void 0===t||t.addEventListener("click",this.handleLinkClick),this.detach})),(0,R.Z)(this,"detach",(()=>{var e;null===(e=this.sensorSource)||void 0===e||e.removeEventListener("click",this.handleLinkClick)}))}},Re=(0,Z.Z)(Te.prototype,"projectDoc",[Ne],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),je=(0,Z.Z)(Te.prototype,"projectUIState",[Ce],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fe=(0,Z.Z)(Te.prototype,"modalManagementFlow",[Ee],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ze=(0,Z.Z)(Te.prototype,"iframeRef",[Oe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Te);var Ae=n(2100),Ue=n(77729);const Le=e=>{const{initSize:{width:t,height:n},cursorInfo:o={style:Ue.or.CURSOR.NWSE},keepAspectRatio:i=!1}=e,s=n/t,{width:r,height:d}=(e=>{const{increaseBy:{x:t,y:n}={x:1,y:1},position:{x:o,y:i},cursorInfo:{revert:s}={revert:""},initPosition:{x:r,y:d},initSize:{width:a,height:l},stageWidth:c,inIframe:h,scale:u,element:p}=e,m=(0,G.d$)(p),v=s===Ue.sF.b.EW||s===Ue.sF.b.NWSE?-1:1,f=s===Ue.sF.b.NS||s===Ue.sF.b.NWSE?-1:1,y=h?o-r:(o-r)/u,I=h?i-d:(i-d)/u,g=Math.round(a/m.x+y*v*t),b=Math.round(l/m.y+I*f*n),w=g>=0?g:0;return{width:w>c?c:w,height:b>=0?b:0}})(e);return o.style===Ue.or.CURSOR.EW?i?{width:r,height:Math.floor(r*s)}:{width:r}:o.style===Ue.or.CURSOR.NS?i?{height:d,width:Math.floor(d/s)}:{height:d}:i?{width:r,height:Math.floor(r*s)}:{width:r,height:d}},ze=e=>{const{cursor:t,elementRef:n}=e,o=n&&n.parentElement;if(!o)return t.revert;const i=window.getComputedStyle(o),s=o.getBoundingClientRect(),r=n.getBoundingClientRect();if((t.style===Ue.or.CURSOR.EW||t.style===Ue.or.CURSOR.NWSE||t.style===Ue.or.CURSOR.NESW)&&!n.clientWidth&&o.clientWidth){const e=i.borderWidth.split(" "),t=1===e.length?e[0]:e[1];if(s.right-parseInt(t)-parseInt(i.paddingRight||"0")===r.right)return Ue.sF.b.EW}if((t.style===Ue.or.CURSOR.NS||t.style===Ue.or.CURSOR.NWSE||t.style===Ue.or.CURSOR.NESW)&&!n.clientHeight&&o.clientHeight){if(!parseInt(i.height))return t.revert;const e=i.borderWidth.split(" "),n=1===e.length?e[0]:e[3];if(s.top+s.height-parseInt(n)-parseInt(i.paddingBottom||"0")===r.top+r.height)return Ue.sF.b.NS}return t.revert},Be=(e,t)=>{const n=e&&e.parentElement;if(!n||!e)return{x:1,y:1};const o=window.getComputedStyle(n),i=window.getComputedStyle(e),s=Array.from(n.children).indexOf(e),r=(0,G.AO)(e),d=(0,G.d$)(e);if("flex"!==o.display)return{x:1/r/d.x,y:1/r/d.y};const a=o.flexDirection,l={x:1,y:1};return"center"===o.justifyContent&&(l.x="row"===a?2:l.x,l.y="row"===a?l.y:2),"space-around"!==o.justifyContent&&"space-evenly"!==o.justifyContent||(l.x="row"===a?1.5:l.x,l.y="row"===a?l.y:1.5),"space-between"===o.justifyContent&&s>0&&s<Array.from(n.children).length-1&&(l.x="row"===a?2:l.x,l.y="row"===a?l.y:2),("center"===o.alignItems&&"auto"===i.alignSelf||"center"===i.alignSelf)&&(l.x="row"===a?l.x:2,l.y="row"===a?2:l.y),"absolute"!==t.position&&"fixed"!==t.position||((t.left||t.right)&&(l.x=1),(t.top||t.bottom)&&(l.y=1)),l.x=l.x/r/d.x,l.y=l.y/r/d.y,l},_e=(e,t)=>{const n=(e=>e>300?10:e>200?8:e>100?6:e>50?4:2)(t);if(e>=t-n&&e<=t+n)return"100%";const o=t/2;return e>=o-n&&e<=o+n?"50%":e};var We,He,Ve,Ge,Ke,Ye,$e,Je,Xe,qe,Qe,et,tt,nt,ot,it,st,rt,dt=n(71919),at=n(74922),lt=n(76263),ct=n(72790);let ht=(We=(0,A.f3)("projectDoc"),He=(0,A.f3)("projectUIState"),Ve=(0,A.f3)("nodeStyleManagmentFlow"),Ge=(0,A.f3)("nodeManagementFlow"),Ke=(0,A.f3)("nodeEditingFlow"),Ye=(0,A.f3)("notificationsManagementFlow"),$e=(0,A.f3)("rtcFlow"),Je=(0,A.f3)("elementRefProvider"),Xe=(0,at.G)(lt.l.RESIZE),qe=class{constructor(){(0,T.Z)(this,"projectDoc",Qe,this),(0,T.Z)(this,"projectUIState",et,this),(0,T.Z)(this,"nodeStyleManagmentFlow",tt,this),(0,T.Z)(this,"nodeManagementFlow",nt,this),(0,T.Z)(this,"nodeEditingFlow",ot,this),(0,T.Z)(this,"notificationsManagementFlow",it,this),(0,T.Z)(this,"rtcFlow",st,this),(0,T.Z)(this,"elementRefProvider",rt,this),(0,R.Z)(this,"unsubs",[]),(0,R.Z)(this,"iframeBody",null),(0,R.Z)(this,"isMouseDown",!1),(0,R.Z)(this,"selectedNode",""),(0,R.Z)(this,"nodeStyle",{}),(0,R.Z)(this,"parentStyle",{}),(0,R.Z)(this,"nodeType",null),(0,R.Z)(this,"cursor",{style:"",revert:""}),(0,R.Z)(this,"initSize",{width:0,height:0}),(0,R.Z)(this,"initPosition",{x:0,y:0}),(0,R.Z)(this,"elementRef",null),(0,R.Z)(this,"keepAspectRatio",!1),(0,R.Z)(this,"finalSize",{width:void 0,height:void 0}),(0,R.Z)(this,"iframeRect",null),(0,R.Z)(this,"handleMouseDown",(e=>{var t,n;const o=e,i=o.detail.eventTarget;if(!i)return;this.selectedNode=Object.keys(this.projectUIState.selection.nodes)[0];const s=this.projectUIState.selection.compInstanceId;if(!this.selectedNode)return;const r=null===(t=this.elementRefProvider.getIframeRef())||void 0===t?void 0:t.current;if(!r)return;if(this.elementRef=this.elementRefProvider.getDomTargetNode(this.selectedNode,s)||null,this.iframeRect=r.getBoundingClientRect(),!this.elementRef)return;const d=this.projectDoc.nodes.byId[this.selectedNode];if(!d)return;this.nodeManagementFlow.beginLocalWork([this.selectedNode]),this.rtcFlow.lockEditedNodes([this.selectedNode]),this.nodeStyle=this.nodeStyleManagmentFlow.getResolvedStylesBasedOnCurrentBreakpoint({nodeId:this.selectedNode}),this.nodeType=(null===(n=this.projectDoc.nodes.byId[this.selectedNode])||void 0===n?void 0:n.primitiveType)||null;const a=d.parentId;this.parentStyle=a?this.nodeStyleManagmentFlow.getResolvedStylesBasedOnCurrentBreakpoint({nodeId:a}):{},this.cursor.style=i.dataset.resizeDirection||"",this.cursor.revert=i.dataset.revert||"",this.initPosition=o.detail.position;const{height:l,width:c}=this.elementRef.getBoundingClientRect();this.initSize.height=Math.round(l),this.initSize.width=Math.round(c),this.isMouseDown=!0,(0,U.JG)(this.projectUIState,(e=>{e.userInteractions.resizeInProgress=!0,e.userInteractions.cursorProperty=this.cursor.style===ct.CURSOR.NS?'url("static/cursors/resize-ns.svg") 5 10, ns-resize':this.cursor.style===ct.CURSOR.EW?'url("static/cursors/resize-ew.svg") 10 5, ew-resize':this.cursor.style===ct.CURSOR.NWSE?'url("static/cursors/resize-nwse.svg") 10 10, nwse-resize':this.cursor.style===ct.CURSOR.NESW?'url("static/cursors/resize-nesw.svg") 10 10, nesw-resize':"auto"}))})),(0,R.Z)(this,"handleDoubleClick",(e=>{if(!e.detail.eventTarget)return;this.selectedNode=Object.keys(this.projectUIState.selection.nodes)[0];const t=this.projectUIState.selection.compInstanceId;if(!this.selectedNode)return;if(this.elementRef=this.elementRefProvider.getDomNodeElementRefByCompInstance(this.selectedNode,t)||null,!this.elementRef)return;const n=this.projectDoc.nodes.byId[this.selectedNode];n&&((0,G.xK)(n)||n.primitiveType===K.sO.HTML_NODE)&&(this.nodeEditingFlow.beginEditingNode(n.id),this.elementRef.focus())})),(0,R.Z)(this,"handleIframeMouseMove",(e=>{this.handleMouseMove(e,!0)})),(0,R.Z)(this,"handleEventMouseMove",(e=>{this.handleMouseMove(e)})),(0,R.Z)(this,"handleMouseUp",(()=>{this.isMouseDown&&this.selectedNode&&((0,U.JG)(this.projectUIState,(e=>{e.userInteractions.resizeInProgress=!1,e.userInteractions.cursorProperty="auto"})),this.isMouseDown=!1,this.nodeManagementFlow.commitLocalWork(),this.rtcFlow.unlockEditedNodes(),"string"===typeof this.finalSize.width&&this.finalSize.width.indexOf("%")>-1&&this.notificationsManagementFlow.createNotification(dt.k.INFO,`The width was set to ${this.finalSize.width}`),"string"===typeof this.finalSize.height&&this.finalSize.height.indexOf("%")>-1&&this.notificationsManagementFlow.createNotification(dt.k.INFO,`The height was set to ${this.finalSize.height}`),this.finalSize={width:void 0,height:void 0})}))}handleMouseMove(e,t){if(!this.isMouseDown||!this.elementRef||!this.selectedNode||!this.iframeRect)return;const{userInteractions:n,userPreferences:o,stage:i}=this.projectUIState,{ctrl:s,shift:r}=n.pressedKeys,d=o.keepAspectRatio,a=i.webComp.controlValues.scale,l=i.getCurrentWidth();this.keepAspectRatio=d||r||!1;let c=this.initPosition;t&&(c={x:Math.abs((this.initPosition.x-this.iframeRect.x)/a),y:Math.abs((this.initPosition.y-this.iframeRect.y)/a)}),this.cursor.revert=ze({cursor:this.cursor,elementRef:this.elementRef});const h={initPosition:c,stageWidth:l,scale:a,inIframe:t,initSize:this.initSize,cursorInfo:this.cursor,keepAspectRatio:this.keepAspectRatio,position:{x:e.x,y:e.y},increaseBy:Be(this.elementRef,this.nodeStyle),element:this.elementRef},u=Le(h);let p=u.width,m=u.height;if(!s&&!this.keepAspectRatio){const e=((e,t,n)=>{const o=t&&t.parentElement,i=window.getComputedStyle(t),s=o&&o.getBoundingClientRect();return s&&"absolute"!==i.position&&"fixed"!==i.position?{width:n.width?_e(e.width,s.width):e.width,height:n.height&&n.height.indexOf("%")<0&&"auto"!==n.height?_e(e.height,s.height):e.height}:e})({width:p||0,height:m||0},this.elementRef,this.parentStyle);p=p?e.width:p,m=m?e.height:m}const v={};if(void 0!==p){const e="string"===typeof p?p:`${p}px`;v.width={value:e},this.finalSize.width=e}if(void 0!==m){const e="string"===typeof m?m:`${m}px`;v.height={value:e},this.finalSize.height=e}Object.keys(v).length&&this.nodeStyleManagmentFlow.setMultipleStylesByKeyForCurrentBreakpoint({nodeIds:[this.selectedNode],styleMap:v}),this.nodeStyle.flexGrow&&this.nodeStyleManagmentFlow.removeStyleByKeyBasedOnCurrentBreakpoint({nodeIds:[this.selectedNode],key:"flexGrow"}),this.nodeStyle.flex&&("row"===this.parentStyle.flexDirection&&this.cursor.style.includes("ew")||"column"===this.parentStyle.flexDirection&&this.cursor.style.includes("ns"))&&this.nodeStyleManagmentFlow.removeStyleByKeyBasedOnCurrentBreakpoint({nodeIds:[this.selectedNode],key:"flex"})}attach(){document.addEventListener("resize-handle:mousedown",this.handleMouseDown),document.addEventListener("resize-handle:dblclick",this.handleDoubleClick),document.addEventListener("mousemove",this.handleEventMouseMove),document.addEventListener("mouseup",this.handleMouseUp),this.unsubs=[...(0,z.un)({target:window,types:["mousemove"],callback:e=>this.handleIframeMouseMove(e)}),...(0,z.un)({target:window,types:["mouseup"],callback:()=>this.handleMouseUp()})]}detach(){document.removeEventListener("resize-handle:mousedown",this.handleMouseDown),document.removeEventListener("resize-handle:dblclick",this.handleDoubleClick),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.unsubs.forEach((e=>e())),this.unsubs=[]}},Qe=(0,Z.Z)(qe.prototype,"projectDoc",[We],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),et=(0,Z.Z)(qe.prototype,"projectUIState",[He],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tt=(0,Z.Z)(qe.prototype,"nodeStyleManagmentFlow",[Ve],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nt=(0,Z.Z)(qe.prototype,"nodeManagementFlow",[Ge],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ot=(0,Z.Z)(qe.prototype,"nodeEditingFlow",[Ke],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),it=(0,Z.Z)(qe.prototype,"notificationsManagementFlow",[Ye],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),st=(0,Z.Z)(qe.prototype,"rtcFlow",[$e],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rt=(0,Z.Z)(qe.prototype,"elementRefProvider",[Je],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,Z.Z)(qe.prototype,"handleMouseMove",[Xe],Object.getOwnPropertyDescriptor(qe.prototype,"handleMouseMove"),qe.prototype),qe);var ut=n(39818),pt=n(78498),mt=n(29389),vt=n(54335),ft=n(98200),yt=n(96486);const It=(e,t,n,o)=>{const i=t.getBoundingClientRect(),s=(0,G.AO)(t),r=e.y,d=r+e.height,a=e.x,l=a+e.width,c=i.top*o*s+n.y,h=c+i.height*o*s,u=i.left*o*s+n.x,p=u+i.width*o*s;return d>c&&h>r&&l>u&&p>a&&!(r>c&&d<h&&a>u&&l<p)};var gt,bt,wt,St,Dt,Mt,Nt,Ct,Et;function Ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Tt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ot(Object(n),!0).forEach((function(t){(0,R.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let Rt=(gt=(0,A.f3)("projectDoc"),bt=(0,A.f3)("projectUIState"),wt=(0,A.f3)("nodeSelectionFlow"),St=(0,A.f3)("elementRefProvider"),Dt=class{constructor(){(0,T.Z)(this,"projectDoc",Mt,this),(0,T.Z)(this,"projectUIState",Nt,this),(0,T.Z)(this,"nodeSelectionFlow",Ct,this),(0,T.Z)(this,"elementRefProvider",Et,this),(0,R.Z)(this,"unsubs",[]),(0,R.Z)(this,"iframeBody",null),(0,R.Z)(this,"isMouseDown",!1),(0,R.Z)(this,"initPosition",{x:0,y:0}),(0,R.Z)(this,"initStagePosition",{x:0,y:0}),(0,R.Z)(this,"handleIframeMouseDown",(e=>{var t,n;const o=e.target,{nodeId:i,compInstanceId:s}=(0,ft.MT)({element:o})||{},r=i&&(null===(t=this.projectDoc.nodes.byId[i])||void 0===t?void 0:t.compIdOfRootNode)&&!s||"nodes-placeholder"===o.dataset.reference,{pressedKeys:d}=this.projectUIState.userInteractions;if(!d.ctrl&&!r)return;const a=this.projectUIState.stage.webComp.controlValues.scale,l=null===(n=this.elementRefProvider.getIframeRef())||void 0===n?void 0:n.current;if(!l)return;const c=l.getBoundingClientRect(),h={x:e.clientX*a+c.x,y:e.clientY*a+c.y};this.handleMouseDown(e,h,!0)})),(0,R.Z)(this,"handleMouseDown",((e,t,n)=>{const{userInteractions:{pressedKeys:o,resizeInProgress:i},layout:{mainPanel:s}}=this.projectUIState;1!==e.which||o.space||i||e.defaultPrevented&&!n||s===X.iW.CODEVIEW||e.target.closest(`.${vt.h}`)||!n&&!e.target.closest(".stage")||(this.isMouseDown=!0,this.initPosition=t||{x:e.clientX,y:e.clientY},this.initStagePosition={x:this.projectUIState.stage.webComp.controlValues.x,y:this.projectUIState.stage.webComp.controlValues.y},(0,U.JG)(this.projectUIState,(e=>{e.selection.dragSelection=Tt(Tt({},this.initPosition),{},{width:0,height:0,nodes:[]})})))})),(0,R.Z)(this,"handleIframeMouseMove",(e=>{this.handleMouseMove(e,!0)})),(0,R.Z)(this,"handleMouseMove",(0,yt.throttle)(((e,t)=>{var n;if(!this.isMouseDown)return;const o=this.projectUIState.selection.dragSelection;if(!o)return;const{webComp:i}=this.projectUIState.stage,s=i.controlValues.scale,r=Math.max(i.stateValues.stageBox.width,i.stateValues.contentBox.width),d=Math.max(i.stateValues.stageBox.height,i.stateValues.contentBox.height),a=(i.controlValues.x-this.initStagePosition.x)*r,l=(i.controlValues.y-this.initStagePosition.y)*d,c=e.deltaY||0;let h=this.initPosition.x+a,u=this.initPosition.y+l,p=e.x,m=e.y+c;if(t){var v;const t=null===(v=this.elementRefProvider.getIframeRef())||void 0===v?void 0:v.current;if(!t)return;const n=t.getBoundingClientRect();p=e.x*s+n.x,m=e.y*s+n.y+c}h>p&&([h,p]=[p,h]),u>m&&([u,m]=[m,u]);const f=Math.round(p-h),y=Math.round(m-u),I=(null===(n=this.getSelectedNodes(o,s))||void 0===n?void 0:n.filter((e=>e)))||[];(0,U.JG)(this.projectUIState,(e=>{e.selection.dragSelection={x:h,y:u,width:f,height:y,nodes:I}}))}),mt.x1.SIXTY)),(0,R.Z)(this,"handleMouseUp",(()=>{var e,t,n;if(!this.isMouseDown)return;this.isMouseDown=!1;const o=this.projectUIState.selection.dragSelection;if(!o)return;(0,U.JG)(this.projectUIState,(e=>{e.selection.dragSelection=null}));const i=o.nodes;i&&(1!==(null===i||void 0===i?void 0:i.length)?(this.nodeSelectionFlow.setMultipleNodesSelection(i),null===(e=this.elementRefProvider.getIframeRef())||void 0===e||null===(t=e.current)||void 0===t||null===(n=t.contentWindow)||void 0===n||n.focus()):this.nodeSelectionFlow.setNodeSelection({nodeId:i[0]}))})),(0,R.Z)(this,"getSelectedNodes",((e,t)=>{var n,o,i;const s=null===(n=this.iframeBody)||void 0===n||null===(o=n.querySelectorAll('[data-reference="nodes-placeholder"]'))||void 0===o?void 0:o[0],r=null===(i=this.elementRefProvider.getIframeRef())||void 0===i?void 0:i.current;if(!r)return;const d=r.getBoundingClientRect();if(!s||!e)return;const a=s.children[0],l=[...a.children],c=[];for(;l.length;){const n=l.pop();if(n){if(n.nodeName!==_.rC.toUpperCase()&&It(e,n,d,t)){const{nodeId:e,compInstanceId:t}=(0,ft.MT)({element:n})||{},o=t||e;if(!o||-1!==c.indexOf(o))continue;c.push(o)}l.push(...n.children)}}if(c.length)return c;if(It(e,a,d,t)){return[a.getAttribute("data-node-id")]}})),(0,R.Z)(this,"handleMouseWheel",((e,t)=>{setTimeout((()=>{this.handleMouseMove(e,t)}),mt.x1.SIXTY)})),(0,R.Z)(this,"handleIframeMouseWheel",(e=>{this.handleMouseWheel(e,!0)}))}attach(e){e&&(this.iframeBody=e),document.addEventListener("mousedown",this.handleMouseDown),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp),this.unsubs=[...(0,z.un)({target:window,types:["mousedown"],callback:e=>this.handleIframeMouseDown(e)}),...(0,z.un)({target:window,types:["mousemove"],callback:e=>this.handleIframeMouseMove(e)}),...(0,z.un)({target:window,types:["wheel"],callback:e=>this.handleIframeMouseWheel(e)}),...(0,z.un)({target:window,types:["mouseup"],callback:()=>this.handleMouseUp()})]}detach(){document.removeEventListener("mousedown",this.handleMouseDown),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.unsubs.forEach((e=>e())),this.unsubs=[]}},Mt=(0,Z.Z)(Dt.prototype,"projectDoc",[gt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Nt=(0,Z.Z)(Dt.prototype,"projectUIState",[bt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ct=(0,Z.Z)(Dt.prototype,"nodeSelectionFlow",[wt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Et=(0,Z.Z)(Dt.prototype,"elementRefProvider",[St],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dt);const jt=e=>{const{valueTop:t,valueLeft:n,valueBottom:o,valueRight:i}=(e=>{const{increaseBy:{x:t,y:n}={x:1,y:1},position:{x:o,y:i},cursorInfo:{style:s,revert:r}={style:Ue.or.CURSOR.NWSE,revert:""},initPosition:{x:d,y:a},initValues:{top:l,left:c,bottom:h,right:u},inIframe:p,scale:m,resizeType:v}=e,f="0"!==l?l:"0px",y="0"!==c?c:"0px",I="0"!==h?h:"0px",g="0"!==u?u:"0px";let b=r===Ue.sF.b.EW||r===Ue.sF.b.NWSE?-1:1,w=r===Ue.sF.b.NS||r===Ue.sF.b.NWSE?-1:1;"padding"===v&&(b*=-1,w*=-1);const S=p?o-d:(o-d)/m,D=p?i-a:(i-a)/m;let M=parseInt(l||"0"),N=parseInt(c||"0"),C=parseInt(h||"0"),E=parseInt(u||"0");return s===ct.CURSOR.EW?r===Ue.sF.b.EW?(N=Math.round(parseInt(y)+S*b*t),N=Math.max(N,0)):(E=Math.round(parseInt(g)+S*b*t),E=Math.max(E,0)):s===ct.CURSOR.NS&&(r===Ue.sF.b.NS?(M=Math.round(parseInt(f)+D*w*n),M=Math.max(M,0)):(C=Math.round(parseInt(I)+D*w*n),C=Math.max(C,0))),{valueTop:M>=0?M:l,valueLeft:N>=0?N:c,valueBottom:C>=0?C:h,valueRight:E>=0?E:u}})(e);return{valueTop:t,valueLeft:n,valueBottom:o,valueRight:i}},Ft=(e,t,n,o)=>{let i;for(const s of t.getClassesUsedByNodes([n]).reverse())if(i=e.classes.byId[s].content[o],void 0!==i)break;return!!i&&i.content};var Zt,xt,Pt,kt,At,Ut,Lt,zt,Bt,_t,Wt,Ht,Vt,Gt,Kt,Yt,$t,Jt,Xt,qt=n(7446);let Qt=(Zt=(0,A.f3)("projectDoc"),xt=(0,A.f3)("projectUIState"),Pt=(0,A.f3)("nodeStyleManagmentFlow"),kt=(0,A.f3)("projectClassManagementFlow"),At=(0,A.f3)("nodeManagementFlow"),Ut=(0,A.f3)("nodeEditingFlow"),Lt=(0,A.f3)("notificationsManagementFlow"),zt=(0,A.f3)("rtcFlow"),Bt=(0,A.f3)("elementRefProvider"),_t=class{constructor(e){(0,T.Z)(this,"projectDoc",Wt,this),(0,T.Z)(this,"projectUIState",Ht,this),(0,T.Z)(this,"nodeStyleManagmentFlow",Vt,this),(0,T.Z)(this,"projectClassManagementFlow",Gt,this),(0,T.Z)(this,"nodeManagementFlow",Kt,this),(0,T.Z)(this,"nodeEditingFlow",Yt,this),(0,T.Z)(this,"notificationsManagementFlow",$t,this),(0,T.Z)(this,"rtcFlow",Jt,this),(0,T.Z)(this,"elementRefProvider",Xt,this),(0,R.Z)(this,"unsubs",[]),(0,R.Z)(this,"resizeType",void 0),(0,R.Z)(this,"isMouseDown",!1),(0,R.Z)(this,"selectedNode",""),(0,R.Z)(this,"nodeStyle",{}),(0,R.Z)(this,"parentStyle",{}),(0,R.Z)(this,"nodeType",null),(0,R.Z)(this,"cursor",{style:"",revert:""}),(0,R.Z)(this,"initPosition",{x:0,y:0}),(0,R.Z)(this,"initValues",{top:"0px",left:"0px",bottom:"0px",right:"0px"}),(0,R.Z)(this,"elementRef",null),(0,R.Z)(this,"finalValues",{top:"0",left:"0",bottom:"0",right:"0"}),(0,R.Z)(this,"iframeRect",null),(0,R.Z)(this,"spaceTokens",[]),(0,R.Z)(this,"tokensDict",{}),(0,R.Z)(this,"directions",["top","left","bottom","right"]),(0,R.Z)(this,"marginPaddingDirections",void 0),(0,R.Z)(this,"currentDirection",""),(0,R.Z)(this,"distanceIndicator",null),(0,R.Z)(this,"setInitSpaceTokens",(()=>{this.spaceTokens=this.projectDoc.designLanguage.getTokensByTokenType(qt.i.SPACE),this.spaceTokens.forEach((e=>{if(e.value.includes("px")){const t=parseInt(e.value);let n=this.projectUIState.stage.webComp.controlValues.scale;n=n<1?2:1;for(let o=Math.round(t-1*n);o<=Math.round(t+1*n);o++)this.tokensDict[o]={id:e.id,name:e.name,value:e.value}}}))})),(0,R.Z)(this,"setDistanceIndicators",(()=>{if(this.distanceIndicator){this.cursor.style===ct.CURSOR.EW?this.cursor.revert===Ue.sF.b.EW?(this.currentDirection="left",this.distanceIndicator.left=document.getElementById("left-"+this.resizeType+"-distance-indicator"),this.distanceIndicator.left.style.display="block"):(this.currentDirection="right",this.distanceIndicator.right=document.getElementById("right-"+this.resizeType+"-distance-indicator"),this.distanceIndicator.right.style.display="block"):this.cursor.style===ct.CURSOR.NS&&(this.cursor.revert===Ue.sF.b.NS?(this.currentDirection="top",this.distanceIndicator.top=document.getElementById("top-"+this.resizeType+"-distance-indicator"),this.distanceIndicator.top.style.display="block"):(this.currentDirection="bottom",this.distanceIndicator.bottom=document.getElementById("bottom-"+this.resizeType+"-distance-indicator"),this.distanceIndicator.bottom.style.display="block"));for(let e=0;e<4;e++)this.distanceIndicator[this.directions[e]]&&(this.distanceIndicator[this.directions[e]].innerHTML=this.initValues[this.directions[e]])}})),(0,R.Z)(this,"setInitMarginPaddingFromClasses",(()=>{for(let e=0;e<4;e++){const t=Ft(this.projectDoc,this.projectClassManagementFlow,this.selectedNode,this.marginPaddingDirections[e]);if(t)if("string"===typeof t)this.initValues[this.directions[e]]=t,this.distanceIndicator&&this.distanceIndicator[this.directions[e]]&&(this.distanceIndicator[this.directions[e]].innerHTML=t);else{const n=this.projectDoc.designLanguage.tokensById[t.id].value;if(this.initValues[this.directions[e]]=n,this.distanceIndicator&&this.distanceIndicator[this.directions[e]]){const t=this.tokensDict[parseInt(n)];this.distanceIndicator[this.directions[e]].innerHTML=`${t.name} - ${t.value}`}}}})),(0,R.Z)(this,"setInitMarginPadding",(()=>{if(this.nodeStyle.hasOwnProperty(this.resizeType)){var e;const t=(null===(e=this.spaceTokens.find((e=>e.name===this.nodeStyle[this.resizeType])))||void 0===e?void 0:e.value)||this.nodeStyle[this.resizeType]||"0px";for(let e=0;e<4;e++)this.directions[e]===this.currentDirection&&(this.nodeStyle.hasOwnProperty(this.marginPaddingDirections[e])||(this.initValues[this.directions[e]]=t,this.nodeStyleManagmentFlow.setStyleByKeyBasedOnCurrentBreakpoint({nodeIds:[this.selectedNode],key:this.marginPaddingDirections[e],value:t}),this.distanceIndicator&&this.distanceIndicator[this.directions[e]]&&(this.distanceIndicator[this.directions[e]].innerHTML=this.initValues[this.directions[e]])))}if(this.nodeStyle.hasOwnProperty(this.resizeType+"Top")||this.nodeStyle.hasOwnProperty(this.resizeType+"Left")||this.nodeStyle.hasOwnProperty(this.resizeType+"Bottom")||this.nodeStyle.hasOwnProperty(this.resizeType+"Right"))for(let n=0;n<4;n++)if(this.nodeStyle[this.marginPaddingDirections[n]]){var t;const e=(null===(t=this.spaceTokens.find((e=>e.name===this.nodeStyle[this.marginPaddingDirections[n]])))||void 0===t?void 0:t.value)||this.nodeStyle[this.marginPaddingDirections[n]];if(this.initValues[this.directions[n]]=e,this.distanceIndicator&&this.distanceIndicator[this.directions[n]]){const t=this.tokensDict[parseInt(e)];this.distanceIndicator[this.directions[n]].innerHTML=t?`${t.name} - ${t.value}`:e}}})),(0,R.Z)(this,"handleMouseDown",(e=>{var t,n;const o=e,i=o.detail.eventTarget;if(!i)return;if(this.selectedNode=Object.keys(this.projectUIState.selection.nodes)[0],!this.selectedNode)return;const s=null===(t=this.elementRefProvider.getIframeRef())||void 0===t?void 0:t.current,r=this.projectUIState.selection.compInstanceId;if(!s)return;if(this.elementRef=this.elementRefProvider.getDomNodeElementRefByCompInstance(this.selectedNode,r)||null,this.iframeRect=s.getBoundingClientRect(),!this.elementRef)return;const d=this.projectDoc.nodes.byId[this.selectedNode];if(!d)return;this.nodeManagementFlow.beginLocalWork([this.selectedNode]),this.rtcFlow.lockEditedNodes([this.selectedNode]),this.nodeStyle=this.nodeStyleManagmentFlow.getResolvedStylesBasedOnCurrentBreakpoint({nodeId:this.selectedNode}),this.nodeType=(null===(n=this.projectDoc.nodes.byId[this.selectedNode])||void 0===n?void 0:n.primitiveType)||null;const a=d.parentId;this.parentStyle=a?this.nodeStyleManagmentFlow.getResolvedStylesBasedOnCurrentBreakpoint({nodeId:a}):{},this.cursor.style=i.dataset.resizeDirection||"",this.cursor.revert=i.dataset.revert||"",this.initPosition=o.detail.position,this.initValues={top:"0px",left:"0px",bottom:"0px",right:"0px"},this.setInitSpaceTokens(),this.setDistanceIndicators(),this.setInitMarginPaddingFromClasses(),this.setInitMarginPadding(),this.isMouseDown=!0,(0,U.JG)(this.projectUIState,(e=>{e.userInteractions.resizeInProgress=!0,e.userInteractions.cursorProperty=this.cursor.style===ct.CURSOR.NS?'url("static/cursors/'+this.resizeType+'-ns.svg") 5 10, ns-resize':'url("static/cursors/'+this.resizeType+'-ew.svg") 10 5, ew-resize'}))})),(0,R.Z)(this,"handleDoubleClick",(e=>{if(!e.detail.eventTarget)return;this.selectedNode=Object.keys(this.projectUIState.selection.nodes)[0];const t=this.projectUIState.selection.compInstanceId;if(!this.selectedNode)return;if(this.elementRef=this.elementRefProvider.getDomNodeElementRefByCompInstance(this.selectedNode,t)||null,!this.elementRef)return;const n=this.projectDoc.nodes.byId[this.selectedNode];n&&("padding"!==this.resizeType||!(0,G.xK)(n)&&n.primitiveType!==K.sO.HTML_NODE||(this.nodeEditingFlow.beginEditingNode(n.id),this.elementRef.focus()))})),(0,R.Z)(this,"handleIframeMouseMove",(e=>{this.handleMouseMove(e,!0)})),(0,R.Z)(this,"handleMouseMove",((e,t)=>{if(!this.isMouseDown||!this.elementRef||!this.selectedNode||!this.iframeRect)return;const{stage:n}=this.projectUIState,o=n.webComp.controlValues.scale,i=n.getCurrentWidth(),s=(0,G.AO)(this.elementRef),r=(0,G.d$)(this.elementRef);let d=this.initPosition;t&&(d={x:Math.abs((this.initPosition.x-this.iframeRect.x)/o),y:Math.abs((this.initPosition.y-this.iframeRect.y)/o)}),this.cursor.revert=ze({cursor:this.cursor,elementRef:this.elementRef});const a={initPosition:d,stageWidth:i,scale:o,inIframe:t,initValues:this.initValues,cursorInfo:this.cursor,position:{x:e.x,y:e.y},increaseBy:{x:1/s/r.x,y:1/s/r.y},resizeType:this.resizeType},l=jt(a),c=[l.valueTop,l.valueLeft,l.valueBottom,l.valueRight];for(let h=0;h<4;h++){if(this.directions[h]!==this.currentDirection)continue;const e="string"===typeof c[h]?c[h]:`${c[h]}px`;if(this.tokensDict[parseInt(e)]){if(this.nodeStyleManagmentFlow.setStyleByKeyBasedOnCurrentBreakpoint({doc:this.projectDoc,nodeIds:[this.selectedNode],key:this.marginPaddingDirections[h],value:e,tokenId:this.tokensDict[parseInt(e)].id}),this.finalValues[this.directions[h]]=e,this.distanceIndicator&&this.distanceIndicator[this.directions[h]]){const t=this.tokensDict[parseInt(e)];this.distanceIndicator[this.directions[h]].innerHTML=`${t.name} - ${t.value}`}}else this.nodeStyleManagmentFlow.setStyleByKeyBasedOnCurrentBreakpoint({nodeIds:[this.selectedNode],key:this.marginPaddingDirections[h],value:e}),this.finalValues[this.directions[h]]=e,this.distanceIndicator&&this.distanceIndicator[this.directions[h]]&&(this.distanceIndicator[this.directions[h]].innerHTML=this.finalValues[this.directions[h]])}})),(0,R.Z)(this,"handleMouseUp",(()=>{if(this.isMouseDown&&this.selectedNode){for(let e=0;e<4;e++)this.distanceIndicator&&this.distanceIndicator[this.directions[e]]&&(this.distanceIndicator[this.directions[e]].style.display="none");this.nodeStyle.hasOwnProperty(this.resizeType+"Top")&&this.nodeStyle.hasOwnProperty(this.resizeType+"Left")&&this.nodeStyle.hasOwnProperty(this.resizeType+"Bottom")&&this.nodeStyle.hasOwnProperty(this.resizeType+"Right")&&this.nodeStyle.hasOwnProperty(this.resizeType)&&this.nodeStyleManagmentFlow.removeStyleByKey({nodeIds:[this.selectedNode],key:this.resizeType});for(let e=0;e<4;e++)if("0px"===this.finalValues[this.directions[e]]&&!Ft(this.projectDoc,this.projectClassManagementFlow,this.selectedNode,this.marginPaddingDirections[e])&&!Ft(this.projectDoc,this.projectClassManagementFlow,this.selectedNode,this.resizeType)){if(this.nodeStyle.hasOwnProperty(this.resizeType)){for(let e=0;e<4;e++){const t=this.spaceTokens.find((e=>e.name===this.nodeStyle[this.resizeType]));t?this.nodeStyleManagmentFlow.setStyleByKeyBasedOnCurrentBreakpoint({doc:this.projectDoc,nodeIds:[this.selectedNode],key:this.marginPaddingDirections[e],value:t.value,tokenId:t.id}):this.nodeStyleManagmentFlow.setStyleByKeyBasedOnCurrentBreakpoint({nodeIds:[this.selectedNode],key:this.marginPaddingDirections[e],value:this.nodeStyle[this.resizeType]})}this.nodeStyleManagmentFlow.removeStyleByKey({nodeIds:[this.selectedNode],key:this.resizeType})}this.nodeStyleManagmentFlow.removeStyleByKey({nodeIds:[this.selectedNode],key:this.marginPaddingDirections[e]})}(0,U.JG)(this.projectUIState,(e=>{e.userInteractions.resizeInProgress=!1,e.userInteractions.cursorProperty="auto"})),this.isMouseDown=!1,this.nodeManagementFlow.commitLocalWork(),this.rtcFlow.unlockEditedNodes(),this.finalValues={top:"0",left:"0",bottom:"0",right:"0"}}})),this.resizeType=e,this.distanceIndicator={};for(let t=0;t<4;t++)this.distanceIndicator[this.directions[t]]=document.getElementById(this.directions[t]+"-"+this.resizeType+"-distance-indicator");this.marginPaddingDirections=[this.resizeType+"Top",this.resizeType+"Left",this.resizeType+"Bottom",this.resizeType+"Right"]}attach(){document.addEventListener(this.resizeType+"-handle:mousedown",this.handleMouseDown),document.addEventListener(this.resizeType+"-handle:dblclick",this.handleDoubleClick),document.addEventListener("mousemove",this.handleMouseMove),document.addEventListener("mouseup",this.handleMouseUp),this.unsubs=[...(0,z.un)({target:window,types:["mousemove"],callback:e=>this.handleIframeMouseMove(e)}),...(0,z.un)({target:window,types:["mouseup"],callback:()=>this.handleMouseUp()})]}detach(){document.removeEventListener(this.resizeType+"-handle:mousedown",this.handleMouseDown),document.removeEventListener(this.resizeType+"-handle:dblclick",this.handleDoubleClick),document.removeEventListener("mousemove",this.handleMouseMove),document.removeEventListener("mouseup",this.handleMouseUp),this.unsubs.forEach((e=>e())),this.unsubs=[]}},Wt=(0,Z.Z)(_t.prototype,"projectDoc",[Zt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ht=(0,Z.Z)(_t.prototype,"projectUIState",[xt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vt=(0,Z.Z)(_t.prototype,"nodeStyleManagmentFlow",[Pt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Gt=(0,Z.Z)(_t.prototype,"projectClassManagementFlow",[kt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kt=(0,Z.Z)(_t.prototype,"nodeManagementFlow",[At],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yt=(0,Z.Z)(_t.prototype,"nodeEditingFlow",[Ut],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$t=(0,Z.Z)(_t.prototype,"notificationsManagementFlow",[Lt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jt=(0,Z.Z)(_t.prototype,"rtcFlow",[zt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xt=(0,Z.Z)(_t.prototype,"elementRefProvider",[Bt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_t);var en,tn,nn,on,sn;let rn=(en=(0,A.f3)("projectUIState"),on=new WeakMap,sn=new WeakMap,tn=class{constructor(){(0,T.Z)(this,"projectUIState",nn,this),on.set(this,{writable:!0,value:null}),sn.set(this,{writable:!0,value:!1}),(0,R.Z)(this,"handleContextSwitch",(()=>{(0,U.JG)(this.projectUIState,(e=>{e.userInteractions.pressedKeys={}}))})),(0,R.Z)(this,"handleFocus",(()=>{(0,j.Z)(this,sn,!0)})),(0,R.Z)(this,"handleBlur",(()=>{(0,j.Z)(this,sn,!1),setTimeout((()=>{(0,F.Z)(this,sn)||this.handleContextSwitch()}),200)}))}attach(e=null){e&&(0,j.Z)(this,on,e.contentWindow),document.addEventListener("visibilitychange",this.handleContextSwitch,!1),document.addEventListener("blur",this.handleContextSwitch),window.addEventListener("focus",this.handleFocus),window.addEventListener("blur",this.handleBlur),(0,F.Z)(this,on)&&((0,F.Z)(this,on).addEventListener("focus",this.handleFocus),(0,F.Z)(this,on).addEventListener("blur",this.handleBlur))}detach(){document.removeEventListener("visibilitychange",this.handleContextSwitch,!1),document.removeEventListener("focus",this.handleContextSwitch),window.removeEventListener("focus",this.handleFocus),window.removeEventListener("blur",this.handleBlur),(0,F.Z)(this,on)&&((0,F.Z)(this,on).removeEventListener("focus",this.handleFocus),(0,F.Z)(this,on).removeEventListener("blur",this.handleBlur))}},nn=(0,Z.Z)(tn.prototype,"projectUIState",[en],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tn);var dn,an,ln,cn,hn,un,pn,mn,vn,fn,yn;let In=(dn=(0,A.f3)("projectUIState"),an=(0,A.f3)("elementRefProvider"),ln=(0,A.f3)("notificationsManagementFlow"),cn=(0,A.f3)("projectDoc"),fn=new WeakMap,yn=new WeakMap,hn=class extends L.PureComponent{constructor(e){super(e),(0,R.Z)(this,"nodeInstanceContextualMenu",null),(0,R.Z)(this,"nodeInstancePointerSensor",null),(0,R.Z)(this,"nodeInstanceHoverAndSelect",null),(0,R.Z)(this,"linksInPreviewSensor",null),(0,R.Z)(this,"nodeInstanceDoubleClickSensor",null),(0,R.Z)(this,"nodeInstanceResize",null),(0,R.Z)(this,"nodeInstanceMarginResize",null),(0,R.Z)(this,"nodeInstancePaddingResize",null),(0,R.Z)(this,"nodeDragSelection",null),(0,R.Z)(this,"nodeHierarchyKeyboardShorcutsSensor",null),(0,R.Z)(this,"globalKeyboardShortcuts",null),(0,R.Z)(this,"globalKeyboardModifiers",null),(0,R.Z)(this,"resizeObserver",null),(0,R.Z)(this,"contextSwitchSensor",null),(0,T.Z)(this,"projectUIState",un,this),(0,T.Z)(this,"elementRefProvider",pn,this),(0,T.Z)(this,"notificationsManagementFlow",mn,this),(0,T.Z)(this,"projectDoc",vn,this),(0,R.Z)(this,"iframeRef",(0,L.createRef)()),(0,R.Z)(this,"mainRootDOMNode",null),fn.set(this,{writable:!0,value:[]}),yn.set(this,{writable:!0,value:[]}),(0,R.Z)(this,"state",{internalHeight:0,internalWidth:0}),(0,R.Z)(this,"uidlRenderer",new oe),(0,R.Z)(this,"startRenderer",(()=>{var e,t,n,o,i,s;this.uidlRenderer.detach(),this.uidlRenderer.init({rootHead:null===(e=this.iframeRef.current)||void 0===e||null===(t=e.contentDocument)||void 0===t?void 0:t.head,rootNode:null===(n=this.iframeRef.current)||void 0===n||null===(o=n.contentDocument)||void 0===o?void 0:o.body.children[0],styleRootNode:null===(i=this.iframeRef.current)||void 0===i||null===(s=i.contentDocument)||void 0===s?void 0:s.body.children[1],renderingMode:this.props.renderingMode}),this.uidlRenderer.attach()})),(0,R.Z)(this,"handleFrameContentResize",k()((e=>{this.setState({internalHeight:e.height,internalWidth:e.width})}),10)),(0,R.Z)(this,"updateIframeHead",(()=>{const e=this.iframeRef.current;if(null===e||void 0===e||!e.contentDocument||!this.projectDoc.settings.code)return;const{headTag:t,bodyTag:n}=this.projectDoc.settings.code;if(t&&(e.contentDocument.head.innerHTML+=`${t}`),null!==n&&void 0!==n&&n.includes("data-section-id")){var o;const t=document.createElement("script");t.src="https://unpkg.com/@teleporthq/teleport-custom-scripts",t.type="text/javascript",null===(o=e.contentDocument)||void 0===o||o.body.appendChild(t)}}))}componentDidMount(){-1===navigator.userAgent.indexOf("Firefox")&&this.onIFrameMount();const e=(0,U.Ys)(this.projectUIState,["selection/componentId"],(({selection:e})=>{e.componentId&&this.uidlRenderer.refreshComponent(e.componentId)}),"StageContentFrameWrapper");(0,F.Z)(this,fn).push((()=>{e.dispose()}))}onIFrameMount(){var e,t;this.elementRefProvider.setIframeRef(this.iframeRef);const n=this.iframeRef.current;this.mainRootDOMNode=document.createElement("div"),this.mainRootDOMNode.dataset.reference="nodes-placeholder";const o=document.createElement("span");o.dataset.reference="styles-placeholder",this.elementRefProvider.setIframeRoot(this.mainRootDOMNode),this.elementRefProvider.setIframeStyleRoot(o),null===(e=n.contentDocument)||void 0===e||e.body.appendChild(this.mainRootDOMNode),null===(t=n.contentDocument)||void 0===t||t.body.appendChild(o),this.resizeObserver=((e,t)=>{const n=new ResizeObserver((e=>{if(e.length>1)throw new Error("This senzor was designed to work with only one element");window.requestAnimationFrame((()=>{t(e[0].contentRect,e[0].contentBoxSize)}))}));return n.observe(e),()=>{n.disconnect()}})(n.contentDocument.body.children[0],this.handleFrameContentResize),(0,j.Z)(this,fn,(0,z.Cr)({source:n.contentDocument,target:n,types:["click","touchmove","mousedown","mousemove","mouseup","touchend","mouseleave","contextmenu","gesturestart","gestureend","gesturechange"]})),(0,F.Z)(this,fn).push((0,z.kb)({source:n.contentDocument,target:n,type:"wheel",eventParams:{passive:!1}}));const i=e=>{const{deltaX:t,deltaY:n,target:o,ctrlKey:i}=e;i&&!e.defaultPrevented&&e.preventDefault();let s=o;const r=e.shiftKey?n:t,d=e.shiftKey?t:n;for(;s;){const{overflowX:t,overflowY:n}=window.getComputedStyle(s),o=s.scrollHeight!==s.offsetHeight&&("scroll"===n||"auto"===n),i=s.scrollWidth!==s.offsetWidth&&("scroll"===t||"auto"===t);if(o&&0!==d){const t=s.offsetHeight-s.clientHeight,n=s.scrollTop+d,o=Math.round(Math.min(Math.max(0,n),s.scrollHeight-s.offsetHeight+t));if(o!==Math.ceil(s.scrollTop)&&o!==Math.floor(s.scrollTop))return void e.stopImmediatePropagation()}if(i&&0!==r){const t=s.offsetWidth-s.clientWidth,n=s.scrollLeft+r,o=Math.round(Math.min(Math.max(0,n),s.scrollWidth-s.offsetWidth+t));if(o!==Math.ceil(s.scrollLeft)&&o!==Math.floor(s.scrollLeft))return void e.stopImmediatePropagation()}s=s.parentElement}},s=n.contentDocument.body;s.addEventListener("wheel",i,{passive:!1}),(0,F.Z)(this,yn).push({name:"wheel",func:i});const r=()=>{const e=new CustomEvent("custom:mouseup");document.dispatchEvent(e)};s.addEventListener("mouseup",r,{passive:!1}),(0,F.Z)(this,yn).push({name:"mouseup",func:r}),(0,F.Z)(this,yn).push({name:"mousemove",func:e=>{const t=new CustomEvent("custom:mousemove",{detail:{width:e.screenX,x:e.clientX}});document.dispatchEvent(t)}});try{this.startRenderer()}catch(d){this.notificationsManagementFlow.handleErrorAndLogToSentry(d)}"preview"===this.props.renderingMode&&(this.linksInPreviewSensor=new ke,this.linksInPreviewSensor.attach(s),this.updateIframeHead()),"stage"===this.props.renderingMode&&(this.nodeInstanceContextualMenu=new Ae.V,this.nodeInstancePointerSensor=new ve.T,this.nodeInstanceHoverAndSelect=new fe.s,this.nodeInstanceResize=new ht,this.nodeInstanceMarginResize=new Qt("margin"),this.nodeInstancePaddingResize=new Qt("padding"),this.nodeDragSelection=new Rt,this.nodeHierarchyKeyboardShorcutsSensor=new ye.U,this.globalKeyboardModifiers=new ut.i,this.globalKeyboardShortcuts=new pt.Q,this.nodeInstanceDoubleClickSensor=new Ie,this.contextSwitchSensor=new rn,this.globalKeyboardShortcuts.attach(n),this.globalKeyboardModifiers.attach(n),this.nodeInstanceDoubleClickSensor.attach(s),this.contextSwitchSensor.attach(n),this.nodeHierarchyKeyboardShorcutsSensor.attach(s),this.nodeInstancePointerSensor.attach(s),this.nodeInstanceHoverAndSelect.attach(s),this.nodeInstanceContextualMenu.attach(s),this.nodeDragSelection.attach(s),this.nodeInstanceResize.attach(),this.nodeInstanceMarginResize.attach(),this.nodeInstancePaddingResize.attach())}componentWillUnmount(){var e,t,n,o,i,s,r,d,a,l,c,h,u;(0,F.Z)(this,fn).forEach((e=>e())),(0,F.Z)(this,yn).forEach((e=>{var t,n;null===(t=this.iframeRef.current)||void 0===t||null===(n=t.contentDocument)||void 0===n||n.body.removeEventListener(e.name,e.func)})),null===(e=this.nodeInstanceDoubleClickSensor)||void 0===e||e.detach(),null===(t=this.nodeHierarchyKeyboardShorcutsSensor)||void 0===t||t.detach(),null===(n=this.linksInPreviewSensor)||void 0===n||n.detach(),null===(o=this.nodeInstancePointerSensor)||void 0===o||o.detach(),null===(i=this.nodeInstanceHoverAndSelect)||void 0===i||i.detach(),null===(s=this.nodeInstanceContextualMenu)||void 0===s||s.detach(),null===(r=this.nodeInstanceResize)||void 0===r||r.detach(),null===(d=this.nodeInstanceMarginResize)||void 0===d||d.detach(),null===(a=this.nodeInstancePaddingResize)||void 0===a||a.detach(),null===(l=this.nodeDragSelection)||void 0===l||l.detach(),null===(c=this.globalKeyboardModifiers)||void 0===c||c.detach(),null===(h=this.globalKeyboardShortcuts)||void 0===h||h.detach(),null===(u=this.contextSwitchSensor)||void 0===u||u.detach(),this.uidlRenderer.detach(),this.resizeObserver&&this.resizeObserver()}render(){return(0,De.jsxs)("div",{id:"frame-container",style:{width:this.props.width,height:"preview"===this.props.renderingMode?"100vh":this.state.internalHeight},className:"jsx-1524840290 frame-container",children:[(0,De.jsx)("iframe",{id:"stage-frame",onLoad:()=>{var e,t,n,o,i;null!==(e=this.iframeRef.current)&&void 0!==e&&e.contentDocument&&0===(null===(t=this.iframeRef.current)||void 0===t||null===(n=t.contentDocument)||void 0===n||null===(o=n.body)||void 0===o||null===(i=o.childNodes)||void 0===i?void 0:i.length)&&this.onIFrameMount()},scrolling:"preview"===this.props.renderingMode?"yes":"no",ref:this.iframeRef,className:"jsx-1524840290"}),(0,De.jsx)(x.default,{id:"1524840290",children:[".frame-container.jsx-1524840290{position:relative;}","iframe.jsx-1524840290{position:absolute;top:0;left:0;right:0;bottom:0;width:100%;height:100%;}"]})]})}},un=(0,Z.Z)(hn.prototype,"projectUIState",[dn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pn=(0,Z.Z)(hn.prototype,"elementRefProvider",[an],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mn=(0,Z.Z)(hn.prototype,"notificationsManagementFlow",[ln],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vn=(0,Z.Z)(hn.prototype,"projectDoc",[cn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hn)}}]);
